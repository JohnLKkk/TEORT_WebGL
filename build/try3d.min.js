!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Try3d=t():e.Try3d=t()}(self,(function(){return(()=>{"use strict";var __webpack_modules__={4755:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r;(r=n(3846))&&r.__esModule;function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._m_PathName=t,this._m_Keyframes=[],this._m_ActionTrack=null}var t,n,r;return t=e,(n=[{key:"getLength",value:function(){var e=-Number.MAX_VALUE;return this._m_Keyframes.forEach((function(t){e=Math.max(e,t.getTime())})),e==-Number.MAX_VALUE?0:e}},{key:"addKeyframe",value:function(e){this._m_Keyframes.push(e)}},{key:"getPathName",value:function(){return this._m_PathName}},{key:"setActionTrack",value:function(e){this._m_ActionTrack=e}},{key:"update",value:function(e){for(var t=0,n=null,r=this._m_Keyframes.length;t<r&&this._m_Keyframes[t].getTime()<e;)t++;if(0==t)n=this._m_Keyframes[t],this._m_ActionTrack.setValue(n.getValue());else if(t==r)t-=1,n=this._m_Keyframes[t],this._m_ActionTrack.setValue(n.getValue());else{var _=this._m_Keyframes[t-1],a=this._m_Keyframes[t],i=1/(a.getTime()-_.getTime());n=_.interpolation(_.getValue(),a.getValue(),(e-_.getTime())*i),this._m_ActionTrack.setValue(n)}}}])&&_(t.prototype,n),r&&_(t,r),e}();t.default=a},479:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,_=(r=n(3846))&&r.__esModule?r:{default:r};function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._m_Name=t,this._m_Time=0,this._m_TimeLength=0,this._m_Mode=e.S_LOOP,this._m_TimeMode=1,this._m_Processor=null,this._m_TrackMixer=null,this._m_State=e.S_STOP}var t,n,r;return t=e,(n=[{key:"setAnimationMode",value:function(e){}},{key:"_setProcessor",value:function(e){this._m_Processor=e}},{key:"getName",value:function(){return this._m_Name}},{key:"getAnimationLength",value:function(){return this._m_TimeLength}},{key:"setTrackMixer",value:function(e){var t=this;this._m_TrackMixer=e,this._m_Time=0,this._m_TimeLength=-Number.MAX_VALUE,e.getClips().forEach((function(e){t._m_TimeLength=Math.max(e.getLength(),t._m_TimeLength)})),this._m_TimeLength==-Number.MAX_VALUE&&(this._m_TimeLength=0),_.default.log("[["+this.getName()+"]]动画时长:"+this._m_TimeLength+"s")}},{key:"play",value:function(){this._m_State!=e.S_PLAY&&(this._m_Processor._activeAnimationAction(this),this._m_State=e.S_PLAY)}},{key:"pause",value:function(){this._m_State!=e.S_PAUSE&&(this._m_State==e.S_PLAY&&this._m_Processor._disableAnimationAction(this),this._m_State=e.S_PAUSE)}},{key:"stop",value:function(){this._m_State!=e.S_STOP&&(this._m_State==e.S_PLAY&&this._m_Processor._disableAnimationAction(this),this._m_State=e.S_STOP,this._m_Time=0)}},{key:"update",value:function(t){if(this._m_Time>=this._m_TimeLength){if(this._m_Mode==e.S_DONT_LOOP)return void(this._m_TimeMode=1);this._m_Mode==e.S_LOOP&&(this._m_Time=0,this._m_TimeMode=1),this._m_Mode==e.S_BACK_AND_FORTH&&(this._m_Time=this._m_TimeLength,this._m_TimeMode=-1)}this._m_Time+=t*this._m_TimeMode,this._m_TrackMixer.update(this._m_Time)}}])&&a(t.prototype,n),r&&a(t,r),e}();t.default=o,i(o,"S_LOOP",1),i(o,"S_DONT_LOOP",2),i(o,"S_BACK_AND_FORTH",3),i(o,"S_PLAY",1),i(o,"S_PAUSE",2),i(o,"S_STOP",4)},1648:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=a(n(9650));a(n(3846));function a(e){return e&&e.__esModule?e:{default:e}}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t){return o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},o(e,t)}function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=l(e);if(t){var _=l(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return s(this,n)}}function s(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}var f=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(a,e);var t,n,r,_=u(a);function a(e,t){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=_.call(this,e,t))._m_AnimationActions=[],n._m_AnimationActionMaps={},n._m_ActiveAnimationActions=[];var r=-1;return n._m_Scene.on("update",(function(e){if((r=n._m_ActiveAnimationActions.length)>0)for(var t=0;t<r;t++)n._m_ActiveAnimationActions[t].update(e)})),n}return t=a,(n=[{key:"getType",value:function(){return"AnimationProcessor"}},{key:"_activeAnimationAction",value:function(e){this._m_ActiveAnimationActions.push(e)}},{key:"_disableAnimationAction",value:function(e){var t=this._m_ActiveAnimationActions.indexOf(e);t>-1&&this._m_ActiveAnimationActions.splice(t,1)}},{key:"addAnimationAction",value:function(e){this._m_AnimationActionMaps[e.getName()]||(this._m_AnimationActionMaps[e.getName()]=e,this._m_AnimationActions.push(e),e._setProcessor(this))}},{key:"getAnimationAction",value:function(e){return this._m_AnimationActionMaps[e]}},{key:"getAnimationActionAtIndex",value:function(e){return e>=this._m_AnimationActions.length?null:this._m_AnimationActions[e]}},{key:"getAnimationActions",value:function(){return this._m_AnimationActions}}])&&i(t.prototype,n),r&&i(t,r),a}(_.default);t.default=f},9586:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}var _;function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=l(e)););return e}(e,t);if(r){var _=Object.getOwnPropertyDescriptor(r,t);return _.get?_.get.call(n):_.value}},i(e,t,n||e)}function o(e,t){return o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},o(e,t)}function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=l(e);if(t){var _=l(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return s(this,n)}}function s(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var f=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(s,e);var t,n,r,_=u(s);function s(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(n=_.call(this,e,t))._m_Bind=null,n}return t=s,(n=[{key:"getType",value:function(){return"Bone"}},{key:"bind",value:function(e){this._m_Bind=e}},{key:"getBind",value:function(){return this._m_Bind}},{key:"_updateLocalMatrix",value:function(){i(l(s.prototype),"_updateLocalMatrix",this).call(this),this._m_Bind&&this._m_Bind.actived()}}])&&a(t.prototype,n),r&&a(t,r),s}(((_=n(2949))&&_.__esModule?_:{default:_}).default);t.default=f},6458:(e,t)=>{function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._m_Time=t,this._m_Value=null,this._m_InterpolationMode=e.S_INTERPOLATION_MODE[e.S_LINEAR],this.interpolation=null}var t,r,_;return t=e,(r=[{key:"getTime",value:function(){return this._m_Time}},{key:"getValue",value:function(){return this._m_Value}},{key:"setInterpolationMode",value:function(t){this._m_InterpolationMode=e.S_INTERPOLATION_MODE[t]}}])&&n(t.prototype,r),_&&n(t,_),e}();t.default=_,r(_,"S_INTERPOLATION_MODE",{LINEAR:0}),r(_,"S_LINEAR","LINEAR")},7868:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(6454)),_=a(n(8081));function a(e){return e&&e.__esModule?e:{default:e}}var i,o,u,s=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)};t.default=s,i=s,o="S_KEY_FRAME",u={scale:r.default,rotation:_.default,translation:r.default},o in i?Object.defineProperty(i,o,{value:u,enumerable:!0,configurable:!0,writable:!0}):i[o]=u},8081:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=i(n(6458)),a=i(n(453));function i(e){return e&&e.__esModule?e:{default:e}}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=m(e)););return e}(e,t);if(r){var _=Object.getOwnPropertyDescriptor(r,t);return _.get?_.get.call(n):_.value}},u(e,t,n||e)}function s(e,t){return s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},s(e,t)}function l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m(e);if(t){var _=m(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return f(this,n)}}function f(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function m(e){return m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},m(e)}var c=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(f,e);var t,n,r,i=l(f);function f(e,t,n,r,_){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),(o=i.call(this,e))._m_Value=new a.default(t,n,r,_),o}return t=f,(n=[{key:"setInterpolationMode",value:function(e){u(m(f.prototype),"setInterpolationMode",this).call(this,e),e==_.default.S_LINEAR&&(this.interpolation=a.default.slerp)}}])&&o(t.prototype,n),r&&o(t,r),f}(_.default);t.default=c},6454:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=i(n(6458)),a=i(n(5604));i(n(3846));function i(e){return e&&e.__esModule?e:{default:e}}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=m(e)););return e}(e,t);if(r){var _=Object.getOwnPropertyDescriptor(r,t);return _.get?_.get.call(n):_.value}},u(e,t,n||e)}function s(e,t){return s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},s(e,t)}function l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m(e);if(t){var _=m(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return f(this,n)}}function f(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function m(e){return m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},m(e)}var c=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(f,e);var t,n,r,i=l(f);function f(e,t,n,r){var _;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),(_=i.call(this,e))._m_Value=new a.default(t,n,r),_}return t=f,(n=[{key:"setInterpolationMode",value:function(e){u(m(f.prototype),"setInterpolationMode",this).call(this,e),e==_.default.S_LINEAR&&(this.interpolation=a.default.inter)}}])&&o(t.prototype,n),r&&o(t,r),f}(_.default);t.default=c},2414:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=i(n(6458)),a=i(n(7141));function i(e){return e&&e.__esModule?e:{default:e}}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=m(e)););return e}(e,t);if(r){var _=Object.getOwnPropertyDescriptor(r,t);return _.get?_.get.call(n):_.value}},u(e,t,n||e)}function s(e,t){return s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},s(e,t)}function l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m(e);if(t){var _=m(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return f(this,n)}}function f(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function m(e){return m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},m(e)}var c=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(f,e);var t,n,r,i=l(f);function f(e,t,n,r,_){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),(o=i.call(this,e))._m_Value=new a.default(t,n,r,_),o}return t=f,(n=[{key:"setInterpolationMode",value:function(e){u(m(f.prototype),"setInterpolationMode",this).call(this,e),e==_.default.S_LINEAR&&(this.interpolation=a.default.inter)}}])&&o(t.prototype,n),r&&o(t,r),f}(_.default);t.default=c},1245:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,_=(r=n(3846))&&r.__esModule?r:{default:r};function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(t,n){switch(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._m_Node=t,this._m_Node||_.default.warn("node为null:"),this.setValue=null,this.getValue=null,n){case"rotation":this.setValue=function(e){t.setLocalRotation(e)},this.getValue=function(){return t.getLocalRotation()};break;case"translation":this.setValue=function(e){t.setLocalTranslation(e)},this.getValue=function(){return t.getLocalTranslation()};break;case"scale":this.setValue=function(e){t.setLocalScale(e)},this.getValue=function(){return t.getLocalScale()}}}var t,n,r;return t=e,r=[{key:"bind",value:function(t,n){return new e(t,n)}},{key:"createTrack",value:function(t,n){t.setActionTrack(e.bind(n,t.getPathName()))}}],(n=null)&&a(t.prototype,n),r&&a(t,r),e}();t.default=i},7938:(e,t)=>{function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._m_Clips=[]}var t,r,_;return t=e,(r=[{key:"addClip",value:function(e){this._m_Clips.push(e)}},{key:"getClip",value:function(e){return this._m_Clips[e]}},{key:"getClips",value:function(){return this._m_Clips}},{key:"update",value:function(e){this._m_Clips.forEach((function(t){t.update(e)}))}}])&&n(t.prototype,r),_&&n(t,_),e}();t.default=r},8649:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(2320)),_=a(n(3846));a(n(453)),a(n(431)),a(n(5397));function a(e){return e&&e.__esModule?e:{default:e}}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._m_OwnerSkeleton=null,this._m_Bone=null,this._m_Refs={},this._m_Id=t,this._m_Num=n,this._m_RelMat4=new r.default,this._m_JointMat4=new r.default,this._m_IsActive=!1}var t,n,a;return t=e,(n=[{key:"actived",value:function(){this._m_IsActive||(this._m_IsActive=!0,this._m_OwnerSkeleton.addActiveJoint(this))}},{key:"disable",value:function(){this._m_IsActive=!1}},{key:"addRef",value:function(e,t){this._m_Refs[e]?this._m_Refs[e]!=t&&_.default.warn("ref不等于最新ref:"+t):this._m_Refs[e]=t}},{key:"init",value:function(e,t){this.update(e,t)}},{key:"getId",value:function(){return this._m_Id}},{key:"getNum",value:function(){return this._m_Num}},{key:"setOwnerSkeleton",value:function(e){this._m_OwnerSkeleton=e}},{key:"link",value:function(e){e!=this._m_Bone&&e&&(this._m_Bone=e,this._m_Bone.bind(this))}},{key:"setJointSpace",value:function(e){this._m_RelMat4.setArray(e)}},{key:"getJointMat4",value:function(){return this._m_JointMat4}},{key:"update",value:function(e,t){this._m_Bone?(r.default.multiplyMM(this._m_JointMat4,0,this._m_Bone.getWorldMatrix(),0,this._m_RelMat4,0),e.uniformMatrix4fv(this._m_Refs[t],!1,this._m_JointMat4.getBufferData())):_.default.log("joint_"+this.getNum()+";id:"+this.getId()+"未关联Bone!")}}])&&i(t.prototype,n),a&&i(t,a),e}();t.default=o},1608:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(9784)),_=a(n(3846));function a(e){return e&&e.__esModule?e:{default:e}}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._m_Name=t,this._m_Joints=[],this._m_ActiveJoints=[],this._m_IsReady=!1,this._m_Finished=!0,this._m_OwnerShaders={}}var t,n,a;return t=e,(n=[{key:"init",value:function(e,t){this._m_IsReady||(this._m_IsReady=!0,this._m_Joints.forEach((function(n){n.setRef(t.m_LastSubShader.getRef(e,r.default.S_JOINTS_SRC+"["+n.getNum()+"]")),n.init(e)})))}},{key:"isReady",value:function(){return this._m_IsReady}},{key:"owner",value:function(e,t){return this._m_OwnerShaders[t.m_LastSubShader.getSId()]||(this._m_Joints.forEach((function(n){n.addRef(t.m_LastSubShader.getSId(),t.m_LastSubShader.getRef(e,r.default.S_JOINTS_SRC+"["+n.getNum()+"]")),n.init(e,t.m_LastSubShader.getSId())})),this._m_OwnerShaders[t.m_LastSubShader.getSId()]=!0,_.default.log("持有!")),!0}},{key:"isFinished",value:function(){return this._m_Finished}},{key:"finished",value:function(){this._m_Finished=!0}},{key:"getActiveJoints",value:function(){return this._m_ActiveJoints}},{key:"addActiveJoint",value:function(e){this._m_ActiveJoints.push(e)}},{key:"setJoints",value:function(e){var t=this;this._m_Joints.length=0,e.forEach((function(e){t._m_Joints.push(e),e.setOwnerSkeleton(t)}))}},{key:"getJoints",value:function(){return this._m_Joints}},{key:"addJointAtIndex",value:function(e,t){this._m_Joints[e]=t,t.setOwnerSkeleton(this)}},{key:"addJoint",value:function(e){this._m_Joints.push(e),e.setOwnerSkeleton(this)}},{key:"updateJoints",value:function(e,t){this._m_ActiveJoints.length>0&&(this._m_ActiveJoints.forEach((function(n){n.update(e,t.m_LastSubShader.getSId()),n.disable()})),this._m_ActiveJoints.length=0)}}])&&i(t.prototype,n),a&&i(t,a),e}();t.default=o},6858:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=s(n(4720)),a=s(n(9784)),i=s(n(2320)),o=s(n(2475)),u=s(n(3846));function s(e){return e&&e.__esModule?e:{default:e}}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t){return f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},f(e,t)}function m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=h(e);if(t){var _=h(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return c(this,n)}}function c(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function h(e){return h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},h(e)}var d=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(s,e);var t,n,r,_=m(s);function s(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(n=_.call(this,e,t))._m_Skeleton=null,n}return t=s,(n=[{key:"setSkeleton",value:function(e){this._m_Skeleton=e}},{key:"draw",value:function(e){var t=this._m_Scene.getCanvas().getGLContext();if(this._m_Skeleton){if(!this._m_Skeleton.isFinished())return;this._m_Skeleton.owner(t,e)||u.default.log("错误持有!"),this._m_Skeleton.updateJoints(t,e)}var n=e.m_LastSubShader.getContextVars(),r=null,_=null;for(var s in n)switch(s){case a.default.S_MODEL_MATRIX_SRC:t[n[s].fun](n[s].loc,!1,this.getWorldMatrix().getBufferData());break;case a.default.S_MV_SRC:r=e.getCalcContext(a.default.S_VIEW_MATRIX_SRC),i.default.multiplyMM(o.default.S_TEMP_MAT4,0,r,0,this.getWorldMatrix(),0),n[s].fun(n[s].loc,!1,o.default.S_TEMP_MAT4.getBufferData());break;case a.default.S_MVP_SRC:r=e.getCalcContext(a.default.S_VIEW_MATRIX_SRC),_=e.getCalcContext(a.default.S_PROJECT_MATRIX_SRC),i.default.multiplyMM(o.default.S_TEMP_MAT4,0,r,0,this.getWorldMatrix(),0),i.default.multiplyMM(o.default.S_TEMP_MAT4_1,0,_,0,r,0),t[n[s].fun](n[s].loc,!1,o.default.S_TEMP_MAT4_1.getBufferData())}this._m_Mesh.draw(t)}}])&&l(t.prototype,n),r&&l(t,r),s}(_.default);t.default=d},9650:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(8636)),_=a(n(66));function a(e){return e&&e.__esModule?e:{default:e}}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n=n||{},this._mEvents=new _.default,this._m_NeedUpdate=!1,this._m_Id=n.id||r.default.nextId(),this._m_Components=[],this._m_ComponentIDs={},this._m_Scene=null,this._m_Owner=t,this._m_OwnerAttachComponents=[],this._m_OwnerAttachComponentIDs={},"Scene"==this.getType()?this._m_Scene=this:this._m_Scene=t._m_Scene,this._m_Scene.addComponentInScene(this),this._m_Owner&&this._m_Owner.attachComponent(this)}var t,n,a;return t=e,(n=[{key:"getType",value:function(){return null}},{key:"on",value:function(e,t,n){this._mEvents.register(e,t,n)}},{key:"off",value:function(e,t,n){this._mEvents.unregister(e,t,n)}},{key:"fire",value:function(e,t,n){this._mEvents.trigger(e,t,n)}},{key:"getId",value:function(){return this._m_Id}},{key:"attachComponent",value:function(t){t instanceof e?this._m_OwnerAttachComponentIDs[t.getId()]||(this._m_OwnerAttachComponentIDs[t.getId()]=t,this._m_OwnerAttachComponents.push(t)):console.error("component必须是一个组件!!")}},{key:"getComponent",value:function(e){return this._m_OwnerAttachComponentIDs[e]?this._m_OwnerAttachComponentIDs[e]:null}},{key:"getComponentAtIndex",value:function(e){return e>=this._m_OwnerAttachComponents.length?null:this._m_OwnerAttachComponents[e]}},{key:"getComponentAtType",value:function(e){for(var t=this._m_OwnerAttachComponents.length,n=0;n<t;n++)if(this._m_OwnerAttachComponents[n].getType()==e)return this._m_OwnerAttachComponents[n];return null}},{key:"getComponentAtTypes",value:function(e){for(var t=this._m_OwnerAttachComponents.length,n=null,r=0;r<t;r++)this._m_OwnerAttachComponents[r].getType()==e&&(n||(n=[]),n.push(this._m_OwnerAttachComponents[r]));return n}},{key:"getComponents",value:function(){return this._m_OwnerAttachComponents}},{key:"detachComponent",value:function(t){if(t instanceof e&&this._m_OwnerAttachComponentIDs[t.getId()]){this._m_OwnerAttachComponentIDs[t.getId()]=null;var n=this._m_OwnerAttachComponents.indexOf(t);n>-1&&this._m_OwnerAttachComponents.splice(n,1)}}},{key:"_doUpdate",value:function(e){this._m_NeedUpdate=!1,e?this._update&&this._update():this._m_Scene.scheduleTask(this._update,this)}},{key:"_update",value:function(){}}])&&i(t.prototype,n),a&&i(t,a),e}();t.default=o},5109:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=i(n(9650)),a=i(n(3846));function i(e){return e&&e.__esModule?e:{default:e}}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t){return u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},u(e,t)}function s(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var _=f(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return l(this,n)}}function l(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},f(e)}var m=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(i,e);var t,n,r,_=s(i);function i(e,t){var n;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),n=_.call(this,e,t),t.version=t.version||"webgl2",n._m_Canvas=t.canvas,n._m_Canvas){if(n._m_GL=n._m_Canvas.getContext(t.version,{antialias:!!t.antialias||!0,depth:!0,powerPreference:!!t.powerPreference||"high-performance",alpha:!!t.alpha||!1}),n._m_GL){if(n._m_GL.getExtension("OES_texture_float_linear"),"webgl2"==t.version)n._m_GL.getExtension("EXT_color_buffer_float");else if(n._m_GL.getExtension("OES_texture_float"),n._m_GL.getExtension("OES_texture_half_float"),n._m_GL.getExtension("OES_texture_half_float_linear"),t.mobile&&n._m_GL.getExtension("WEBGL_color_buffer_float"),!n._m_GL.getExtension("WEBGL_depth_texture"))return console.log("Extension Depth texture is not working"),alert(":( Sorry, Your browser doesn't support depth texture extension. Please browse to webglreport.com to see more information."),l(n);var r=n._m_GL.getExtension("EXT_texture_filter_anisotropic");if(r||console.log("不支持各向异性拓展!"),r){var o=n._m_GL.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT);console.log("maxAnisotropy:"+o)}n._init()}else a.default.error("浏览器不支持"+t.version+"!");n._sizeCanvas(n._m_Canvas.parentNode,n._m_Canvas)}return n}return t=i,(n=[{key:"_sizeCanvas",value:function(e,t){var n=this,r=function(){e?(t.width=e.clientWidth,t.height=e.clientHeight):(t.width=document.documentElement.clientWidth,t.height=document.documentElement.clientHeight),a.default.debug("改变大小:"+t.width+","+t.height),n.fire("resize",[t.width,t.height])};window.onresize=r,r()}},{key:"getCanvasElement",value:function(){return this._m_Canvas}},{key:"_init",value:function(){var e=this._m_GL;e.clearColor(.3,.3,.3,1),e.enable(e.DEPTH_TEST),e.enable(e.CULL_FACE),e.disable(e.BLEND),e.cullFace(e.BACK),e.depthFunc(e.LEQUAL)}},{key:"getWidth",value:function(){return this._m_Canvas.width}},{key:"getHeight",value:function(){return this._m_Canvas.height}},{key:"getGLContext",value:function(){return this._m_GL}}])&&o(t.prototype,n),r&&o(t,r),i}(_.default);t.default=m},7120:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=o(n(9650)),a=o(n(5397)),i=o(n(7280));function o(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}function m(e,t){return m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},m(e,t)}function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=d(e);if(t){var _=d(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return h(this,n)}}function h(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function d(e){return d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},d(e)}function S(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var p=function(e){f(n,e);var t=c(n);function n(e,r){var _;u(this,n),_=t.call(this,e,r);var o=function(e){f(n,e);var t=c(n);function n(e,r){return u(this,n),t.call(this,e,r)}return l(n,[{key:"getType",value:function(){return"FramePicture"}},{key:"isFramePicture",value:function(){return!0}}]),n}(i.default);return _._m_Enable=!0,_._m_FramePicture=new o(e,{id:a.default.nextId()}),_._m_PreFrames=null,_._m_PostFilters=null,_}return l(n,[{key:"getMaterial",value:function(){return this._m_FramePicture.getMaterial()}},{key:"finish",value:function(){this._init()}},{key:"_init",value:function(){this._m_FramePicture.getMaterial().getCurrentTechnology().getSubPasss(n.S_PRE_FRAME_FILTER)&&(this._m_PreFrames={},this._m_PreFrames[this._m_FramePicture.getMaterial().getId()]=[],this._m_PreFrames[this._m_FramePicture.getMaterial().getId()].push(this._m_FramePicture)),this._m_FramePicture.getMaterial().getCurrentTechnology().getSubPasss(n.S_POST_FILTER)&&(this._m_PostFilters={},this._m_PostFilters[this._m_FramePicture.getMaterial().getId()]=[],this._m_PostFilters[this._m_FramePicture.getMaterial().getId()].push(this._m_FramePicture))}},{key:"preFrame",value:function(e){this._m_PreFrames}},{key:"postFilter",value:function(){if(this._m_PostFilters){var e=this._m_Scene.getCanvas().getGLContext();this._m_Scene.getRender().draw(e,n.S_POST_FILTER,this._m_PostFilters)}}},{key:"isEnable",value:function(){return this._m_Enable}},{key:"enable",value:function(){this._m_Enable=!0}},{key:"disable",value:function(){this._m_Enable=!1}}],[{key:"newFilterFromMaterial",value:function(e,t){var r=new n(e,{id:a.default.nextId()});return r._m_FramePicture.setMaterial(t),r.finish(),r}}]),n}(_.default);t.default=p,S(p,"S_PRE_FRAME_FILTER","PreFrame"),S(p,"S_POST_FILTER","PostFilter")},8636:(e,t)=>{function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=0,_=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,_,a;return t=e,a=[{key:"nextId",value:function(){return r--}}],(_=null)&&n(t.prototype,_),a&&n(t,a),e}();t.default=_},6984:(e,t)=>{function n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)};t.default=r,n(r,"CHASECAM_DOWN","ChaseCamDown"),n(r,"CHASECAM_UP","ChaseCamUp"),n(r,"CHASECAM_ZOOMIN","ChaseCamZoomIn"),n(r,"CHASECAM_ZOOMOUT","ChaseCamZoomOut"),n(r,"CHASECAM_MOVELEFT","ChaseCamMoveLeft"),n(r,"CHASECAM_MOVERIGHT","ChaseCamMoveRight"),n(r,"CHASECAM_TOGGLEROTATE","ChaseCamToggleRotate"),n(r,"CAMERA_MOVELEFT","CameraMoveLeft"),n(r,"CAMERA_MOVERIGHT","CameraMoveRight"),n(r,"CAMERA_MOVEFRONT","CameraMoveFront"),n(r,"CAMERA_MOVEBACK","CameraMoveBack"),n(r,"FLYCAM_LEFT","FLYCAM_Left"),n(r,"FLYCAM_RIGHT","FLYCAM_Right"),n(r,"FLYCAM_UP","FLYCAM_Up"),n(r,"FLYCAM_DOWN","FLYCAM_Down"),n(r,"FLYCAM_STRAFELEFT","FLYCAM_StrafeLeft"),n(r,"FLYCAM_STRAFERIGHT","FLYCAM_StrafeRight"),n(r,"FLYCAM_FORWARD","FLYCAM_Forward"),n(r,"FLYCAM_BACKWARD","FLYCAM_Backward"),n(r,"FLYCAM_ZOOMIN","FLYCAM_ZoomIn"),n(r,"FLYCAM_ZOOMOUT","FLYCAM_ZoomOut"),n(r,"FLYCAM_ROTATEDRAG","FLYCAM_RotateDrag"),n(r,"FLYCAM_RISE","FLYCAM_Rise"),n(r,"FLYCAM_LOWER","FLYCAM_Lower"),n(r,"FLYCAM_INVERTY","FLYCAM_InvertY")},8878:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=f(n(9650)),a=f(n(5604)),i=f(n(431)),o=f(n(1550)),u=f(n(2320)),s=f(n(4165)),l=f(n(2475));function f(e){return e&&e.__esModule?e:{default:e}}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t){return c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},c(e,t)}function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var _=S(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return d(this,n)}}function d(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function S(e){return S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},S(e)}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var g=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(f,e);var t,n,r,_=h(f);function f(e,t){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),(n=_.call(this,e,t))._m_LastExTime=0,n._m_Camera=null,n._m_CameraList=function(e,t,r){n.refresh()},n.setCamera(t.camera||n._m_Scene.getMainCamera()),n._m_Position=new a.default,t.position=t.position||n._m_Camera.getEye(),t.position&&n._m_Position.setTo(t.position),n._m_Front=new a.default(0,0,-1),t.front=t.front||n._m_Camera.getAt().subRetNew(t.position).normal(),t.front&&n._m_Front.setTo(t.front),n._m_Up=new a.default,n._m_Right=new a.default,n._m_WorldUp=new a.default(0,1,0),t.up&&n._m_WorldUp.setTo(t.up),n._m_Yaw=t.yaw||f.YAW,n._m_Pitch=t.pitch||f.PITCH,n._m_MovementSpeed=t.movementSpeed||f.SPEED,n._m_MouseSensitivity=t.mouseSensitivity||f.SENSITIVITY,n._m_Zoom=t.zoom||f.ZOOM,n._m_ViewMatrix=new u.default,n._m_ViewMatrix.identity(),n.synYawPitch(),n.updateCameraVectors(),n._updateViewMatrix();var r=s.default.getInput(n._m_Scene,{id:n._m_Scene.getId()});return n._m_Scene.on("update",(function(e){n._m_LastExTime=e;var t=!1;r.getMouseButtonDown(s.default.S_MOUSE_BUTTON0)&&(n.processMouseMovement(r.getAmountX(),r.getAmountY(),!0),n.updateCameraVectors(),t=!0);var _=null;r.getKeyDown(s.default.S_KEY_W)?_=f.FORWARD:r.getKeyDown(s.default.S_KEY_S)&&(_=f.BACKWARD),r.getKeyDown(s.default.S_KEY_A)?_=f.LEFT:r.getKeyDown(s.default.S_KEY_D)&&(_=f.RIGHT),null!=_&&(t=!0,n.processKeyboard(_,n._m_LastExTime)),t&&n._doUpdate(!0)})),r.on("mousewheel",(function(e){e&&(n.processMouseScroll(e),n._m_Camera.scroll(n._m_Zoom))})),n}return t=f,(n=[{key:"setMovementSpeed",value:function(e){this._m_MovementSpeed=e}},{key:"setMouseSensitivity",value:function(e){this._m_MouseSensitivity=e}},{key:"refresh",value:function(){this._m_Position.setTo(this._m_Camera.getEye()),this._m_Front.setTo(this._m_Camera.getAt().subRetNew(this._m_Position).normal()),this.synYawPitch()}},{key:"setCamera",value:function(e){null!=e&&this._m_Camera!=e&&(this._m_Camera&&this._m_Camera.off(o.default.S_CAMERA_UPDATE_EVENT,this._m_CameraList),this._m_Camera=e,this._m_Camera.on(o.default.S_CAMERA_UPDATE_EVENT,this._m_CameraList))}},{key:"synYawPitch",value:function(){this._m_Pitch=i.default.toAngle(Math.asin(this._m_Front._m_Y));var e=Math.cos(i.default.toRadians(this._m_Pitch)),t=this._m_Front._m_Z/e;t>=1?t=1:t<=-1&&(t=-1),this._m_Yaw=i.default.toAngle(Math.asin(t)),Math.cos(i.default.toRadians(this._m_Yaw))*e*this._m_Front._m_X<0&&(this._m_Yaw=180-this._m_Yaw)}},{key:"processKeyboard",value:function(e,t){var n=this._m_MovementSpeed*t;e==f.FORWARD?(this._m_Front.multLength(n,l.default.S_TEMP_VEC3),this._m_Position.add(l.default.S_TEMP_VEC3)):e==f.BACKWARD?(this._m_Front.multLength(-1*n,l.default.S_TEMP_VEC3),this._m_Position.add(l.default.S_TEMP_VEC3)):e==f.LEFT?(this._m_Right.multLength(-1*n,l.default.S_TEMP_VEC3),this._m_Position.add(l.default.S_TEMP_VEC3)):e==f.RIGHT&&(this._m_Right.multLength(n,l.default.S_TEMP_VEC3),this._m_Position.add(l.default.S_TEMP_VEC3))}},{key:"processMouseMovement",value:function(e,t,n){n=null==n||null==n||n,e*=this._m_MouseSensitivity,t*=this._m_MouseSensitivity,this._m_Yaw+=e,this._m_Pitch+=t,n&&(this._m_Pitch>89?this._m_Pitch=89:this._m_Pitch<-89&&(this._m_Pitch=-89))}},{key:"processMouseScroll",value:function(e){this._m_Zoom-=e,this._m_Zoom<1&&(this._m_Zoom=1),this._m_Zoom>45&&(this._m_Zoom=45)}},{key:"_updateViewMatrix",value:function(){this._m_Position.add(this._m_Front,l.default.S_TEMP_VEC3),this._m_ViewMatrix.lookAt(this._m_Position,l.default.S_TEMP_VEC3,this._m_Up)}},{key:"getViewMatrix",value:function(){return this._m_ViewMatrix}},{key:"getViewMatrixArray",value:function(){return this.getViewMatrix().m}},{key:"updateCameraVectors",value:function(){l.default.S_TEMP_VEC3._m_X=Math.cos(i.default.toRadians(this._m_Yaw))*Math.cos(i.default.toRadians(this._m_Pitch)),l.default.S_TEMP_VEC3._m_Y=Math.sin(i.default.toRadians(this._m_Pitch)),l.default.S_TEMP_VEC3._m_Z=Math.sin(i.default.toRadians(this._m_Yaw))*Math.cos(i.default.toRadians(this._m_Pitch)),this._m_Front.setTo(l.default.S_TEMP_VEC3),this._m_Front.normal(),this._m_Front.cross(this._m_WorldUp,this._m_Right),this._m_Right.normal(),this._m_Right.cross(this._m_Front,this._m_Up),this._m_Up.normal()}},{key:"_update",value:function(){this._updateViewMatrix(),this._m_Camera.lookAt(this._m_Position,this._m_Position.add(this._m_Front,l.default.S_TEMP_VEC3),this._m_Up)}}])&&m(t.prototype,n),r&&m(t,r),f}(_.default);t.default=g,p(g,"FORWARD",1),p(g,"BACKWARD",g.FORWARD<<1),p(g,"LEFT",g.BACKWARD<<1),p(g,"RIGHT",g.LEFT<<1),p(g,"YAW",-90),p(g,"PITCH",0),p(g,"SPEED",10.5),p(g,"SENSITIVITY",.1),p(g,"ZOOM",45)},4165:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}var _;function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t){return i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},i(e,t)}function o(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=s(e);if(t){var _=s(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return u(this,n)}}function u(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function s(e){return s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},s(e)}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var f=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(u,e);var t,n,r,_=o(u);function u(e,t){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u);var r=(n=_.call(this,e,t))._m_Scene.getCanvas().getCanvasElement();n._keys={},n._mouseButtons={},n._mouseCoords=null,n._wheelDelta=0,n._amountX=0,n._amountY=0,n._mouseStartDownCoords=null,r.oncontextmenu=function(){return!1},r.onkeydown=function(e){n._keys[u.S_KEYS[e.key]]=!0,n.fire("keydown",[u.S_KEYS[e.key]])},r.onkeyup=function(e){n._keys[u.S_KEYS[e.key]]=!1,n.fire("keyup",[u.S_KEYS[e.key]])},r.onkeypress=function(e){n.fire("keypress",[u.S_KEYS[e.key]])};var a=!1;r.onmousedown=function(e){a=!0,n._wheelDelta=0,n._amountX=0,n._amountY=0,n._mouseCoords=n._getClickCoordsWithinElement(e),n._mouseStartDownCoords=n._mouseCoords;var t=null;switch(e.which||e.button+1){case 1:n._mouseButtons[u.S_MOUSE_BUTTON0]=!0,t=u.S_MOUSE_BUTTON0_DOWN;break;case 2:n._mouseButtons[u.S_MOUSE_BUTTON1]=!0,t=u.S_MOUSE_BUTTON1_DOWN;break;case 3:n._mouseButtons[u.S_MOUSE_BUTTON2]=!0,t=u.S_MOUSE_BUTTON2_DOWN}n.fire("mousedown",[t])},r.onmouseup=function(e){a=!1,n._wheelDelta=0,n._amountX=0,n._amountY=0,n._mouseCoords=n._getClickCoordsWithinElement(e),n._mouseStartDownCoords=n._mouseCoords;var t=null;switch(e.which||e.button+1){case 1:n._mouseButtons[u.S_MOUSE_BUTTON0]=!1,t=u.S_MOUSE_BUTTON0_UP;break;case 2:n._mouseButtons[u.S_MOUSE_BUTTON1]=!1,t=u.S_MOUSE_BUTTON1_UP;break;case 3:n._mouseButtons[u.S_MOUSE_BUTTON2]=!1,t=u.S_MOUSE_BUTTON2_UP}n.fire("mouseup",[t])};var i=!1;return r.onmouseenter=function(e){n._wheelDelta=0,n._amountX=0,n._amountY=0,i=!0,n._mouseCoords=n._getClickCoordsWithinElement(e)},r.onmouseout=function(e){n._wheelDelta=0,n._amountX=0,n._amountY=0,i=!1,n._mouseCoords=n._getClickCoordsWithinElement(e)},r.onmousemove=function(e){i&&(n._wheelDelta=0,n._mouseCoords=n._getClickCoordsWithinElement(e),a&&(n._amountX=n._mouseCoords[0]-n._mouseStartDownCoords[0],n._amountY=n._mouseCoords[1]-n._mouseStartDownCoords[1],n._mouseStartDownCoords[0]=n._mouseCoords[0],n._mouseStartDownCoords[1]=n._mouseCoords[1]),n.fire("mousemove",[n._mouseCoords]))},r.onmousewheel=function(e){n._amountX=0,n._amountY=0,n._mouseCoords=n._getClickCoordsWithinElement(e),e.wheelDelta?(n._wheelDelta=e.wheelDelta/120,window.opera&&(n._wheelDelta=-n._wheelDelta)):e.detail&&(n._wheelDelta=-e.detail/3),n.fire("mousewheel",[n._wheelDelta])},n}return t=u,r=[{key:"getInput",value:function(e,t){if(u.S_INPUTS[t.id])return u.S_INPUTS[t.id];var n=new u(e,t);return u.S_INPUTS[t.id]=n,n}}],(n=[{key:"getMouseButtonDown",value:function(e){return this._mouseButtons[e]}},{key:"getKeyDown",value:function(e){return this._keys[e]}},{key:"getKeyUp",value:function(e){return!this._keys[e]}},{key:"getAmountX",value:function(){return this._amountX}},{key:"getAmountY",value:function(){return-this._amountY}},{key:"getMouseCoords",value:function(){return this._mouseCoords}},{key:"getWheelDelta",value:function(){return this._wheelDelta}},{key:"_getClickCoordsWithinElement",value:function(e){var t=[0,0];if(e){for(var n=e.target,r=0,_=0;n.offsetParent;)r+=n.offsetLeft,_+=n.offsetTop,n=n.offsetParent;t[0]=e.pageX-r,t[1]=e.pageY-_}else e=window.event,t.x=e.x,t.y=e.y;return t}}])&&a(t.prototype,n),r&&a(t,r),u}(((_=n(9650))&&_.__esModule?_:{default:_}).default);t.default=f,l(f,"s_Inputs",{}),l(f,"S_KEY_0",0),l(f,"S_KEY_1",1),l(f,"S_KEY_2",2),l(f,"S_KEY_3",3),l(f,"S_KEY_4",4),l(f,"S_KEY_5",5),l(f,"S_KEY_6",6),l(f,"S_KEY_7",7),l(f,"S_KEY_8",8),l(f,"S_KEY_9",9),l(f,"S_KEY_A",10),l(f,"S_KEY_B",11),l(f,"S_KEY_C",12),l(f,"S_KEY_D",13),l(f,"S_KEY_E",14),l(f,"S_KEY_F",15),l(f,"S_KEY_G",16),l(f,"S_KEY_H",17),l(f,"S_KEY_I",18),l(f,"S_KEY_J",19),l(f,"S_KEY_K",20),l(f,"S_KEY_L",21),l(f,"S_KEY_M",22),l(f,"S_KEY_N",23),l(f,"S_KEY_O",24),l(f,"S_KEY_P",25),l(f,"S_KEY_Q",26),l(f,"S_KEY_R",27),l(f,"S_KEY_S",28),l(f,"S_KEY_T",29),l(f,"S_KEY_U",30),l(f,"S_KEY_V",31),l(f,"S_KEY_W",32),l(f,"S_KEY_X",33),l(f,"S_KEY_Y",34),l(f,"S_KEY_Z",35),l(f,"S_KEYS",{0:f.S_KEY_0,1:f.S_KEY_1,2:f.S_KEY_2,3:f.S_KEY_3,4:f.S_KEY_4,5:f.S_KEY_5,6:f.S_KEY_6,7:f.S_KEY_7,8:f.S_KEY_8,9:f.S_KEY_9,a:f.S_KEY_A,b:f.S_KEY_B,c:f.S_KEY_C,d:f.S_KEY_D,e:f.S_KEY_E,f:f.S_KEY_F,g:f.S_KEY_G,h:f.S_KEY_H,i:f.S_KEY_I,j:f.S_KEY_J,k:f.S_KEY_K,l:f.S_KEY_L,m:f.S_KEY_M,n:f.S_KEY_N,o:f.S_KEY_O,p:f.S_KEY_P,q:f.S_KEY_Q,r:f.S_KEY_R,s:f.S_KEY_S,t:f.S_KEY_T,u:f.S_KEY_U,v:f.S_KEY_V,w:f.S_KEY_W,x:f.S_KEY_X,y:f.S_KEY_Y,z:f.S_KEY_Z}),l(f,"S_MOUSE_BUTTON0_DOWN",36),l(f,"S_MOUSE_BUTTON1_DOWN",37),l(f,"S_MOUSE_BUTTON2_DOWN",38),l(f,"S_MOUSE_BUTTON0_UP",39),l(f,"S_MOUSE_BUTTON1_UP",40),l(f,"S_MOUSE_BUTTON2_UP",41),l(f,"S_MOUSE_BUTTON0",42),l(f,"S_MOUSE_BUTTON1",43),l(f,"S_MOUSE_BUTTON2",44),l(f,"S_INPUTS",{})},2028:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=s(n(5604)),a=s(n(431)),i=s(n(9650)),o=s(n(4165)),u=s(n(6984));function s(e){return e&&e.__esModule?e:{default:e}}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t){return f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},f(e,t)}function m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=d(e);if(t){var _=d(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return c(this,n)}}function c(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return h(e)}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e){return d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},d(e)}function S(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var p=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(s,e);var t,n,r,i=m(s);function s(e,t){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),S(h(n=i.call(this,e,t)),"_m_Enabled",!0),S(h(n),"_m_Rotating",!0),S(h(n),"_m_VRotating",!0),S(h(n),"_m_CanRotate",!0),S(h(n),"_m_Rotation",0),S(h(n),"_m_VRotation",Math.PI/6),S(h(n),"_m_PreviousTargetRotation",0),S(h(n),"_m_TargetRotation",n._m_Rotation),S(h(n),"_m_TargetVRotation",n._m_VRotation),S(h(n),"_m_RotationSpeed",.3),S(h(n),"_m_ZoomSensitivity",2),S(h(n),"_m_ZoomSpeed",1),S(h(n),"_m_VeryCloseRotation",!0),S(h(n),"_m_MaxVerticalRotation",Math.PI/2),S(h(n),"_m_MinVerticalRotation",-Math.PI/2),S(h(n),"_m_Distance",1),S(h(n),"_m_TargetDistance",n._m_Distance),S(h(n),"_m_MinDistance",1),S(h(n),"_m_MaxDistance",10),S(h(n),"_m_Chasing",!0),S(h(n),"_m_Zooming",!0),S(h(n),"_m_Zoomin",!1),S(h(n),"_m_TrailingRotationInertia",.05),S(h(n),"_m_DistanceLerpFactor",0),S(h(n),"_m_TrailingLerpFactor",0),S(h(n),"_m_TrailingSensitivity",5),S(h(n),"_m_RotationSensitivity",5),S(h(n),"_m_TrailingEnabled",!0),S(h(n),"_m_SmoothMotion",!0),S(h(n),"_m_TargetLocation",new _.default),S(h(n),"_m_TargetDir",new _.default),S(h(n),"_m_OffsetDistance",.002),S(h(n),"_m_Target",new _.default),S(h(n),"_m_LookAtOffset",new _.default),S(h(n),"_m_PrevPos",new _.default),S(h(n),"temp",new _.default),S(h(n),"temp2",new _.default),S(h(n),"_m_Pos",new _.default),S(h(n),"_m_InitialUpVec",(new _.default).setTo(_.default.S_UNIT_AXIS_Y)),S(h(n),"_m_Cam",void 0),S(h(n),"_m_ChasingSensitivity",5),S(h(n),"_m_Input",void 0),S(h(n),"_m_TargetMoves",!1),n._m_Cam=t.camera||n._m_Scene.getMainCamera(),n._m_Input=o.default.getInput(n._m_Scene,{id:n._m_Scene.getId()});var r=0;return n._m_Scene.on("update",(function(e){r=e,n.updateCamera(e)})),n._m_Input.on("mousewheel",(function(e){e&&n.analog(e>0?u.default.CHASECAM_ZOOMIN:u.default.CHASECAM_ZOOMOUT,(e>0?e:-e)*n._m_ZoomSpeed,r)})),n}return t=s,(n=[{key:"setRotationSpeed",value:function(e){this._m_RotationSpeed=e}},{key:"getRotationSpeed",value:function(){return this._m_RotationSpeed}},{key:"setZoomSpeed",value:function(e){this._m_ZoomSpeed=e}},{key:"getZoomSpeed",value:function(){return this._m_ZoomSpeed}},{key:"setTargetDistance",value:function(e){this._m_TargetDistance=e}},{key:"getDistance",value:function(){return this._m_Distance}},{key:"lookScene",value:function(e){if(e){var t=e.getBoundingVolume(),n=2*t.getXHalf(),r=2*t.getYHalf(),a=2*t.getZHalf(),i=5*Math.sqrt(Math.pow(n,2)+Math.pow(r,2)+Math.pow(a,2)),o=i/5e3,u=i-o,s=2*Math.max(n,r,a);this.setTargetDistance(.5*(s-o)+o),this.setMaxDistance(s),this.setMinDistance(o),this.setZoomSpeed(.2*u);var l=new _.default;t.getCenter(l),this.setTarget(l)}}},{key:"setTarget",value:function(e){this._m_Target.setTo(e)}},{key:"syncNavDir",value:function(e,t){this._m_TargetDir.setToInXYZ(e[0],e[1],e[2]),this._m_TargetDir.normal(),this._m_TargetVRotation=Math.asin(this._m_TargetDir.y);var n=Math.cos(this._m_TargetVRotation),r=this._m_TargetDir.z/n;r>=1?r=1:r<=-1&&(r=-1),this._m_TargetRotation=Math.asin(r),Math.cos(this._m_TargetRotation)*n*this._m_TargetDir.x<0&&(this._m_TargetRotation=Math.PI+-this._m_TargetRotation),this._m_Rotating=!0,this._m_VRotating=!0,t&&(this._m_Zooming=!0,this.setTargetDistance(this._m_MaxDistance))}},{key:"rotate",value:function(e,t){var n=this._m_RotationSpeed;this._m_RotationSpeed=Math.PI/100,this._rotate1(e),this._rotate2(t),this._m_RotationSpeed=n}},{key:"_rotate1",value:function(e){this._m_CanRotate&&this._m_Enabled&&(this._m_Rotating=!0,this._m_TargetRotation+=e*this._m_RotationSpeed)}},{key:"_rotate2",value:function(e){if(this._m_CanRotate&&this._m_Enabled){this._m_VRotating=!0;var t=this._m_TargetVRotation;this._m_TargetVRotation+=e*this._m_RotationSpeed,this._m_TargetVRotation>this._m_MaxVerticalRotation&&(this._m_TargetVRotation=t),this._m_VeryCloseRotation?this._m_TargetVRotation<this._m_MinVerticalRotation&&this._m_TargetDistance>this._m_MinDistance+1?this._m_TargetVRotation=this._m_MinVerticalRotation:this._m_TargetVRotation<90*-a.default.S_DEG_TO_RAD&&(this._m_TargetVRotation=t):this._m_TargetVRotation<this._m_MinVerticalRotation&&(this._m_TargetVRotation=t)}}},{key:"setMinVerticalRotation",value:function(e){this._m_MinVerticalRotation=e}},{key:"setMaxVerticalRotation",value:function(e){this._m_MaxVerticalRotation=e}},{key:"_zoomCamera",value:function(e){this._m_Enabled&&(this._m_Zooming=!0,this._m_TargetDistance+=e*this._m_ZoomSensitivity,this._m_TargetDistance>this._m_MaxDistance&&(this._m_TargetDistance=this._m_MaxDistance),this._m_TargetDistance<this._m_MinDistance&&(this._m_TargetDistance=this._m_MinDistance),this._m_VeryCloseRotation&&this._m_TargetVRotation<this._m_MinVerticalRotation&&this._m_TargetDistance>this._m_MinDistance+1&&(this._m_TargetVRotation=this._m_MinVerticalRotation))}},{key:"_checkInput",value:function(e){if(this._m_Input.getMouseButtonDown(o.default.S_MOUSE_BUTTON0)){var t=this._m_Input.getAmountX(),n=this._m_Input.getAmountY();0!=t&&this.analog(t>0?u.default.CHASECAM_MOVERIGHT:u.default.CHASECAM_MOVELEFT,t>0?t:-t,e),0!=n&&this.analog(n>0?u.default.CHASECAM_DOWN:u.default.CHASECAM_UP,n>0?n:-n,e)}}},{key:"updateCamera",value:function(e){this._m_Enabled&&(this._checkInput(e),this._updateCamera(e))}},{key:"_updateCamera",value:function(e){if(this._m_Enabled){if(this._m_TargetLocation.setTo(this._m_Target).add(this._m_LookAtOffset),this._m_SmoothMotion){this._m_TargetDir.setTo(this._m_TargetLocation).sub(this._m_PrevPos);var t=this._m_TargetDir.length();if(this._m_OffsetDistance<t?(this._m_Chasing=!0,this._m_TrailingEnabled&&(this._m_Trailing=!0),this._m_TargetMoves=!0):(this._m_TargetMoves&&!this._m_CanRotate&&(this._m_TargetRotation-this._m_Rotation>this._m_TrailingRotationInertia?this._m_TargetRotation=this._m_Rotation+this._m_TrailingRotationInertia:this._m_TargetRotation-this._m_Rotation<-this._m_TrailingRotationInertia&&(this._m_TargetRotation=this._m_Rotation-this._m_TrailingRotationInertia)),this._m_TargetMoves=!1),this._m_CanRotate&&(this._m_TrailingLerpFactor=0,this._m_Trailing=!1),this._m_TrailingEnabled&&this._m_Trailing){if(this._m_TargetMoves){var n=this._m_TargetDir.negate().normal(),r=_.default.S_UNIT_AXIS_X;n.y=0,this._m_TargetDir.z>0?this._m_TargetRotation=a.default.S_TWO_PI-Math.acos(n.dot(r)):this._m_TargetRotation=Math.acos(n.dot(r)),(this._m_TargetRotation-this._m_Rotation>Math.PI||this._m_TargetRotation-this._m_Rotation<-Math.PI)&&(this._m_TargetRotation-=a.default.S_TWO_PI),this._m_TargetRotation!=this._m_PreviousTargetRotation&&Math.abs(this._m_TargetRotation-this._m_PreviousTargetRotation)>Math.PI/8&&(this._m_TrailingLerpFactor=0),this._m_PreviousTargetRotation=this._m_TargetRotation}this._m_TrailingLerpFactor=Math.min(this._m_TrailingLerpFactor+e*e*this._m_TrailingSensitivity,1),this._m_Rotation=a.default.interpolateLinear(this._m_TrailingLerpFactor,this._m_Rotation,this._m_TargetRotation),this._m_TargetRotation+.01>=this._m_Rotation&&this._m_TargetRotation-.01<=this._m_Rotation&&(this._m_Trailing=!1,this._m_TrailingLerpFactor=0)}this._m_Chasing&&(this.temp2.setTo(this._m_Cam.getEye()),this._m_Distance=this.temp.setTo(this._m_TargetLocation).sub(this.temp2).length(),this._m_DistanceLerpFactor=Math.min(this._m_DistanceLerpFactor+e*e*this._m_ChasingSensitivity*.05,1),this._m_Distance=a.default.interpolateLinear(this._m_DistanceLerpFactor,this._m_Distance,this._m_TargetDistance),this._m_TargetDistance+.01>=this._m_Distance&&this._m_TargetDistance-.01<=this._m_Distance&&(this._m_DistanceLerpFactor=0,this._m_Chasing=!1)),this._m_Zooming&&(this._m_DistanceLerpFactor=Math.min(this._m_DistanceLerpFactor+e*e*this._m_ZoomSensitivity,1),this._m_Distance=a.default.interpolateLinear(this._m_DistanceLerpFactor,this._m_Distance,this._m_TargetDistance),this._m_TargetDistance+.1>=this._m_Distance&&this._m_TargetDistance-.1<=this._m_Distance&&(this._m_Zooming=!1,this._m_DistanceLerpFactor=0)),this._m_Rotating&&(this._m_RotationLerpFactor=Math.min(this._m_RotationLerpFactor+e*e*this._m_RotationSensitivity,1),this._m_Rotation=a.default.interpolateLinear(this._m_RotationLerpFactor,this._m_Rotation,this._m_TargetRotation),this._m_TargetRotation+.01>=this._m_Rotation&&this._m_TargetRotation-.01<=this._m_Rotation&&(this._m_Rotating=!1,this._m_RotationLerpFactor=0)),this._m_VRotating&&(this._m_VRotationLerpFactor=Math.min(this._m_VRotationLerpFactor+e*e*this._m_RotationSensitivity,1),this._m_VRotation=a.default.interpolateLinear(this._m_VRotationLerpFactor,this._m_VRotation,this._m_TargetVRotation),this._m_TargetVRotation+.01>=this._m_VRotation&&this._m_TargetVRotation-.01<=this._m_VRotation&&(this._m_VRotating=!1,this._m_VRotationLerpFactor=0)),this.computePosition(),this._m_Pos.add(this._m_LookAtOffset)}else this._m_VRotation=this._m_TargetVRotation,this._m_Rotation=this._m_TargetRotation,this._m_Distance=this._m_TargetDistance,this.computePosition(),this._m_Pos.add(this._m_LookAtOffset);this._m_PrevPos.setTo(this._m_TargetLocation),this._m_Cam.lookAt(this._m_Pos,this._m_TargetLocation,this._m_InitialUpVec)}}},{key:"computePosition",value:function(){var e=this._m_Distance*Math.sin(Math.PI/2-this._m_VRotation);this._m_Pos.setToInXYZ(e*Math.cos(this._m_Rotation),this._m_Distance*Math.sin(this._m_VRotation),e*Math.sin(this._m_Rotation)),this._m_Pos.add(this._m_Target)}},{key:"analog",value:function(e,t,n){e==u.default.CHASECAM_MOVELEFT?this._rotate1(-t*n):e==u.default.CHASECAM_MOVERIGHT?this._rotate1(t*n):e==u.default.CHASECAM_UP?this._rotate2(t*n):e==u.default.CHASECAM_DOWN?this._rotate2(-t*n):e==u.default.CHASECAM_ZOOMIN?(this._zoomCamera(-t*n),0==this._m_Zoomin&&(this._m_DistanceLerpFactor=0),this._m_Zoomin=!0):e==u.default.CHASECAM_ZOOMOUT&&(this._zoomCamera(+t*n),1==this._m_Zoomin&&(this._m_DistanceLerpFactor=0),this._m_Zoomin=!1)}},{key:"isEnabled",value:function(){return this._m_Enabled}},{key:"setEnabled",value:function(e){this._m_Enabled=e,this._m_CanRotate=e}},{key:"getMaxDistance",value:function(){return this._m_MaxDistance}},{key:"setMaxDistance",value:function(e){this._m_MaxDistance=e,e<this._m_Distance&&this._zoomCamera(e-this._m_Distance)}},{key:"getMinDistance",value:function(){return this._m_MinDistance}},{key:"setMinDistance",value:function(e){this._m_MinDistance=e,e>this._m_Distance&&this._zoomCamera(this._m_Distance-e)}}])&&l(t.prototype,n),r&&l(t,r),s}(i.default);t.default=p},7539:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=u(n(513)),a=u(n(5604)),i=u(n(6177)),o=u(n(3846));function u(e){return e&&e.__esModule?e:{default:e}}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t){return l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},l(e,t)}function f(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=c(e);if(t){var _=c(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return m(this,n)}}function m(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function c(e){return c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},c(e)}function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var d=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(u,e);var t,n,r,_=f(u);function u(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(n=_.call(this,e,t))._m_Direction=new a.default,n}return t=u,(n=[{key:"getType",value:function(){return"DirectionalLight"}},{key:"getTypeId",value:function(){return 0}},{key:"_genShadow",value:function(){this._m_ShadowCfg.id=this._m_Id+"_shadow",this._m_ShadowCfg.nbSplits=this._m_ShadowCfg.nbSplits||2,this._m_Shadow=new i.default(this._m_Scene,this._m_ShadowCfg)}},{key:"setShadowSplitNum",value:function(e){(e<1||e>4)&&o.default.error("错误的分区数目:"+e),this._m_ShadowCfg.nbSplits=e||2}},{key:"setShadowSplitType",value:function(e){this._m_ShadowCfg.shadowSplitType=e}},{key:"setDirection",value:function(e){this._m_Direction.setTo(e)}},{key:"getDirection",value:function(){return this._m_Direction}},{key:"setDirectionXYZ",value:function(e,t,n){this._m_Direction.setToInXYZ(e,t,n),this._m_Direction.normal()}},{key:"getBoundingVolume",value:function(){return null}}])&&s(t.prototype,n),r&&s(t,r),u}(_.default);t.default=d,h(d,"S_SHADER_SPLIT_TYPE_HALF_TRANSITION",1),h(d,"S_SHADER_SPLIT_TYPE_FIXED",2)},2815:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=o(n(6967)),a=o(n(1846)),i=o(n(1446));function o(e){return e&&e.__esModule?e:{default:e}}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t){return s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},s(e,t)}function l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m(e);if(t){var _=m(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return f(this,n)}}function f(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function m(e){return m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},m(e)}var c=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(o,e);var t,n,r,_=l(o);function o(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(n=_.call(this,e,t))._m_ShCoeffs=null,n._m_ShCoeffsBufferData=null,n._m_PrefilterEnvMap=null,n._m_PrefilterMipmap=0,n._m_Bounding=new a.default,n}return t=o,(n=[{key:"getType",value:function(){return"GIProbe"}},{key:"getTypeId",value:function(){return 4}},{key:"setPrefilterMipmap",value:function(e){this._m_PrefilterMipmap=e}},{key:"getPrefilterMipmap",value:function(){return this._m_PrefilterMipmap}},{key:"setRadius",value:function(e){this._m_Bounding.setRaiuds(e)}},{key:"getRadius",value:function(){return this._m_Bounding.getRadius()}},{key:"setShCoeffs",value:function(e){this._m_ShCoeffs=e,this._m_ShCoeffsBufferData=new i.default(27);for(var t=this._m_ShCoeffsBufferData.getArray(),n=0,r=0;n<e.length;n++)t[r++]=e[n]._m_X,t[r++]=e[n]._m_Y,t[r++]=e[n]._m_Z}},{key:"getShCoeffs",value:function(){return this._m_ShCoeffs}},{key:"getShCoeffsBufferData",value:function(){return this._m_ShCoeffsBufferData}},{key:"setPrefilterEnvMap",value:function(e){this._m_PrefilterEnvMap=e}},{key:"getPrefilterEnvMap",value:function(){return this._m_PrefilterEnvMap}}])&&u(t.prototype,n),r&&u(t,r),o}(_.default);t.default=c},513:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=i(n(2949)),a=i(n(7141));function i(e){return e&&e.__esModule?e:{default:e}}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t){return u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},u(e,t)}function s(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m(e);if(t){var _=m(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return l(this,n)}}function l(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return f(e)}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function m(e){return m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},m(e)}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var h=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(i,e);var t,n,r,_=s(i);function i(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(n=_.call(this,e,t))._m_Color=new a.default,n._m_Enable=!0,n._m_Scene.enableLight(f(n)),n._m_ProShadow=!1,n._m_ResetProShadow=n._m_ProShadow,n._m_Shadow=null,n._m_ShadowCfg={shadowMapSize:512,backfaceShadows:!1,debug:!1},n._m_Mark=0,n._init(),n}return t=i,(n=[{key:"getType",value:function(){return"Light"}},{key:"getTypeId",value:function(){return-1}},{key:"_init",value:function(){this._m_Mark|=i.S_VISIBLE_LIGHT,this._m_Mark|=i.S_DYNAMIC}},{key:"enable",value:function(){this._m_Enable||(this._m_Enable=!0,this._m_Scene.enableLight(this),this._m_ResetProShadow&&(this._m_ResetProShadow=!1,this.proShadow(!0)))}},{key:"getShadow",value:function(){return this._m_Shadow}},{key:"setShadowMapSize",value:function(e){this._m_ShadowCfg.shadowMapSize=e}},{key:"debugShadowMap",value:function(){this._m_ShadowCfg.debug=!0}},{key:"proShadow",value:function(e){this._m_ProShadow=e,this._m_ProShadow&&!this._m_Shadow&&(this._genShadow(),this._m_Shadow&&this._m_Shadow.setLight(this)),this._m_Shadow&&this._m_Shadow.enable(e)}},{key:"isProShadow",value:function(){return this._m_ProShadow}},{key:"_genShadow",value:function(){}},{key:"disable",value:function(){this._m_Enable&&(this._m_Enable=!1,this._m_Scene.disableLight(this),this._m_ProShadow&&(this._m_ResetProShadow=this._m_ProShadow,this.proShadow(!1)))}},{key:"isEnable",value:function(){return this._m_Enable}},{key:"setColor",value:function(e){this._m_Color.setTo(e)}},{key:"getColor",value:function(){return this._m_Color}},{key:"setColorRGBA",value:function(e,t,n,r){this._m_Color.setToInXYZW(e,t,n,r)}},{key:"updateBounding",value:function(){this._updateBounding()}}])&&o(t.prototype,n),r&&o(t,r),i}(_.default);t.default=h,c(h,"S_VISIBLE_LIGHT",1),c(h,"S_STATIC_LIGHT",2),c(h,"S_DYNAMIC",3)},6807:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=u(n(513)),a=u(n(5604)),i=u(n(1846)),o=u(n(4867));function u(e){return e&&e.__esModule?e:{default:e}}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t){return l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},l(e,t)}function f(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=c(e);if(t){var _=c(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return m(this,n)}}function m(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function c(e){return c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},c(e)}var h=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(u,e);var t,n,r,_=f(u);function u(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(n=_.call(this,e,t))._m_Position=new a.default,n._m_Radius=-1,n._m_StepClip=.2,n._m_InvRadius=1/n._m_Radius,n._m_InvRadius2=1/(n._m_Radius-n._m_StepClip),n}return t=u,(n=[{key:"getType",value:function(){return"PointLight"}},{key:"getTypeId",value:function(){return 1}},{key:"_genShadow",value:function(){this._m_ShadowCfg.id=this._m_Id+"_shadow",this._m_Shadow=new o.default(this._m_Scene,this._m_ShadowCfg)}},{key:"setStepClip",value:function(e){e<0&&(e=1),this._m_StepClip=e,this._m_InvRadius2=1/(this._m_Radius-this._m_StepClip)}},{key:"getStepClip",value:function(){return this._m_StepClip}},{key:"setPosition",value:function(e){this._m_Position.setTo(e),this._updateBounding()}},{key:"getPosition",value:function(){return this._m_Position}},{key:"setPositionXYZ",value:function(e,t,n){this._m_Position.setToInXYZ(e,t,n),this._updateBounding()}},{key:"setRadius",value:function(e){this._m_Radius=e,this._m_InvRadius=1/e,this._updateBounding()}},{key:"getRadius",value:function(){return this._m_Radius}},{key:"getInRadius",value:function(){return this._m_InvRadius}},{key:"getInRadius2",value:function(){return this._m_InvRadius2}},{key:"getBoundingVolume",value:function(){return this._m_UpdateBoundingVolume&&(this._m_BoudingVolume||(this._m_BoudingVolume=new i.default),this._m_BoudingVolume.setCenter(this._m_Position),this._m_BoudingVolume.setRaiuds(this._m_Radius),this._m_UpdateBoundingVolume=!1),this._m_BoudingVolume}}])&&s(t.prototype,n),r&&s(t,r),u}(_.default);t.default=h},6967:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=i(n(513)),a=i(n(5604));function i(e){return e&&e.__esModule?e:{default:e}}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t){return u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},u(e,t)}function s(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var _=f(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return l(this,n)}}function l(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},f(e)}var m=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(i,e);var t,n,r,_=s(i);function i(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(n=_.call(this,e,t))._m_Position=new a.default,n}return t=i,(n=[{key:"getType",value:function(){return"Probe"}},{key:"getTypeId",value:function(){return 100}},{key:"setPositionFromXYZ",value:function(e,t,n){this._m_Position.setToInXYZ(e,t,n)}},{key:"getPosition",value:function(){return this._m_Position}}])&&o(t.prototype,n),r&&o(t,r),i}(_.default);t.default=m},3330:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}var _;function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t){return i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},i(e,t)}function o(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=s(e);if(t){var _=s(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return u(this,n)}}function u(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function s(e){return s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},s(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var l=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(u,e);var t,n,r,_=o(u);function u(e,t){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),_.call(this,e,t)}return t=u,(n=[{key:"getType",value:function(){return"RefProbe"}},{key:"getTypeId",value:function(){return 5}}])&&a(t.prototype,n),r&&a(t,r),u}(((_=n(6967))&&_.__esModule?_:{default:_}).default);t.default=l},9098:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=l(n(513)),a=l(n(5604)),i=l(n(431)),o=l(n(1846)),u=l(n(2475)),s=l(n(948));function l(e){return e&&e.__esModule?e:{default:e}}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e,t){return m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},m(e,t)}function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=d(e);if(t){var _=d(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return h(this,n)}}function h(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function d(e){return d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},d(e)}var S=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(l,e);var t,n,r,_=c(l);function l(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(n=_.call(this,e,t))._m_Direction=new a.default,n._m_Position=new a.default,n._m_InnerAngle=i.default.toRadians(30),n._m_InnerCorner=Math.cos(n._m_InnerAngle),n._m_OuterAngle=i.default.toRadians(45),n._m_OuterCorner=Math.cos(n._m_OuterAngle),n._m_SpotRange=100,n._m_StepClip=4,n._m_InvSpotRange=1/n._m_SpotRange,n._m_InnerMinusOuter=n._m_InnerCorner-n._m_OuterCorner,n._m_PackedAngleCos=0,n.computeAngleParameters(),n}return t=l,(n=[{key:"getType",value:function(){return"SpotLight"}},{key:"getTypeId",value:function(){return 2}},{key:"_genShadow",value:function(){this._m_ShadowCfg.id=this._m_Id+"_shadow",this._m_Shadow=new s.default(this._m_Scene,this._m_ShadowCfg)}},{key:"setStepClip",value:function(e){e<0&&(e=1),this._m_StepClip=e}},{key:"getStepClip",value:function(){return this._m_StepClip}},{key:"getPackedAngleCos",value:function(){return this._m_PackedAngleCos}},{key:"computeAngleParameters",value:function(){this._m_PackedAngleCos=Math.floor(1e3*this._m_InnerCorner),this._m_PackedAngleCos==Math.floor(1e3*this._m_OuterCorner)&&(this._m_OuterCorner-=.001),this._m_PackedAngleCos+=1*this._m_OuterCorner}},{key:"getInnerMinusOuter",value:function(){return this._m_InnerMinusOuter}},{key:"setSpotRange",value:function(e){e<=0?(this._m_SpotRange=0,this._m_InvSpotRange=0):(this._m_SpotRange=e,this._m_InvSpotRange=1/this._m_SpotRange)}},{key:"getSpotRange",value:function(){return this._m_SpotRange}},{key:"getInvSpotRange",value:function(){return this._m_InvSpotRange}},{key:"setInnerAngle",value:function(e){this._m_InnerAngle=e,this._m_InnerCorner=Math.cos(this._m_InnerAngle),this._m_InnerMinusOuter=this._m_InnerCorner-this._m_OuterCorner,this.computeAngleParameters()}},{key:"getInnerAngle",value:function(){return this._m_InnerAngle}},{key:"setOuterAngle",value:function(e){this._m_OuterAngle=e,this._m_OuterCorner=Math.cos(this._m_OuterAngle),this._m_InnerMinusOuter=this._m_InnerCorner-this._m_OuterCorner,this.computeAngleParameters()}},{key:"getOuterAngle",value:function(){return this._m_OuterAngle}},{key:"setPosition",value:function(e){this._m_Position.setTo(e)}},{key:"setPositionXYZ",value:function(e,t,n){this._m_Position.setToInXYZ(e,t,n)}},{key:"getPosition",value:function(){return this._m_Position}},{key:"setDirection",value:function(e){this._m_Direction.setTo(e),this._m_Direction.normal()}},{key:"setDirectionXYZ",value:function(e,t,n){this._m_Direction.setToInXYZ(e,t,n).normal()}},{key:"getDirection",value:function(){return this._m_Direction}},{key:"getBoundingVolume",value:function(){if(0==this._m_SpotRange)return null;if(this._m_UpdateBoundingVolume){this._m_BoudingVolume||(this._m_BoudingVolume=new o.default);var e=.5*this._m_SpotRange,t=u.default.S_TEMP_VEC3_2;this._m_Direction.multLength(.5*this._m_SpotRange,t).add(this._m_Position);var n=this._m_SpotRange*Math.tan(this._m_OuterCorner);this._m_BoudingVolume.setCenter(t),this._m_BoudingVolume.setRaiuds(Math.max(e,n)),this._m_UpdateBoundingVolume=!1}return this._m_BoudingVolume}}])&&f(t.prototype,n),r&&f(t,r),l}(_.default);t.default=S},4008:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=l(n(9650)),a=l(n(2603)),i=l(n(2768)),o=l(n(9784)),u=l(n(3846)),s=l(n(7341));function l(e){return e&&e.__esModule?e:{default:e}}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e,t){return m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},m(e,t)}function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=d(e);if(t){var _=d(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return h(this,n)}}function h(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function d(e){return d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},d(e)}var S=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(l,e);var t,n,r,_=c(l);function l(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(n=_.call(this,e,t))._m_Params={},n._m_ParamValues={},n._m_CanDefineParams={},n._m_AleadyDefinedParams={},n._m_ChangeParams=[],n._init(),n._m_CurrentSubShader=null,n._m_RenderTechnologys={},n._m_CurrentTechnology=null,t.materialDef?function(){var e=n._m_Scene.getCanvas().getGLContext(),r=t.materialDef,_=r.getParams();for(var o in _)n._m_ParamValues[_[o].getName()]=null,n._m_Params[_[o].getName()]=!0,n._m_CanDefineParams[_[o].getName()]=!0;var u=r.getSubShaderDefs(),s={};for(var l in u)n._initGlobals(r,u[l]),s[u[l].getName()]=new a.default(e,t.frameContext||n._m_Scene.getRender().getFrameContext(),u[l]);var f=r.getTechnologyDefs(),m=null,c=null;for(var h in f){m=f[h],n._m_RenderTechnologys[m.getName()]=new i.default(m.getName()),c=m.getSubPass();var d=function(e){c[e].forEach((function(t){t.getPass().forEach((function(t){n._m_RenderTechnologys[m.getName()].addSubPass(e,s[t.pass.getName()],t.renderState)}))}))};for(var S in c)d(S)}n.selectTechnology(n._m_Scene.getRender().getPriorityTechnology())}():console.log("找不到materialDef..."),n}return t=l,(n=[{key:"getType",value:function(){return"Material"}},{key:"_newAtc",value:function(e,t,n,r,_){"color"==n?t.addTexture(e,r,e.RGBA,0,e.RGBA,e.UNSIGNED_BYTE,e.COLOR_ATTACHMENT0+Number(_),!0):"depth24_stencil8"==n&&t.addBuffer(e,r,e.DEPTH24_STENCIL8,e.DEPTH_STENCIL_ATTACHMENT)}},{key:"_initGlobals",value:function(e){var t=this._m_Scene.getRender().getFrameContext(),n=e.getGlobals(),r=this._m_Scene.getCanvas().getGLContext(),_=this._m_Scene.getCanvas().getWidth(),a=this._m_Scene.getCanvas().getHeight();for(var i in n)if(!t.getFrameBuffer(i)){var o=n[i],l=new s.default(r,i,_,a);if(t.addFrameBuffer(i,l),o){for(var f in o)o[f][0].type,o[f].length>1?this._newAtc(r,l,o[f][1].type,o[f][1].name,o[f][1].loc):o[f].length>0?this._newAtc(r,l,o[f][0].type,o[f][0].name):u.default.log("错误的atc!");l.finish(r,this._m_Scene,!0)}u.default.log("create global "+i)}}},{key:"getRenderTechnology",value:function(e){return this._m_RenderTechnologys.get(e)}},{key:"addTechnology",value:function(e,t){this._m_RenderTechnologys[e]=t}},{key:"selectTechnology",value:function(e){var t=this;if(null==this._m_CurrentTechnology||this._m_RenderTechnologys[e]!=this._m_CurrentTechnology){var n=this._m_CurrentTechnology,r=null!=this._m_CurrentTechnology;if(this._m_CurrentTechnology=this._m_RenderTechnologys[e],null==this._m_CurrentTechnology&&(this._m_CurrentTechnology=null!=n?n:this._m_RenderTechnologys[""]),r){var _=function(e){for(var n in t._m_CurrentTechnology.getSubPassList())t._m_CurrentTechnology.getSubPasss(n).getSubShaders().forEach((function(t){t.subShader.addDefine(e)}))};for(var a in this._m_AleadyDefinedParams)_(a)}}}},{key:"getCurrentTechnology",value:function(){return this._m_CurrentTechnology}},{key:"preload",value:function(){var e=this,t=this.getCurrentTechnology().getSubPassList();t&&function(){var n=e._m_Scene.getCanvas().getGLContext(),r=e._m_Scene.getRender().getFrameContext();for(var _ in t)t[_].getSubShaders().forEach((function(e){e.subShader.needCompile()&&e.subShader._compile(n,r)}))}()}},{key:"_selectSubShader",value:function(e){var t=this,n=!1;this._m_CurrentSubShader=e;var r=this._m_Scene.getCanvas().getGLContext(),_=this._m_Scene.getRender().getFrameContext();if(this._m_CurrentSubShader.needCompile()&&this._m_CurrentSubShader._compile(r,_),_.m_LastSubShaderId!=e.getDefId()&&(e.use(r),_.m_LastSubShaderId=e.getDefId(),_.m_LastMaterial=this,_.m_SM++,n=!0),_.m_LastSubShader!=e)for(var a in _.m_LastSubShader=e,_.m_SS++,this._m_ParamValues)this._m_ParamValues[a]&&this._m_CurrentSubShader.uploadParam(r,a,this._m_ParamValues[a]);return this._m_ChangeParams.length>0&&(this._m_ChangeParams.forEach((function(e){t._m_ParamValues[e.paramName]&&t._m_ParamValues[e.paramName].compare(e.value)||(t._m_CurrentSubShader.uploadParam(r,e.paramName,e.value),t._m_ParamValues[e.paramName]=e.value)})),this._m_ChangeParams.length=0),n}},{key:"_init",value:function(){}},{key:"setParam",value:function(e,t){var n=this;if(this._m_Params[e]){var r=!1;if(this._m_AleadyDefinedParams[e]||(r=!0,this._m_AleadyDefinedParams[e]=!0),r){var _=function(e){for(var t in n._m_CurrentTechnology.getSubPassList())n._m_CurrentTechnology.getSubPasss(t).getSubShaders().forEach((function(t){t.subShader.addDefine(e)}))};for(var a in this._m_AleadyDefinedParams)_(a)}var i=!0;if(this._m_ChangeParams.length>0)for(var o=0;o<this._m_ChangeParams.length;o++)if(this._m_ChangeParams[o].paramName==e){this._m_ChangeParams[o].value=t,i=!1;break}t.owner(this,e),i&&this._m_ChangeParams.push({paramName:e,value:t})}}},{key:"clearParams",value:function(e){}},{key:"addDefine",value:function(e,t){var n=this,r=!1;if(this._m_AleadyDefinedParams[e]||(r=!0,this._m_AleadyDefinedParams[e]=!0),r){var _=function(r){for(var _ in n._m_CurrentTechnology.getSubPassList())n._m_CurrentTechnology.getSubPasss(_).getSubShaders().forEach((function(n){n.subShader.addDefine(r,e==r&&null!=o.default.Context_Data[e],t)}))};for(var a in this._m_AleadyDefinedParams)_(a)}}},{key:"clearDefine",value:function(e,t){}}])&&f(t.prototype,n),r&&f(t,r),l}(_.default);t.default=S},8113:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Component=_interopRequireDefault(__webpack_require__(9650)),_AssetLoader=_interopRequireDefault(__webpack_require__(1193)),_ShaderSource=_interopRequireDefault(__webpack_require__(9784)),_Tools=_interopRequireDefault(__webpack_require__(5397)),_SubShaderDef=_interopRequireDefault(__webpack_require__(4974)),_TechnologyDef=_interopRequireDefault(__webpack_require__(8173)),_Render=_interopRequireDefault(__webpack_require__(3061)),_Log=_interopRequireDefault(__webpack_require__(3846));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var Block=function(){function e(t,n,r,_,a){_classCallCheck(this,e),this.m_Type=t,this.m_Id=n,this.m_Data=r,this.m_Start=_,this.m_End=a,this.m_SubBlock=[]}return _createClass(e,[{key:"getName",value:function(){return this.m_Id}},{key:"getType",value:function(){return this.m_Type}},{key:"addSubBlock",value:function(e){this.m_SubBlock.push(e)}},{key:"getSubBlock",value:function(){return this.m_SubBlock}},{key:"setStart",value:function(e){this.m_Start=e}},{key:"getStart",value:function(){return this.m_Start}},{key:"setEnd",value:function(e){this.m_End=e}},{key:"getEnd",value:function(){return this.m_End}},{key:"getData",value:function(){return this.m_Data}},{key:"toString",value:function(){return"type:"+this.m_Type+"\nid:"+this.m_Id+"\ndata:\n"+this.m_Data+"\n"}}]),e}(),Param=function(){function Param(){_classCallCheck(this,Param),this.m_Name=null,this.m_Type=null,this.m_DefaultValue=null,this.m_Pattern=null,this.m_Pattern2=null,this.m_TagPattern=null,this.m_DefType=null}return _createClass(Param,[{key:"creator",value:function creator(){this.m_Pattern=eval("/Params."+this.m_Name+"/"),this.m_Pattern2=eval("/Params."+this.m_Name+"[\\s+-;.,\\*\\\\]{1,}/"),this.m_TagPattern=eval("/Params."+this.m_Name+"/g"),this.m_DefType=""+this.m_Name}},{key:"getDefType",value:function(){return this.m_DefType}},{key:"getPattern",value:function(){return this.m_Pattern}},{key:"getPattern2",value:function(){return this.m_Pattern2}},{key:"getTagPattern",value:function(){return this.m_TagPattern}},{key:"setName",value:function(e){this.m_Name=e}},{key:"getName",value:function(){return this.m_Name}},{key:"setType",value:function(e){this.m_Type=e}},{key:"getType",value:function(){return this.m_Type}},{key:"setDefaultValue",value:function(e){this.m_DefaultValue=e}},{key:"getDefaultVaule",value:function(){return this.m_DefaultValue}}]),Param}(),SubTechnology=null,SubPassDef=function(){function e(t){_classCallCheck(this,e),this.m_RenderPath=t,this.m_Pass=[],this._m_FromMaterialDef=null}return _createClass(e,[{key:"addPass",value:function(e,t){this.m_Pass.push({pass:e,renderState:t})}},{key:"getPass",value:function(){return this.m_Pass}},{key:"setFromMaterialDef",value:function(e){this._m_FromMaterialDef=e}},{key:"getFromMaterialDef",value:function(){return this._m_FromMaterialDef}}]),e}(),MaterialDef=function(){function MaterialDef(e){_classCallCheck(this,MaterialDef),this._m_Name=e,this._m_Globals={},this._m_Params={},this._m_SubShaderDefs={},this._m_TechnologyDefs={},this._m_FBs={}}return _createClass(MaterialDef,[{key:"addSubShaderDef",value:function(e,t){this._m_SubShaderDefs[e]=t,t.setFromMaterialDef(this)}},{key:"getSubShaderDef",value:function(e){return this._m_SubShaderDefs[e]}},{key:"getSubShaderDefs",value:function(){return this._m_SubShaderDefs}},{key:"addTechnologyDef",value:function(e,t){this._m_TechnologyDefs[e]=t,t.setFromMaterialDef(this)}},{key:"getTechnologyDef",value:function(e){return this._m_TechnologyDefs[e]}},{key:"getTechnologyDefs",value:function(){return this._m_TechnologyDefs}},{key:"addParam",value:function(e){this._m_Params[e.getName()]=e}},{key:"getParams",value:function(){return this._m_Params}},{key:"getGlobalInner",value:function(e){return e.indexOf("color")>-1?"color":e.indexOf("depth24_stencil8")>-1?"depth24_stencil8":e.indexOf("depth")>-1?"depth":e.indexOf("stencil")>-1?"stencil":void 0}},{key:"addGlobal",value:function addGlobal(name,type,dataType,varName){this._m_Globals[name]||(this._m_Globals[name]={});var pName=varName;varName="_"+name+varName,this._m_Globals[name][varName]=[];var innerType=this.getGlobalInner(type),t=type.indexOf("color");if(t>-1){this._m_Globals[name][varName].push({type:innerType,dataType:"uniform sampler2D",refName:name,name:varName,pattern:eval("/Globals"+name+".In"+pName+"/"),pattern2:eval("/Globals"+name+".In"+pName+"[\\s+-;.,\\*\\\\]{1,}/"),tagPattern:eval("/Globals"+name+".In"+pName+"/g")});var loc=type.substring(t+5,type.length);_Log.default.log("loc:"+loc),this._m_Globals[name][varName].push({type:innerType,dataType,loc,refName:name,name:varName,pattern:eval("/Globals"+name+".Out"+pName+"/"),pattern2:eval("/Globals"+name+".Out"+pName+"[\\s+-;.,\\*\\\\]{1,}/"),tagPattern:eval("/Globals"+name+".Out"+pName+"/g")})}else this._m_Globals[name][varName].push({type:innerType,dataType,refName:name,name:varName,pattern:eval("/Globals"+name+".In"+pName+"/"),pattern2:eval("/Globals"+name+".In"+pName+"[\\s+-;.,\\*\\\\]{1,}/"),tagPattern:eval("/Globals"+name+".In"+pName+"/g")})}},{key:"getGlobals",value:function(){return this._m_Globals}},{key:"setName",value:function(e){this._m_Name=e}},{key:"getName",value:function(){return this._m_Name}}],[{key:"load",value:function(e){return MaterialDef.parse(_AssetLoader.default.loadMaterialSourceDef(e))}},{key:"trim",value:function(e){return e.replace(/(^\s*)|(\s*$)/g,"")}},{key:"parseGlobals",value:function(e,t){for(var n=t.getName(),r=t.getData(),_=null,a=t.getStart()+1;a<t.getEnd();a++)_=r[a],_=(_=_Tools.default.trim(_)).substring(0,_.length-1).split(" "),e.addGlobal(n,_[0],_[1],_[2])}},{key:"parseParams",value:function(e,t){for(var n=t.getData(),r=null,_=null,a=t.getStart()+1;a<t.getEnd();a++)r=n[a],(r=_Tools.default.trim(r)).startsWith("//")||(r=r.substring(0,r.length-1).split(" "),(_=new Param).setName(r[1]),_.setType(r[0]),_.creator(),r.length>2&&_.setDefaultValue(r[3]),e.addParam(_))}},{key:"parseSubTechnology",value:function(e,t){t.data}},{key:"parseShader",value:function(e,t){t.getSubBlock().forEach((function(t){MaterialDef.parseBlockDef(e,t)}))}},{key:"parseShaderVars",value:function(e,t){for(var n=t.getData(),r=null,_=t.getStart()+1;_<t.getEnd();_++)r=n[_],(r=_Tools.default.trim(r)).startsWith("//")||(r=(r=r.substring(0,r.length-1)).split(" "),e.addVar(r[0],r[1]))}},{key:"parseAdvanced",value:function(e,t){for(var n=t.getData(),r=null,_=t.getStart()+1;_<t.getEnd();_++)r=n[_],(r=_Tools.default.trim(r)).startsWith("//")||(r=(r=r.substring(0,r.length-1)).split(" "))[0].startsWith("RenderProgram")&&e.setRenderProgramType(r[1])}},{key:"parseVsShader",value:function(e,t){for(var n=t.getData(),r=null,_="",a=[],i=[],o=e.getVarTable(),u=e.getFromMaterialDef().getParams(),s=null,l=!1,f=[],m={},c={},h={},d=function(t){if((r=_Tools.default.trim(n[t])).startsWith("//"))return"continue";var d=null,S=-1,p=-1,g=null;if(o.forEach((function(e){-1!=(S=_Tools.default.find2(r,e.pattern))&&(null!=(p=_Tools.default.find2(r,e.pattern2))&&p!=S&&(S=p),g||(g={}),null!=g[S]?g[S].name.length<e.name.length&&(g[S]=e):g[S]=e)})),g)for(var y in g)d=g[y],h[d.name]||(h[d.name]=!0,i.push(d));for(var v in d=null,S=-1,p=-1,g=null,u)s=u[v],-1!=(S=_Tools.default.find2(r,s.getPattern()))&&(null!=(p=_Tools.default.find2(r,s.getPattern2()))&&p!=S&&(S=p),g||(g={}),null!=g[S]?g[S].getName().length<s.getName().length&&(g[S]=s):g[S]=s);if(g)for(var T in g)d=g[T],m[d.getName()]||(f.push(d),m[d.getName()]=!0),r=_Tools.default.repSrc(r,d.getPattern(),d.getTagPattern(),d.getName()),l=!0;var E=null;for(var b in g=null,_ShaderSource.default.Context_Data)if(null!=(E=_ShaderSource.default.Context_Data[b]).pattern&&(-1!=(S=_Tools.default.find2(r,E.pattern))&&(null!=(p=_Tools.default.find2(r,E.pattern2))&&p!=S&&(S=p),g||(g={}),null!=g[S]?g[S].src.length<E.src.length&&(g[S]=E):g[S]=E),g))for(var C in g)E=g[C],c[E.src]||(E.isFlagVariable?e.addContextDefine(_ShaderSource.default.VERTEX_SHADER,E.src):(c[E.src]=!0,a.push(E))),r=_Tools.default.repSrc(r,E.pattern,E.tagPattern,E.tag);_+=_Tools.default.trim(r)+"\n"},S=t.getStart()+1;S<t.getEnd();S++)d(S);if(l){e.addUseParams(_ShaderSource.default.VERTEX_SHADER,f);var p="\n";for(var g in f)p+="uniform "+(s=f[g]).getType()+" "+s.getName()+";\n";_=p+_}if(i.length>0){var y="\n";i.forEach((function(e){y+="out "+e.type+" "+e.name+";\n"})),_=y+_}if(a.length>0){var v={},T=[];e.addUseContexts(a);var E="\n";for(var b in a.forEach((function(e){null!=e.loc||null!=e.loc?E+="layout (location="+e.loc+") in "+e.type+" "+e.src+";\n":e.def?(v[e.def]||T.push(e.def),v[e.def]=e.def):e.utype?(E+=e.utype+" "+e.src,e.modifier&&(E+=e.modifier),E+=";\n"):e.type&&(E+=e.type+" "+e.src+";\n")})),e.addUseBlocks(T),v)E+=_ShaderSource.default.BLOCKS[b].blockDef;_=E+_}_="#version 300 es\n"+_,e.addShaderSource(_ShaderSource.default.VERTEX_SHADER,_)}},{key:"parseVsShaderFun",value:function(e,t){}},{key:"parseVsShaderMain",value:function(e,t){for(var n=t.getData(),r=null,_="void main(){\n",a=[],i=[],o=e.getVarTable(),u=e.getFromMaterialDef().getParams(),s=null,l=!1,f=[],m={},c={},h={},d=t.getStart()+1;d<t.getEnd();d++)if(!(r=_Tools.default.trim(n[d])).startsWith("//")){for(var S in o.forEach((function(e){_Tools.default.find(r,e.pattern)&&(h[e.name]||(h[e.name]=!0,i.push(e)))})),u)s=u[S],_Tools.default.find(r,s.getPattern())&&(m[s.getName()]||(f.push(s),m[s.getName()]=!0),r=_Tools.default.repSrc(r,s.getPattern(),s.getTagPattern(),s.getName()),l=!0);var p=null;for(var g in _ShaderSource.default.Context_Data)p=_ShaderSource.default.Context_Data[g],_Tools.default.find(r,p.pattern)&&(c[p.src]||(c[p.src]=!0,a.push(p)),r=_Tools.default.repSrc(r,p.pattern,p.tagPattern,p.tag));_+=_Tools.default.trim(r)+"\n"}if(_+="}\n",l){e.addUseParams(f);var y="\n";for(var v in f)y+="uniform "+(s=f[v]).getType()+" "+s.getName()+";\n";_=y+_}if(i.length>0){var T="\n";i.forEach((function(e){T+="out "+e.type+" "+e.name+";\n"})),_=T+_}if(a.length>0){var E={},b=[];e.addUseContexts(a);var C="\n";for(var P in a.forEach((function(e){null!=e.loc||null!=e.loc?C+="layout (location="+e.loc+") in "+e.type+" "+e.src+";\n":e.def?(E[e.def]||b.push(e.def),E[e.def]=e.def):e.utype?(C+=e.utype+" "+e.src,e.modifier&&(C+=e.modifier),C+=";\n"):e.type&&(C+=e.type+" "+e.src+";\n")})),e.addUseBlocks(b),E)C+=_ShaderSource.default.BLOCKS[P].blockDef;_=C+_}return _="#version 300 es\n"+_}},{key:"parseFsShader",value:function(e,t){for(var n=t.getData(),r=null,_="",a=[],i=[],o=e.getVarTable(),u=e.getFromMaterialDef().getGlobals(),s=null,l=e.getFromMaterialDef().getParams(),f=null,m=!1,c=[],h=!1,d={},S={},p={},g={},y=[],v=null,T=function(t){if((r=_Tools.default.trim(n[t])).startsWith("//"))return"continue";var v=null,T=-1,E=-1,b=null;if(o.forEach((function(e){-1!=(T=_Tools.default.find2(r,e.pattern))&&(null!=(E=_Tools.default.find2(r,e.pattern2))&&E!=T&&(T=E),b||(b={}),null!=b[T]?b[T].name.length<e.name.length&&(b[T]=e):b[T]=e)})),b)for(var C in b)v=b[C],p[v.name]||(p[v.name]=!0,i.push(v));v=null,T=-1,E=-1,b=null;var P=null;for(var R in u)for(var M in s=u[R])for(var A=0;A<s[M].length;A++)P=s[M][A],-1!=(T=_Tools.default.find2(r,P.pattern))&&(null!=(E=_Tools.default.find2(r,P.pattern2))&&E!=T&&(T=E),b||(b={}),null!=b[T]?b[T].name.length<f.name.length&&(b[T]=P):b[T]=P);if(b)for(var w in b)v=b[w],g[v.name]||(y.push(v),g[v.name]=!0),r=_Tools.default.repSrc(r,v.pattern,v.tagPattern,v.name),h=!0;for(var I in v=null,T=-1,E=-1,b=null,l)f=l[I],-1!=(T=_Tools.default.find2(r,f.getPattern()))&&(null!=(E=_Tools.default.find2(r,f.getPattern2()))&&E!=T&&(T=E),b||(b={}),null!=b[T]?b[T].getName().length<f.getName().length&&(b[T]=f):b[T]=f);if(b)for(var L in b)v=b[L],d[v.getName()]||(c.push(v),d[v.getName()]=!0),r=_Tools.default.repSrc(r,v.getPattern(),v.getTagPattern(),v.getName()),m=!0;var D=null;for(var O in b=null,_ShaderSource.default.Context_Data)if(null!=(D=_ShaderSource.default.Context_Data[O]).pattern&&(-1!=(T=_Tools.default.find2(r,D.pattern))&&(null!=(E=_Tools.default.find2(r,D.pattern2))&&E!=T&&(T=E),b||(b={}),null!=b[T]?b[T].src.length<D.src.length&&(b[T]=D):b[T]=D),b))for(var F in b)D=b[F],S[D.src]||(D.isFlagVariable?e.addContextDefine(_ShaderSource.default.FRAGMENT_SHADER,D.src):(S[D.src]=!0,a.push(D))),r=_Tools.default.repSrc(r,D.pattern,D.tagPattern,D.tag);_+=_Tools.default.trim(r)+"\n"},E=t.getStart()+1;E<t.getEnd();E++)T(E);if(m){e.addUseParams(_ShaderSource.default.FRAGMENT_SHADER,c);var b="\n";for(var C in c)b+="uniform "+(f=c[C]).getType()+" "+f.getName()+";\n";_=b+_}if(h){e.addUseGlobals(y);var P="\n",R=null;for(var M in y)null!=(R=y[M]).loc||null!=R.loc?P+="layout (location="+R.loc+") out "+R.dataType+" "+R.name+";\n":P+=R.dataType+" "+R.name+";\n";_=P+_}if(i.length>0){var A="\n";i.forEach((function(e){A+="in "+e.type+" "+e.name+";\n"})),_=A+_}if(a.length>0){var w={},I=[];e.addUseContexts(a);var L="\n";for(var D in a.forEach((function(e){null!=e.loc||null!=e.loc?(v=_ShaderSource.default.Context_RenderDataRefFBs[e.src],L+="layout (location="+e.loc+") out "+e.type+" "+e.src+";\n"):e.def?(w[e.def]||I.push(e.def),w[e.def]=e.def):e.utype?(L+=e.utype+" "+e.src,e.modifier&&(L+=e.modifier),L+=";\n"):e.type&&(L+=e.type+" "+e.src+";\n")})),e.addUseBlocks(I),w)L+=_ShaderSource.default.BLOCKS[D].blockDef;_=L+_}_="#version 300 es\nprecision mediump float;\n"+_,e.addShaderSource(_ShaderSource.default.FRAGMENT_SHADER,_),e.setFBId(v)}},{key:"parseFsShaderFun",value:function(e,t){}},{key:"parseFsShaderMain",value:function(e,t){for(var n=t.getData(),r=null,_="void main(){\n",a=[],i=[],o=e.getVarTable(),u=e.getFromMaterialDef().getParams(),s=null,l=!1,f=[],m={},c={},h={},d=null,S=t.getStart()+1;S<t.getEnd();S++)if(!(r=_Tools.default.trim(n[S])).startsWith("//")){for(var p in o.forEach((function(e){_Tools.default.find(r,e.pattern)&&(h[e.name]||(h[e.name]=!0,i.push(e)))})),u)s=u[p],_Tools.default.find(r,s.getPattern())&&(m[s.getName()]||(f.push(s),m[s.getName()]=!0),r=_Tools.default.repSrc(r,s.getPattern(),s.getTagPattern(),s.getName()),l=!0);var g=null;for(var y in _ShaderSource.default.Context_Data)g=_ShaderSource.default.Context_Data[y],_Tools.default.find(r,g.pattern)&&(c[g.src]||(c[g.src]=!0,a.push(g)),r=_Tools.default.repSrc(r,g.pattern,g.tagPattern,g.tag));_+=_Tools.default.trim(r)+"\n"}if(_+="}\n",l){e.addUseParams(f);var v="\n";for(var T in f)v+="uniform "+(s=f[T]).getType()+" "+s.getName()+";\n";_=v+_}if(i.length>0){var E="\n";i.forEach((function(e){E+="in "+e.type+" "+e.name+";\n"})),_=E+_}if(a.length>0){e.addUseContexts(a);var b="\n";a.forEach((function(e){null!=e.loc||null!=e.loc?(d=_ShaderSource.default.Context_RenderDataRefFBs[e.src],b+="layout (location="+e.loc+") out "+e.type+" "+e.src+";\n"):e.utype?b+=e.utype+" "+e.src+";\n":e.type&&(b+=e.type+" "+e.src+";\n")})),_=b+_}return _="#version 300 es\nprecision mediump float;\n"+_,e.setFBId(d),_}},{key:"parseSubPass",value:function(e,t){var n=t.getName();null!=n&&""!=n||(n=_Render.default.FORWARD);for(var r=t.getData(),_=null,a=t.getStart()+1;a<t.getEnd();a++)_=r[a],(_=_Tools.default.trim(_)).startsWith("//")||(_=_.substring(0,_.length-1),e.addSubPass(n,e.getFromMaterialDef().getSubShaderDef(_)))}},{key:"parsePass",value:function(e,t){for(var n=t.getData(),r=null,_={},a=t.getStart()+1;a<t.getEnd();a++)if(r=n[a],!(r=_Tools.default.trim(r)).startsWith("//")&&0!=r.length)if((r=(r=r.substring(0,r.length-1)).split(" ")).length>2){for(var i=[],o=1;o<r.length;o++)i.push(r[o]);_[""+r[0]]=i}else _[""+r[0]]=""+r[1];e.addPass(e.getFromMaterialDef().getSubShaderDef(t.getName()),_)}},{key:"parseBlockDef",value:function(e,t){if(t){switch(t.getType()){case"Def":e.setName(t.getName());break;case"Globals":MaterialDef.parseGlobals(e,t);break;case"Params":MaterialDef.parseParams(e,t);break;case"SubTechnology":var n=new _SubShaderDef.default(t.getName());e.addSubShaderDef(n.getName(),n),e=n;break;case"Vs_Shader":return void MaterialDef.parseVsShader(e,t);case"Fs_Shader":return void MaterialDef.parseFsShader(e,t);case"Vars":MaterialDef.parseShaderVars(e,t);break;case"Advanced":MaterialDef.parseAdvanced(e,t);break;case"Vs_Shader_Main":case"Fs_Shader_Main":break;case"Technology":var r=new _TechnologyDef.default(t.getName());e.addTechnologyDef(t.getName(),r),e=r;break;case"Sub_Pass":var _=t.getName();null!=_&&""!=_||(_=_Render.default.FORWARD);var a=new SubPassDef(_);e.addSubPass(_,a),e=a;break;case"Pass":MaterialDef.parsePass(e,t)}t.getSubBlock().forEach((function(t){MaterialDef.parseBlockDef(e,t)}))}}},{key:"getBlockDef",value:function(e,t,n){for(var r=1,_=null,a=n+1;a<t.length;a++)if(!(_=MaterialDef.trim(t[a])).startsWith("//")){if(_.endsWith("{")){r++;var i=_.substring(0,_.indexOf("{")).split(" "),o=i[0];"void"==o&&(o=e.getType()+"_Main");var u="";i.length>1&&(u=i[i.length-1]);var s=new Block(o,u,t,a);2==r&&e.addSubBlock(s),this.getBlockDef(s,t,a)}else _.endsWith("}")&&r--;if(0==r){e.setEnd(a);break}}}},{key:"parse",value:function(e){if(e){e=e.split("\n");for(var t=0;t<e.length;t++){var n=MaterialDef.trim(e[t]);if(!n.startsWith("//")&&n.endsWith("{")){var r=n.substring(0,n.indexOf("{")).split(" "),_=r[0];if("void"!=_){var a="";r.length>1&&(a=r[r.length-1]);var i=new Block(_,a,e,t);MaterialDef.getBlockDef(i,e,t);var o=new MaterialDef(i.getName());return MaterialDef.parseBlockDef(o,i),o}}}}return null}}]),MaterialDef}();exports.default=MaterialDef},5449:(e,t)=>{function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._m_RenderPath=t,this._m_SubShaders=[],this._m_SubShaderMaps={},this._m_FBId=null,this._m_PassId=0}var t,r,_;return t=e,(r=[{key:"setFBId",value:function(e){this._m_FBId=e}},{key:"getFBId",value:function(){return this._m_FBId}},{key:"getRenderPath",value:function(){return this._m_RenderPath}},{key:"addSubShader",value:function(e){this._m_SubShaders.push(e),this._m_SubShaderMaps[e.subShader.getName()]=e,this._m_SubShaderMaps[this._m_PassId++]=e}},{key:"getSubShaders",value:function(){return this._m_SubShaders}},{key:"getSubShaderMaps",value:function(){return this._m_SubShaderMaps}}])&&n(t.prototype,r),_&&n(t,_),e}();t.default=r},2603:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(n(9784)),_=o(n(9836)),a=o(n(5397)),i=o(n(3846));function o(e){return e&&e.__esModule?e:{default:e}}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._m_Def=r,this._m_ObjId=a.default.nextId(),this._m_DefId=r.getDefId(),this._m_Name=r.getName(),this._m_MatParams={},this._m_CanDefineParams={},this._m_AleadyDefinedParams={},this._m_Params={},this._m_ParamValues={},this._m_Defines=null,this._m_KeyDefs=null,this._m_NeedLoadShaderCaches=!1,this._m_ContextVars={},this._m_RenderDatas={},this._m_FBId=r.getFBId(),this._m_RefRenderDataFBs=null,this._m_RenderProgramType=r.getRenderProgramType(),this._loadParams(),this._newShaderProgram(t,n)}var t,n,o;return t=e,(n=[{key:"getSId",value:function(){return this._m_DefId}},{key:"_loadParams",value:function(){var e=this,t=this._m_Def.getUseParams();t&&t.length>0&&t.forEach((function(t){e._m_CanDefineParams[t.getName()]="#define "+t.getDefType()+" "+t.getDefType(),e._m_Params[t.getName()]=!0}))}},{key:"uploadParam",value:function(e,t,n){if(this._m_MatParams[t]){if(this._m_ParamValues[t]&&this._m_ParamValues[t].compare(n))return;n._upload(e,this._m_MatParams[t].loc,null),this._m_ParamValues[t]=n}}},{key:"needCompile",value:function(){return this._m_NeedLoadShaderCaches||null!=this._m_Defines||this._m_ShaderProgram.needCompile()}},{key:"_compile",value:function(e,t){this._m_Defines&&this._newShaderProgram(e,t),this._m_ShaderProgram.needCompile()&&(this._m_ShaderProgram._compile(e),this._m_RenderDatas={},i.default.log("编译!")),this._loadShaderCaches(e,t)}},{key:"_loadShaderCaches",value:function(e,t){var n=this;this._m_MatParams=[],this._m_NeedLoadShaderCaches=!1,this.use(e);var _=this._m_Def.getUseParams(),a=this._m_Def.getUseGlobals(),i=this._m_Def.getUseContexts(),o=0;if(_&&_.length>0&&_.forEach((function(t){var r=e.getUniformLocation(n._m_ShaderProgram.getProgram(),t.getName());if(r){var _=null;switch(t.getType()){case"vec4":_="uniform4f";break;case"sampler2D":case"samplerCube":e.uniform1i(r,o),_=null,r=o++}n._m_MatParams[t.getName()]={type:t.getType(),loc:r,fun:_}}})),a&&a.length>0){var u=null,s=null;a.forEach((function(t){null==t.loc||null==t.loc?n._m_RenderDatas[t.name]||(u=e.getUniformLocation(n._m_ShaderProgram.getProgram(),t.name),e.uniform1i(u,o),s=null,u=o++,n._m_RenderDatas[t.name]={type:t.type,loc:u,fun:s,refId:t.refName,dataId:t.name}):n._m_FBId=t.refName}))}i&&i.length>0&&i.forEach((function(_){if(null==_.loc||null==_.loc){var a=e.getUniformLocation(n._m_ShaderProgram.getProgram(),_.src);if(a){var i=null;switch(_.type){case"mat4":i="uniformMatrix4fv";break;case"samplerCube":case"sampler2D":e.uniform1i(a,o),i=null,a=o++,"renderData"==_.flag&&(n._m_RenderDatas[_.src]={type:_.type,loc:a,fun:i,refId:r.default.Context_RenderDataRefFBs[_.src],dataId:_.src})}n._m_ContextVars[_.src]={type:_.type,loc:a,fun:i},n._m_MatParams[_.src]={type:_.type,loc:a,fun:i}}t.addContext(_.src)}}));var l=this._m_Def.getUseBlocks();l&&l.length>0&&l.forEach((function(t){e.uniformBlockBinding(n._m_ShaderProgram.getProgram(),e.getUniformBlockIndex(n._m_ShaderProgram.getProgram(),t),r.default.BLOCKS[t].blockIndex)})),t.m_LastSubShader&&t.m_LastSubShader.use(e)}},{key:"getRenderProgramType",value:function(){return this._m_RenderProgramType}},{key:"getName",value:function(){return this._m_Name}},{key:"getDefId",value:function(){return this._m_DefId}},{key:"setFBId",value:function(e){this._m_FBId=e}},{key:"getFBId",value:function(){return this._m_FBId}},{key:"use",value:function(e){this._m_ShaderProgram.use(e)}},{key:"getContextVars",value:function(){return this._m_ContextVars}},{key:"getRenderDatas",value:function(){return this._m_RenderDatas}},{key:"getRefRenderDataFBs",value:function(){return this._m_RefRenderDataFBs}},{key:"addDefine",value:function(e,t,n){var _=!1;if(this._m_AleadyDefinedParams[e]||(this._m_CanDefineParams[e]||t)&&(_=!0,this._m_AleadyDefinedParams[e]=!0),_){for(var a in this._m_Defines=null,this._m_KeyDefs=null,this._m_AleadyDefinedParams){this._m_Defines||(this._m_Defines={});var i=this._m_Def.getShaderParams(),o=this._m_Def.getShaderContextDefines();i[r.default.VERTEX_SHADER]&&i[r.default.VERTEX_SHADER][a]||o[r.default.VERTEX_SHADER]&&o[r.default.VERTEX_SHADER][a]?(this._m_Defines[r.default.VERTEX_SHADER]||(this._m_Defines[r.default.VERTEX_SHADER]=""),t&&a==e||null!=r.default.Context_Data[a]?this._m_Defines[r.default.VERTEX_SHADER]+=r.default.Context_Data[a]+"\n":this._m_Defines[r.default.VERTEX_SHADER]+=this._m_CanDefineParams[a]+"\n",this._m_KeyDefs||(this._m_KeyDefs=""),this._m_KeyDefs+=a+","):(i[r.default.FRAGMENT_SHADER]&&i[r.default.FRAGMENT_SHADER][a]||o[r.default.FRAGMENT_SHADER]&&o[r.default.FRAGMENT_SHADER][a])&&(this._m_Defines[r.default.FRAGMENT_SHADER]||(this._m_Defines[r.default.FRAGMENT_SHADER]=""),t&&a==e||null!=r.default.Context_Data[a]?this._m_Defines[r.default.FRAGMENT_SHADER]+=r.default.Context_Data[a]+"\n":this._m_Defines[r.default.FRAGMENT_SHADER]+=this._m_CanDefineParams[a]+"\n",this._m_KeyDefs||(this._m_KeyDefs=""),this._m_KeyDefs+=a+",")}if(null!=this._m_Defines&&n){var u=this._m_ShaderProgram._m_Holds;for(var s in u)u[s]!=this&&u[s]&&(u[s]._m_KeyDefs=this._m_KeyDefs,u[s]._m_Defines=this._m_Defines)}}}},{key:"_newShaderProgram",value:function(e,t){if(this._m_Defines){var n=this._m_KeyDefs;n&&n.length>0&&(n=n.substr(0,n.length-1),this._m_DefId=this._m_Def.computeSignatureDefId(n))}t.m_Shaders[this._m_DefId]?(this._m_ShaderProgram&&(this._m_ShaderProgram.deleteHold(this),this._m_ShaderProgram.canDestroy()&&this._m_ShaderProgram.destroy(e,t)),this._m_ShaderProgram=t.m_Shaders[this._m_DefId],this._m_ShaderProgram.addHold(this),this._m_Defines=null):(this._m_ShaderProgram&&(this._m_ShaderProgram.deleteHold(this),this._m_ShaderProgram.canDestroy()&&this._m_ShaderProgram.destroy(e,t)),this._m_ShaderProgram=new _.default(e,this._m_DefId,this._m_Def.getShaderSource(),this._m_Defines,!0),t.m_Shaders[this._m_DefId]=this._m_ShaderProgram,this._m_ShaderProgram.addHold(this),this._m_Defines=null),this._m_NeedLoadShaderCaches=!0}},{key:"getRef",value:function(e,t){return e.getUniformLocation(this._m_ShaderProgram.getProgram(),t)}}])&&u(t.prototype,n),o&&u(t,o),e}();t.default=s},4974:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _ShaderSource=_interopRequireDefault(__webpack_require__(9784)),_Tools=_interopRequireDefault(__webpack_require__(5397));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var SubShaderDef=function(){function SubShaderDef(e){_classCallCheck(this,SubShaderDef),this._m_Name=e,this._m_DefId=null,this._m_Signature=null,this._m_ShaderSource=new _ShaderSource.default,this._m_FromMaterialDef=null,this._m_Var_Table=[],this._m_UseContexts=[],this._m_UseParams=[],this._m_UseGlobals=[],this._m_ShaderParams={},this._m_ShaderContextDefines={},this._m_UseBlocks=[],this._m_FBId=null,this._m_RefFBs=null,this._m_RenderProgramType=null}return _createClass(SubShaderDef,[{key:"setRenderProgramType",value:function(e){this._m_RenderProgramType=e}},{key:"getRenderProgramType",value:function(){return this._m_RenderProgramType}},{key:"setFBId",value:function(e){this._m_FBId=e}},{key:"getFBId",value:function(){return this._m_FBId}},{key:"computeSignatureDefId",value:function(e){if(e){var t=e.split(",").sort((function(e,t){return e.localeCompare(t)}));return e="",t.forEach((function(t){e+=t+","})),e=e.substr(0,e.length-1),_Tools.default.uniqueId(this._m_Signature+e)}return this._m_DefId=_Tools.default.uniqueId(this._m_Signature),this._m_DefId}},{key:"getDefId",value:function(){return this._m_DefId}},{key:"addUseContexts",value:function(e){var t=this;e.forEach((function(e){t._m_UseContexts.push(e)}))}},{key:"getUseContexts",value:function(){return this._m_UseContexts}},{key:"addUseGlobals",value:function(e){var t=this;e.forEach((function(e){t._m_UseGlobals.push(e)}))}},{key:"getUseGlobals",value:function(){return this._m_UseGlobals}},{key:"addUseParams",value:function(e,t){var n=this;t.forEach((function(t){n._m_UseParams.push(t),e==_ShaderSource.default.VERTEX_SHADER?(n._m_ShaderParams[_ShaderSource.default.VERTEX_SHADER]||(n._m_ShaderParams[_ShaderSource.default.VERTEX_SHADER]={}),n._m_ShaderParams[_ShaderSource.default.VERTEX_SHADER][t.getName()]=!0):e==_ShaderSource.default.FRAGMENT_SHADER&&(n._m_ShaderParams[_ShaderSource.default.FRAGMENT_SHADER]||(n._m_ShaderParams[_ShaderSource.default.FRAGMENT_SHADER]={}),n._m_ShaderParams[_ShaderSource.default.FRAGMENT_SHADER][t.getName()]=!0)}))}},{key:"addContextDefine",value:function(e,t){this._m_ShaderContextDefines[e]||(this._m_ShaderContextDefines[e]={}),this._m_ShaderContextDefines[e][t]=!0}},{key:"getShaderParams",value:function(){return this._m_ShaderParams}},{key:"getShaderContextDefines",value:function(){return this._m_ShaderContextDefines}},{key:"getUseParams",value:function(){return this._m_UseParams}},{key:"addUseBlocks",value:function(e){var t=this;e.forEach((function(e){t._m_UseBlocks.push(e)}))}},{key:"getUseBlocks",value:function(){return this._m_UseBlocks}},{key:"setFromMaterialDef",value:function(e){this._m_FromMaterialDef=e,this._m_Signature=e.getName()+this.getName(),this.computeSignatureDefId()}},{key:"getFromMaterialDef",value:function(){return this._m_FromMaterialDef}},{key:"getName",value:function(){return this._m_Name}},{key:"addVar",value:function addVar(type,name){this._m_Var_Table.push({type,name,pattern:eval("/"+name+"/"),pattern2:eval("/"+name+"[\\s+-;.,\\*\\\\]{1,}/")})}},{key:"getVarTable",value:function(){return this._m_Var_Table}},{key:"addShaderSource",value:function(e,t){this._m_ShaderSource.set(e,t)}},{key:"getShaderSource",value:function(){return this._m_ShaderSource}}]),SubShaderDef}();exports.default=SubShaderDef},7057:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,_=(r=n(9784))&&r.__esModule?r:{default:r};function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._m_ShaderSource=null,this._m_ShaderSource=new _.default,this._m_ShaderSource.set(_.default.VERTEX_SHADER,t.getVsSrc()),this._m_ShaderSource.set(_.default.FRAGMENT_SHADER,t.getFsSrc())}var t,n,r;return t=e,(n=[{key:"getShaderSource",value:function(){return this._m_ShaderSource}}])&&a(t.prototype,n),r&&a(t,r),e}();t.default=i},2768:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(8435)),_=a(n(5449));function a(e){return e&&e.__esModule?e:{default:e}}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._m_Name=t,this._m_SubPasss={}}var t,n,a;return t=e,(n=[{key:"setName",value:function(e){this._m_Name=e}},{key:"addSubPass",value:function(e,t,n){this._m_SubPasss[e]||(this._m_SubPasss[e]=new _.default(e));var a=null;if(n)for(var i in n)a||(a=new r.default),a.setFlag(i,n[i]);this._m_SubPasss[e].addSubShader({subShader:t,renderState:a})}},{key:"getSubPasss",value:function(e){return this._m_SubPasss[e]}},{key:"getSubPassList",value:function(){return this._m_SubPasss}}])&&i(t.prototype,n),a&&i(t,a),e}();t.default=o},8173:(e,t)=>{function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.m_Name=t,this.m_SubPass={},this._m_FromMaterialDef=null}var t,r,_;return t=e,(r=[{key:"getName",value:function(){return this.m_Name}},{key:"setFromMaterialDef",value:function(e){this._m_FromMaterialDef=e}},{key:"getFromMaterialDef",value:function(){return this._m_FromMaterialDef}},{key:"addSubPass",value:function(e,t){this.m_SubPass[e]||(this.m_SubPass[e]=[]),this.m_SubPass[e].push(t),t.setFromMaterialDef(this._m_FromMaterialDef)}},{key:"getSubPass",value:function(){return this.m_SubPass}}])&&n(t.prototype,r),_&&n(t,_),e}();t.default=r},3801:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=u(n(1322)),a=u(n(7088)),i=u(n(5604)),o=u(n(2320));function u(e){return e&&e.__esModule?e:{default:e}}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t){return l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},l(e,t)}function f(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=c(e);if(t){var _=c(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return m(this,n)}}function m(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function c(e){return c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},c(e)}function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var d=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(m,e);var t,n,r,u=f(m);function m(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,m),(t=u.call(this,e))._m_XHalf=0,t._m_YHalf=0,t._m_ZHalf=0,t}return t=m,(n=[{key:"setHalfInXYZ",value:function(e,t,n){this._m_XHalf=e,this._m_YHalf=t,this._m_ZHalf=n}},{key:"setHalf",value:function(e){this._m_XHalf=e._m_X,this._m_YHalf=e._m_Y,this._m_ZHalf=e._m_Z}},{key:"setXHalf",value:function(e){this._m_XHalf=e}},{key:"getXHalf",value:function(){return this._m_XHalf}},{key:"setYHalf",value:function(e){this._m_YHalf=e}},{key:"getYHalf",value:function(){return this._m_YHalf}},{key:"setZHalf",value:function(e){this._m_ZHalf=e}},{key:"getZHalf",value:function(){return this._m_ZHalf}},{key:"getType",value:function(){return _.default.S_TYPE_AABB}},{key:"fromPositions",value:function(e){for(var t=Number.MAX_VALUE,n=Number.MAX_VALUE,r=Number.MAX_VALUE,_=-Number.MAX_VALUE,a=-Number.MAX_VALUE,i=-Number.MAX_VALUE,o=0;o<e.length;o+=3)t=Math.min(e[o],t),n=Math.min(e[o+1],n),r=Math.min(e[o+2],r),_=Math.max(e[o],_),a=Math.max(e[o+1],a),i=Math.max(e[o+2],i);this._m_Center.setToInXYZ(t+_,n+a,r+i),this._m_Center.multLength(.5),this._m_XHalf=Math.abs(_-this._m_Center._m_X),this._m_YHalf=Math.abs(a-this._m_Center._m_Y),this._m_ZHalf=Math.abs(i-this._m_Center._m_Z)}},{key:"fromMinMax",value:function(e,t){this._m_Center.setTo(t),this._m_Center.add(e),this._m_Center.multLength(.5),this._m_XHalf=Math.abs(t._m_X-this._m_Center._m_X),this._m_YHalf=Math.abs(t._m_Y-this._m_Center._m_Y),this._m_ZHalf=Math.abs(t._m_Z-this._m_Center._m_Z)}},{key:"whichSide",value:function(e){var t=e.distance(this._m_Center),n=e.getNormal(),r=Math.abs(this._m_XHalf*n._m_X)+Math.abs(this._m_YHalf*n._m_Y)+Math.abs(this._m_ZHalf*n._m_Z);return t>r?a.default.S_SIDE_POSITIVE:t<-r?a.default.S_SIDE_NEGATIVE:a.default.S_SIDE_NONE}},{key:"_mergeFromCenterAndHalf",value:function(e,t,n,r){if(this._m_XHalf==Number.POSITIVE_INFINITY||t==Number.POSITIVE_INFINITY)this._m_Center._m_X=0,this._m_XHalf=Number.POSITIVE_INFINITY;else{var _=this._m_Center._m_X-this._m_XHalf;_>e._m_X-t&&(_=e._m_X-t);var a=this._m_Center._m_X+this._m_XHalf;a<e._m_X+t&&(a=e._m_X+t),this._m_Center._m_X=(_+a)/2,this._m_XHalf=a-this._m_Center._m_X}if(this._m_YHalf==Number.POSITIVE_INFINITY||t==Number.POSITIVE_INFINITY)this._m_Center._m_Y=0,this._m_YHalf=Number.POSITIVE_INFINITY;else{var i=this._m_Center._m_Y-this._m_YHalf;i>e._m_Y-n&&(i=e._m_Y-n);var o=this._m_Center._m_Y+this._m_YHalf;o<e._m_Y+n&&(o=e._m_Y+n),this._m_Center._m_Y=(i+o)/2,this._m_YHalf=o-this._m_Center._m_Y}if(this._m_ZHalf==Number.POSITIVE_INFINITY||t==Number.POSITIVE_INFINITY)this._m_Center._m_Z=0,this._m_ZHalf=Number.POSITIVE_INFINITY;else{var u=this._m_Center._m_Z-this._m_ZHalf;u>e._m_Z-r&&(u=e._m_Z-r);var s=this._m_Center._m_Z+this._m_ZHalf;s<e._m_Z+r&&(s=e._m_Z+r),this._m_Center._m_Z=(u+s)/2,this._m_ZHalf=s-this._m_Center._m_Z}return this}},{key:"merge",value:function(e){if(!e)return this;switch(e.getType()){case _.default.S_TYPE_AABB:return this._mergeFromCenterAndHalf(e._m_Center,e._m_XHalf,e._m_YHalf,e._m_ZHalf);case _.default.S_TYPE_SPHERE:}}},{key:"setTo",value:function(e){e.getType()==_.default.S_TYPE_AABB&&(this._m_Center.setTo(e._m_Center),this._m_XHalf=e._m_XHalf,this._m_YHalf=e._m_YHalf,this._m_ZHalf=e._m_ZHalf)}},{key:"transform",value:function(e,t,n,r){r=r||m.S_TEMP_AABB,this._m_Center.mult(e,r._m_Center),t.multVec3(r._m_Center),r._m_Center.add(n),m.S_TEMP_VEC3.setToInXYZ(this._m_XHalf*Math.abs(e._m_X),this._m_YHalf*Math.abs(e._m_Y),this._m_ZHalf*Math.abs(e._m_Z)),o.default.fromQuaternion(t,m.S_TEMP_MAT4),m.S_TEMP_MAT4.absLocal(),o.default.multiplyMV3In3x3(m.S_TEMP_VEC32,m.S_TEMP_VEC3,m.S_TEMP_MAT4),r._m_XHalf=Math.abs(m.S_TEMP_VEC32._m_X),r._m_YHalf=Math.abs(m.S_TEMP_VEC32._m_Y),r._m_ZHalf=Math.abs(m.S_TEMP_VEC32._m_Z)}},{key:"transformFromMat44",value:function(e,t){t=t||m.S_TEMP_AABB;var n=o.default.multiplyMV3(t._m_Center,this._m_Center,e);t._m_Center.multLength(1/n);var r=m.S_TEMP_MAT4;r.set(e),r.keepRotation(),r.absLocal(),m.S_TEMP_VEC3.setToInXYZ(this._m_XHalf,this._m_YHalf,this._m_ZHalf),o.default.multiplyMV3In3x3(m.S_TEMP_VEC32,m.S_TEMP_VEC3,r),t.setHalfInXYZ(Math.abs(m.S_TEMP_VEC32._m_X),Math.abs(m.S_TEMP_VEC32._m_Y),Math.abs(m.S_TEMP_VEC32._m_Z))}},{key:"getMin",value:function(e){return(e=e||new i.default).setTo(this._m_Center),e.subInXYZ(this._m_XHalf,this._m_YHalf,this._m_ZHalf),e}},{key:"getMax",value:function(e){return(e=e||new i.default).setTo(this._m_Center),e.addInXYZ(this._m_XHalf,this._m_YHalf,this._m_ZHalf),e}},{key:"contains",value:function(e){switch(e.getType()){case _.default.S_TYPE_AABB:var t=this.getMin(m.S_TEMP_VEC3),n=this.getMax(m.S_TEMP_VEC32),r=e.getMin(m.S_TEMP_VEC33),a=e.getMax(m.S_TEMP_VEC34);return!(r._m_X>n._m_X||r._m_Y>n._m_Y||r._m_Z>n._m_Z||a._m_X<t._m_X||a._m_Y<t._m_Y||a._m_Z<t._m_Z);case _.default.S_TYPE_SPHERE:return!1}return!1}}])&&s(t.prototype,n),r&&s(t,r),m}(_.default);t.default=d,h(d,"S_TEMP_VEC3",new i.default),h(d,"S_TEMP_VEC32",new i.default),h(d,"S_TEMP_VEC33",new i.default),h(d,"S_TEMP_VEC34",new i.default),h(d,"S_TEMP_MAT4",new o.default),h(d,"S_TEMP_AABB",new d)},1846:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=i(n(1322)),a=i(n(7088));function i(e){return e&&e.__esModule?e:{default:e}}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t){return u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},u(e,t)}function s(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var _=f(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return l(this,n)}}function l(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},f(e)}var m,c,h,d=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(l,e);var t,n,r,i=s(l);function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=i.call(this,e))._m_Radius=0,t}return t=l,(n=[{key:"setRaiuds",value:function(e){this._m_Radius=e}},{key:"getRadius",value:function(){return this._m_Radius}},{key:"getType",value:function(){return _.default.S_TYPE_SPHERE}},{key:"whichSide",value:function(e){var t=e.distance(this._m_Center);return t>this._m_Radius?a.default.S_SIDE_POSITIVE:t<-this._m_Radius?a.default.S_SIDE_NEGATIVE:a.default.S_SIDE_NONE}}])&&o(t.prototype,n),r&&o(t,r),l}(_.default);t.default=d,h=1.00001,(c="_S_RADIUS_EPSILON")in(m=d)?Object.defineProperty(m,c,{value:h,enumerable:!0,configurable:!0,writable:!0}):m[c]=h},1322:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,_=(r=n(5604))&&r.__esModule?r:{default:r};function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._m_PriorityPlane=0,this._m_Center=new _.default}var t,n,r;return t=e,(n=[{key:"setCenter",value:function(e){this._m_Center.setTo(e)}},{key:"getCenter",value:function(e){return(e=e||new _.default).setTo(this._m_Center),e}},{key:"getType",value:function(){return-1}},{key:"whichSide",value:function(e){}},{key:"setTo",value:function(e){}},{key:"transform",value:function(e,t,n,r){}},{key:"transformFromMat44",value:function(e,t){}},{key:"merge",value:function(e){return null}},{key:"setPriorityPlane",value:function(e){this._m_PriorityPlane=e}},{key:"getPriorityPlane",value:function(){return this._m_PriorityPlane}},{key:"contains",value:function(e){return!1}},{key:"distance",value:function(e){return this._m_Center.distance(e)}}])&&a(t.prototype,n),r&&a(t,r),e}();t.default=o,i(o,"S_TYPE_AABB",0),i(o,"S_TYPE_SPHERE",1)},2320:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,_=(r=n(5604))&&r.__esModule?r:{default:r};function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.m=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.bufferData=new Float32Array(16)}var t,n,r;return t=e,r=[{key:"lookAt",value:function(e,t,n,r){var _=e.subRetNew(t).normal(),a=n.crossRetNew(_).normal(),i=_.crossRetNew(a).normal();return(r=r||new Array(16).fill(0))[0]=a._m_X,r[4]=a._m_Y,r[8]=a._m_Z,r[3]=0,r[1]=i._m_X,r[5]=i._m_Y,r[9]=i._m_Z,r[7]=0,r[2]=_._m_X,r[6]=_._m_Y,r[10]=_._m_Z,r[11]=0,r[12]=-(e._m_X*a._m_X+e._m_Y*a._m_Y+e._m_Z*a._m_Z),r[13]=-(e._m_X*i._m_X+e._m_Y*i._m_Y+e._m_Z*i._m_Z),r[14]=-(e._m_X*_._m_X+e._m_Y*_._m_Y+e._m_Z*_._m_Z),r[15]=1,r}},{key:"invert",value:function(e,t){var n=e[0],r=e[1],_=e[2],a=e[3],i=e[4],o=e[5],u=e[6],s=e[7],l=e[8],f=e[9],m=e[10],c=e[11],h=e[12],d=e[13],S=e[14],p=e[15],g=n*o-r*i,y=n*u-_*i,v=n*s-a*i,T=r*u-_*o,E=r*s-a*o,b=_*s-a*u,C=l*d-f*h,P=l*S-m*h,R=l*p-c*h,M=f*S-m*d,A=f*p-c*d,w=m*p-c*S,I=g*w-y*A+v*M+T*R-E*P+b*C;return I?(I=1/I,t[0]=(o*w-u*A+s*M)*I,t[1]=(_*A-r*w-a*M)*I,t[2]=(d*b-S*E+p*T)*I,t[3]=(m*E-f*b-c*T)*I,t[4]=(u*R-i*w-s*P)*I,t[5]=(n*w-_*R+a*P)*I,t[6]=(S*v-h*b-p*y)*I,t[7]=(l*b-m*v+c*y)*I,t[8]=(i*A-o*R+s*C)*I,t[9]=(r*R-n*A-a*C)*I,t[10]=(h*E-d*v+p*g)*I,t[11]=(f*v-l*E-c*g)*I,t[12]=(o*P-i*M-u*C)*I,t[13]=(n*M-r*P+_*C)*I,t[14]=(d*y-h*T-S*g)*I,t[15]=(l*T-f*y+m*g)*I,t):null}},{key:"parallelM",value:function(e,t,n,r,_,a,i,o){e[t+0]=2/(1*r-n),e[t+5]=2/(1*_-a),e[t+10]=-2/(1*o-i),e[t+15]=1,e[t+12]=-(r+n)/(1*r-n),e[t+13]=-(_+a)/(1*_-a),e[t+14]=-(o+i)/(1*o-i)}},{key:"perspectiveM",value:function(e,t,n,r,_,a){var i=1/Math.tan(n*(Math.PI/360)),o=1/(_-a);e[t+0]=i/r,e[t+1]=0,e[t+2]=0,e[t+3]=0,e[t+4]=0,e[t+5]=i,e[t+6]=0,e[t+7]=0,e[t+8]=0,e[t+9]=0,e[t+10]=(a+_)*o,e[t+11]=-1,e[t+12]=0,e[t+13]=0,e[t+14]=2*a*_*o,e[t+15]=0}},{key:"multiplyMM",value:function(e,t,n,r,_,a){e.m[t+0]=_.m[0]*n.m[0]+_.m[1]*n.m[4]+_.m[2]*n.m[8]+_.m[3]*n.m[12],e.m[t+1]=_.m[0]*n.m[1]+_.m[1]*n.m[5]+_.m[2]*n.m[9]+_.m[3]*n.m[13],e.m[t+2]=_.m[0]*n.m[2]+_.m[1]*n.m[6]+_.m[2]*n.m[10]+_.m[3]*n.m[14],e.m[t+3]=_.m[0]*n.m[3]+_.m[1]*n.m[7]+_.m[2]*n.m[11]+_.m[3]*n.m[15],e.m[t+4]=_.m[4]*n.m[0]+_.m[5]*n.m[4]+_.m[6]*n.m[8]+_.m[7]*n.m[12],e.m[t+5]=_.m[4]*n.m[1]+_.m[5]*n.m[5]+_.m[6]*n.m[9]+_.m[7]*n.m[13],e.m[t+6]=_.m[4]*n.m[2]+_.m[5]*n.m[6]+_.m[6]*n.m[10]+_.m[7]*n.m[14],e.m[t+7]=_.m[4]*n.m[3]+_.m[5]*n.m[7]+_.m[6]*n.m[11]+_.m[7]*n.m[15],e.m[t+8]=_.m[8]*n.m[0]+_.m[9]*n.m[4]+_.m[10]*n.m[8]+_.m[11]*n.m[12],e.m[t+9]=_.m[8]*n.m[1]+_.m[9]*n.m[5]+_.m[10]*n.m[9]+_.m[11]*n.m[13],e.m[t+10]=_.m[8]*n.m[2]+_.m[9]*n.m[6]+_.m[10]*n.m[10]+_.m[11]*n.m[14],e.m[t+11]=_.m[8]*n.m[3]+_.m[9]*n.m[7]+_.m[10]*n.m[11]+_.m[11]*n.m[15],e.m[t+12]=_.m[12]*n.m[0]+_.m[13]*n.m[4]+_.m[14]*n.m[8]+_.m[15]*n.m[12],e.m[t+13]=_.m[12]*n.m[1]+_.m[13]*n.m[5]+_.m[14]*n.m[9]+_.m[15]*n.m[13],e.m[t+14]=_.m[12]*n.m[2]+_.m[13]*n.m[6]+_.m[14]*n.m[10]+_.m[15]*n.m[14],e.m[t+15]=_.m[12]*n.m[3]+_.m[13]*n.m[7]+_.m[14]*n.m[11]+_.m[15]*n.m[15]}},{key:"multiplyMV",value:function(e,t,n){e._m_X=t._m_X*n.m[0]+t._m_Y*n.m[4]+t._m_Z*n.m[8]+t._m_W*n.m[12],e._m_Y=t._m_X*n.m[1]+t._m_Y*n.m[5]+t._m_Z*n.m[9]+t._m_W*n.m[13],e._m_Z=t._m_X*n.m[2]+t._m_Y*n.m[6]+t._m_Z*n.m[10]+t._m_W*n.m[14],e._m_W=t._m_X*n.m[3]+t._m_Y*n.m[7]+t._m_Z*n.m[11]+t._m_W*n.m[15]}},{key:"multiplyMV3",value:function(e,t,n){return e._m_X=t._m_X*n.m[0]+t._m_Y*n.m[4]+t._m_Z*n.m[8]+n.m[12],e._m_Y=t._m_X*n.m[1]+t._m_Y*n.m[5]+t._m_Z*n.m[9]+n.m[13],e._m_Z=t._m_X*n.m[2]+t._m_Y*n.m[6]+t._m_Z*n.m[10]+n.m[14],t._m_X*n.m[3]+t._m_Y*n.m[7]+t._m_Z*n.m[11]+n.m[15]}},{key:"multiplyMV3In3x3",value:function(e,t,n){e._m_X=t._m_X*n.m[0]+t._m_Y*n.m[4]+t._m_Z*n.m[8],e._m_Y=t._m_X*n.m[1]+t._m_Y*n.m[5]+t._m_Z*n.m[9],e._m_Z=t._m_X*n.m[2]+t._m_Y*n.m[6]+t._m_Z*n.m[10]}},{key:"composeMat4",value:function(t,n,r,_){return e.fromQuaternion(n,_),_.scale(r._m_X,r._m_Y,r._m_Z),_.translate(t._m_X,t._m_Y,t._m_Z),_}},{key:"decomposeMat4",value:function(t,n,r,_){e._S_TEMP_VEC3.setToInXYZ(t.m[0],t.m[1],t.m[2]);var a=e._S_TEMP_VEC3.length();e._S_TEMP_VEC3.setToInXYZ(t.m[4],t.m[5],t.m[6]);var i=e._S_TEMP_VEC3.length();e._S_TEMP_VEC3.setToInXYZ(t.m[8],t.m[9],t.m[10]);var o=e._S_TEMP_VEC3.length();e.determinantMat4(t)<0&&(a=-a),n.setToInXYZ(t.m[12],t.m[13],t.m[14]),e._S_TEMP_MAT4.set(t);var u=1/a,s=1/i,l=1/o;e._S_TEMP_MAT4.m[0]*=u,e._S_TEMP_MAT4.m[1]*=u,e._S_TEMP_MAT4.m[2]*=u,e._S_TEMP_MAT4.m[4]*=s,e._S_TEMP_MAT4.m[5]*=s,e._S_TEMP_MAT4.m[6]*=s,e._S_TEMP_MAT4.m[8]*=l,e._S_TEMP_MAT4.m[9]*=l,e._S_TEMP_MAT4.m[10]*=l,r.fromMat44(e._S_TEMP_MAT4),_.setToInXYZ(a,i,o)}},{key:"determinantMat4",value:function(e){var t=e.m[0],n=e.m[1],r=e.m[2],_=e.m[3],a=e.m[4],i=e.m[5],o=e.m[6],u=e.m[7],s=e.m[8],l=e.m[9],f=e.m[10],m=e.m[11],c=e.m[12],h=e.m[13],d=e.m[14],S=e.m[15];return c*l*o*_-s*h*o*_-c*i*f*_+a*h*f*_+s*i*d*_-a*l*d*_-c*l*r*u+s*h*r*u+c*n*f*u-t*h*f*u-s*n*d*u+t*l*d*u+c*i*r*m-a*h*r*m-c*n*o*m+t*h*o*m+a*n*d*m-t*i*d*m-s*i*r*S+a*l*r*S+s*n*o*S-t*l*o*S-a*n*f*S+t*i*f*S}},{key:"fromQuaternion",value:function(e,t){var n=e._m_X,r=e._m_Y,_=e._m_Z,a=e._m_W,i=n+n,o=r+r,u=_+_,s=n*i,l=n*o,f=n*u,m=r*o,c=r*u,h=_*u,d=a*i,S=a*o,p=a*u;return t.m[0]=1-(m+h),t.m[4]=l-p,t.m[8]=f+S,t.m[1]=l+p,t.m[5]=1-(s+h),t.m[9]=c-d,t.m[2]=f-S,t.m[6]=c+d,t.m[10]=1-(s+m),t.m[3]=0,t.m[7]=0,t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0,t.m[15]=1,t}}],(n=[{key:"identity",value:function(){this.m=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"scale",value:function(e,t,n){return this.m[0]*=e,this.m[4]*=t,this.m[8]*=n,this.m[1]*=e,this.m[5]*=t,this.m[9]*=n,this.m[2]*=e,this.m[6]*=t,this.m[10]*=n,this.m[3]*=e,this.m[7]*=t,this.m[11]*=n,this}},{key:"translate",value:function(e,t,n){var r=this.m[3];this.m[0]+=r*e,this.m[1]+=r*t,this.m[2]+=r*n;var _=this.m[7];this.m[4]+=_*e,this.m[5]+=_*t,this.m[6]+=_*n;var a=this.m[11];this.m[8]+=a*e,this.m[9]+=a*t,this.m[10]+=a*n;var i=this.m[15];return this.m[12]+=i*e,this.m[13]+=i*t,this.m[14]+=i*n,this}},{key:"lookAt",value:function(t,n,r){return this.m=e.lookAt(t,n,r,this.m),this}},{key:"inert",value:function(){e.invert(this.m,e._S_TEMP_MAT4.m)&&this.set(e._S_TEMP_MAT4)}},{key:"inertRetNew",value:function(t){return e.invert(this.m,e._S_TEMP_MAT4.m)?((t=t||new e).set(e._S_TEMP_MAT4),t):null}},{key:"set",value:function(e){for(var t=0;t<16;t++)this.m[t]=e.m[t]}},{key:"setArray",value:function(e){for(var t=0;t<16;t++)this.m[t]=e[t]}},{key:"setArrayTranspose",value:function(e){for(var t=0,n=0;t<4;t++)for(var r=0;r<4;r++)this.m[n++]=e[4*r+t]}},{key:"keepRotation",value:function(){this.m[12]=this.m[13]=this.m[14]=0,this.m[15]=1}},{key:"transpose",value:function(){for(var e=[],t=0;t<this.m.length;t++)e[t]=this.m[t];for(var n=0,r=0;n<4;n++)for(var _=0;_<4;_++)this.m[r++]=e[4*_+n]}},{key:"absLocal",value:function(){for(var e=0;e<16;e++)this.m[e]=Math.abs(this.m[e])}},{key:"perspectiveM",value:function(t,n,r,_){return e.perspectiveM(this.m,0,t,n,r,_),this}},{key:"parallelM",value:function(t,n,r,_,a,i){return this.identity(),e.parallelM(this.m,0,t,n,r,_,a,i),this}},{key:"getData",value:function(){return this.m}},{key:"getBufferData",value:function(){return this.bufferData.set(this.m),this.bufferData}},{key:"toString",value:function(){return"["+this.m[0]+","+this.m[1]+","+this.m[2]+","+this.m[3]+",\n"+this.m[4]+","+this.m[5]+","+this.m[6]+","+this.m[7]+",\n"+this.m[8]+","+this.m[9]+","+this.m[10]+","+this.m[11]+",\n"+this.m[12]+","+this.m[13]+","+this.m[14]+","+this.m[15]+"]"}}])&&a(t.prototype,n),r&&a(t,r),e}();t.default=o,i(o,"_S_TEMP_MAT4",new o),i(o,"_S_TEMP_VEC3",new _.default)},431:(e,t)=>{function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;Math.PI,Math.PI;var _=1/Math.PI,a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,a;return t=e,a=[{key:"toRadians",value:function(e){return.005555555555555556*e*Math.PI}},{key:"toAngle",value:function(e){return 180*e*_}},{key:"interpolateLinear",value:function(e,t,n){return t==n||e<=0?t:e>=1?n:(1-e)*t+e*n}},{key:"interpolateLinearVec3",value:function(e,t,n){return t==n||e<=0?t:e>=1?n:(t.multLength(1-e),t.add(n.mulReturn(e)),t)}}],(r=null)&&n(t.prototype,r),a&&n(t,a),e}();t.default=a,r(a,"S_HALF_PI",.5*Math.PI),r(a,"S_DEG_TO_RAD",.0174532925),r(a,"S_RAD_TO_DEG",57.295779513),r(a,"S_TWO_PI",2*Math.PI)},7088:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,_=(r=n(5604))&&r.__esModule?r:{default:r};function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._m_Normal=new _.default,this._m_D=0}var t,n,r;return t=e,(n=[{key:"setD",value:function(e){this._m_D=e}},{key:"getD",value:function(){return this._m_D}},{key:"setNormal",value:function(e){this._m_Normal.setTo(e),this._m_Normal.normal()}},{key:"setNormaXYZ",value:function(e,t,n){this._m_Normal.setToInXYZ(e,t,n),this._m_Normal.normal()}},{key:"getNormal",value:function(){return this._m_Normal}},{key:"distance",value:function(e){return this._m_Normal.dot(e)-this._m_D}}])&&a(t.prototype,n),r&&a(t,r),e}();t.default=o,i(o,"S_SIDE_POSITIVE",1),i(o,"S_SIDE_NEGATIVE",o.S_SIDE_POSITIVE<<1),i(o,"S_SIDE_NONE",o.S_SIDE_POSITIVE<<2)},453:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,_=(r=n(431))&&r.__esModule?r:{default:r};function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var o=function(){function e(t,n,r,_){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._m_X=t||0,this._m_Y=n||0,this._m_Z=r||0,this._m_W=_||0}var t,n,r;return t=e,r=[{key:"slerp",value:function(t,n,r,_){var a,i,o=t._m_W*n._m_W+t._m_X*n._m_X+t._m_Y*n._m_Y+t._m_Z*n._m_Z,u=null;if(o<0?((u=e._S_TEMP_QUATERNION)._m_W=-t._m_W,u._m_X=-t._m_X,u._m_Y=-t._m_Y,u._m_Z=-t._m_Z,o=-o):u=t,o>.9995)a=1-r,i=r;else{var s=Math.acos(o),l=Math.sin(s);a=Math.sin((1-r)*s)/l,i=Math.sin(r*s)/l}return(_=_||e._S_TEMP_QUATERNION_2)._m_W=u._m_W*a+n._m_W*i,_._m_X=u._m_X*a+n._m_X*i,_._m_Y=u._m_Y*a+n._m_Y*i,_._m_Z=u._m_Z*a+n._m_Z*i,_}},{key:"slerp2",value:function(t,n,r,_){if(_=_||e._S_TEMP_QUATERNION_2,0===r)return _.setTo(t),_;if(1===r)return _.setTo(n),_;var a=t._m_X,i=t._m_Y,o=t._m_Z,u=t._m_W,s=u*n._m_W+a*n._m_X+i*n._m_Y+o*n._m_Z,l=null;if(s<0?((l=e._S_TEMP_QUATERNION)._m_W=-n._m_W,l._m_X=-n._m_X,l._m_Y=-n._m_Y,l._m_Z=-n._m_Z,s=-s):l=n,s>=1)return _._m_W=u,_._m_X=a,_._m_Y=i,_._m_Z=o,_;var f=1-s*s;if(f<=Number.EPSILON){var m=1-r;return _._m_W=m*u+r*l._m_W,_._m_X=m*a+r*l._m_X,_._m_Y=m*i+r*l._m_Y,_._m_Z=m*o+r*l._m_Z,_.normal(),_}var c=Math.sqrt(f),h=Math.atan2(c,s),d=Math.sin((1-r)*h)/c,S=Math.sin(r*h)/c;return _._m_W=u*d+l._m_W*S,_._m_X=a*d+l._m_X*S,_._m_Y=i*d+l._m_Y*S,_._m_Z=o*d+l._m_Z*S,_}},{key:"inter",value:function(t,n,r,_){var a=1-r;return(_=_||e._S_TEMP_QUATERNION)._m_X=t._m_X*a+n._m_X*r,_._m_Y=t._m_Y*a+n._m_Y*r,_._m_Z=t._m_Z*a+n._m_Z*r,_._m_W=t._m_W*a+n._m_W*r,_}}],(n=[{key:"setTo",value:function(e){this._m_X=e._m_X,this._m_Y=e._m_Y,this._m_Z=e._m_Z,this._m_W=e._m_W}},{key:"setToInXYZW",value:function(e,t,n,r){this._m_X=e||0,this._m_Y=t||0,this._m_Z=n||0,this._m_W=r||0}},{key:"toAngles",value:function(e){e=e||new Array(3);var t=this._m_W*this._m_W,n=this._m_X*this._m_X,r=this._m_Y*this._m_Y,a=this._m_Z*this._m_Z,i=n+r+a+t,o=this._m_X*this._m_Y+this._m_Z*this._m_W;return o>.499*i?(e[1]=2*Math.atan2(this._m_X,this._m_W),e[2]=_.default.S_HALF_PI,e[0]=0):o<-.499*i?(e[1]=-2*Math.atan2(this._m_X,this._m_W),e[2]=-_.default.S_HALF_PI,e[0]=0):(e[1]=Math.atan2(2*this._m_Y*this._m_W-2*this._m_X*this._m_Z,n-r-a+t),e[2]=Math.asin(2*o/i),e[0]=Math.atan2(2*this._m_X*this._m_W-2*this._m_Y*this._m_Z,-n+r-a+t)),e}},{key:"fromEuler",value:function(e,t,n){var r=-1;r=.5*e;var _=Math.cos(r),a=Math.sin(r);r=.5*t;var i=Math.cos(r),o=Math.sin(r);r=.5*n;var u=Math.cos(r),s=Math.sin(r),l=i*u,f=o*s,m=i*s,c=o*u;this._m_X=l*a+f*_,this._m_Y=c*_+m*a,this._m_Z=m*_-c*a,this._m_W=l*_-f*a}},{key:"fromMat44",value:function(e){var t,n=e.m[0],r=e.m[4],_=e.m[8],a=e.m[1],i=e.m[5],o=e.m[9],u=e.m[2],s=e.m[6],l=e.m[10],f=n+i+l;f>0?(t=.5/Math.sqrt(f+1),this._m_W=.25/t,this._m_X=(s-o)*t,this._m_Y=(_-u)*t,this._m_Z=(a-r)*t):n>i&&n>l?(t=2*Math.sqrt(1+n-i-l),this._m_W=(s-o)/t,this._m_X=.25*t,this._m_Y=(r+a)/t,this._m_Z=(_+u)/t):i>l?(t=2*Math.sqrt(1+i-n-l),this._m_W=(_-u)/t,this._m_X=(r+a)/t,this._m_Y=.25*t,this._m_Z=(o+s)/t):(t=2*Math.sqrt(1+l-n-i),this._m_W=(a-r)/t,this._m_X=(_+u)/t,this._m_Y=(o+s)/t,this._m_Z=.25*t)}},{key:"multVec3",value:function(e,t){t=t||e;var n=e._m_X,r=e._m_Y,_=e._m_Z,a=this._m_X,i=this._m_Y,o=this._m_Z,u=this._m_W;return t._m_X=u*u*n+2*i*u*_-2*o*u*r+a*a*n+2*i*a*r+2*o*a*_-o*o*n-i*i*n,t._m_Y=2*a*i*n+i*i*r+2*o*i*_+2*u*o*n-o*o*r+u*u*r-2*a*u*_-a*a*r,t._m_Z=2*a*o*n+2*i*o*r+o*o*_-2*u*i*n-i*i*_+2*u*a*r-a*a*_+u*u*_,t}},{key:"slerp",value:function(t,n,r){return e.slerp(this,t,n,r)}},{key:"normal",value:function(){var e=this.length();return e?(e=1/e,this._m_X*=e,this._m_Y*=e,this._m_Z*=e,this._m_W*=e):console.error("Vector3.normal异常,长度为0。"),this}},{key:"length",value:function(){var e=this._m_X*this._m_X+this._m_Y*this._m_Y+this._m_Z*this._m_Z+this._m_W*this._m_W;return e=Math.sqrt(e)}},{key:"inter",value:function(t,n,r){return e.inter(this,t,n,r)}},{key:"toString",value:function(){return"["+this._m_X+","+this._m_Y+","+this._m_Z+","+this._m_W+"]"}}])&&a(t.prototype,n),r&&a(t,r),e}();t.default=o,i(o,"_S_TEMP_QUATERNION",new o),i(o,"_S_TEMP_QUATERNION_2",new o)},9271:(e,t)=>{function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._m_X=t||0,this._m_Y=n||0}var t,r,_;return t=e,(r=[{key:"setTo",value:function(e){this._m_X=e._m_X,this._m_Y=e._m_Y}},{key:"setToInXY",value:function(e,t){this._m_X=e||0,this._m_Y=t||0}},{key:"dot",value:function(e){return this._m_X*e._m_X+this._m_Y*e._m_Y}},{key:"cross",value:function(e,t){if(t)return t._m_X=this._m_Y*e._m_Z-this._m_Z*e._m_Y,t._m_Y=this._m_Z*e._m_X-this._m_X*e._m_Z,t;var n=this._m_Y*e._m_Z-this._m_Z*e._m_Y,r=this._m_Z*e._m_X-this._m_X*e._m_Z;return this._m_X=n,this._m_Y=r,this}},{key:"crossRetNew",value:function(t){var n=new e(0,0);return this.cross(t,n)}},{key:"divide",value:function(e,t){return t?(t._m_X=this._m_X/e._m_X,t._m_Y=this._m_Y/e._m_Y,t):(this._m_X/=e._m_X,this._m_Y/=e._m_Y,this)}},{key:"divideRetNew",value:function(t){var n=new e(0,0);return this.divide(t,n)}},{key:"mult",value:function(e,t){return t?(t._m_X=this._m_X*e._m_X,t._m_Y=this._m_Y*e._m_Y,t):(this._m_X*=e._m_X,this._m_Y*=e._m_Y,this)}},{key:"multRetNew",value:function(t){var n=new e(0,0);return this.mult(t,n)}},{key:"sub",value:function(e,t){return t?(t._m_X=this._m_X-e._m_X,t._m_Y=this._m_Y-e._m_Y,t):(this._m_X-=e._m_X,this._m_Y-=e._m_Y,this)}},{key:"subRetNew",value:function(t){var n=new e(0,0);return this.sub(t,n)}},{key:"add",value:function(e,t){return t?(t._m_X=this._m_X+e._m_X,t._m_Y=this._m_Y+e._m_Y,t):(this._m_X+=e._m_X,this._m_Y+=e._m_Y,this)}},{key:"addRetNew",value:function(t){var n=new e(0,0);return this.add(t,n)}},{key:"multLength",value:function(e,t){return t?(t._m_X=this._m_X*e,t._m_Y=this._m_Y*e,t):(this._m_X*=e,this._m_Y*=e,this)}},{key:"normal",value:function(){var e=this.length();return e?(e=1/e,this._m_X*=e,this._m_Y*=e):console.error("Vector3.normal异常,长度为0。"),this}},{key:"length",value:function(){var e=this._m_X*this._m_X+this._m_Y*this._m_Y;return e=Math.sqrt(e)}},{key:"toString",value:function(){return"["+this._m_X+","+this._m_Y+"]"}}])&&n(t.prototype,r),_&&n(t,_),e}();t.default=r},5604:(e,t)=>{function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._m_X=t||0,this._m_Y=n||0,this._m_Z=r||0,this.bufferData=new Float32Array(3)}var t,r,_;return t=e,_=[{key:"inter",value:function(t,n,r,_){var a=1-r;return(_=_||e._S_TEMP_VEC3)._m_X=t._m_X*a+n._m_X*r,_._m_Y=t._m_Y*a+n._m_Y*r,_._m_Z=t._m_Z*a+n._m_Z*r,_}}],(r=[{key:"getBufferData",value:function(){return this.bufferData.set([this._m_X,this._m_Y,this._m_Z]),this.bufferData}},{key:"toArray",value:function(){return[this._m_X,this._m_Y,this._m_Z]}},{key:"setTo",value:function(e){return this._m_X=e._m_X,this._m_Y=e._m_Y,this._m_Z=e._m_Z,this}},{key:"setToInXYZ",value:function(e,t,n){return this._m_X=e||0,this._m_Y=t||0,this._m_Z=n||0,this}},{key:"dot",value:function(e){return this._m_X*e._m_X+this._m_Y*e._m_Y+this._m_Z*e._m_Z}},{key:"min",value:function(e,t){return t?(t._m_X=e._m_X<this._m_X?e._m_X:this._m_X,t._m_Y=e._m_Y<this._m_Y?e._m_Y:this._m_Y,t._m_Z=e._m_Z<this._m_Z?e._m_Z:this._m_Z,t):(this._m_X=e._m_X<this._m_X?e._m_X:this._m_X,this._m_Y=e._m_Y<this._m_Y?e._m_Y:this._m_Y,this._m_Z=e._m_Z<this._m_Z?e._m_Z:this._m_Z,this)}},{key:"max",value:function(e,t){return t?(t._m_X=e._m_X>this._m_X?e._m_X:this._m_X,t._m_Y=e._m_Y>this._m_Y?e._m_Y:this._m_Y,t._m_Z=e._m_Z>this._m_Z?e._m_Z:this._m_Z,t):(this._m_X=e._m_X>this._m_X?e._m_X:this._m_X,this._m_Y=e._m_Y>this._m_Y?e._m_Y:this._m_Y,this._m_Z=e._m_Z>this._m_Z?e._m_Z:this._m_Z,this)}},{key:"cross",value:function(e,t){if(t)return t._m_X=this._m_Y*e._m_Z-this._m_Z*e._m_Y,t._m_Y=this._m_Z*e._m_X-this._m_X*e._m_Z,t._m_Z=this._m_X*e._m_Y-this._m_Y*e._m_X,t;var n=this._m_Y*e._m_Z-this._m_Z*e._m_Y,r=this._m_Z*e._m_X-this._m_X*e._m_Z,_=this._m_X*e._m_Y-this._m_Y*e._m_X;return this._m_X=n,this._m_Y=r,this._m_Z=_,this}},{key:"crossRetNew",value:function(t){var n=new e(0,0,0);return this.cross(t,n)}},{key:"distance",value:function(e){return Math.sqrt(this.distanceSq(e))}},{key:"distanceSq",value:function(e){var t=this._m_X-e._m_X,n=this._m_Y-e._m_Y,r=this._m_Z-e._m_Z;return t*t+n*n+r*r}},{key:"divide",value:function(e,t){return t?(t._m_X=this._m_X/e._m_X,t._m_Y=this._m_Y/e._m_Y,t._m_Z=this._m_Z/e._m_Z,t):(this._m_X/=e._m_X,this._m_Y/=e._m_Y,this._m_Z/=e._m_Z,this)}},{key:"divideInXYZ",value:function(e,t,n,r){return r?(r._m_X=this._m_X/e,r._m_Y=this._m_Y/t,r._m_Z=this._m_Z/n,r):(this._m_X/=e,this._m_Y/=t,this._m_Z/=n,this)}},{key:"divideRetNew",value:function(t){var n=new e(0,0,0);return this.divide(t,n)}},{key:"divideRetNewInXYZ",value:function(t,n,r){var _=new e(0,0,0);return this.divideInXYZ(t,n,r,_)}},{key:"mult",value:function(e,t){return t?(t._m_X=this._m_X*e._m_X,t._m_Y=this._m_Y*e._m_Y,t._m_Z=this._m_Z*e._m_Z,t):(this._m_X*=e._m_X,this._m_Y*=e._m_Y,this._m_Z*=e._m_Z,this)}},{key:"multInXYZ",value:function(e,t,n,r){return r?(r._m_X=this._m_X*e,r._m_Y=this._m_Y*t,r._m_Z=this._m_Z*n,r):(this._m_X*=e,this._m_Y*=t,this._m_Z*=n,this)}},{key:"multRetNew",value:function(t){var n=new e(0,0,0);return this.mult(t,n)}},{key:"multRetNewInXYZ",value:function(t,n,r){var _=new e(0,0,0);return this.multInXYZ(t,n,r,_)}},{key:"sub",value:function(e,t){return t?(t._m_X=this._m_X-e._m_X,t._m_Y=this._m_Y-e._m_Y,t._m_Z=this._m_Z-e._m_Z,t):(this._m_X-=e._m_X,this._m_Y-=e._m_Y,this._m_Z-=e._m_Z,this)}},{key:"subInXYZ",value:function(e,t,n,r){return r?(r._m_X=this._m_X-e,r._m_Y=this._m_Y-t,r._m_Z=this._m_Z-n,r):(this._m_X-=e,this._m_Y-=t,this._m_Z-=n,this)}},{key:"subRetNew",value:function(t){var n=new e(0,0,0);return this.sub(t,n)}},{key:"subRetNewInXYZ",value:function(t,n,r){var _=new e(0,0,0);return this.subInXYZ(t,n,r,_)}},{key:"add",value:function(e,t){return t?(t._m_X=this._m_X+e._m_X,t._m_Y=this._m_Y+e._m_Y,t._m_Z=this._m_Z+e._m_Z,t):(this._m_X+=e._m_X,this._m_Y+=e._m_Y,this._m_Z+=e._m_Z,this)}},{key:"addInXYZ",value:function(e,t,n,r){return r?(reslut._m_X=this._m_X+e,reslut._m_Y=this._m_Y+t,reslut._m_Z=this._m_Z+n,reslut):(this._m_X+=e,this._m_Y+=t,this._m_Z+=n,this)}},{key:"addRetNew",value:function(t){var n=new e(0,0,0);return this.add(t,n)}},{key:"addRetNewInXYZ",value:function(t,n,r){var _=new e(0,0,0);return this.addInXYZ(t,n,r,_)}},{key:"multLength",value:function(e,t){return t?(t._m_X=this._m_X*e,t._m_Y=this._m_Y*e,t._m_Z=this._m_Z*e,t):(this._m_X*=e,this._m_Y*=e,this._m_Z*=e,this)}},{key:"normal",value:function(){var e=this.length();return e?(e=1/e,this._m_X*=e,this._m_Y*=e,this._m_Z*=e):this._m_X=this._m_Y=this._m_Z=0,this}},{key:"negate",value:function(){return new e(-this._m_X,-this._m_Y,-this._m_Z)}},{key:"length",value:function(){var e=this._m_X*this._m_X+this._m_Y*this._m_Y+this._m_Z*this._m_Z;return e=Math.sqrt(e)}},{key:"toString",value:function(){return"["+this._m_X+","+this._m_Y+","+this._m_Z+"]"}},{key:"inter",value:function(t,n,r){return e.inter(this,t,n,r)}},{key:"equals",value:function(e){return e==this||null!=e&&this._m_X==e._m_X&&this._m_Y==e._m_Y&&this._m_Z==e._m_Z}}])&&n(t.prototype,r),_&&n(t,_),e}();t.default=_,r(_,"_S_TEMP_VEC3",new _),r(_,"S_UNIT_AXIS_X",new _(1,0,0)),r(_,"S_UNIT_AXIS_Y",new _(0,1,0)),r(_,"S_UNIT_AXIS_Z",new _(0,0,1)),r(_,"S_UNIT_AXIS_NEGATIVE_X",new _(-1,0,0)),r(_,"S_UNIT_AXIS_NEGATIVE_Y",new _(0,-1,0)),r(_,"S_UNIT_AXIS_NEGATIVE_Z",new _(0,0,-1)),r(_,"S_POSITIVE_INFINITY",new _(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY)),r(_,"S_NEGATIVE_INFINITY",new _(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY)),r(_,"S_MAX",new _(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)),r(_,"S_MIN",new _(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE))},7141:(e,t)=>{function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,_,a,i=function(){function e(t,n,r,_){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._m_X=t||0,this._m_Y=n||0,this._m_Z=r||0,this._m_W=null!=_&&null!=_?_:1,this.bufferData=new Float32Array(4)}var t,r,_;return t=e,_=[{key:"inter",value:function(t,n,r,_){var a=1-r;return(_=_||e._S_TEMP_VEC4)._m_X=t._m_X*a+n._m_X*r,_._m_Y=t._m_Y*a+n._m_Y*r,_._m_Z=t._m_Z*a+n._m_Z*r,_._m_W=1,_}}],(r=[{key:"getBufferData",value:function(){return this.bufferData.set([this._m_X,this._m_Y,this._m_Z,this._m_W]),this.bufferData}},{key:"setTo",value:function(e){return this._m_X=e._m_X,this._m_Y=e._m_Y,this._m_Z=e._m_Z,this._m_W=e._m_W,this}},{key:"setToInXYZW",value:function(e,t,n,r){return this._m_X=e||0,this._m_Y=t||0,this._m_Z=n||0,this._m_W=null!=r&&null!=r?r:1,this}},{key:"dot",value:function(e){return this._m_X*e._m_X+this._m_Y*e._m_Y+this._m_Z*e._m_Z+this._m_W*e._m_W}},{key:"cross",value:function(e,t){if(t)return t._m_X=this._m_Y*e._m_Z-this._m_Z*e._m_Y,t._m_Y=this._m_Z*e._m_X-this._m_X*e._m_Z,t._m_Z=this._m_X*e._m_Y-this._m_Y*e._m_X,t;var n=this._m_Y*e._m_Z-this._m_Z*e._m_Y,r=this._m_Z*e._m_X-this._m_X*e._m_Z,_=this._m_X*e._m_Y-this._m_Y*e._m_X;return this._m_X=n,this._m_Y=r,this._m_Z=_,this}},{key:"crossRetNew",value:function(t){var n=new e(0,0,0,1);return this.cross(t,n)}},{key:"divide",value:function(e,t){return t?(t._m_X=this._m_X/e._m_X,t._m_Y=this._m_Y/e._m_Y,t._m_Z=this._m_Z/e._m_Z,t._m_W=this._m_W/e._m_W,t):(this._m_X/=e._m_X,this._m_Y/=e._m_Y,this._m_Z/=e._m_Z,this._m_W/=e._m_W,this)}},{key:"divideRetNew",value:function(t){var n=new e(0,0,0,1);return this.divide(t,n)}},{key:"mult",value:function(e,t){return t?(t._m_X=this._m_X*e._m_X,t._m_Y=this._m_Y*e._m_Y,t._m_Z=this._m_Z*e._m_Z,t._m_W=this._m_W*e._m_W,t):(this._m_X*=e._m_X,this._m_Y*=e._m_Y,this._m_Z*=e._m_Z,this._m_W*=e._m_W,this)}},{key:"multRetNew",value:function(t){var n=new e(0,0,0,1);return this.mult(t,n)}},{key:"sub",value:function(e,t){return t?(t._m_X=this._m_X-e._m_X,t._m_Y=this._m_Y-e._m_Y,t._m_Z=this._m_Z-e._m_Z,t):(this._m_X-=e._m_X,this._m_Y-=e._m_Y,this._m_Z-=e._m_Z,this)}},{key:"subRetNew",value:function(t){var n=new e(0,0,0,1);return this.sub(t,n)}},{key:"add",value:function(e,t){return t?(t._m_X=this._m_X+e._m_X,t._m_Y=this._m_Y+e._m_Y,t._m_Z=this._m_Z+e._m_Z,t):(this._m_X+=e._m_X,this._m_Y+=e._m_Y,this._m_Z+=e._m_Z,this)}},{key:"addRetNew",value:function(t){var n=new e(0,0,0,1);return this.add(t,n)}},{key:"multLength",value:function(e,t){return t?(t._m_X=this._m_X*e,t._m_Y=this._m_Y*e,t._m_Z=this._m_Z*e,t):(this._m_X*=e,this._m_Y*=e,this._m_Z*=e,this)}},{key:"normal",value:function(){var e=this.length();return e?(e=1/e,this._m_X*=e,this._m_Y*=e,this._m_Z*=e):console.error("Vector3.normal异常,长度为0。"),this}},{key:"distanceSq",value:function(e){var t=this._m_X-e._m_X,n=this._m_Y-e._m_Y,r=this._m_Z-e._m_Z;return t*t+n*n+r*r}},{key:"distance",value:function(e){return Math.sqrt(this.distanceSq(e))}},{key:"length",value:function(){var e=this._m_X*this._m_X+this._m_Y*this._m_Y+this._m_Z*this._m_Z;return e=Math.sqrt(e)}},{key:"toString",value:function(){return"["+this._m_X+","+this._m_Y+","+this._m_Z+","+this._m_W+"]"}},{key:"inter",value:function(t,n,r){return e.inter(this,t,n,r)}}])&&n(t.prototype,r),_&&n(t,_),e}();t.default=i,r=i,_="_S_TEMP_VEC4",a=new i,_ in r?Object.defineProperty(r,_,{value:a,enumerable:!0,configurable:!0,writable:!0}):r[_]=a},5776:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}var _;function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t){return i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},i(e,t)}function o(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=s(e);if(t){var _=s(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return u(this,n)}}function u(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function s(e){return s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},s(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var l=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(u,e);var t,n,r,_=o(u);function u(e,t){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),_.call(this,e,t)}return t=u,(n=[{key:"getType",value:function(){return"FramePicture"}},{key:"isFramePicture",value:function(){return!0}}])&&a(t.prototype,n),r&&a(t,r),u}(((_=n(7280))&&_.__esModule?_:{default:_}).default);t.default=l},4720:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=l(n(2949)),a=l(n(9784)),i=l(n(307)),o=l(n(2320)),u=l(n(2475)),s=l(n(3801));l(n(3846));function l(e){return e&&e.__esModule?e:{default:e}}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e,t){return m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},m(e,t)}function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=d(e);if(t){var _=d(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return h(this,n)}}function h(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function d(e){return d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},d(e)}var S=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(h,e);var t,n,r,l=c(h);function h(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h),(n=l.call(this,e,t))._m_Mesh=null,n._m_ModelAABBBoundingBox=null,n._m_Material=null,n._m_IsDrawable=!0,n._m_Opaque=!0,n}return t=h,(n=[{key:"getType",value:function(){return"Geometry"}},{key:"lod",value:function(e){this._m_CurrentLod!=e&&(this._m_CurrentLod=e,null!=this._m_Mesh&&this._m_Mesh.lod(this._m_CurrentLod))}},{key:"setMaterial",value:function(e){this._m_Material=e,this._m_Mesh&&this._refreshBufLocal()}},{key:"getMaterial",value:function(){return this._m_Material}},{key:"setMesh",value:function(e){this._m_Mesh=e,this._m_Material&&this._refreshBufLocal()}},{key:"getMesh",value:function(){return this._m_Mesh}},{key:"updateBound",value:function(){this._m_Mesh&&(this._m_Mesh._updateBound(this._m_Scene.getCanvas().getGLContext()),this._m_ModelAABBBoundingBox||(this._m_ModelAABBBoundingBox=new s.default,this._m_ModelAABBBoundingBox.fromPositions(this._m_Mesh.getData(i.default.S_POSITIONS)),this._m_BoudingVolume||(this._m_BoudingVolume=new s.default),this._m_BoudingVolume.setTo(this._m_ModelAABBBoundingBox)),this._m_Mesh.lod(this._m_CurrentLod))}},{key:"getBoundingVolume",value:function(){return this._m_UpdateBoundingVolume&&(o.default.decomposeMat4(this.getWorldMatrix(),_.default.S_TEMP_VEC3,_.default.S_TEMP_Q,_.default.S_TEMP_VEC3_2),this._m_ModelAABBBoundingBox.transform(_.default.S_TEMP_VEC3_2,_.default.S_TEMP_Q,_.default.S_TEMP_VEC3,this._m_BoudingVolume),this._m_UpdateBoundingVolume=!1),this._m_BoudingVolume}},{key:"_refreshBufLocal",value:function(){}},{key:"isDrawable",value:function(){return this._m_IsDrawable}},{key:"setIsDrawable",value:function(e){this._m_IsDrawable=e}},{key:"isFramePicture",value:function(){return!1}},{key:"setOpaque",value:function(){this._m_Opaque=!0}},{key:"isOpaque",value:function(){return this._m_Opaque}},{key:"setTranslucent",value:function(){this._m_Opaque=!1}},{key:"isTranslucent",value:function(){return!this._m_Opaque}},{key:"isSky",value:function(){}},{key:"isGUI",value:function(){}},{key:"draw",value:function(e){var t=this._m_Scene.getCanvas().getGLContext(),n=e.m_LastSubShader.getContextVars(),r=null,_=null;for(var i in n)switch(i){case a.default.S_MODEL_MATRIX_SRC:t[n[i].fun](n[i].loc,!1,this.getWorldMatrix().getBufferData());break;case a.default.S_MV_SRC:r=e.getCalcContext(a.default.S_VIEW_MATRIX_SRC),o.default.multiplyMM(u.default.S_TEMP_MAT4,0,r,0,this.getWorldMatrix(),0),n[i].fun(n[i].loc,!1,u.default.S_TEMP_MAT4.getBufferData());break;case a.default.S_MVP_SRC:r=e.getCalcContext(a.default.S_VIEW_MATRIX_SRC),_=e.getCalcContext(a.default.S_PROJECT_MATRIX_SRC),o.default.multiplyMM(u.default.S_TEMP_MAT4,0,r,0,this.getWorldMatrix(),0),o.default.multiplyMM(u.default.S_TEMP_MAT4_1,0,_,0,r,0),t[n[i].fun](n[i].loc,!1,u.default.S_TEMP_MAT4_1.getBufferData())}this._m_Mesh.draw(t)}}])&&f(t.prototype,n),r&&f(t,r),h}(_.default);t.default=S},2949:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=m(n(9650)),a=m(n(2320)),i=m(n(5604)),o=m(n(453)),u=m(n(3801)),s=m(n(1550)),l=m(n(5397)),f=m(n(3846));function m(e){return e&&e.__esModule?e:{default:e}}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function h(e,t){return h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},h(e,t)}function d(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=p(e);if(t){var _=p(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return S(this,n)}}function S(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function p(e){return p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},p(e)}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(m,e);var t,n,r,_=d(m);function m(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,m),(n=_.call(this,e,{id:l.default.nextId()+t.id}))._m_Name=t.id,n._m_CurrentLod=0,n._m_LocalMatrix=new a.default,n._m_WorldMatrix=new a.default,n._m_Parent=null,n._m_Children=[],n._m_ChildrenIDs={},n._m_LocalScale=new i.default(1,1,1),n._m_LocalRotation=new o.default(0,0,0,1),n._m_LocalTranslation=new i.default,n._m_UpdateLocalMatrix=!1,n._m_UpdateWorldMatrix=!1,n._m_BoudingVolume=null,n._m_UpdateBoundingVolume=!0,n._m_FrustumContain=s.default.S_FRUSTUM_INTERSECT_INTERSECTS,n._m_CullMode=null,n._m_CullingFlags=1,n._m_CullingFlags|=m.S_DEFAULT_FRUSTUM_CULLING,n._m_FilterFlag=m.S_DYNAMIC,n._m_ShadowMode=1,n._m_ShadowMode|=m.S_SHADOW_CAST_AND_RECEIVE,n}return t=m,(n=[{key:"getType",value:function(){return"Node"}},{key:"castShadow",value:function(e){!e||0!=(this._m_ShadowMode&m.S_SHADOW_CAST)&&0!=(this._m_ShadowMode&m.S_SHADOW_CAST_AND_RECEIVE)?(0!=(this._m_ShadowMode&m.S_SHADOW_CAST)&&(this._m_ShadowMode^=m.S_SHADOW_CAST),0!=(this._m_ShadowMode&m.S_SHADOW_CAST_AND_RECEIVE)&&(this._m_ShadowMode^=m.S_SHADOW_CAST_AND_RECEIVE,console.log("_m_ShadowMode:"+this._m_ShadowMode),this._m_ShadowMode&0==m.S_SHADOW_RECEIVE&&(this._m_ShadowMode|=m.S_SHADOW_RECEIVE))):this._m_ShadowMode|=m.S_SHADOW_CAST,this._m_Children.forEach((function(t){t.castShadow(e)}))}},{key:"isCastShadow",value:function(){return 0!=(this._m_ShadowMode&m.S_SHADOW_CAST)||0!=(this._m_ShadowMode&m.S_SHADOW_CAST_AND_RECEIVE)}},{key:"receiveShadow",value:function(e){!e||0!=(this._m_ShadowMode&m.S_SHADOW_RECEIVE)&&0!=(this._m_FilterFlag&m.S_SHADOW_CAST_AND_RECEIVE)?(0!=(this._m_ShadowMode&m.S_SHADOW_RECEIVE)&&(this._m_ShadowMode^=m.S_SHADOW_RECEIVE),0!=(this._m_ShadowMode&m.S_SHADOW_CAST_AND_RECEIVE)&&(this._m_ShadowMode^=m.S_SHADOW_CAST_AND_RECEIVE,this._m_ShadowMode&0==m.S_SHADOW_CAST&&(this._m_ShadowMode|=m.S_SHADOW_CAST))):this._m_ShadowMode|=m.S_SHADOW_RECEIVE,this._m_Children.forEach((function(t){t.receiveShadow(e)}))}},{key:"isReceiveShadow",value:function(){return 0!=(this._m_ShadowMode&m.S_SHADOW_RECEIVE)||0!=(this._m_ShadowMode&m.S_SHADOW_CAST_AND_RECEIVE)}},{key:"isDrawable",value:function(){return!1}},{key:"lod",value:function(e){this._m_CurrentLod!=e&&this._m_Children.getChildren().length>0&&this._m_Children.forEach((function(t){t.lod(e)}))}},{key:"setFilterFlag",value:function(e){this._m_FilterFlag=e}},{key:"getFilterFlag",value:function(){return this._m_FilterFlag}},{key:"getCullingFlags",value:function(){return this._m_CullingFlags}},{key:"clearCullingFlags",value:function(e){this._m_CullingFlags^=e}},{key:"addCullingFlags",value:function(e){this._m_CullingFlags|=e}},{key:"inFrustum",value:function(e){return this._m_FrustumContain=null==this._m_Parent?s.default.S_FRUSTUM_INTERSECT_INTERSECTS:this._m_Parent._m_FrustumContain,this._m_FrustumContain==s.default.S_FRUSTUM_INTERSECT_INTERSECTS&&(this._m_FrustumContain=e.frustumContains(this.getBoundingVolume())),this._m_FrustumContain!=s.default.S_FRUSTUM_INTERSECT_OUTSIDE}},{key:"getBoundingVolume",value:function(){var e=this;if(this._m_UpdateBoundingVolume){if(this._m_Children.length>0){var t=null;this._m_Children.forEach((function(n){(t=n.getBoundingVolume())&&(e._m_BoudingVolume||(e._m_BoudingVolume=new u.default),e._m_BoudingVolume.merge(t))}))}this._m_UpdateBoundingVolume=!1}return this._m_BoudingVolume}},{key:"getChildren",value:function(){return this._m_Children}},{key:"getChildrenAtName",value:function(e){var t=this._m_ChildrenIDs[e];if(t)return t;for(var n=this._m_Children.length,r=0;r<n;r++)if(t=this._m_Children[r].getChildrenAtName(e))return t;return null}},{key:"getChildrenAtIndex",value:function(e){return e>=this._m_Children.length?null:this._m_Children[e]}},{key:"getParent",value:function(){return this._m_Parent}},{key:"setLocalScale",value:function(e){this._m_LocalScale.setTo(e),this._updateLocalMatrix()}},{key:"setLocalScaleXYZ",value:function(e,t,n){this._m_LocalScale.setToInXYZ(e,t,n),this._updateLocalMatrix()}},{key:"getLocalScale",value:function(){return this._m_LocalScale}},{key:"setLocalRotation",value:function(e){this._m_LocalRotation.setTo(e),this._updateLocalMatrix()}},{key:"setLocalRotationFromEuler",value:function(e,t,n){this._m_LocalRotation.fromEuler(e,t,n),this._updateLocalMatrix()}},{key:"setLocalRotationFromXYZW",value:function(e,t,n,r){this._m_LocalRotation.setToInXYZW(e,t,n,r),this._updateLocalMatrix()}},{key:"getLocalRotation",value:function(){return this._m_LocalRotation}},{key:"setLocalTranslation",value:function(e){this._m_LocalTranslation.setTo(e),this._updateLocalMatrix()}},{key:"setLocalTranslationXYZ",value:function(e,t,n){this._m_LocalTranslation.setToInXYZ(e,t,n),this._updateLocalMatrix()}},{key:"getLocalTranslation",value:function(){return this._m_LocalTranslation}},{key:"_updateBounding",value:function(){this._m_UpdateBoundingVolume=!0}},{key:"_updateLocalMatrix",value:function(){this._m_UpdateLocalMatrix=!0,this._updateWorldMatrix(),this._updateBounding(),null!=this._m_Parent&&this._m_Parent._updateBounding(),this._m_Children.forEach((function(e){e._updateBounding()}))}},{key:"_updateWorldMatrix",value:function(){this._m_UpdateWorldMatrix=!0,this._m_Children.forEach((function(e){e._updateWorldMatrix()}))}},{key:"getLocalMatrix",value:function(){return this._m_UpdateLocalMatrix&&(a.default.composeMat4(this._m_LocalTranslation,this._m_LocalRotation,this._m_LocalScale,this._m_LocalMatrix),this._m_UpdateLocalMatrix=!1),this._m_LocalMatrix}},{key:"setLocalMatrix",value:function(e){this._m_LocalMatrix.set(e),this._updateLocalMatrix(),this._m_UpdateLocalMatrix=!1,a.default.decomposeMat4(e,this._m_LocalTranslation,this._m_LocalRotation,this._m_LocalScale)}},{key:"setLocalMatrixFromArray",value:function(e){this._m_LocalMatrix.setArray(e),this._updateLocalMatrix(),this._m_UpdateLocalMatrix=!1,a.default.decomposeMat4(this._m_LocalMatrix,this._m_LocalTranslation,this._m_LocalRotation,this._m_LocalScale)}},{key:"getWorldMatrix",value:function(){return this._m_UpdateWorldMatrix&&this._buildWorldMatrix(),this._m_WorldMatrix}},{key:"_buildWorldMatrix",value:function(){this._m_UpdateWorldMatrix&&(this.getLocalMatrix(),this._m_Parent?a.default.multiplyMM(this._m_WorldMatrix,0,this._m_Parent.getWorldMatrix(),0,this._m_LocalMatrix,0):this._m_WorldMatrix.set(this._m_LocalMatrix),this._m_UpdateWorldMatrix=!1)}},{key:"getName",value:function(){return this._m_Name}},{key:"addChildren",value:function(e){if(e instanceof m)if(null!=e._m_Parent||this._m_ChildrenIDs[e.getName()]){var t=e.getName()+l.default.nextId();f.default.warn("已存在:"+e.getName()+",重命名为:"+t),e._m_Name=t,null==e._m_Parent?(this._m_ChildrenIDs[e.getName()]=e,this._m_Children.push(e),e._m_Parent=this,e._updateWorldMatrix(),this._updateBounding()):f.default.warn(t+"已存在与父节点:"+e._m_Parent.getName())}else this._m_ChildrenIDs[e.getName()]=e,this._m_Children.push(e),e._m_Parent=this,e._updateWorldMatrix(),this._updateBounding();else f.default.error("children不是一个合法的Node!")}},{key:"removeChildren",value:function(e){if(e instanceof m&&this._m_ChildrenIDs[e.getName()]){this._m_ChildrenIDs[e.getName()]=null;var t=this._m_Children.indexOf(e);t>-1&&this._m_Children.splice(t,1),e._m_Parent=null}}},{key:"traverse",value:function(e){e&&e(this),this._m_Children.forEach((function(t){e&&e(t),t.traverse(e)}))}}])&&c(t.prototype,n),r&&c(t,r),m}(_.default);t.default=y,g(y,"S_DEFAULT_FRUSTUM_CULLING",2),g(y,"S_DYNAMIC",4),g(y,"S_ALWAYS",8),g(y,"S_NEVER",16),g(y,"S_SHADOW_RECEIVE",2),g(y,"S_SHADOW_CAST",4),g(y,"S_SHADOW_CAST_AND_RECEIVE",8),g(y,"S_SHADOW_NONE",0),g(y,"S_TEMP_VEC3",new i.default),g(y,"S_TEMP_Q",new o.default),g(y,"S_TEMP_VEC3_2",new i.default)},7280:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=f(n(4720)),a=f(n(2949)),i=f(n(307)),o=f(n(3370)),u=f(n(8113)),s=f(n(4008)),l=f(n(5397));function f(e){return e&&e.__esModule?e:{default:e}}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t){return c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},c(e,t)}function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var _=S(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return d(this,n)}}function d(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function S(e){return S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},S(e)}var p=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(f,e);var t,n,r,_=h(f);function f(e,t){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),(n=_.call(this,e,t))._m_Width=t.width||1,n._m_Height=t.height||1,n._m_Zindex=1,n._m_Left=0,n._m_Top=0;var r=new i.default;return r.setData(i.default.S_POSITIONS,[-1,1,1,-1,-1,1,1,1,1,1,-1,1]),r.setData(i.default.S_UV0,[0,1,0,0,1,1,1,0]),r.setData(i.default.S_INDICES,[0,1,2,2,1,3]),n.setMesh(r),n.updateBound(),n._m_FilterFlag=a.default.S_NEVER,n._m_ShadowMode=a.default.S_SHADOW_NONE,n}return t=f,(n=[{key:"getType",value:function(){return"Picture"}},{key:"useDefaultMat",value:function(){this.setMaterial(new s.default(this._m_Scene,{id:"picture_gui_"+l.default.nextId(),materialDef:u.default.parse(o.default.S_PICTURE_DEF_DATA)}))}},{key:"setSize",value:function(e,t){this._m_Width==e&&this._m_Height==t||this.setLocalScaleXYZ(e,t,1)}},{key:"setLeftTop",value:function(e,t){this._m_Left==e&&this._m_Top==t||(this._m_Left=e,this._m_Top=t,this.setLocalTranslationXYZ(this._m_Left,this._m_Top,2*this._m_Zindex-1))}},{key:"setZIndex",value:function(e){this._m_Zindex!=e&&(this._m_Zindex=Math.min(Math.max(0,e),1),this._m_Scene.getCanvas().getWidth(),this._m_Scene.getCanvas().getHeight(),this.setLocalTranslationXYZ(this._m_Left,this._m_Top,2*this._m_Zindex-1))}},{key:"getWidthSize",value:function(){return this._m_Width*this._m_Scene.getCanvas().getWidth()}},{key:"getWidth",value:function(){return this._m_Width}},{key:"getHeightSize",value:function(){return this._m_Height*this._m_Scene.getCanvas().getHeight()}},{key:"getHeight",value:function(){return this._m_Height}},{key:"isDrawable",value:function(){return!0}},{key:"isGUI",value:function(){return!0}}])&&m(t.prototype,n),r&&m(t,r),f}(_.default);t.default=p},5765:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=o(n(4720)),a=o(n(307)),i=o(n(5397));function o(e){return e&&e.__esModule?e:{default:e}}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t){return s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},s(e,t)}function l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m(e);if(t){var _=m(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return f(this,n)}}function f(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function m(e){return m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},m(e)}var c=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(o,e);var t,n,r,_=l(o);function o(e,t){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),n=_.call(this,e,t);var r=t.xHalf||1;r<=0&&(console.error("xHalf不能小于等于0!"),r*=-1);var u=t.yHalf||1;u<=0&&(console.error("yHalf不能小于等于0!"),u*=-1);var s=t.zHalf||1;s<=0&&(console.error("zHalf不能小于等于0!"),s*=-1);var l=t.center,f=l?l._m_X:0,m=l?l._m_Y:0,c=l?l._m_Z:0,h=-r+f,d=-u+m,S=-s+c,p=r+f,g=u+m,y=s+c,v=new a.default;v.setData(a.default.S_POSITIONS,[p,g,y,h,g,y,h,d,y,p,d,y,p,g,y,p,d,y,p,d,S,p,g,S,p,g,y,p,g,S,h,g,S,h,g,y,h,g,y,h,g,S,h,d,S,h,d,y,h,d,S,p,d,S,p,d,y,h,d,y,p,d,S,h,d,S,h,g,S,p,g,S]),v.setData(a.default.S_NORMALS,[0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1]),v.setData(a.default.S_UV0,[1,0,0,0,0,1,1,1,0,0,0,1,1,1,1,0,1,1,1,0,0,0,0,1,1,0,0,0,0,1,1,1,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0]),v.setData(a.default.S_INDICES,[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]);var T=i.default.generatorTangents2(v.getData(a.default.S_INDICES),v.getData(a.default.S_POSITIONS),v.getData(a.default.S_UV0),v.getData(a.default.S_NORMALS));return v.setData(a.default.S_TANGENTS,T),n.setMesh(v),n.updateBound(),n}return t=o,(n=[{key:"getType",value:function(){return"Box"}}])&&u(t.prototype,n),r&&u(t,r),o}(_.default);t.default=c},7698:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=o(n(4720)),a=o(n(307)),i=o(n(5397));function o(e){return e&&e.__esModule?e:{default:e}}function u(e,t){return u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},u(e,t)}function s(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var _=f(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return l(this,n)}}function l(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},f(e)}var m=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(n,e);var t=s(n);function n(e,r){var _;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),_=t.call(this,e,r);var o,u,s,l,f,m,c,h,d=r.width||1,S=r.height||1,p=[],g=[],y=[],v=[],T=d/2,E=S/2,b=r.widthSegments||1,C=r.heightSegments||1,P=b+1,R=C+1,M=d/b,A=S/C;for(u=0;u<R;u++)for(o=0;o<P;o++)s=o*M-T,l=u*A-E,p.push(s),p.push(0),p.push(-l),g.push(0),g.push(1),g.push(0),y.push(o/b),y.push(1-u/C);for(u=0;u<C;u++)for(o=0;o<b;o++)f=o+P*u,m=o+P*(u+1),c=o+1+P*(u+1),h=o+1+P*u,v.push(f),v.push(m),v.push(c),v.push(c),v.push(h),v.push(f);var w=new a.default;w.setData(a.default.S_POSITIONS,p),w.setData(a.default.S_NORMALS,g),w.setData(a.default.S_UV0,y),w.setData(a.default.S_INDICES,v);var I=i.default.generatorTangents2(w.getData(a.default.S_INDICES),w.getData(a.default.S_POSITIONS),w.getData(a.default.S_UV0),w.getData(a.default.S_NORMALS));return w.setData(a.default.S_TANGENTS,I),w.setPrimitive(a.default.S_PRIMITIVE_LINES),_.setMesh(w),_.updateBound(),_}return n}(_.default);t.default=m},1645:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=o(n(4720)),a=o(n(307)),i=o(n(5397));function o(e){return e&&e.__esModule?e:{default:e}}function u(e,t){return u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},u(e,t)}function s(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var _=f(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return l(this,n)}}function l(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},f(e)}var m=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(n,e);var t=s(n);function n(e,r){var _;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),_=t.call(this,e,r);var o=r.xSize||1;o<=0&&(console.error("xSize不能小于等于0!"),o*=-1);var u=r.zSize||1;u<=0&&(console.error("zSize不能小于等于0!"),u*=-1);var s=r.xSegments||1;s<=0&&(console.error("xSegments不能小于等于0!"),s*=-1),s<1&&(s=1);var l=r.zSegments||1;l<0&&(console.error("zSegments不能小于等于0!"),l*=-1),l<1&&(l=1);var f,m,c,h,d,S,p,g=r.center,y=g?g[0]:0,v=g?g[1]:0,T=g?g[2]:0,E=o/2,b=u/2,C=Math.floor(s)||1,P=Math.floor(l)||1,R=C+1,M=P+1,A=o/C,w=u/P,I=new Float32Array(R*M*3),L=new Float32Array(R*M*3),D=new Float32Array(R*M*2),O=0,F=0;for(f=0;f<M;f++){var x=f*w-b;for(m=0;m<R;m++)c=m*A-E,I[O]=c+y,I[O+1]=v,I[O+2]=-x+T,L[O+2]=-1,D[F]=(C-m)/C,D[F+1]=(P-f)/P,O+=3,F+=2}O=0;var k=new(I.length/3>65535?Uint32Array:Uint16Array)(C*P*6);for(f=0;f<P;f++)for(m=0;m<C;m++)h=m+R*f,d=m+R*(f+1),S=m+1+R*(f+1),p=m+1+R*f,k[O]=p,k[O+1]=d,k[O+2]=h,k[O+3]=p,k[O+4]=S,k[O+5]=d,O+=6;var N=new a.default;N.setData(a.default.S_POSITIONS,I),N.setData(a.default.S_NORMALS,L),N.setData(a.default.S_UV0,D),N.setData(a.default.S_INDICES,k);var B=i.default.generatorTangents2(N.getData(a.default.S_INDICES),N.getData(a.default.S_POSITIONS),N.getData(a.default.S_UV0),N.getData(a.default.S_NORMALS));return N.setData(a.default.S_TANGENTS,B),_.setMesh(N),_.updateBound(),_}return n}(_.default);t.default=m},6341:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=o(n(4720)),a=o(n(307)),i=o(n(5397));function o(e){return e&&e.__esModule?e:{default:e}}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t){return s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},s(e,t)}function l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m(e);if(t){var _=m(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return f(this,n)}}function f(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function m(e){return m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},m(e)}var c=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(o,e);var t,n,r,_=l(o);function o(e,t){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),n=_.call(this,e,t);var r=t.lod||1,u=t.center?t.center._m_X:0,s=t.center?t.center._m_Y:0,l=t.center?t.center._m_Z:0,f=t.radius||1;f<=0&&(console.error("radius不能小于等于0!"),f*=-1);var m=t.heightSegments||18;m<=0&&(console.error("heightSegments不能小于等于0!"),m*=-1),(m=Math.floor(r*m))<18&&(m=18);var c=t.widthSegments||18;c<=0&&(console.error("widthSegments不能小于等于0!"),c*=-1),(c=Math.floor(r*c))<18&&(c=18);var h,d,S,p,g,y,v,T,E,b,C,P,R,M,A=[],w=[],I=[],L=[];for(h=0;h<=m;h++)for(S=h*Math.PI/m,p=Math.sin(S),g=Math.cos(S),d=0;d<=c;d++)y=2*d*Math.PI/c,v=Math.sin(y),T=Math.cos(y)*p,E=g,b=v*p,C=1-d/c,P=h/m,w.push(T),w.push(E),w.push(b),I.push(C),I.push(P),A.push(u+f*T),A.push(s+f*E),A.push(l+f*b);for(h=0;h<m;h++)for(d=0;d<c;d++)M=(R=h*(c+1)+d)+c+1,L.push(R+1),L.push(M+1),L.push(M),L.push(R+1),L.push(M),L.push(R);var D=new a.default;D.setData(a.default.S_POSITIONS,A),D.setData(a.default.S_NORMALS,w),D.setData(a.default.S_UV0,I),D.setData(a.default.S_INDICES,L);var O=i.default.generatorTangents2(D.getData(a.default.S_INDICES),D.getData(a.default.S_POSITIONS),D.getData(a.default.S_UV0),D.getData(a.default.S_NORMALS));return D.setData(a.default.S_TANGENTS,O),n.setMesh(D),n.updateBound(),n}return t=o,(n=[{key:"getType",value:function(){return"Sphere"}}])&&u(t.prototype,n),r&&u(t,r),o}(_.default);t.default=c},9468:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=l(n(4720)),a=l(n(307)),i=l(n(4008)),o=l(n(5397)),u=l(n(3370)),s=l(n(8113));function l(e){return e&&e.__esModule?e:{default:e}}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e,t){return m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},m(e,t)}function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=d(e);if(t){var _=d(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return h(this,n)}}function h(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function d(e){return d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},d(e)}var S=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(l,e);var t,n,r,_=c(l);function l(e,t){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),n=_.call(this,e,t);var r=new a.default;r.setData(a.default.S_POSITIONS,[3.4201992,0,-9.396927,2.7669992,2.0103426,-9.396927,1.0568995,3.2528028,-9.396927,-1.0568998,3.2528026,-9.396927,-2.7669995,2.0103424,-9.396927,-3.4201992,-2.9900332e-7,-9.396927,-2.766999,-2.010343,-9.396927,-1.0569,-3.2528026,-9.396927,1.0569001,-3.2528026,-9.396927,2.7670002,-2.0103416,-9.396927,3.4201992,0,-9.396927,6.427875,0,-7.660445,5.20026,3.7782102,-7.660445,1.9863225,6.1132727,-7.660445,-1.9863229,6.113272,-7.660445,-5.2002606,3.7782097,-7.660445,-6.427875,-5.6194267e-7,-7.660445,-5.2002597,-3.7782109,-7.660445,-1.9863232,-6.113272,-7.660445,1.9863235,-6.113272,-7.660445,5.2002616,-3.7782083,-7.660445,6.427875,0,-7.660445,8.6602545,0,-4.9999995,7.0062933,5.0903697,-4.9999995,2.6761656,8.236392,-4.9999995,-2.676166,8.236391,-4.9999995,-7.006294,5.090369,-4.9999995,-8.6602545,-7.5710346e-7,-4.9999995,-7.006293,-5.0903707,-4.9999995,-2.6761668,-8.236391,-4.9999995,2.676167,-8.236391,-4.9999995,7.006295,-5.0903673,-4.9999995,8.6602545,0,-4.9999995,9.848078,0,-1.7364818,7.9672623,5.7885547,-1.7364818,3.0432231,9.366078,-1.7364818,-3.0432239,9.366078,-1.7364818,-7.9672627,5.788554,-1.7364818,-9.848078,-8.6094633e-7,-1.7364818,-7.967262,-5.788556,-1.7364818,-3.0432243,-9.366078,-1.7364818,3.0432246,-9.366078,-1.7364818,7.9672647,-5.788552,-1.7364818,9.848078,0,-1.7364818,9.848078,0,1.7364826,7.9672623,5.7885547,1.7364826,3.0432231,9.366078,1.7364826,-3.0432239,9.366078,1.7364826,-7.9672627,5.788554,1.7364826,-9.848078,-8.6094633e-7,1.7364826,-7.967262,-5.788556,1.7364826,-3.0432243,-9.366078,1.7364826,3.0432246,-9.366078,1.7364826,7.9672647,-5.788552,1.7364826,9.848078,0,1.7364826,8.660254,0,5.0000005,7.0062923,5.090369,5.0000005,2.6761653,8.236391,5.0000005,-2.6761658,8.23639,5.0000005,-7.006293,5.0903687,5.0000005,-8.660254,-7.571034e-7,5.0000005,-7.006292,-5.09037,5.0000005,-2.6761663,-8.23639,5.0000005,2.6761665,-8.23639,5.0000005,7.0062943,-5.090367,5.0000005,8.660254,0,5.0000005,6.427875,0,7.660445,5.20026,3.7782102,7.660445,1.9863225,6.1132727,7.660445,-1.9863229,6.113272,7.660445,-5.2002606,3.7782097,7.660445,-6.427875,-5.6194267e-7,7.660445,-5.2002597,-3.7782109,7.660445,-1.9863232,-6.113272,7.660445,1.9863235,-6.113272,7.660445,5.2002616,-3.7782083,7.660445,6.427875,0,7.660445,3.4201992,0,9.396927,2.7669992,2.0103426,9.396927,1.0568995,3.2528028,9.396927,-1.0568998,3.2528026,9.396927,-2.7669995,2.0103424,9.396927,-3.4201992,-2.9900332e-7,9.396927,-2.766999,-2.010343,9.396927,-1.0569,-3.2528026,9.396927,1.0569001,-3.2528026,9.396927,2.7670002,-2.0103416,9.396927,3.4201992,0,9.396927,0,0,-10,0,0,10]),r.setData(a.default.S_INDICES,[0,11,1,1,11,12,1,12,2,2,12,13,2,13,3,3,13,14,3,14,4,4,14,15,4,15,5,5,15,16,5,16,6,6,16,17,6,17,7,7,17,18,7,18,8,8,18,19,8,19,9,9,19,20,9,20,10,10,20,21,11,22,12,12,22,23,12,23,13,13,23,24,13,24,14,14,24,25,14,25,15,15,25,26,15,26,16,16,26,27,16,27,17,17,27,28,17,28,18,18,28,29,18,29,19,19,29,30,19,30,20,20,30,31,20,31,21,21,31,32,22,33,23,23,33,34,23,34,24,24,34,35,24,35,25,25,35,36,25,36,26,26,36,37,26,37,27,27,37,38,27,38,28,28,38,39,28,39,29,29,39,40,29,40,30,30,40,41,30,41,31,31,41,42,31,42,32,32,42,43,33,44,34,34,44,45,34,45,35,35,45,46,35,46,36,36,46,47,36,47,37,37,47,48,37,48,38,38,48,49,38,49,39,39,49,50,39,50,40,40,50,51,40,51,41,41,51,52,41,52,42,42,52,53,42,53,43,43,53,54,44,55,45,45,55,56,45,56,46,46,56,57,46,57,47,47,57,58,47,58,48,48,58,59,48,59,49,49,59,60,49,60,50,50,60,61,50,61,51,51,61,62,51,62,52,52,62,63,52,63,53,53,63,64,53,64,54,54,64,65,55,66,56,56,66,67,56,67,57,57,67,68,57,68,58,58,68,69,58,69,59,59,69,70,59,70,60,60,70,71,60,71,61,61,71,72,61,72,62,62,72,73,62,73,63,63,73,74,63,74,64,64,74,75,64,75,65,65,75,76,66,77,67,67,77,78,67,78,68,68,78,79,68,79,69,69,79,80,69,80,70,70,80,81,70,81,71,71,81,82,71,82,72,72,82,83,72,83,73,73,83,84,73,84,74,74,84,85,74,85,75,75,85,86,75,86,76,76,86,87,0,1,88,1,2,88,2,3,88,3,4,88,4,5,88,5,6,88,6,7,88,7,8,88,8,9,88,9,10,88,77,89,78,78,89,79,79,89,80,80,89,81,81,89,82,82,89,83,83,89,84,84,89,85,85,89,86,86,89,87]),n.setMesh(r),n.updateBound();var f=new i.default(e,{id:t.id+o.default.nextId(),materialDef:s.default.parse(u.default.S_DEFAULT_SKY_BOX_DEF)});return n.setMaterial(f),n}return t=l,(n=[{key:"getType",value:function(){return"SkyBox"}}])&&f(t.prototype,n),r&&f(t,r),l}(_.default);t.default=S},2482:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=o(n(9650)),a=o(n(2949)),i=o(n(3846));o(n(5397));function o(e){return e&&e.__esModule?e:{default:e}}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t){return s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},s(e,t)}function l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m(e);if(t){var _=m(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return f(this,n)}}function f(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function m(e){return m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},m(e)}var c=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(o,e);var t,n,r,_=l(o);function o(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),n=_.call(this,e,t),e instanceof a.default||i.default.error("owner必须是Geometry或其子类!"),n._m_LastDistance=0,n._m_LastLodLevel=0,n._m_DistCommonDifference=t.distCommonDifference||1,n._m_LodLevelDists=[],n._m_TrisPerPixel=t.trisPerPixel||1,n._m_NumLodLevels=0,n._m_NumTris=[],n.distr(),n._m_Scene.on("render",(function(e){n._doUpdate()})),n}return t=o,(n=[{key:"getType",value:function(){return"LodControl"}},{key:"distr",value:function(){this._m_NumLodLevels=this._m_Owner.getMesh().getLodLevelCount();for(var e=0;e<this._m_NumLodLevels;e++)this._m_NumTris[e]=this._m_Owner.getMesh().getLodPrimitiveCount(e),this._m_LodLevelDists[e]=this._m_DistCommonDifference*e}},{key:"_update",value:function(){var e=this._m_Owner.getBoundingVolume(),t=this._m_Scene.getMainCamera(),n=Math.atan(t.getTop()*t.getNear()),r=Math.PI/(8*n),_=e.distance(t.getEye())/r,a=0;_>this._m_LastDistance&&Math.abs(_-this._m_LastDistance)<=this._m_DistCommonDifference||this._m_LastDistance>_&&0==this._m_LastLodLevel||this._m_LastDistance<_&&this._m_LastLodLevel==this._m_NumLodLevels-1?a=this._m_LastLodLevel:(a=_>this._m_LastDistance?this._m_LastLodLevel+1:this._m_LastLodLevel-1,a=Math.min(a,this._m_NumLodLevels),a=Math.max(a,0),this._m_LastDistance=this._m_LodLevelDists[a],this._m_LastLodLevel=a),this._m_Owner.lod(a)}}])&&u(t.prototype,n),r&&u(t,r),o}(_.default);t.default=c},9011:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=m(n(9650)),a=m(n(2949)),i=m(n(9369)),o=m(n(4720)),u=m(n(3801)),s=m(n(5604)),l=m(n(8583)),f=m(n(3846));function m(e){return e&&e.__esModule?e:{default:e}}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function h(e,t){return h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},h(e,t)}function d(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=p(e);if(t){var _=p(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return S(this,n)}}function S(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function p(e){return p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},p(e)}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(m,e);var t,n,r,_=d(m);function m(e,t){var n;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,m),(n=_.call(this,e,t))._m_OctNode=null,e instanceof a.default&&(e.clearCullingFlags(a.default.S_DEFAULT_FRUSTUM_CULLING),n.createOct(e,4),n._m_OctNode)){var r=null,i=null;n._m_Scene.on("render",(function(e){r=n._m_Scene.getRender().getVisDrawables(),i=n._m_Scene.getFrustumCullingCamera(),n.octCulling(i,r)}))}return n}return t=m,(n=[{key:"getType",value:function(){return"OctCullingControl"}},{key:"_debug",value:function(e,t,n){var r=this;if(n.isValid()){var _=new o.default(e,{id:l.default.nextId()+"_oct"});_.setMesh(l.default.createAABBBoundingBoxMeshFromAABBBoundingBox(n.getAABBBoundingBox())),_.setMaterial(t),_.updateBound(),e.addChildren(_),n.getLeafs()&&n.getLeafs().forEach((function(n){r._debug(e,t,n)}))}}},{key:"debug",value:function(e,t){this._m_OctNode&&this._debug(e,t,this._m_OctNode)}},{key:"createOct",value:function(e,t){var n=e.getBoundingVolume();if(n){var r=new u.default,_=n.getXHalf(),a=n.getYHalf(),o=n.getZHalf(),l=Math.max(Math.max(_,a),o),m=n.getCenter();r.fromMinMax(new s.default(-l+m._m_X,-l+m._m_Y,-l+m._m_Z),new s.default(l+m._m_X,l+m._m_Y,l+m._m_Z)),this._m_OctNode=new i.default(null,r),this._m_OctNode.setValid(!0),f.default.debug("开始预建!"),this._preBuilt(this._m_OctNode,t),f.default.debug("预建完成!"),this.distrNode(e,this._m_OctNode)}}},{key:"_preBuiltOctLeaf",value:function(e,t){var n=null,r=e.getLeafs(),_=e.getAABBBoundingBox(),a=_.getMin(),o=_.getMax(),u=_.getCenter();m.S_TEMP_MIN.setToInXYZ(a._m_X,u._m_Y,a._m_Z),m.S_TEMP_MAX.setToInXYZ(u._m_X,o._m_Y,u._m_Z),m.S_TEMP_AABBBOUNDINGBOX.fromMinMax(m.S_TEMP_MIN,m.S_TEMP_MAX),n=new i.default(null,m.S_TEMP_AABBBOUNDINGBOX),r.push(n),this._preBuilt(n,t),m.S_TEMP_MIN.setToInXYZ(a._m_X,u._m_Y,u._m_Z),m.S_TEMP_MAX.setToInXYZ(u._m_X,o._m_Y,o._m_Z),m.S_TEMP_AABBBOUNDINGBOX.fromMinMax(m.S_TEMP_MIN,m.S_TEMP_MAX),n=new i.default(null,m.S_TEMP_AABBBOUNDINGBOX),r.push(n),this._preBuilt(n,t),m.S_TEMP_MIN.setToInXYZ(u._m_X,u._m_Y,a._m_Z),m.S_TEMP_MAX.setToInXYZ(o._m_X,o._m_Y,u._m_Z),m.S_TEMP_AABBBOUNDINGBOX.fromMinMax(m.S_TEMP_MIN,m.S_TEMP_MAX),n=new i.default(null,m.S_TEMP_AABBBOUNDINGBOX),r.push(n),this._preBuilt(n,t),m.S_TEMP_MIN.setToInXYZ(u._m_X,u._m_Y,u._m_Z),m.S_TEMP_MAX.setToInXYZ(o._m_X,o._m_Y,o._m_Z),m.S_TEMP_AABBBOUNDINGBOX.fromMinMax(m.S_TEMP_MIN,m.S_TEMP_MAX),n=new i.default(null,m.S_TEMP_AABBBOUNDINGBOX),r.push(n),this._preBuilt(n,t),m.S_TEMP_MIN.setToInXYZ(a._m_X,a._m_Y,a._m_Z),m.S_TEMP_MAX.setToInXYZ(u._m_X,u._m_Y,u._m_Z),m.S_TEMP_AABBBOUNDINGBOX.fromMinMax(m.S_TEMP_MIN,m.S_TEMP_MAX),n=new i.default(null,m.S_TEMP_AABBBOUNDINGBOX),r.push(n),this._preBuilt(n,t),m.S_TEMP_MIN.setToInXYZ(a._m_X,a._m_Y,u._m_Z),m.S_TEMP_MAX.setToInXYZ(u._m_X,u._m_Y,o._m_Z),m.S_TEMP_AABBBOUNDINGBOX.fromMinMax(m.S_TEMP_MIN,m.S_TEMP_MAX),n=new i.default(null,m.S_TEMP_AABBBOUNDINGBOX),r.push(n),this._preBuilt(n,t),m.S_TEMP_MIN.setToInXYZ(u._m_X,a._m_Y,a._m_Z),m.S_TEMP_MAX.setToInXYZ(o._m_X,u._m_Y,u._m_Z),m.S_TEMP_AABBBOUNDINGBOX.fromMinMax(m.S_TEMP_MIN,m.S_TEMP_MAX),n=new i.default(null,m.S_TEMP_AABBBOUNDINGBOX),r.push(n),this._preBuilt(n,t),m.S_TEMP_MIN.setToInXYZ(u._m_X,a._m_Y,u._m_Z),m.S_TEMP_MAX.setToInXYZ(o._m_X,u._m_Y,o._m_Z),m.S_TEMP_AABBBOUNDINGBOX.fromMinMax(m.S_TEMP_MIN,m.S_TEMP_MAX),n=new i.default(null,m.S_TEMP_AABBBOUNDINGBOX),r.push(n),this._preBuilt(n,t)}},{key:"_preBuilt",value:function(e,t){t>0&&(t--,e.initLeafs(),this._preBuiltOctLeaf(e,t))}},{key:"distrNode",value:function(e,t){var n=this,r=e.getChildren();r&&r.length>0?r.forEach((function(e){n.distrNode(e,t)})):e instanceof o.default&&this.distrOct(e,t)}},{key:"distrOct",value:function(e,t){var n=e.getBoundingVolume();if(t.getAABBBoundingBox().contains(n)){var r=t.getLeafs();if(null!=r){for(var _=!1,a=0;a<8;a++)if(this.distrOct(e,r[a])){_=!0,t.setValid(!0);break}return _||(t.addRef(e),t.setValid(!0)),!0}return t.addRef(e),t.setValid(!0),!0}return!1}},{key:"cullingLeafs",value:function(e,t,n){var r=this;if(e.isValid()&&e.inFrustum(t)){if(e.getRefs()){var _=t.getFrustumMask();e.getRefs().forEach((function(e){e.inFrustum(t)&&n.push(e),t.setFrustumMask(_)}))}if(e.getLeafs()){var a=t.getFrustumMask();e.getLeafs().forEach((function(e){t.setFrustumMask(a),r.cullingLeafs(e,t,n)}))}}}},{key:"octCulling",value:function(e,t){var n=e.getFrustumMask();e.setFrustumMask(0),this.cullingLeafs(this._m_OctNode,e,t),e.setFrustumMask(n)}}])&&c(t.prototype,n),r&&c(t,r),m}(_.default);t.default=y,g(y,"S_TEMP_AABBBOUNDINGBOX",new u.default),g(y,"S_TEMP_MIN",new s.default),g(y,"S_TEMP_MAX",new s.default)},9369:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(3801)),_=a(n(1550));function a(e){return e&&e.__esModule?e:{default:e}}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var u=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._m_Valid=!1,this._m_Refs=t,this._m_AABBBoundingBox=new r.default,this._m_AABBBoundingBox.setTo(n),this._m_Leafs=null,this._m_FrustumContain=null}var t,n,a;return t=e,(n=[{key:"inFrustum",value:function(e){return this._m_FrustumContain=e.frustumContains(this.getAABBBoundingBox()),this._m_FrustumContain!=_.default.S_FRUSTUM_INTERSECT_OUTSIDE}},{key:"setValid",value:function(e){this._m_Valid=e}},{key:"isValid",value:function(){return this._m_Valid}},{key:"addRef",value:function(e){this._m_Refs||(this._m_Refs=[]),this._m_Refs.push(e)}},{key:"getRefs",value:function(){return this._m_Refs}},{key:"getAABBBoundingBox",value:function(){return this._m_AABBBoundingBox}},{key:"getLeaf",value:function(e){return this._m_Leafs[e]}},{key:"getLeafs",value:function(){return this._m_Leafs}},{key:"initLeafs",value:function(){this._m_Leafs=[]}}])&&i(t.prototype,n),a&&i(t,a),e}();t.default=u,o(u,"S_LEAF_TBL",0),o(u,"S_LEAF_TFL",1),o(u,"S_LEAF_TBR",2),o(u,"S_LEAF_TFR",3),o(u,"S_LEAF_BBL",4),o(u,"S_LEAF_BFL",5),o(u,"S_LEAF_BBR",6),o(u,"S_LEAF_BFR",7)},1797:(e,t)=>{function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._m_Scenes=[],this._m_SceneIds={},this._m_Stop=!1}var t,r,_;return t=e,(r=[{key:"addScene",value:function(e){this._m_SceneIds[e.id]||(this._m_SceneIds[e.id]=e,this._m_Scenes.push(e))}},{key:"removeScene",value:function(e){this._m_SceneIds[e.id]&&(this._m_SceneIds[e.id]=null,this._m_Scenes.remove(e))}},{key:"launch",value:function(){var e=this;this._m_Stop=!1;var t=this,n=Date.now();requestAnimationFrame((function r(){var _=Date.now(),a=.001*(_-n);n=_,e._m_Scenes.forEach((function(e){e.update(a),e.render(a)})),t._m_Stop||requestAnimationFrame(r)}))}},{key:"close",value:function(){this._m_Stop=!0}}])&&n(t.prototype,r),_&&n(t,_),e}();t.default=r},7664:(e,t)=>{function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,_;return t=e,(r=[{key:"isDrawable",value:function(){}},{key:"isFramePicture",value:function(){}},{key:"isOpaque",value:function(){}},{key:"isTranslucent",value:function(){}},{key:"isTransparent",value:function(){}},{key:"draw",value:function(e){}}])&&n(t.prototype,r),_&&n(t,_),e}();t.default=r},3370:(e,t)=>{function n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)};t.default=r,n(r,"S_COLOR_DEF_DATA","// 颜色材质,提供指定颜色或颜色纹理并渲染\nDef ColorDef{\n    Params{\n        vec4 color;\n        sampler2D colorMap;\n        float alphaDiscard;\n    }\n    SubTechnology ScalePass{\n        Vars{\n            vec4 wordPosition;\n        }\n        Vs_Shader{\n            void main(){\n                //Context.OutPosition = Context.ProjectViewModelMatrix * vec4(Context.InPosition, 1.0f);\n                mat4 scaleMat4 = mat4(\n                    0.2f, 0.0f, 0.0f, 0.0f,\n                    0.0f, 0.2f, 0.0f, 0.0f,\n                    0.0f, 0.0f, 0.2f, 0.0f,\n                    0.0f, 0.0f, 0.0f, 1.0f\n                );\n                Context.OutPosition = Context.ProjectMatrix * Context.ViewMatrix * Context.ModelMatrix * vec4(Context.InPosition, 1.0f);\n                wordPosition = Context.OutPosition;\n            }\n        }\n        Fs_Shader{\n            void main(){\n                // 使用自定义颜色输出\n                #ifdef Params.color\n                    Context.OutColor = Params.color;\n                #else\n                    // 使用纹理\n                    #ifdef Params.colorMap\n                        Context.OutColor = texture(Params.colorMap, Context.InUv0);\n                        #ifdef Params.alphaDiscard\n                            if(Context.OutColor.a < Params.alphaDiscard){\n                                discard;\n                            }\n                        #endif\n                    #else\n                        Context.OutColor = vec4(1.0f, 1.0f, 0.0f, 1.0f);\n                    #endif\n                #endif\n                vec4 wPosition = wordPosition;\n            }\n        }\n    }\n    SubTechnology ColorPass{\n        Vars{\n            vec4 wordPosition;\n            vec2 uv0;\n        }\n        Vs_Shader{\n            void main(){\n                //Context.OutPosition = Context.ProjectViewModelMatrix * vec4(Context.InPosition, 1.0f);\n                Context.OutPosition = Context.ProjectMatrix * Context.ViewMatrix * Context.ModelMatrix * vec4(Context.InPosition, 1.0f);\n                wordPosition = Context.OutPosition;\n                uv0 = Context.InUv0;\n            }\n        }\n        Fs_Shader{\n            void main(){\n                // 使用自定义颜色输出\n                #ifdef Params.color\n                    Context.OutColor = Params.color;\n                #else\n                    // 使用纹理\n                    #ifdef Params.colorMap\n                        Context.OutColor = texture(Params.colorMap, uv0);\n                        #ifdef Params.alphaDiscard\n                            if(Context.OutColor.a < Params.alphaDiscard){\n                                discard;\n                            }\n                        #endif\n                    #else\n                        Context.OutColor = vec4(1.0f, 1.0f, 1.0f, 1.0f);\n                    #endif\n                #endif\n            }\n        }\n    }\n    SubTechnology GreenPass{\n        Vars{\n            vec4 wordPosition;\n        }\n        Vs_Shader{\n            void main(){\n                Context.OutPosition = Context.ProjectMatrix * Context.ViewMatrix * Context.ModelMatrix * vec4(Context.InPosition, 1.0f);\n                wordPosition = Context.OutPosition;\n            }\n        }\n        Fs_Shader{\n            void main(){\n                // 先判断Params.color是否有值\n                #ifdef Params.color\n                    Context.OutColor = Params.color;\n                #else\n                    Context.OutColor = vec4(0.0f, 1.0f, 0.0f, 1.0f);\n                #endif\n            }\n        }\n    }\n    Technology{\n        Sub_Pass{\n            Pass ColorPass{\n            }\n        }\n    }\n    Technology Green{\n        Sub_Pass{\n            Pass GreenPass{\n            }\n        }\n    }\n    // ScaleColorPass\n    Technology ScaleColor{\n        Sub_Pass{\n            //第一个pass不应该写入深度,否则第二个pass被剔除\n            //可以指定每个pass的写入状态,比如关闭深度,开启深度之类的\n            Pass ScalePass{\n                // 这个pass剔除前面\n                FaceCull Front;\n            }\n            Pass ColorPass{\n                // 这个pass剔除背面\n                FaceCull Back;\n            }\n        }\n    }\n}\n"),n(r,"S_POST_SHADOW_DEF_DATA","// PostShadowDef\nDef PostShadowDef{\n    Params{\n        // ShadowInfo\n        float shadowIntensity;\n        int filterMode;\n        bool hardwareShadow;\n        bool backfaceShadows;\n        float pcfEdge;\n        vec2 fadeInfo;\n    }\n    SubTechnology PostShadowPass{\n        Vars{\n            vec2 wUv0;\n            mat4 pvInverse;\n            vec4 pvRow2;\n        }\n        Vs_Shader{\n            void main(){\n                Context.OutPosition = vec4(Context.InPosition, 1.0f);\n                pvInverse = inverse(Context.ProjectViewMatrix);\n                // glsl是列矩阵,这里我获取第二行(只需要变换得到z即可测试PSSM)\n                pvRow2 = vec4(Context.ProjectViewMatrix[0][2], Context.ProjectViewMatrix[1][2], Context.ProjectViewMatrix[2][2], Context.ProjectViewMatrix[3][2]);\n                wUv0 = Context.InUv0;\n            }\n        }\n        Fs_Shader{\n            //#extension GL_ARB_gpu_shader5 : enable\n            float shadowBorderScale = 1.0f;\n            #ifdef HARDWARE_SHADOWS\n                #define SHADOWMAP sampler2DShadow\n                #define SHADOWCOMPAREOFFSET(tex,coord,offset) textureProjOffset(tex, coord, offset)\n                #define SHADOWCOMPARE(tex,coord) textureProj(tex, coord)\n                #define SHADOWGATHER(tex,coord) textureGather(tex, coord.xy, coord.z)\n            #else\n                #define SHADOWMAP sampler2D\n                #define SHADOWCOMPAREOFFSET(tex,coord,offset) step(coord.z, textureProjOffset(tex, coord, offset).r)\n                #define SHADOWCOMPARE(tex,coord) step(coord.z, textureProj(tex, coord).r)\n                #define SHADOWGATHER(tex,coord) step(coord.z, textureGather(tex, coord.xy))\n            #endif\n\n            #define FILTER_MODE 1\n\n            #if FILTER_MODE == 10\n                #define GETSHADOW Shadow_Nearest\n                #define KERNEL 1.0\n            #elif FILTER_MODE == 1\n                #ifdef HARDWARE_SHADOWS\n                    #define GETSHADOW Shadow_Nearest\n                #else\n                    #define GETSHADOW Shadow_DoBilinear_2x2\n                #endif\n                #define KERNEL 1.0\n            #endif\n\n            #if (FILTER_MODE == 2)\n                #define GETSHADOW Shadow_DoDither_2x2\n                #define KERNEL 1.0\n            #elif FILTER_MODE == 3\n                #define GETSHADOW Shadow_DoPCF\n                #define KERNEL 4.0\n            #elif FILTER_MODE == 4\n                #define GETSHADOW Shadow_DoPCFPoisson\n                #define KERNEL 4.0\n            #elif FILTER_MODE == 5\n                #define GETSHADOW Shadow_DoPCF\n                #define KERNEL 8.0\n            #endif\n\n            float Shadow_DoShadowCompare(in SHADOWMAP tex,in vec4 projCoord){\n                return SHADOWCOMPARE(tex, projCoord);\n            }\n\n            float Shadow_BorderCheck(in vec2 coord){\n                // 最快的“hack”方法（使用 4-5 条指令）\n                vec4 t = vec4(coord.xy, 0.0f, 1.0f);\n                t = step(t.wwxy, t.xyzz);\n                return dot(t,t);\n            }\n\n            float Shadow_Nearest(in SHADOWMAP tex,in vec4 projCoord){\n                float border = Shadow_BorderCheck(projCoord.xy);\n                if (border > 0.0f){\n                    return 1.0f;\n                }\n                return SHADOWCOMPARE(tex, projCoord);\n            }\n\n            //----------------------------------ShadowFilter--------------------------------------\n            float Shadow_DoShadowCompareOffset(in SHADOWMAP tex,in vec4 projCoord,in vec2 offset){\n                vec4 coord = vec4(projCoord.xy + offset.xy * Context.SMapSizeInverse * shadowBorderScale, projCoord.zw);\n                return SHADOWCOMPARE(tex, coord);\n            }\n\n\n            float Shadow_DoDither_2x2(in SHADOWMAP tex, in vec4 projCoord){\n                float border = Shadow_BorderCheck(projCoord.xy);\n                if (border > 0.0f)\n                    return 1.0f;\n\n                float shadow = 0.0f;\n                vec2 o = vec2(ivec2(mod(floor(gl_FragCoord.xy), 2.0f))); //Strict type checking in GLSL ES\n                shadow += Shadow_DoShadowCompareOffset(tex, projCoord, (vec2(-1.5f, 1.5f)+o));\n                shadow += Shadow_DoShadowCompareOffset(tex, projCoord, (vec2( 0.5f, 1.5f)+o));\n                shadow += Shadow_DoShadowCompareOffset(tex, projCoord, (vec2(-1.5f, -0.5f)+o));\n                shadow += Shadow_DoShadowCompareOffset(tex, projCoord, (vec2( 0.5f, -0.5f)+o));\n                shadow *= 0.25f;\n                return shadow;\n            }\n\n            float Shadow_DoBilinear_2x2(in SHADOWMAP tex, in vec4 projCoord){\n                float border = Shadow_BorderCheck(projCoord.xy);\n                if (border > 0.0f){\n                    return 1.0f;\n                }\n\n                vec4 gather = vec4(0.0f);\n                #if defined GL_ARB_gpu_shader5 || defined GL_OES_gpu_shader5\n                    vec4 coord = vec4(projCoord.xyz / projCoord.www, 0.0f);\n                    gather = SHADOWGATHER(tex, coord);\n                #else\n                    gather.x = SHADOWCOMPAREOFFSET(tex, projCoord, ivec2(0, 1));\n                    gather.y = SHADOWCOMPAREOFFSET(tex, projCoord, ivec2(1, 1));\n                    gather.z = SHADOWCOMPAREOFFSET(tex, projCoord, ivec2(1, 0));\n                    gather.w = SHADOWCOMPAREOFFSET(tex, projCoord, ivec2(0, 0));\n                #endif\n\n               vec2 f = fract( projCoord.xy * Context.ShadowMapSize );\n               vec2 mx = mix( gather.wx, gather.zy, f.x );\n               return mix( mx.x, mx.y, f.y );\n            }\n\n            float Shadow_DoPCF(in SHADOWMAP tex,in vec4 projCoord){\n\n                float shadow = 0.0f;\n                float border = Shadow_BorderCheck(projCoord.xy);\n                if (border > 0.0f)\n                    return 1.0f;\n\n                float bound = KERNEL * 0.5f - 0.5f;\n                bound *= Params.pcfEdge;\n                for (float y = -bound; y <= bound; y += Params.pcfEdge){\n                    for (float x = -bound; x <= bound; x += Params.pcfEdge){\n                        shadow += Shadow_DoShadowCompareOffset(tex, projCoord, vec2(x,y));\n                    }\n                }\n\n                shadow = shadow / (KERNEL * KERNEL);\n                return shadow;\n            }\n\n            //12 tap poisson disk\n            const vec2 poissonDisk0 =  vec2(-0.1711046f, -0.425016f);\n            const vec2 poissonDisk1 =  vec2(-0.7829809f, 0.2162201f);\n            const vec2 poissonDisk2 =  vec2(-0.2380269f, -0.8835521f);\n            const vec2 poissonDisk3 =  vec2(0.4198045f, 0.1687819f);\n            const vec2 poissonDisk4 =  vec2(-0.684418f, -0.3186957f);\n            const vec2 poissonDisk5 =  vec2(0.6026866f, -0.2587841f);\n            const vec2 poissonDisk6 =  vec2(-0.2412762f, 0.3913516f);\n            const vec2 poissonDisk7 =  vec2(0.4720655f, -0.7664126f);\n            const vec2 poissonDisk8 =  vec2(0.9571564f, 0.2680693f);\n            const vec2 poissonDisk9 =  vec2(-0.5238616f, 0.802707f);\n            const vec2 poissonDisk10 = vec2(0.5653144f, 0.60262f);\n            const vec2 poissonDisk11 = vec2(0.0123658f, 0.8627419f);\n\n\n            float Shadow_DoPCFPoisson(in SHADOWMAP tex, in vec4 projCoord){\n                float shadow = 0.0f;\n                float border = Shadow_BorderCheck(projCoord.xy);\n                if (border > 0.0f){\n                    return 1.0f;\n                }\n\n                vec2 texelSize = Context.SMapSizeInverse * 4.0f * Params.pcfEdge * shadowBorderScale;\n\n                shadow += SHADOWCOMPARE(tex, vec4(projCoord.xy + poissonDisk0 * texelSize, projCoord.zw));\n                shadow += SHADOWCOMPARE(tex, vec4(projCoord.xy + poissonDisk1 * texelSize, projCoord.zw));\n                shadow += SHADOWCOMPARE(tex, vec4(projCoord.xy + poissonDisk2 * texelSize, projCoord.zw));\n                shadow += SHADOWCOMPARE(tex, vec4(projCoord.xy + poissonDisk3 * texelSize, projCoord.zw));\n                shadow += SHADOWCOMPARE(tex, vec4(projCoord.xy + poissonDisk4 * texelSize, projCoord.zw));\n                shadow += SHADOWCOMPARE(tex, vec4(projCoord.xy + poissonDisk5 * texelSize, projCoord.zw));\n                shadow += SHADOWCOMPARE(tex, vec4(projCoord.xy + poissonDisk6 * texelSize, projCoord.zw));\n                shadow += SHADOWCOMPARE(tex, vec4(projCoord.xy + poissonDisk7 * texelSize, projCoord.zw));\n                shadow += SHADOWCOMPARE(tex, vec4(projCoord.xy + poissonDisk8 * texelSize, projCoord.zw));\n                shadow += SHADOWCOMPARE(tex, vec4(projCoord.xy + poissonDisk9 * texelSize, projCoord.zw));\n                shadow += SHADOWCOMPARE(tex, vec4(projCoord.xy + poissonDisk10 * texelSize, projCoord.zw));\n                shadow += SHADOWCOMPARE(tex, vec4(projCoord.xy + poissonDisk11 * texelSize, projCoord.zw));\n\n                // 除以 12\n                return shadow * 0.08333333333f;\n            }\n            //----------------------------------ShadowFilter--------------------------------------\n\n\n            vec3 getPosition(in float depth, in vec2 newTexCoord){\n\n                vec4 pos;\n                pos.xy = (newTexCoord * vec2(2.0f)) - vec2(1.0f);\n                pos.z  = depth * 2.0f - 1.0f;\n                pos.w  = 1.0f;\n                pos    = pvInverse * pos;\n                pos.xyz /= pos.w;\n                return pos.xyz;\n            }\n            #ifdef Context.Pssm\n                // 基于PSSM实现的DirectionalLightShadows\n                float getDirectionalLightShadows(in vec4 splits,in float shadowPosition, in SHADOWMAP shadowMap0, in SHADOWMAP shadowMap1, in SHADOWMAP shadowMap2,in SHADOWMAP shadowMap3, in vec4 projCoord0,in vec4 projCoord1,in vec4 projCoord2,in vec4 projCoord3){\n                    float shadow = 1.0f;\n                    if(shadowPosition < splits.x){\n                        shadow = GETSHADOW(shadowMap0, projCoord0 );\n                    }\n                    else if( shadowPosition <  splits.y){\n                        shadowBorderScale = 0.5f;\n                        shadow = GETSHADOW(shadowMap1, projCoord1);\n                    }\n                    else if( shadowPosition <  splits.z){\n                        shadowBorderScale = 0.25f;\n                        shadow = GETSHADOW(shadowMap2, projCoord2);\n                    }\n                    else if( shadowPosition <  splits.w){\n                        shadowBorderScale = 0.125f;\n                        shadow = GETSHADOW(shadowMap3, projCoord3);\n                    }\n                    return shadow;\n                }\n            #endif\n            #ifdef Context.PointLightShadows\n                float getPointLightShadows(in vec4 worldPos,in vec3 lightPos, in SHADOWMAP shadowMap0, in SHADOWMAP shadowMap1, in SHADOWMAP shadowMap2, in SHADOWMAP shadowMap3, in SHADOWMAP shadowMap4, in SHADOWMAP shadowMap5, in vec4 projCoord0,in vec4 projCoord1,in vec4 projCoord2,in vec4 projCoord3,in vec4 projCoord4,in vec4 projCoord5){\n                    float shadow = 1.0f;\n                    vec3 vect = worldPos.xyz - lightPos;\n                    vec3 absv = abs(vect);\n                    float maxComp = max(absv.x,max(absv.y,absv.z));\n                    if(maxComp == absv.y){\n                       if(vect.y < 0.0f){\n                           shadow = GETSHADOW(shadowMap0, projCoord0 / projCoord0.w);\n                       }\n                       else{\n                           shadow = GETSHADOW(shadowMap1, projCoord1 / projCoord1.w);\n                       }\n                    }\n                    else if(maxComp == absv.z){\n                       if(vect.z < 0.0f){\n                           shadow = GETSHADOW(shadowMap2, projCoord2 / projCoord2.w);\n                       }\n                       else{\n                           shadow = GETSHADOW(shadowMap3, projCoord3 / projCoord3.w);\n                       }\n                    }\n                    else if(maxComp == absv.x){\n                       if(vect.x < 0.0f){\n                           shadow = GETSHADOW(shadowMap4, projCoord4 / projCoord4.w);\n                       }\n                       else{\n                           shadow = GETSHADOW(shadowMap5, projCoord5 / projCoord5.w);\n                       }\n                    }\n                    return shadow;\n                }\n            #endif\n            #ifdef Context.SpotLightShadows\n                float getSpotLightShadows(in SHADOWMAP shadowMap, in  vec4 projCoord){\n                    float shadow = 1.0f;\n                    projCoord /= projCoord.w;\n                    shadow = GETSHADOW(shadowMap, projCoord);\n\n                    // 一个小的衰减，使阴影很好地融入暗部，将纹理坐标值转换为 -1,1 范围，因此纹理坐标向量的长度实际上是地面上变亮区域的半径\n                    projCoord = projCoord * 2.0f - 1.0f;\n                    float fallOff = ( length(projCoord.xy) - 0.9f ) / 0.1f;\n                    return mix(shadow, 1.0f, clamp(fallOff, 0.0f, 1.0f));\n                }\n            #endif\n            vec3 approximateNormal(in vec4 worldPos,in vec2 texCoord, in sampler2D depthMap, in vec2 resolutionInverse){\n                float step = resolutionInverse.x;\n                float stepy = resolutionInverse.y;\n                float depth2 = texture(depthMap, texCoord + vec2(step, -stepy)).r;\n                float depth3 = texture(depthMap, texCoord + vec2(-step, -stepy)).r;\n                vec4 worldPos2 = vec4(getPosition(depth2, texCoord + vec2(step, -stepy)),1.0f);\n                vec4 worldPos3 = vec4(getPosition(depth3, texCoord + vec2(-step, -stepy)),1.0f);\n\n                vec3 v1 = (worldPos - worldPos2).xyz;\n                vec3 v2 = (worldPos3 - worldPos2).xyz;\n                return normalize(cross(v1, v2));\n            }\n            const mat4 biasMat = mat4(0.5f, 0.0f, 0.0f, 0.0f,\n                                      0.0f, 0.5f, 0.0f, 0.0f,\n                                      0.0f, 0.0f, 0.5f, 0.0f,\n                                      0.5f, 0.5f, 0.5f, 1.0f);\n            void main(){\n                float depth = texture(Context.InDepth, wUv0).r;\n                Context.OutColor = texture(Context.InScreen, wUv0);\n\n                // 跳过不需要的部分,depth为1.0的基本上是背景或sky部分\n                if(depth >= 1.0f){\n                    return;\n                }\n\n                // 深度重建世界坐标\n                vec4 wPosition = vec4(getPosition(depth, wUv0), 1.0f);\n\n                vec3 lightDir;\n                #ifdef Context.Pssm\n                    lightDir = Context.LightDir;\n                #else\n                    lightDir = wPosition.xyz - Context.LightPos;\n                #endif\n\n                #ifdef Params.backfaceShadows\n                    // 丢弃背面时,由于在forward pipeline下无法获取该点法线,所以只能通过近似算法获取法线\n                    // 该近似算法依赖于深度信息,所以很容易造成Shadow Acne\n                    if(!Params.backfaceShadows){\n                        vec3 normal = approximateNormal(wPosition, wUv0, Context.InDepth, Context.ResolutionInverse);\n                        float ndotl = dot(normal, lightDir);\n                        if(ndotl > 0.0f){\n                            return;\n                        }\n                    }\n                #endif\n\n                #if !defined(Context.PointLightShadows)\n                    #if !defined(Context.Pssm)\n                        if( dot(Context.LightDir, lightDir) < 0.0f){\n                            return;\n                        }\n                    #endif\n                #endif\n\n                // 将坐标转换到光源空间\n                vec4 projCoord0 = biasMat * Context.LightViewProjectMatrix0 * wPosition;\n                vec4 projCoord1 = biasMat * Context.LightViewProjectMatrix1 * wPosition;\n                vec4 projCoord2 = biasMat * Context.LightViewProjectMatrix2 * wPosition;\n                vec4 projCoord3 = biasMat * Context.LightViewProjectMatrix3 * wPosition;\n                #ifdef Context.PointLightShadows\n                   vec4 projCoord4 = biasMat * Context.LightViewProjectMatrix4 * wPosition;\n                   vec4 projCoord5 = biasMat * Context.LightViewProjectMatrix5 * wPosition;\n                #endif\n\n                // 计算阴影\n                float shadow = 1.0f;\n\n                #if defined(Context.Pssm)\n                    float shadowPosition = pvRow2.x * wPosition.x +  pvRow2.y * wPosition.y +  pvRow2.z * wPosition.z +  pvRow2.w;\n                #else\n                    #if defined(Params.fadeInfo)\n                        float shadowPosition = pvRow2.x * wPosition.x +  pvRow2.y * wPosition.y +  pvRow2.z * wPosition.z +  pvRow2.w;\n                    #endif\n                #endif\n\n                #ifdef Context.PointLightShadows\n                    // pointLight shadow\n                    shadow = getPointLightShadows(wPosition, Context.LightPos, Context.InShadowMap0, Context.InShadowMap1, Context.InShadowMap2, Context.InShadowMap3, Context.InShadowMap4, Context.InShadowMap5, projCoord0, projCoord1, projCoord2, projCoord3, projCoord4, projCoord5);\n                #else\n                    #ifdef Context.Pssm\n                        // directionalLight shadow\n                        shadow = getDirectionalLightShadows(Context.Splits, shadowPosition, Context.InShadowMap0, Context.InShadowMap1, Context.InShadowMap2, Context.InShadowMap3, projCoord0, projCoord1, projCoord2, projCoord3);\n                    #else\n                        #ifdef Context.SpotLightShadows\n                            // spotLight shadow\n                            shadow = getSpotLightShadows(Context.InShadowMap0, projCoord0);\n                        #endif\n                    #endif\n                #endif\n\n                #ifdef Params.fadeInfo\n                    shadow = clamp(max(0.0f, mix(shadow, 1.0f,(shadowPosition - Params.fadeInfo.x) * Params.fadeInfo.y)), 0.0f, 1.0f);\n                #endif\n                #ifdef Params.shadowIntensity\n                    shadow = shadow * Params.shadowIntensity + (1.0f - Params.shadowIntensity);\n                #else\n                    shadow = shadow * 0.7f + 0.3f;\n                #endif\n                Context.OutColor = Context.OutColor * vec4(shadow, shadow, shadow, 1.0f);\n            }\n        }\n    }\n    Technology{\n        Sub_Pass PostFilter{\n            Pass PostShadowPass{\n            }\n        }\n    }\n}\n"),n(r,"S_PRE_SHADOW_DEF_DATA","// PreShadowDef\n// 这个材质定义用于捕获ShadowMap,因此,它很简单,只是简单的将深度信息渲染到指定缓冲中\nDef PreShadowDef{\n    Params{\n        bool debug;\n    }\n    SubTechnology PreShadowPass{\n        Vars{\n            vec2 wUv0;\n        }\n        Vs_Shader{\n            void main(){\n                #ifdef Context.Skins\n                    mat4 skinMat =\n                            Context.InWeight0.x * Context.Joints[int(Context.InJoint0.x)] +\n                            Context.InWeight0.y * Context.Joints[int(Context.InJoint0.y)] +\n                            Context.InWeight0.z * Context.Joints[int(Context.InJoint0.z)] +\n                            Context.InWeight0.w * Context.Joints[int(Context.InJoint0.w)];\n                    // vec4 pos = Context.ModelMatrix * skinMat * vec4(Context.InPosition, 1.0f);\n                    vec4 pos = skinMat * vec4(Context.InPosition, 1.0f);\n                #else\n                    vec4 pos = Context.ModelMatrix * vec4(Context.InPosition, 1.0f);\n                #endif\n                wUv0 = Context.InUv0;\n                Context.OutPosition = Context.ProjectViewMatrix * pos;\n            }\n        }\n        Fs_Shader{\n            void main(){\n                #ifdef Params.debug\n                    if(Params.debug){\n                        Context.OutColor = vec4(vec3(gl_FragCoord.z), 1.0f);\n                    }\n                #endif\n            }\n        }\n    }\n    Technology{\n        Sub_Pass PreFrame{\n            Pass PreShadowPass{\n            }\n        }\n    }\n}\n"),n(r,"S_PICTURE_DEF_DATA","// 颜色材质,提供指定颜色或颜色纹理并渲染\nDef PictureDef{\n    Params{\n        vec4 color;\n        sampler2D colorMap;\n        float alphaDiscard;\n    }\n    SubTechnology DefaultPass{\n        Vars{\n            vec2 uv0;\n        }\n        Vs_Shader{\n            void main(){\n                Context.OutPosition = Context.ModelMatrix * vec4(Context.InPosition, 1.0f);\n                uv0 = Context.InUv0;\n            }\n        }\n        Fs_Shader{\n            void main(){\n                // 使用自定义颜色输出\n                #ifdef Params.color\n                    Context.OutColor = Params.color;\n                #else\n                    // 使用纹理\n                    #ifdef Params.colorMap\n                        Context.OutColor = texture(Params.colorMap, uv0);\n                        #ifdef Params.alphaDiscard\n                            if(Context.OutColor.a < Params.alphaDiscard){\n                                discard;\n                            }\n                        #endif\n                    #else\n                        Context.OutColor = vec4(1.0f, 1.0f, 1.0f, 1.0f);\n                    #endif\n                #endif\n            }\n        }\n    }\n    Technology{\n        Sub_Pass{\n            Pass DefaultPass{\n            }\n        }\n    }\n}\n"),n(r,"S_GAMMA_CORRECTION_DEF_DATA","// gamma矫正\n// 由于webGL不支持硬件gamma矫正,只能通过后处理进行\nDef GammaCorrectionFilterDef{\n    Params{\n        float gammaFactor;\n        bool toneMapping;\n    }\n    SubTechnology GammaCorrectionFilter{\n        Vars{\n            vec2 uv0;\n        }\n        Vs_Shader{\n            void main(){\n                Context.OutPosition = vec4(Context.InPosition, 1.0f);\n                uv0 = Context.InUv0;\n            }\n        }\n        Fs_Shader{\n            void main(){\n                Context.OutColor = texture(Context.InScreen, uv0);\n                #ifdef Params.toneMapping\n                    if(Params.toneMapping){\n                        Context.OutColor.rgb = Context.OutColor.rgb / (Context.OutColor.rgb + vec3(1.0f));\n                    }\n                #endif\n                #ifdef Params.gammaFactor\n                    Context.OutColor.rgb = pow(Context.OutColor.rgb, vec3(Params.gammaFactor));\n                #endif\n            }\n        }\n    }\n    Technology{\n        Sub_Pass PostFilter{\n            Pass GammaCorrectionFilter{\n            }\n        }\n    }\n}\n"),n(r,"S_DEFAULT_OUT_COLOR_DEF_DATA","// 输出颜色缓冲材质\nDef DefaultOutColorDef{\n    Params{\n        float gammaFactor;\n        bool toneMapping;\n    }\n    SubTechnology DefaultOutColor{\n        Vars{\n            vec2 uv0;\n        }\n        Vs_Shader{\n            void main(){\n                Context.OutPosition = vec4(Context.InPosition, 1.0f);\n                uv0 = Context.InUv0;\n            }\n        }\n        Fs_Shader{\n            void main(){\n                Context.OutColor = texture(Context.InForwardColorMap, uv0);\n                #ifdef Params.toneMapping\n                    if(Params.toneMapping){\n                        Context.OutColor.rgb = Context.OutColor.rgb / (Context.OutColor.rgb + vec3(1.0f));\n                    }\n                #endif\n                #ifdef Params.gammaFactor\n                    Context.OutColor.rgb = pow(Context.OutColor.rgb, vec3(Params.gammaFactor));\n                #endif\n            }\n        }\n    }\n    Technology{\n        Sub_Pass{\n            Pass DefaultOutColor{\n            }\n        }\n    }\n}\n"),n(r,"S_DEFAULT_SKY_BOX_DEF","// 天空盒材质定义\nDef SkyBoxDef{\n    Params{\n        // 启用cubeMap通道\n        bool useCubeMap;\n        // 启用envMap通道\n        bool useEnvMap;\n        // 启用高动态映射\n        bool useHDR;\n        samplerCube cubeMap;\n        sampler2D envMap;\n    }\n    SubTechnology SkyBox{\n        Vars{\n            vec3 wPosition;\n        }\n        Vs_Shader{\n            void main(){\n                wPosition = Context.InPosition;\n                // 只需要旋转部分\n                vec4 pos = Context.ViewMatrix * vec4(Context.InPosition, 0.0f);\n                // 应用投影变换\n                pos.w = 1.0f;\n                pos = Context.ProjectMatrix * pos;\n                Context.OutPosition = pos.xyww;\n            }\n        }\n        Fs_Shader{\n            vec2 Optics_SphereCoord(in vec3 dir){\n                float dzplus1 = dir.z + 1.0f;\n\n                // 计算 1/2p\n                // NOTE: 仅当dir归一化时，此简化才有效。\n                float inv_two_p = 1.414f * sqrt(dzplus1);\n                //float inv_two_p = sqrt(dir.x * dir.x + dir.y * dir.y + dzplus1 * dzplus1);\n                inv_two_p *= 2.0f;\n                inv_two_p = 1.0f / inv_two_p;\n\n                // 计算texcoord\n                return (dir.xy * vec2(inv_two_p)) + vec2(0.5f);\n            }\n            const vec2 invAtan = vec2(0.159154943091895f, 0.318309886183790f);\n            #define PI 3.14159265358979323846264\n            // 转换环境纹理映射纹理坐标\n            vec2 fractTexcoord(const in vec3 v)\n            {\n                vec2 uv = vec2(atan(v.z, v.x) + PI, acos(v.y));\n                uv *= invAtan;\n                return uv;\n            }\n            void main(){\n                #ifdef Params.useCubeMap\n                    // 立方体纹理\n                    Context.OutColor = texture( Params.cubeMap, normalize( wPosition ) );\n                #else\n                    #ifdef Params.useEnvMap\n                        // 环境纹理\n                        vec2 uv = fractTexcoord( normalize( wPosition ) );\n                        #ifdef Params.useHDR\n                            // 解码hdr数据,也可以使用硬件RGB9_E5\n                            vec4 rgbe = texture( Params.envMap, uv );\n                            //rgbe.rgb *= pow(2.0f,rgbe.a*255.0f-128.0f);\n                            // 色调映射(后续在后处理统一进行)\n                            //rgbe.rgb = rgbe.rgb / (rgbe.rgb + vec3(1.0f));\n                            // 伽马(后续在后处理统一进行)\n                            //rgbe.rgb = pow(rgbe.rgb, vec3(1.0f / 2.2f));\n                            Context.OutColor.rgb = rgbe.rgb;\n                            Context.OutColor.a = 1.0f;\n                        #else\n                            Context.OutColor = texture( Params.envMap, uv );\n                        #endif\n                    #endif\n                #endif\n            }\n        }\n    }\n    Technology{\n        Sub_Pass{\n            Pass SkyBox{\n            }\n        }\n    }\n}\n"),n(r,"S_PREFILTER_DEF","// 预过滤EnvMap\nDef PrefilterDef{\n    Params{\n        float roughness;\n        float resolution;\n        samplerCube envMap;\n    }\n    SubTechnology Prefilter{\n        Vars{\n            vec3 wPosition;\n        }\n        Vs_Shader{\n            void main(){\n                wPosition = Context.InPosition;\n                // 只需要旋转部分\n                vec4 pos = Context.ViewMatrix * vec4(Context.InPosition, 0.0f);\n                // 应用投影变换\n                pos.w = 1.0f;\n                pos = Context.ProjectMatrix * pos;\n                Context.OutPosition = pos.xyww;\n            }\n        }\n\n        Fs_Shader{\n            const float PI = 3.14159265359f;\n            // ----------------------------------------------------------------------------\n            float DistributionGGX(vec3 N, vec3 H, float roughness)\n            {\n                float a = roughness*roughness;\n                float a2 = a*a;\n                float NdotH = max(dot(N, H), 0.0f);\n                float NdotH2 = NdotH*NdotH;\n\n                float nom   = a2;\n                float denom = (NdotH2 * (a2 - 1.0f) + 1.0f);\n                denom = PI * denom * denom;\n\n                return nom / denom;\n            }\n            // ----------------------------------------------------------------------------\n            // http://holger.dammertz.org/stuff/notes_HammersleyOnHemisphere.html\n            // 高效的VanDerCorpus计算。\n            float RadicalInverse_VdC(uint bits)\n            {\n                 bits = (bits << 16u) | (bits >> 16u);\n                 bits = ((bits & 0x55555555u) << 1u) | ((bits & 0xAAAAAAAAu) >> 1u);\n                 bits = ((bits & 0x33333333u) << 2u) | ((bits & 0xCCCCCCCCu) >> 2u);\n                 bits = ((bits & 0x0F0F0F0Fu) << 4u) | ((bits & 0xF0F0F0F0u) >> 4u);\n                 bits = ((bits & 0x00FF00FFu) << 8u) | ((bits & 0xFF00FF00u) >> 8u);\n                 return float(bits) * 2.3283064365386963e-10; // / 0x100000000\n            }\n            // ----------------------------------------------------------------------------\n            vec2 Hammersley(uint i, uint N)\n            {\n                return vec2(float(i)/float(N), RadicalInverse_VdC(i));\n            }\n            // ----------------------------------------------------------------------------\n            vec3 ImportanceSampleGGX(vec2 Xi, vec3 N, float roughness)\n            {\n                float a = roughness*roughness;\n\n                float phi = 2.0f * PI * Xi.x;\n                float cosTheta = sqrt((1.0 - Xi.y) / (1.0f + (a*a - 1.0f) * Xi.y));\n                float sinTheta = sqrt(1.0 - cosTheta*cosTheta);\n\n                // 从球坐标到笛卡尔坐标-半角向量\n                vec3 H;\n                H.x = cos(phi) * sinTheta;\n                H.y = sin(phi) * sinTheta;\n                H.z = cosTheta;\n\n                // 从切线空间H向量到世界空间样本向量\n                vec3 up          = abs(N.z) < 0.999 ? vec3(0.0f, 0.0f, 1.0f) : vec3(1.0f, 0.0f, 0.0f);\n                vec3 tangent   = normalize(cross(up, N));\n                vec3 bitangent = cross(N, tangent);\n\n                vec3 sampleVec = tangent * H.x + bitangent * H.y + N * H.z;\n                return normalize(sampleVec);\n            }\n            void main(){\n                vec3 N = normalize(wPosition);\n\n                // 做出简化的假设，即V等于R等于法线\n                vec3 R = N;\n                vec3 V = R;\n\n                const uint SAMPLE_COUNT = 1024u;\n                vec3 prefilteredColor = vec3(0.0f);\n                float totalWeight = 0.0f;\n\n                for(uint i = 0u; i < SAMPLE_COUNT; ++i)\n                {\n                    // 生成偏向首选对齐方向的采样矢量（重要性采样）。\n                    vec2 Xi = Hammersley(i, SAMPLE_COUNT);\n                    vec3 H = ImportanceSampleGGX(Xi, N, Params.roughness);\n                    vec3 L  = normalize(2.0 * dot(V, H) * H - V);\n\n                    float NdotL = max(dot(N, L), 0.0f);\n                    if(NdotL > 0.0)\n                    {\n                        // 基于粗糙度/ pdf从环境的mip级别采样\n                        float D   = DistributionGGX(N, H, Params.roughness);\n                        float NdotH = max(dot(N, H), 0.0f);\n                        float HdotV = max(dot(H, V), 0.0f);\n                        float pdf = D * NdotH / (4.0f * HdotV) + 0.0001f;\n\n                        float saTexel  = 4.0f * PI / (6.0f * Params.resolution * Params.resolution);\n                        float saSample = 1.0f / (float(SAMPLE_COUNT) * pdf + 0.0001f);\n\n                        float mipLevel = Params.roughness == 0.0f ? 0.0f : 0.5f * log2(saSample / saTexel);\n\n                        prefilteredColor += textureLod(Params.envMap, L, mipLevel).rgb * NdotL;\n                        totalWeight      += NdotL;\n                    }\n                }\n\n                prefilteredColor = prefilteredColor / totalWeight;\n\n                Context.OutColor = vec4(prefilteredColor, 1.0f);\n            }\n        }\n    }\n    Technology{\n        Sub_Pass{\n            Pass Prefilter{\n            }\n        }\n    }\n}\n"),n(r,"S_ENV_CAPTURE_OUT_DEF","// 将环境捕捉数据渲染并查看\n// 同时,也支持将IBL作为SkyEnv进行场景环境渲染\nDef EnvCaptureOutDef{\n    Params{\n        samplerCube envCaptureMap;\n        float lod;\n    }\n    SubTechnology EnvCaptureOut{\n        Vars{\n            vec3 wPosition;\n        }\n        Vs_Shader{\n            void main(){\n                wPosition = Context.InPosition;\n                Context.OutPosition = Context.ProjectMatrix * Context.ViewMatrix * Context.ModelMatrix * vec4(Context.InPosition, 1.0f);\n            }\n        }\n        Fs_Shader{\n            void main(){\n                #ifdef Params.envCaptureMap\n                    #ifdef Params.lod\n                        Context.OutColor = textureLod(Params.envCaptureMap, normalize(wPosition), Params.lod);\n                    #else\n                        Context.OutColor = texture(Params.envCaptureMap, normalize(wPosition));\n                    #endif\n                #else\n                    Context.OutColor = vec4(1.0f);\n                #endif\n            }\n        }\n    }\n    SubTechnology EnvSkyOut{\n        Vars{\n            vec3 wPosition;\n        }\n        Vs_Shader{\n            void main(){\n                wPosition = Context.InPosition;\n                // 只需要旋转部分\n                vec4 pos = Context.ViewMatrix * vec4(Context.InPosition, 0.0f);\n                // 应用投影变换\n                pos.w = 1.0f;\n                pos = Context.ProjectMatrix * pos;\n                Context.OutPosition = pos.xyww;\n            }\n        }\n        Fs_Shader{\n            void main(){\n                #ifdef Params.envCaptureMap\n                    #ifdef Params.lod\n                        Context.OutColor = textureLod(Params.envCaptureMap, normalize(wPosition), Params.lod);\n                    #else\n                        Context.OutColor = texture(Params.envCaptureMap, normalize(wPosition));\n                    #endif\n                #else\n                    Context.OutColor = vec4(1.0f);\n                #endif\n            }\n        }\n    }\n    Technology{\n        Sub_Pass{\n            Pass EnvCaptureOut{\n            }\n        }\n    }\n    Technology EnvSky{\n        Sub_Pass{\n            Pass EnvSkyOut{\n            }\n        }\n    }\n}\n")},512:(e,t)=>{function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(){function e(t){var n,r,_;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),_=null,(r="_m_Render")in(n=this)?Object.defineProperty(n,r,{value:_,enumerable:!0,configurable:!0,writable:!0}):n[r]=_,this._m_Render=t.render}var t,r,_;return t=e,(r=[{key:"render",value:function(e){}}])&&n(t.prototype,r),_&&n(t,_),e}();t.default=r},6528:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}var _;function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t){return i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},i(e,t)}function o(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=s(e);if(t){var _=s(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return u(this,n)}}function u(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function s(e){return s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},s(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var l=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(u,e);var t,n,r,_=o(u);function u(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),_.call(this,e)}return t=u,(n=[{key:"render",value:function(e){}}])&&a(t.prototype,n),r&&a(t,r),u}(((_=n(870))&&_.__esModule?_:{default:_}).default);t.default=l},870:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=o(n(512)),a=o(n(8435)),i=o(n(3061));function o(e){return e&&e.__esModule?e:{default:e}}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t){return s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},s(e,t)}function l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m(e);if(t){var _=m(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return f(this,n)}}function f(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function m(e){return m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},m(e)}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var h=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(o,e);var t,n,r,_=l(o);function o(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),_.call(this,e)}return t=o,(n=[{key:"render",value:function(e){var t=this,n=e.frameContext,r=e.gl,_=e.scene,u=e.lights,s=!1,l=null,f=!1,m=null,c=!1,h=function(a){n.getRenderState().store();var u=null;e.bucket[a].forEach((function(e){s=!1;var c=_.getComponent(a),h=c.getCurrentTechnology().getSubPasss(i.default.DEFERRED_SHADING);if(h){if(l=h.getSubShaderMaps(),u=o.S_DEFERRED_SHADING_PASS_GROUP[0],null==l[u]&&(u=o.S_DEFERRED_SHADING_PASS_GROUP_2[0]),f)n.m_LastFrameBuffer!=n.getFrameBuffer(l[u].subShader.getFBId()||i.default.DEFAULT_DEFERRED_SHADING_FRAMEBUFFER)&&console.error("使用了不同的dfb>>>");else{f=!0;var d=n.getFrameBuffer(l[u].subShader.getFBId()||i.default.DEFAULT_DEFERRED_SHADING_FRAMEBUFFER);r.bindFramebuffer(r.FRAMEBUFFER,d.getFrameBuffer()),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),n.m_LastFrameBuffer=d}l[u].renderState&&(s=t._m_Render._checkRenderState(r,l[u].renderState,n.getRenderState())),c._selectSubShader(l[u].subShader),e.draw(n),u=o.S_DEFERRED_SHADING_PASS_GROUP[1],m=l[u]?l[u]:l[o.S_DEFERRED_SHADING_PASS_GROUP_2[1]]}s&&t._checkRenderState(r,n.getRenderState().restore(),n.getRenderState())}))};for(var d in e.bucket)h(d);if(f&&m){c=!0;var S=n.m_LastFrameBuffer;r.bindFramebuffer(r.FRAMEBUFFER,n._m_DefaultFrameBuffer),n.m_LastFrameBuffer=n._m_DefaultFrameBuffer,r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),n.m_LastSubShaderId!=m.subShader.getDefId()&&(m.subShader.needCompile()&&m.subShader._compile(r,n),m.subShader.use(r),n.m_LastSubShaderId=m.subShader.getDefId()),n.m_LastSubShader!=m.subShader&&(n.m_LastSubShader=m.subShader),m.renderState&&this._m_Render._checkRenderState(r,m.renderState,n.getRenderState());var p=S.getFramePicture(),g=m.subShader.getRenderDatas();for(var y in g)r.activeTexture(r.TEXTURE0+g[y].loc),r.bindTexture(r.TEXTURE_2D,n.getFrameBuffer(g[y].refId).getTexture(g[y].dataId).getLoc());"On"==n.getRenderState().getFlag(a.default.S_STATES[3])&&r.disable(r.DEPTH_TEST),this._m_Render._m_RenderPrograms[m.subShader.getRenderProgramType()].draw(r,_,n,p,u),"On"==n.getRenderState().getFlag(a.default.S_STATES[3])&&r.enable(r.DEPTH_TEST),r.bindFramebuffer(r.READ_FRAMEBUFFER,S.getFrameBuffer()),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,n._m_DefaultFrameBuffer),r.blitFramebuffer(0,0,_.getCanvas().getWidth(),_.getCanvas().getHeight(),0,0,_.getCanvas().getWidth(),_.getCanvas().getHeight(),r.DEPTH_BUFFER_BIT,r.NEAREST),r.bindFramebuffer(r.FRAMEBUFFER,n._m_DefaultFrameBuffer)}return c}}])&&u(t.prototype,n),r&&u(t,r),o}(_.default);t.default=h,c(h,"S_DEFERRED_SHADING_G_BUFFER_PASS","GBufferPass"),c(h,"S_DEFERRED_SHADING_DEFERRED_SHADING_PASS","DeferredShadingPass"),c(h,"S_DEFERRED_SHADING_PASS_GROUP",[h.S_DEFERRED_SHADING_G_BUFFER_PASS,h.S_DEFERRED_SHADING_DEFERRED_SHADING_PASS]),c(h,"S_DEFERRED_SHADING_PASS_GROUP_2",[0,1])},5734:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=i(n(512)),a=i(n(3061));function i(e){return e&&e.__esModule?e:{default:e}}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t){return u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},u(e,t)}function s(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var _=f(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return l(this,n)}}function l(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},f(e)}var m=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(i,e);var t,n,r,_=s(i);function i(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),_.call(this,e)}return t=i,(n=[{key:"render",value:function(e){var t=this,n=e.frameContext,r=e.gl,_=e.scene,i=e.lights,o=!1,u=null;if(n.getRenderState().store(),e.opaque)for(var s in e.bucket){o=!1;var l=_.getComponent(s),f=l.getCurrentTechnology().getSubPasss(a.default.FORWARD);if(f)for(var m in u=f.getSubShaders())u[m].renderState&&(o=this._m_Render._checkRenderState(r,u[m].renderState,n.getRenderState())),l._selectSubShader(u[m].subShader),this._m_Render._m_RenderPrograms[u[m].subShader.getRenderProgramType()].drawArrays(r,_,n,e.bucket[s],i);o&&this._m_Render._checkRenderState(r,n.getRenderState().restore(),n.getRenderState())}else e.translucent&&e.bucket.forEach((function(e){o=!1;var s=e.getMaterial(),l=s.getCurrentTechnology().getSubPasss(a.default.FORWARD);if(l)for(var f in u=l.getSubShaders())u[f].renderState&&(o=t._checkRenderState(r,u[f].renderState,n.getRenderState())),s._selectSubShader(u[f].subShader),t._m_Render._m_RenderPrograms[u[f].subShader.getRenderProgramType()].draw(r,_,n,e,i);o&&t._m_Render._checkRenderState(r,n.restore(),n.getRenderState())}))}}])&&o(t.prototype,n),r&&o(t,r),i}(_.default);t.default=m},9526:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}var _;function a(e,t){return a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},a(e,t)}function i(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=u(e);if(t){var _=u(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return o(this,n)}}function o(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function u(e){return u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},u(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(n,e);var t=i(n);function n(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),t.call(this,e)}return n}(((_=n(512))&&_.__esModule?_:{default:_}).default);t.default=s},6987:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=i(n(3061)),a=i(n(8435));function i(e){return e&&e.__esModule?e:{default:e}}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t){return u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},u(e,t)}function s(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var _=f(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return l(this,n)}}function l(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},f(e)}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var c=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(l,e);var t,n,r,i=s(l);function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=i.call(this,e))._init(),t}return t=l,(n=[{key:"_init",value:function(){}},{key:"render",value:function(e){var t=this,n=e.frameContext,r=e.gl,i=e.scene,o=e.lights,u=!1,s=null,f=!1,m=null,c=null,h=!1,d=function(a){n.getRenderState().store();var o=null;e.bucket[a].forEach((function(e){u=!1;var h=i.getComponent(a),d=h.getCurrentTechnology().getSubPasss(_.default.TILE_DEFERRED_SHADING);if(d){if(s=d.getSubShaderMaps(),o=l.S_TILE_DEFERRED_SHADING_PASS_GROUP[0],null==s[o]&&(o=l.S_TILE_DEFERRED_SHADING_PASS_GROUP_2[0]),f)n.m_LastFrameBuffer!=n.getFrameBuffer(s[o].subShader.getFBId()||_.default.DEFAULT_DEFERRED_SHADING_FRAMEBUFFER)&&console.error("使用了不同的dfb>>>");else{f=!0;var S=n.getFrameBuffer(s[o].subShader.getFBId()||_.default.DEFAULT_DEFERRED_SHADING_FRAMEBUFFER);r.bindFramebuffer(r.FRAMEBUFFER,S.getFrameBuffer()),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),n.m_LastFrameBuffer=S}s[o].renderState&&(u=t._m_Render._checkRenderState(r,s[o].renderState,n.getRenderState())),h._selectSubShader(s[o].subShader),e.draw(n),o=l.S_TILE_DEFERRED_SHADING_PASS_GROUP[1],m=s[o]?s[o]:s[l.S_TILE_DEFERRED_SHADING_PASS_GROUP_2[1]],o=l.S_TILE_DEFERRED_SHADING_PASS_GROUP[2],c=s[o]?s[o]:s[l.S_TILE_DEFERRED_SHADING_PASS_GROUP_2[2]]}u&&t._checkRenderState(r,n.getRenderState().restore(),n.getRenderState())}))};for(var S in e.bucket)d(S);if(f&&m&&c){h=!0;var p=n.m_LastFrameBuffer;r.bindFramebuffer(r.FRAMEBUFFER,n._m_DefaultFrameBuffer),n.m_LastFrameBuffer=n._m_DefaultFrameBuffer,r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),"On"==n.getRenderState().getFlag(a.default.S_STATES[3])&&r.disable(r.DEPTH_TEST);var g=[],y=[],v=null;o.forEach((function(e){"DirectionalLight"==(v=e.getType())?g.push(e):"PointLight"!=v&&"SpotLight"!=v||y.push(e)})),n.m_LastSubShaderId!=m.subShader.getDefId()&&(m.subShader.needCompile()&&m.subShader._compile(r,n),m.subShader.use(r),n.m_LastSubShaderId=m.subShader.getDefId()),n.m_LastSubShader!=m.subShader&&(n.m_LastSubShader=m.subShader),m.renderState&&this._m_Render._checkRenderState(r,m.renderState,n.getRenderState());var T=p.getFramePicture(),E=m.subShader.getRenderDatas();for(var b in E)r.activeTexture(r.TEXTURE0+E[b].loc),r.bindTexture(r.TEXTURE_2D,n.getFrameBuffer(E[b].refId).getTexture(E[b].dataId).getLoc());for(var C in this._m_Render._m_RenderPrograms[m.subShader.getRenderProgramType()].draw(r,i,n,T,g,0),n.m_LastSubShaderId!=c.subShader.getDefId()&&(c.subShader.needCompile()&&c.subShader._compile(r,n),c.subShader.use(r),n.m_LastSubShaderId=c.subShader.getDefId()),n.m_LastSubShader!=c.subShader&&(n.m_LastSubShader=c.subShader),c.renderState&&this._m_Render._checkRenderState(r,c.renderState,n.getRenderState()),E)r.activeTexture(r.TEXTURE0+E[C].loc),r.bindTexture(r.TEXTURE_2D,n.getFrameBuffer(E[C].refId).getTexture(E[C].dataId).getLoc());this._m_Render._m_RenderPrograms[c.subShader.getRenderProgramType()].draw(r,i,n,T,y,1),"On"==n.getRenderState().getFlag(a.default.S_STATES[3])&&r.enable(r.DEPTH_TEST),r.bindFramebuffer(r.READ_FRAMEBUFFER,p.getFrameBuffer()),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,n._m_DefaultFrameBuffer),r.blitFramebuffer(0,0,i.getCanvas().getWidth(),i.getCanvas().getHeight(),0,0,i.getCanvas().getWidth(),i.getCanvas().getHeight(),r.DEPTH_BUFFER_BIT,r.NEAREST),r.bindFramebuffer(r.FRAMEBUFFER,n._m_DefaultFrameBuffer)}return h}}])&&o(t.prototype,n),r&&o(t,r),l}(i(n(870)).default);t.default=c,m(c,"S_TILE_DEFERRED_SHADING_G_BUFFER_PASS","GBufferPass"),m(c,"S_TILE_DEFERRED_SHADING_GLOBAL_PASS","GlobalPass"),m(c,"S_TILE_DEFERRED_SHADING_TILE_PASS","TilePass"),m(c,"S_TILE_DEFERRED_SHADING_PASS_GROUP",[c.S_TILE_DEFERRED_SHADING_G_BUFFER_PASS,c.S_TILE_DEFERRED_SHADING_GLOBAL_PASS,c.S_TILE_DEFERRED_SHADING_TILE_PASS]),m(c,"S_TILE_DEFERRED_SHADING_PASS_GROUP_2",[0,1,2])},1393:(e,t)=>{function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,_,a,i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,_;return t=e,(r=[{key:"draw",value:function(e,t,n,r,_){r.draw(n)}},{key:"drawArrays",value:function(e,t,n,r,_){r.forEach((function(e){e.draw(n)}))}}])&&n(t.prototype,r),_&&n(t,_),e}();t.default=i,a=null,(_="PROGRAM_TYPE")in(r=i)?Object.defineProperty(r,_,{value:a,enumerable:!0,configurable:!0,writable:!0}):r[_]=a},8388:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=f(n(1393)),a=f(n(8435)),i=(f(n(7539)),f(n(2475))),o=f(n(2320)),u=(f(n(3846)),f(n(9784))),s=f(n(5604)),l=f(n(7141));function f(e){return e&&e.__esModule?e:{default:e}}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t){return c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},c(e,t)}function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=p(e);if(t){var _=p(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return d(this,n)}}function d(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return S(e)}function S(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e){return p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},p(e)}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(f,e);var t,n,r,_=h(f);function f(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),g(S(t=_.call(this,e)),"_m_PV",null),g(S(t),"_m_Temp_Vec3",new s.default),g(S(t),"_m_Temp_Vec4",new l.default),g(S(t),"_m_Temp_Vec4_2",new l.default),g(S(t),"_m_Temp_Vec4_3",new l.default),g(S(t),"_m_Cam_Up",new l.default),g(S(t),"_m_Cam_Left",new l.default),g(S(t),"_m_Light_Left",new l.default),g(S(t),"_m_Light_Up",new l.default),g(S(t),"_m_Light_Center",new l.default),g(S(t),"_m_ViewPortWidth",-1),g(S(t),"_m_ViewPortHeight",-1),g(S(t),"_m_CamLeftCoeff",-1),g(S(t),"_m_CamTopCoeff",-1),t._m_AccumulationLights=new a.default,t._m_AccumulationLights.setFlag(a.default.S_STATES[4],"On"),t._m_AccumulationLights.setFlag(a.default.S_STATES[1],"Off"),t._m_AccumulationLights.setFlag(a.default.S_STATES[5],["SRC_ALPHA","ONE"]),t._m_ClipLights=new a.default,t._m_ClipLights.setFlag(a.default.S_STATES[6],"On"),t._m_m_LastSubShader=null,t}return t=f,(n=[{key:"_blendGIProbes",value:function(e,t,n){var r=n.m_LastSubShader.getContextVars();if(null!=r[f.S_WGIPROBE_SRC]){if(this._m_m_LastSubShader!=n.m_LastSubShader){var _=t.getGIProbes()[0],a=i.default.S_TEMP_VEC4;a.setToInXYZW(_.getPosition()._m_X,_.getPosition()._m_Y,_.getPosition()._m_Z,1/_.getRadius()+_.getPrefilterMipmap()),e.uniform4fv(r[f.S_WGIPROBE_SRC].loc,a.getBufferData(),0,4),a=_.getShCoeffsBufferData(),null!=r[f.S_SH_COEFFS_SRC]&&e.uniform3fv(r[f.S_SH_COEFFS_SRC].loc,a.getBufferData(),0,27),null!=r[f.S_PREF_ENV_MAP_SRC]&&_.getPrefilterEnvMap()._upload(e,r[f.S_PREF_ENV_MAP_SRC].loc),this._m_m_LastSubShader=n.m_LastSubShader}}else{var o=t.getGIProbes();o&&o.length>0&&n.m_LastMaterial.addDefine(u.default.S_GIPROBES_SRC,!0)}}},{key:"_lightClip",value:function(e,t,n){var r=t.getBoundingVolume(),_=r.getRadius(),a=_*this._m_CamLeftCoeff,i=_*this._m_CamTopCoeff,u=r.getCenter(this._m_Temp_Vec3);u=this._m_Temp_Vec4.setToInXYZW(u._m_X,u._m_Y,u._m_Z,1),this._m_Temp_Vec4._m_W=1,this._m_Temp_Vec4_2._m_W=1,this._m_Temp_Vec4_3._m_W=1;var s=this._m_Cam_Left.multLength(a,this._m_Temp_Vec4_2).add(u),l=this._m_Cam_Up.multLength(i,this._m_Temp_Vec4_3).add(u);o.default.multiplyMV(this._m_Light_Left,s,this._m_PV),o.default.multiplyMV(this._m_Light_Up,l,this._m_PV),o.default.multiplyMV(this._m_Light_Center,u,this._m_PV),this._m_Light_Left._m_X/=this._m_Light_Left._m_W,this._m_Light_Left._m_Y/=this._m_Light_Left._m_W,this._m_Light_Up._m_X/=this._m_Light_Up._m_W,this._m_Light_Up._m_Y/=this._m_Light_Up._m_W,this._m_Light_Center._m_X/=this._m_Light_Center._m_W,this._m_Light_Center._m_Y/=this._m_Light_Center._m_W,this._m_Light_Left._m_X=this._m_ViewPortWidth*(1+this._m_Light_Left._m_X),this._m_Light_Up._m_X=this._m_ViewPortWidth*(1+this._m_Light_Up._m_X),this._m_Light_Center._m_X=this._m_ViewPortWidth*(1+this._m_Light_Center._m_X),this._m_Light_Left._m_Y=this._m_ViewPortHeight*(1-this._m_Light_Left._m_Y),this._m_Light_Up._m_Y=this._m_ViewPortHeight*(1-this._m_Light_Up._m_Y),this._m_Light_Center._m_Y=this._m_ViewPortHeight*(1-this._m_Light_Center._m_Y);var f=Math.abs(this._m_Light_Left._m_X-this._m_Light_Center._m_X),m=Math.abs(this._m_Light_Center._m_Y-this._m_Light_Up._m_Y),c=-1,h=-1;return this._m_Light_Center._m_Z<-this._m_Light_Center._m_W?(c=-this._m_Light_Center._m_X-f,h=-this._m_Light_Center._m_Y+m):(c=this._m_Light_Center._m_X-f,h=this._m_Light_Center._m_Y+m),e.scissor(c,2*this._m_ViewPortHeight-h,2*f,2*m),!0}},{key:"_uploadLights",value:function(e,t,n,r,_,a,u,s,l){var m=n.m_LastSubShader.getContextVars(),c=t.enableGIProbes();if(null!=m[f.S_MULTI_ID_SRC]&&e.uniform1i(m[f.S_MULTI_ID_SRC].loc,s),null!=m[f.S_BLEND_GI_PROBES]&&e.uniform1i(m[f.S_BLEND_GI_PROBES].loc,l&&c),0==s){if(null!=m[f.S_AMBIENT_LIGHT_COLOR])if(0==a){var h=t.AmbientLightColor;e.uniform3f(m[f.S_AMBIENT_LIGHT_COLOR].loc,h._m_X,h._m_Y,h._m_Z)}else e.uniform3f(m[f.S_AMBIENT_LIGHT_COLOR].loc,0,0,0),t.getRender()._checkRenderState(e,this._m_AccumulationLights,n.getRenderState());c&&this._blendGIProbes(e,t,n);var d=null,S=null;null!=m[f.S_V_LIGHT_DATA]?(S=1,d=m[f.S_V_LIGHT_DATA].loc):null!=m[f.S_W_LIGHT_DATA]&&(S=0,d=m[f.S_W_LIGHT_DATA].loc);var p=_+a>r.length?r.length-a:_;if(null==d)return p+a;for(var g=null,y=null,v=i.default.S_LIGHT_DATA_4,T=v.getArray(),E=i.default.S_TEMP_VEC4,b=i.default.S_TEMP_VEC4_2,C=a,P=0,R=p+a;C<R;C++,P+=12)y=(g=r[C]).getColor(),T[P]=y._m_X,T[P+1]=y._m_Y,T[P+2]=y._m_Z,T[P+3]=g.getTypeId(),"DirectionalLight"===g.getType()&&(S?(b.setToInXYZW(g.getDirection()._m_X,g.getDirection()._m_Y,g.getDirection()._m_Z,0),o.default.multiplyMV(E,b,t.getMainCamera().getViewMatrix()),T[P+4]=E._m_X,T[P+5]=E._m_Y,T[P+6]=E._m_Z,T[P+7]=-1):(T[P+4]=g.getDirection()._m_X,T[P+5]=g.getDirection()._m_Y,T[P+6]=g.getDirection()._m_Z,T[P+7]=-1),T[P+8]=0,T[P+9]=0,T[P+10]=0,T[P+11]=0);return e.uniform4fv(d,v.getBufferData(),0,12*p),null!=m[f.S_CUR_LIGHT_COUNT]&&e.uniform1i(m[f.S_CUR_LIGHT_COUNT].loc,3*p),p+a}if(1==s){var M,A=null;if(A=r[u],a>0&&!this._lightClip(e,A,!0))return a<=0?-1:0;if(null!=m[f.S_AMBIENT_LIGHT_COLOR])if(a<=0){var w=t.AmbientLightColor;e.uniform3f(m[f.S_AMBIENT_LIGHT_COLOR].loc,w._m_X,w._m_Y,w._m_Z)}else e.uniform3f(m[f.S_AMBIENT_LIGHT_COLOR].loc,0,0,0),t.getRender()._checkRenderState(e,this._m_AccumulationLights,n.getRenderState());c&&this._blendGIProbes(e,t,n);var I=null,L=null,D=null,O=null,F=i.default.S_TEMP_VEC4,x=i.default.S_TEMP_VEC4_2,k=i.default.S_TEMP_VEC4_3;if(null!=m[f.S_V_LIGHT_DATA0]?(O=1,I=m[f.S_V_LIGHT_DATA0].loc,L=m[f.S_V_LIGHT_DATA1].loc,D=m[f.S_V_LIGHT_DATA2].loc):null!=m[f.S_W_LIGHT_DATA0]&&(O=0,I=m[f.S_W_LIGHT_DATA0].loc,L=m[f.S_W_LIGHT_DATA1].loc,D=m[f.S_W_LIGHT_DATA2].loc),null==O)return 1;switch(M=A.getColor(),F.setToInXYZW(M._m_X,M._m_Y,M._m_Z,A.getTypeId()),A.getType()){case"PointLight":O||x.setToInXYZW(A.getPosition()._m_X,A.getPosition()._m_Y,A.getPosition()._m_Z,A.getInRadius()),k.setToInXYZW(0,0,0,0);break;case"SpotLight":O||x.setToInXYZW(A.getPosition()._m_X,A.getPosition()._m_Y,A.getPosition()._m_Z,A.getInvSpotRange()),k.setToInXYZW(A.getDirection()._m_X,A.getDirection()._m_Y,A.getDirection()._m_Z,A.getPackedAngleCos())}return null!=I&&e.uniform4f(I,F._m_X,F._m_Y,F._m_Z,F._m_W),null!=L&&e.uniform4f(L,x._m_X,x._m_Y,x._m_Z,x._m_W),null!=D&&e.uniform4f(D,k._m_X,k._m_Y,k._m_Z,k._m_W),1}return 0}},{key:"draw",value:function(e,t,n,r,_){if(0==_.length){var a=n.m_LastSubShader.getContextVars(),i=t.enableGIProbes();if(i&&this._blendGIProbes(e,t,n),null!=a[f.S_BLEND_GI_PROBES]&&e.uniform1i(a[f.S_BLEND_GI_PROBES].loc,i),null!=a[f.S_MULTI_ID_SRC]&&e.uniform1i(a[f.S_MULTI_ID_SRC].loc,0),null!=a[f.S_AMBIENT_LIGHT_COLOR]){var o=t.AmbientLightColor;e.uniform3f(a[f.S_AMBIENT_LIGHT_COLOR].loc,o._m_X,o._m_Y,o._m_Z)}return null!=a[f.S_CUR_LIGHT_COUNT]&&e.uniform1i(a[f.S_CUR_LIGHT_COUNT].loc,0),void r.draw(n)}var u=t.getRender().getBatchLightSize();n.getRenderState().store();var s=[],l=[],m=null;_.forEach((function(e){"DirectionalLight"==(m=e.getType())?s.push(e):"PointLight"!=m&&"SpotLight"!=m||l.push(e)}));for(var c=0;c<s.length;)c=this._uploadLights(e,t,n,s,u,c,-1,0,0==c),r.draw(n);var h=0;if(l.length>0){t.getRender()._checkRenderState(e,this._m_ClipLights,n.getRenderState()),this._m_ViewPortWidth=.5*t.getMainCamera().getWidth(),this._m_ViewPortHeight=.5*t.getMainCamera().getHeight(),e.scissor(0,0,2*this._m_ViewPortWidth,2*this._m_ViewPortHeight),this._m_PV=t.getMainCamera().getProjectViewMatrix(!0);var d=t.getMainCamera().getViewMatrix();this._m_Temp_Vec3.setToInXYZ(d.m[0],d.m[4],d.m[8]),this._m_CamLeftCoeff=1/t.getMainCamera().getFrustumPlane(1).getNormal().dot(this._m_Temp_Vec3),this._m_Temp_Vec3.setToInXYZ(d.m[1],d.m[5],d.m[9]),this._m_CamTopCoeff=1/t.getMainCamera().getFrustumPlane(2).getNormal().dot(this._m_Temp_Vec3),this._m_Cam_Left.setToInXYZW(d.m[0],d.m[4],d.m[8],1).multLength(-1),this._m_Cam_Up.setToInXYZW(d.m[1],d.m[5],d.m[9],1)}for(;h<l.length;)c=this._uploadLights(e,t,n,l,u,0!=c?c:h,h,1,0==c&&0==h),h++,1==c&&r.draw(n);t.getRender()._checkRenderState(e,n.getRenderState().restore(),n.getRenderState()),n.BatchLightLastIndex=c}},{key:"drawArrays",value:function(e,t,n,r,_){if(0==_.length){var a=n.m_LastSubShader.getContextVars(),i=t.enableGIProbes();if(i&&this._blendGIProbes(e,t,n),null!=a[f.S_BLEND_GI_PROBES]&&e.uniform1i(a[f.S_BLEND_GI_PROBES].loc,i),null!=a[f.S_MULTI_ID_SRC]&&e.uniform1i(a[f.S_MULTI_ID_SRC].loc,0),null!=a[f.S_AMBIENT_LIGHT_COLOR]){var o=t.AmbientLightColor;e.uniform3f(a[f.S_AMBIENT_LIGHT_COLOR].loc,o._m_X,o._m_Y,o._m_Z)}return null!=a[f.S_CUR_LIGHT_COUNT]&&e.uniform1i(a[f.S_CUR_LIGHT_COUNT].loc,0),void r.forEach((function(e){e.draw(n)}))}var u=t.getRender().getBatchLightSize();n.getRenderState().store();var s=[],l=[],m=null;_.forEach((function(e){"DirectionalLight"==(m=e.getType())?s.push(e):"PointLight"!=m&&"SpotLight"!=m||l.push(e)}));for(var c=0;c<s.length;)c=this._uploadLights(e,t,n,s,u,c,-1,0,0==c),iDrawable.draw(n);var h=0;if(l.length>0){t.getRender()._checkRenderState(e,this._m_ClipLights,n.getRenderState()),this._m_ViewPortWidth=.5*t.getMainCamera().getWidth(),this._m_ViewPortHeight=.5*t.getMainCamera().getHeight(),e.scissor(0,0,2*this._m_ViewPortWidth,2*this._m_ViewPortHeight),this._m_PV=t.getMainCamera().getProjectViewMatrix(!0);var d=t.getMainCamera().getViewMatrix();this._m_Temp_Vec3.setToInXYZ(d.m[0],d.m[4],d.m[8]),this._m_CamLeftCoeff=1/t.getMainCamera().getFrustumPlane(1).getNormal().dot(this._m_Temp_Vec3),this._m_Temp_Vec3.setToInXYZ(d.m[1],d.m[5],d.m[9]),this._m_CamTopCoeff=1/t.getMainCamera().getFrustumPlane(2).getNormal().dot(this._m_Temp_Vec3),this._m_Cam_Left.setToInXYZW(d.m[0],d.m[4],d.m[8],1).multLength(-1),this._m_Cam_Up.setToInXYZW(d.m[1],d.m[5],d.m[9],1)}for(;h<l.length;)c=this._uploadLights(e,t,n,l,u,0!=c?c:h,h,1,0==c&&0==h),h++,1==c&&r.forEach((function(e){e.draw(n)}));t.getRender()._checkRenderState(e,n.getRenderState().restore(),n.getRenderState()),n.BatchLightLastIndex=c}}])&&m(t.prototype,n),r&&m(t,r),f}(_.default);t.default=y,g(y,"PROGRAM_TYPE","MultiPassIBLLighting"),g(y,"S_CUR_LIGHT_COUNT","_curLightCount"),g(y,"S_AMBIENT_LIGHT_COLOR","_ambientLightColor"),g(y,"S_BLEND_GI_PROBES","_blend_gi_probes"),g(y,"S_MULTI_ID_SRC","_multiId"),g(y,"S_V_LIGHT_DATA","_vLightData"),g(y,"S_W_LIGHT_DATA","_wLightData"),g(y,"S_V_LIGHT_DATA0","_vLight_Data_0"),g(y,"S_V_LIGHT_DATA1","_vLight_Data_1"),g(y,"S_V_LIGHT_DATA2","_vLight_Data_2"),g(y,"S_W_LIGHT_DATA0","_wLight_Data_0"),g(y,"S_W_LIGHT_DATA1","_wLight_Data_1"),g(y,"S_W_LIGHT_DATA2","_wLight_Data_2"),g(y,"S_PREF_ENV_MAP_SRC","_prefEnvMap"),g(y,"S_WGIPROBE_SRC","_wGIProbe"),g(y,"S_SH_COEFFS_SRC","_ShCoeffs")},4658:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=l(n(1393)),a=l(n(8435)),i=(l(n(7539)),l(n(2475))),o=l(n(2320)),u=l(n(7141)),s=l(n(5604));function l(e){return e&&e.__esModule?e:{default:e}}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e,t){return m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},m(e,t)}function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var _=S(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return h(this,n)}}function h(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return d(e)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function S(e){return S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},S(e)}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var g=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(l,e);var t,n,r,_=c(l);function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),p(d(t=_.call(this,e)),"_m_PV",null),p(d(t),"_m_Temp_Vec3",new s.default),p(d(t),"_m_Temp_Vec4",new u.default),p(d(t),"_m_Temp_Vec4_2",new u.default),p(d(t),"_m_Temp_Vec4_3",new u.default),p(d(t),"_m_Cam_Up",new u.default),p(d(t),"_m_Cam_Left",new u.default),p(d(t),"_m_Light_Left",new u.default),p(d(t),"_m_Light_Up",new u.default),p(d(t),"_m_Light_Center",new u.default),p(d(t),"_m_ViewPortWidth",-1),p(d(t),"_m_ViewPortHeight",-1),p(d(t),"_m_CamLeftCoeff",-1),p(d(t),"_m_CamTopCoeff",-1),t._m_AccumulationLights=new a.default,t._m_AccumulationLights.setFlag(a.default.S_STATES[4],"On"),t._m_AccumulationLights.setFlag(a.default.S_STATES[1],"Off"),t._m_AccumulationLights.setFlag(a.default.S_STATES[5],["SRC_ALPHA","ONE"]),t._m_ClipLights=new a.default,t._m_ClipLights.setFlag(a.default.S_STATES[6],"On"),t}return t=l,(n=[{key:"_uploadLights",value:function(e,t,n,r,_,a,u,s){var f=n.m_LastSubShader.getContextVars();if(null!=f[l.S_MULTI_ID_SRC]&&e.uniform1i(f[l.S_MULTI_ID_SRC].loc,s),0==s){if(null!=f[l.S_AMBIENT_LIGHT_COLOR])if(0==a){var m=t.AmbientLightColor;e.uniform3f(f[l.S_AMBIENT_LIGHT_COLOR].loc,m._m_X,m._m_Y,m._m_Z)}else e.uniform3f(f[l.S_AMBIENT_LIGHT_COLOR].loc,0,0,0),t.getRender()._checkRenderState(e,this._m_AccumulationLights,n.getRenderState());var c=null,h=null;null!=f[l.S_V_LIGHT_DATA]?(h=1,c=f[l.S_V_LIGHT_DATA].loc):null!=f[l.S_W_LIGHT_DATA]&&(h=0,c=f[l.S_W_LIGHT_DATA].loc);var d=_+a>r.length?r.length-a:_,S=null,p=null;if(null==c)return d+a;for(var g=i.default.S_LIGHT_DATA,y=g.getArray(),v=i.default.S_TEMP_VEC4,T=i.default.S_TEMP_VEC4_2,E=a,b=0,C=d+a;E<C;E++,b+=12)p=(S=r[E]).getColor(),y[b]=p._m_X,y[b+1]=p._m_Y,y[b+2]=p._m_Z,y[b+3]=S.getTypeId(),"DirectionalLight"===S.getType()&&(h?(T.setToInXYZW(S.getDirection()._m_X,S.getDirection()._m_Y,S.getDirection()._m_Z,0),o.default.multiplyMV(v,T,t.getMainCamera().getViewMatrix()),y[b+4]=v._m_X,y[b+5]=v._m_Y,y[b+6]=v._m_Z,y[b+7]=-1):(y[b+4]=S.getDirection()._m_X,y[b+5]=S.getDirection()._m_Y,y[b+6]=S.getDirection()._m_Z,y[b+7]=-1),y[b+8]=0,y[b+9]=0,y[b+10]=0,y[b+11]=0);return e.uniform4fv(c,g.getBufferData(),0,12*d),null!=f[l.S_CUR_LIGHT_COUNT]&&e.uniform1i(f[l.S_CUR_LIGHT_COUNT].loc,3*d),d+a}if(1==s){var P,R=null;if(R=r[u],a>0&&!this._lightClip(e,R,!0))return a<=0?-1:0;if(null!=f[l.S_AMBIENT_LIGHT_COLOR])if(a<=0){var M=t.AmbientLightColor;e.uniform3f(f[l.S_AMBIENT_LIGHT_COLOR].loc,M._m_X,M._m_Y,M._m_Z)}else e.uniform3f(f[l.S_AMBIENT_LIGHT_COLOR].loc,0,0,0),t.getRender()._checkRenderState(e,this._m_AccumulationLights,n.getRenderState());var A=null,w=null,I=null,L=null,D=i.default.S_TEMP_VEC4,O=i.default.S_TEMP_VEC4_2,F=i.default.S_TEMP_VEC4_3;if(null!=f[l.S_V_LIGHT_DATA0]?(L=1,A=f[l.S_V_LIGHT_DATA0].loc,w=f[l.S_V_LIGHT_DATA1].loc,I=f[l.S_V_LIGHT_DATA2].loc):null!=f[l.S_W_LIGHT_DATA0]&&(L=0,A=f[l.S_W_LIGHT_DATA0].loc,w=f[l.S_W_LIGHT_DATA1].loc,I=f[l.S_W_LIGHT_DATA2].loc),null==L)return 1;switch(P=R.getColor(),D.setToInXYZW(P._m_X,P._m_Y,P._m_Z,R.getTypeId()),R.getType()){case"PointLight":L||O.setToInXYZW(R.getPosition()._m_X,R.getPosition()._m_Y,R.getPosition()._m_Z,R.getInRadius()),F.setToInXYZW(0,0,0,0);break;case"SpotLight":L||O.setToInXYZW(R.getPosition()._m_X,R.getPosition()._m_Y,R.getPosition()._m_Z,R.getInvSpotRange()),F.setToInXYZW(R.getDirection()._m_X,R.getDirection()._m_Y,R.getDirection()._m_Z,R.getPackedAngleCos())}return null!=A&&e.uniform4f(A,D._m_X,D._m_Y,D._m_Z,D._m_W),null!=w&&e.uniform4f(w,O._m_X,O._m_Y,O._m_Z,O._m_W),null!=I&&e.uniform4f(I,F._m_X,F._m_Y,F._m_Z,F._m_W),1}return 0}},{key:"_lightClip",value:function(e,t,n){var r=t.getBoundingVolume(),_=r.getRadius(),a=_*this._m_CamLeftCoeff,i=_*this._m_CamTopCoeff,u=r.getCenter(this._m_Temp_Vec3);u=this._m_Temp_Vec4.setToInXYZW(u._m_X,u._m_Y,u._m_Z,1),this._m_Temp_Vec4._m_W=1,this._m_Temp_Vec4_2._m_W=1,this._m_Temp_Vec4_3._m_W=1;var s=this._m_Cam_Left.multLength(a,this._m_Temp_Vec4_2).add(u),l=this._m_Cam_Up.multLength(i,this._m_Temp_Vec4_3).add(u);o.default.multiplyMV(this._m_Light_Left,s,this._m_PV),o.default.multiplyMV(this._m_Light_Up,l,this._m_PV),o.default.multiplyMV(this._m_Light_Center,u,this._m_PV),this._m_Light_Left._m_X/=this._m_Light_Left._m_W,this._m_Light_Left._m_Y/=this._m_Light_Left._m_W,this._m_Light_Up._m_X/=this._m_Light_Up._m_W,this._m_Light_Up._m_Y/=this._m_Light_Up._m_W,this._m_Light_Center._m_X/=this._m_Light_Center._m_W,this._m_Light_Center._m_Y/=this._m_Light_Center._m_W,this._m_Light_Left._m_X=this._m_ViewPortWidth*(1+this._m_Light_Left._m_X),this._m_Light_Up._m_X=this._m_ViewPortWidth*(1+this._m_Light_Up._m_X),this._m_Light_Center._m_X=this._m_ViewPortWidth*(1+this._m_Light_Center._m_X),this._m_Light_Left._m_Y=this._m_ViewPortHeight*(1-this._m_Light_Left._m_Y),this._m_Light_Up._m_Y=this._m_ViewPortHeight*(1-this._m_Light_Up._m_Y),this._m_Light_Center._m_Y=this._m_ViewPortHeight*(1-this._m_Light_Center._m_Y);var f=Math.abs(this._m_Light_Left._m_X-this._m_Light_Center._m_X),m=Math.abs(this._m_Light_Center._m_Y-this._m_Light_Up._m_Y),c=-1,h=-1;return this._m_Light_Center._m_Z<-this._m_Light_Center._m_W?(c=-this._m_Light_Center._m_X-f,h=-this._m_Light_Center._m_Y+m):(c=this._m_Light_Center._m_X-f,h=this._m_Light_Center._m_Y+m),e.scissor(c,2*this._m_ViewPortHeight-h,2*f,2*m),!0}},{key:"_lightCvvTest",value:function(e,t,n,r,_,a){return r<-a||e>n||_>a||t<-n}},{key:"draw",value:function(e,t,n,r,_){if(0==_.length){var a=n.m_LastSubShader.getContextVars();if(null!=a[l.S_MULTI_ID_SRC]&&e.uniform1i(a[l.S_MULTI_ID_SRC].loc,0),null!=a[l.S_AMBIENT_LIGHT_COLOR]){var i=t.AmbientLightColor;e.uniform3f(a[l.S_AMBIENT_LIGHT_COLOR].loc,i._m_X,i._m_Y,i._m_Z)}return null!=a[l.S_CUR_LIGHT_COUNT]&&e.uniform1i(a[l.S_CUR_LIGHT_COUNT].loc,0),void r.draw(n)}var o=t.getRender().getBatchLightSize();n.getRenderState().store();var u=[],s=[];_.forEach((function(e){"DirectionalLight"==e.getType()?u.push(e):s.push(e)}));for(var f=0;f<u.length;)f=this._uploadLights(e,t,n,u,o,f,-1,0),r.draw(n);var m=0;if(s.length>0){t.getRender()._checkRenderState(e,this._m_ClipLights,n.getRenderState()),this._m_ViewPortWidth=.5*t.getMainCamera().getWidth(),this._m_ViewPortHeight=.5*t.getMainCamera().getHeight(),e.scissor(0,0,2*this._m_ViewPortWidth,2*this._m_ViewPortHeight),this._m_PV=t.getMainCamera().getProjectViewMatrix(!0);var c=t.getMainCamera().getViewMatrix();this._m_Temp_Vec3.setToInXYZ(c.m[0],c.m[4],c.m[8]),this._m_CamLeftCoeff=1/t.getMainCamera().getFrustumPlane(1).getNormal().dot(this._m_Temp_Vec3),this._m_Temp_Vec3.setToInXYZ(c.m[1],c.m[5],c.m[9]),this._m_CamTopCoeff=1/t.getMainCamera().getFrustumPlane(2).getNormal().dot(this._m_Temp_Vec3),this._m_Cam_Left.setToInXYZW(c.m[0],c.m[4],c.m[8],1).multLength(-1),this._m_Cam_Up.setToInXYZW(c.m[1],c.m[5],c.m[9],1)}for(;m<s.length;)f=this._uploadLights(e,t,n,s,o,0!=f?f:m,m,1),m++,1==f&&r.draw(n);t.getRender()._checkRenderState(e,n.getRenderState().restore(),n.getRenderState()),n.BatchLightLastIndex=f}},{key:"drawArrays",value:function(e,t,n,r,_){if(0==_.length){var a=n.m_LastSubShader.getContextVars();if(null!=a[l.S_MULTI_ID_SRC]&&e.uniform1i(a[l.S_MULTI_ID_SRC].loc,0),null!=a[l.S_AMBIENT_LIGHT_COLOR]){var i=t.AmbientLightColor;e.uniform3f(a[l.S_AMBIENT_LIGHT_COLOR].loc,i._m_X,i._m_Y,i._m_Z)}return null!=a[l.S_CUR_LIGHT_COUNT]&&e.uniform1i(a[l.S_CUR_LIGHT_COUNT].loc,0),void r.forEach((function(e){e.draw(n)}))}var o=t.getRender().getBatchLightSize();n.getRenderState().store();var u=[],s=[];_.forEach((function(e){"DirectionalLight"==e.getType()?u.push(e):s.push(e)}));for(var f=0;f<u.length;)f=this._uploadLights(e,t,n,u,o,f,-1,0),r.forEach((function(e){e.draw(n)}));var m=0;if(s.length>0){t.getRender()._checkRenderState(e,this._m_ClipLights,n.getRenderState()),this._m_ViewPortWidth=.5*t.getMainCamera().getWidth(),this._m_ViewPortHeight=.5*t.getMainCamera().getHeight(),e.scissor(0,0,2*this._m_ViewPortWidth,2*this._m_ViewPortHeight),this._m_PV=t.getMainCamera().getProjectViewMatrix(!0);var c=t.getMainCamera().getViewMatrix();this._m_Temp_Vec3.setToInXYZ(c.m[0],c.m[4],c.m[8]),this._m_CamLeftCoeff=1/t.getMainCamera().getFrustumPlane(1).getNormal().dot(this._m_Temp_Vec3),this._m_Temp_Vec3.setToInXYZ(c.m[1],c.m[5],c.m[9]),this._m_CamTopCoeff=1/t.getMainCamera().getFrustumPlane(2).getNormal().dot(this._m_Temp_Vec3),this._m_Cam_Left.setToInXYZW(c.m[0],c.m[4],c.m[8],1).multLength(-1),this._m_Cam_Up.setToInXYZW(c.m[1],c.m[5],c.m[9],1)}for(;m<s.length;)f=this._uploadLights(e,t,n,s,o,0!=f?f:m,m,1),m++,1==f&&r.forEach((function(e){e.draw(n)}));t.getRender()._checkRenderState(e,n.getRenderState().restore(),n.getRenderState()),n.BatchLightLastIndex=f}}])&&f(t.prototype,n),r&&f(t,r),l}(_.default);t.default=g,p(g,"PROGRAM_TYPE","MultiPassLighting"),p(g,"S_CUR_LIGHT_COUNT","_curLightCount"),p(g,"S_AMBIENT_LIGHT_COLOR","_ambientLightColor"),p(g,"S_MULTI_ID_SRC","_multiId"),p(g,"S_V_LIGHT_DATA","_vLightData"),p(g,"S_W_LIGHT_DATA","_wLightData"),p(g,"S_V_LIGHT_DATA0","_vLight_Data_0"),p(g,"S_V_LIGHT_DATA1","_vLight_Data_1"),p(g,"S_V_LIGHT_DATA2","_vLight_Data_2"),p(g,"S_W_LIGHT_DATA0","_wLight_Data_0"),p(g,"S_W_LIGHT_DATA1","_wLight_Data_1"),p(g,"S_W_LIGHT_DATA2","_wLight_Data_2")},8546:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=s(n(1393)),a=s(n(8435)),i=(s(n(7539)),s(n(2475))),o=s(n(2320)),u=(s(n(3846)),s(n(9784)));function s(e){return e&&e.__esModule?e:{default:e}}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t){return f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},f(e,t)}function m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=h(e);if(t){var _=h(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return c(this,n)}}function c(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function h(e){return h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},h(e)}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var S=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(s,e);var t,n,r,_=m(s);function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=_.call(this,e))._m_AccumulationLights=new a.default,t._m_AccumulationLights.setFlag(a.default.S_STATES[4],"On"),t._m_AccumulationLights.setFlag(a.default.S_STATES[1],"Off"),t._m_AccumulationLights.setFlag(a.default.S_STATES[5],["ONE","ONE"]),t._m_m_LastSubShader=null,t}return t=s,(n=[{key:"_blendGIProbes",value:function(e,t,n){var r=n.m_LastSubShader.getContextVars();if(null!=r[s.S_WGIPROBE_SRC]){if(this._m_m_LastSubShader!=n.m_LastSubShader){var _=t.getGIProbes()[0],a=i.default.S_TEMP_VEC4;a.setToInXYZW(_.getPosition()._m_X,_.getPosition()._m_Y,_.getPosition()._m_Z,1/_.getRadius()+_.getPrefilterMipmap()),e.uniform4fv(r[s.S_WGIPROBE_SRC].loc,a.getBufferData(),0,4),a=_.getShCoeffsBufferData(),null!=r[s.S_SH_COEFFS_SRC]&&e.uniform3fv(r[s.S_SH_COEFFS_SRC].loc,a.getBufferData(),0,27),null!=r[s.S_PREF_ENV_MAP_SRC]&&_.getPrefilterEnvMap()._upload(e,r[s.S_PREF_ENV_MAP_SRC].loc),this._m_m_LastSubShader=n.m_LastSubShader}}else{var o=t.getGIProbes();o&&o.length>0&&n.m_LastMaterial.addDefine(u.default.S_GIPROBES_SRC,!0)}}},{key:"_uploadLights",value:function(e,t,n,r,_,a,u){var l=n.m_LastSubShader.getContextVars(),f=t.enableGIProbes();if(null!=l[s.S_BLEND_GI_PROBES]&&e.uniform1i(l[s.S_BLEND_GI_PROBES].loc,u&&f),null!=l[s.S_AMBIENT_LIGHT_COLOR])if(0==a){var m=t.AmbientLightColor;e.uniform3f(l[s.S_AMBIENT_LIGHT_COLOR].loc,m._m_X,m._m_Y,m._m_Z)}else e.uniform3f(l[s.S_AMBIENT_LIGHT_COLOR].loc,0,0,0),t.getRender()._checkRenderState(e,this._m_AccumulationLights,n.getRenderState());f&&this._blendGIProbes(e,t,n);var c=null,h=null;null!=l[s.S_V_LIGHT_DATA]?(h=1,c=l[s.S_V_LIGHT_DATA].loc):null!=l[s.S_W_LIGHT_DATA]&&(h=0,c=l[s.S_W_LIGHT_DATA].loc);var d=_+a>r.length?r.length-a:_;if(null==c)return d+a;for(var S=null,p=null,g=i.default.S_LIGHT_DATA_4,y=g.getArray(),v=i.default.S_TEMP_VEC4,T=i.default.S_TEMP_VEC4_2,E=a,b=0,C=d+a;E<C;E++,b+=12)switch(p=(S=r[E]).getColor(),y[b]=p._m_X,y[b+1]=p._m_Y,y[b+2]=p._m_Z,y[b+3]=S.getTypeId(),S.getType()){case"DirectionalLight":h?(T.setToInXYZW(S.getDirection()._m_X,S.getDirection()._m_Y,S.getDirection()._m_Z,0),o.default.multiplyMV(v,T,t.getMainCamera().getViewMatrix()),y[b+4]=v._m_X,y[b+5]=v._m_Y,y[b+6]=v._m_Z,y[b+7]=-1):(y[b+4]=S.getDirection()._m_X,y[b+5]=S.getDirection()._m_Y,y[b+6]=S.getDirection()._m_Z,y[b+7]=-1),y[b+8]=0,y[b+9]=0,y[b+10]=0,y[b+11]=0;break;case"PointLight":h||(y[b+4]=S.getPosition()._m_X,y[b+5]=S.getPosition()._m_Y,y[b+6]=S.getPosition()._m_Z,y[b+7]=S.getInRadius()),y[b+8]=0,y[b+9]=0,y[b+10]=0,y[b+11]=0;break;case"SpotLight":h||(y[b+4]=S.getPosition()._m_X,y[b+5]=S.getPosition()._m_Y,y[b+6]=S.getPosition()._m_Z,y[b+7]=S.getInvSpotRange()),y[b+8]=S.getDirection()._m_X,y[b+9]=S.getDirection()._m_Y,y[b+10]=S.getDirection()._m_Z,y[b+11]=S.getPackedAngleCos()}return e.uniform4fv(c,g.getBufferData(),0,12*d),null!=l[s.S_CUR_LIGHT_COUNT]&&e.uniform1i(l[s.S_CUR_LIGHT_COUNT].loc,3*d),d+a}},{key:"draw",value:function(e,t,n,r,_){if(0!=_.length){var a=t.getRender().getBatchLightSize(),i=0;for(n.getRenderState().store();i<_.length;)i=this._uploadLights(e,t,n,_,a,i,0==i),r.draw(n);t.getRender()._checkRenderState(e,n.getRenderState().restore(),n.getRenderState()),n.BatchLightLastIndex=i}else{var o=n.m_LastSubShader.getContextVars(),u=t.enableGIProbes();if(u&&this._blendGIProbes(e,t,n),null!=o[s.S_BLEND_GI_PROBES]&&e.uniform1i(o[s.S_BLEND_GI_PROBES].loc,u),null!=o[s.S_CUR_LIGHT_COUNT]&&e.uniform1i(o[s.S_CUR_LIGHT_COUNT].loc,0),null!=o[s.S_AMBIENT_LIGHT_COLOR]){var l=t.AmbientLightColor;e.uniform3f(o[s.S_AMBIENT_LIGHT_COLOR].loc,l._m_X,l._m_Y,l._m_Z)}r.draw(n)}}},{key:"drawArrays",value:function(e,t,n,r,_){if(0!=_.length){var a=t.getRender().getBatchLightSize(),i=0;for(n.getRenderState().store();i<_.length;)i=this._uploadLights(e,t,n,_,a,i,0==i),r.forEach((function(e){e.draw(n)}));t.getRender()._checkRenderState(e,n.getRenderState().restore(),n.getRenderState()),n.BatchLightLastIndex=i}else{var o=n.m_LastSubShader.getContextVars(),u=t.enableGIProbes();if(u&&this._blendGIProbes(e,t,n),null!=o[s.S_BLEND_GI_PROBES]&&e.uniform1i(o[s.S_BLEND_GI_PROBES].loc,u),null!=o[s.S_CUR_LIGHT_COUNT]&&e.uniform1i(o[s.S_CUR_LIGHT_COUNT].loc,0),null!=o[s.S_AMBIENT_LIGHT_COLOR]){var l=t.AmbientLightColor;e.uniform3f(o[s.S_AMBIENT_LIGHT_COLOR].loc,l._m_X,l._m_Y,l._m_Z)}r.forEach((function(e){e.draw(n)}))}}}])&&l(t.prototype,n),r&&l(t,r),s}(_.default);t.default=S,d(S,"PROGRAM_TYPE","SinglePassIBLLighting"),d(S,"S_CUR_LIGHT_COUNT","_curLightCount"),d(S,"S_AMBIENT_LIGHT_COLOR","_ambientLightColor"),d(S,"S_BLEND_GI_PROBES","_blend_gi_probes"),d(S,"S_V_LIGHT_DATA","_vLightData"),d(S,"S_W_LIGHT_DATA","_wLightData"),d(S,"S_PREF_ENV_MAP_SRC","_prefEnvMap"),d(S,"S_WGIPROBE_SRC","_wGIProbe"),d(S,"S_SH_COEFFS_SRC","_ShCoeffs")},6148:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=u(n(1393)),a=u(n(8435)),i=(u(n(7539)),u(n(2475))),o=u(n(2320));function u(e){return e&&e.__esModule?e:{default:e}}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t){return l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},l(e,t)}function f(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=c(e);if(t){var _=c(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return m(this,n)}}function m(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function c(e){return c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},c(e)}function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var d=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(u,e);var t,n,r,_=f(u);function u(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(t=_.call(this,e))._m_AccumulationLights=new a.default,t._m_AccumulationLights.setFlag(a.default.S_STATES[4],"On"),t._m_AccumulationLights.setFlag(a.default.S_STATES[1],"Off"),t._m_AccumulationLights.setFlag(a.default.S_STATES[5],["ONE","ONE"]),t}return t=u,(n=[{key:"_uploadLights",value:function(e,t,n,r,_,a){var s=n.m_LastSubShader.getContextVars();if(null!=s[u.S_AMBIENT_LIGHT_COLOR])if(0==a){var l=t.AmbientLightColor;e.uniform3f(s[u.S_AMBIENT_LIGHT_COLOR].loc,l._m_X,l._m_Y,l._m_Z)}else e.uniform3f(s[u.S_AMBIENT_LIGHT_COLOR].loc,0,0,0),t.getRender()._checkRenderState(e,this._m_AccumulationLights,n.getRenderState());var f=null,m=null;null!=s[u.S_V_LIGHT_DATA]?(m=1,f=s[u.S_V_LIGHT_DATA].loc):null!=s[u.S_W_LIGHT_DATA]&&(m=0,f=s[u.S_W_LIGHT_DATA].loc);var c=_+a>r.length?r.length-a:_;if(null==f)return c+a;for(var h=null,d=null,S=i.default.S_LIGHT_DATA,p=S.getArray(),g=i.default.S_TEMP_VEC4,y=i.default.S_TEMP_VEC4_2,v=a,T=0,E=c+a;v<E;v++,T+=12)switch(d=(h=r[v]).getColor(),p[T]=d._m_X,p[T+1]=d._m_Y,p[T+2]=d._m_Z,p[T+3]=h.getTypeId(),h.getType()){case"DirectionalLight":m?(y.setToInXYZW(h.getDirection()._m_X,h.getDirection()._m_Y,h.getDirection()._m_Z,0),o.default.multiplyMV(g,y,t.getMainCamera().getViewMatrix()),p[T+4]=g._m_X,p[T+5]=g._m_Y,p[T+6]=g._m_Z,p[T+7]=-1):(p[T+4]=h.getDirection()._m_X,p[T+5]=h.getDirection()._m_Y,p[T+6]=h.getDirection()._m_Z,p[T+7]=-1),p[T+8]=0,p[T+9]=0,p[T+10]=0,p[T+11]=0;break;case"PointLight":m||(p[T+4]=h.getPosition()._m_X,p[T+5]=h.getPosition()._m_Y,p[T+6]=h.getPosition()._m_Z,p[T+7]=h.getInRadius()),p[T+8]=0,p[T+9]=0,p[T+10]=0,p[T+11]=0;break;case"SpotLight":m||(p[T+4]=h.getPosition()._m_X,p[T+5]=h.getPosition()._m_Y,p[T+6]=h.getPosition()._m_Z,p[T+7]=h.getInvSpotRange()),p[T+8]=h.getDirection()._m_X,p[T+9]=h.getDirection()._m_Y,p[T+10]=h.getDirection()._m_Z,p[T+11]=h.getPackedAngleCos()}return e.uniform4fv(f,S.getBufferData(),0,12*c),null!=s[u.S_CUR_LIGHT_COUNT]&&e.uniform1i(s[u.S_CUR_LIGHT_COUNT].loc,3*c),c+a}},{key:"draw",value:function(e,t,n,r,_){if(0==_.length){var a=n.m_LastSubShader.getContextVars();if(null!=a[u.S_AMBIENT_LIGHT_COLOR]){var i=t.AmbientLightColor;e.uniform3f(a[u.S_AMBIENT_LIGHT_COLOR].loc,i._m_X,i._m_Y,i._m_Z)}return null!=a[u.S_CUR_LIGHT_COUNT]&&e.uniform1i(a[u.S_CUR_LIGHT_COUNT].loc,0),void r.draw(n)}for(var o=t.getRender().getBatchLightSize(),s=0;s<_.length;)s=this._uploadLights(e,t,n,_,o,s),r.draw(n);t.getRender()._checkRenderState(e,n.getRenderState().restore(),n.getRenderState()),n.BatchLightLastIndex=s}},{key:"drawArrays",value:function(e,t,n,r,_){if(0==_.length){var a=n.m_LastSubShader.getContextVars();if(null!=a[u.S_AMBIENT_LIGHT_COLOR]){var i=t.AmbientLightColor;e.uniform3f(a[u.S_AMBIENT_LIGHT_COLOR].loc,i._m_X,i._m_Y,i._m_Z)}return null!=a[u.S_CUR_LIGHT_COUNT]&&e.uniform1i(a[u.S_CUR_LIGHT_COUNT].loc,0),void r.forEach((function(e){e.draw(n)}))}var o=t.getRender().getBatchLightSize(),s=0;for(n.getRenderState().store();s<_.length;)s=this._uploadLights(e,t,n,_,o,s),r.forEach((function(e){e.draw(n)}));t.getRender()._checkRenderState(e,n.getRenderState().restore(),n.getRenderState()),n.BatchLightLastIndex=s}}])&&s(t.prototype,n),r&&s(t,r),u}(_.default);t.default=d,h(d,"PROGRAM_TYPE","SinglePassLighting"),h(d,"S_CUR_LIGHT_COUNT","_curLightCount"),h(d,"S_AMBIENT_LIGHT_COLOR","_ambientLightColor"),h(d,"S_V_LIGHT_DATA","_vLightData"),h(d,"S_W_LIGHT_DATA","_wLightData")},2987:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=m(n(1393)),a=m(n(2320)),i=m(n(8435)),o=m(n(9784)),u=m(n(2475)),s=m(n(5604)),l=m(n(7141)),f=m(n(5141));function m(e){return e&&e.__esModule?e:{default:e}}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function h(e,t){return h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},h(e,t)}function d(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=g(e);if(t){var _=g(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return S(this,n)}}function S(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return p(e)}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(e){return g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},g(e)}function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var v=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(m,e);var t,n,r,_=d(m);function m(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,m),y(p(t=_.call(this,e)),"_m_Tiles",[]),y(p(t),"_m_LightsIndex",[]),y(p(t),"_m_LightsDecode",[]),y(p(t),"_m_LightsDecodeData",null),y(p(t),"_m_LightsIndexData",null),y(p(t),"_m_LightsData0",null),y(p(t),"_m_LightsData1",null),y(p(t),"_m_LightsData2",null),y(p(t),"_m_LightsData0Array",[]),y(p(t),"_m_LightsData1Array",[]),y(p(t),"_m_LightsData2Array",[]),y(p(t),"_m_PV",null),y(p(t),"_m_Temp_Vec3",new s.default),y(p(t),"_m_Temp_Vec4",new l.default),y(p(t),"_m_Temp_Vec4_2",new l.default),y(p(t),"_m_Temp_Vec4_3",new l.default),y(p(t),"_m_Cam_Up",new l.default),y(p(t),"_m_Cam_Left",new l.default),y(p(t),"_m_Light_Left",new l.default),y(p(t),"_m_Light_Up",new l.default),y(p(t),"_m_Light_Center",new l.default),y(p(t),"_m_ViewPortWidth",-1),y(p(t),"_m_ViewPortHeight",-1),y(p(t),"_m_CamLeftCoeff",-1),y(p(t),"_m_CamTopCoeff",-1),t._m_AccumulationLights=new i.default,t._m_AccumulationLights.setFlag(i.default.S_STATES[4],"On"),t._m_AccumulationLights.setFlag(i.default.S_STATES[1],"Off"),t._m_AccumulationLights.setFlag(i.default.S_STATES[5],["ONE","ONE"]),t}return t=m,(n=[{key:"_blendGIProbes",value:function(e,t,n){var r=n.m_LastSubShader.getContextVars();if(null!=r[m.S_WGIPROBE_SRC]){if(this._m_m_LastSubShader!=n.m_LastSubShader){var _=t.getGIProbes()[0],a=u.default.S_TEMP_VEC4;a.setToInXYZW(_.getPosition()._m_X,_.getPosition()._m_Y,_.getPosition()._m_Z,1/_.getRadius()+_.getPrefilterMipmap()),e.uniform4fv(r[m.S_WGIPROBE_SRC].loc,a.getBufferData(),0,4),a=_.getShCoeffsBufferData(),null!=r[m.S_SH_COEFFS_SRC]&&e.uniform3fv(r[m.S_SH_COEFFS_SRC].loc,a.getBufferData(),0,27),null!=r[m.S_PREF_ENV_MAP_SRC]&&_.getPrefilterEnvMap()._upload(e,r[m.S_PREF_ENV_MAP_SRC].loc),this._m_m_LastSubShader=n.m_LastSubShader}}else{var i=t.getGIProbes();i&&i.length>0&&n.m_LastMaterial.addDefine(o.default.S_GIPROBES_SRC,!0)}}},{key:"_createTexture",value:function(e,t,n,r){var _=new f.default(e);return e.getCanvas().getGLContext(),_.setTextureFormat(t,n,r),_.setWrap(e,f.default.S_WRAPS.S_CLAMP_TO_EDGE,f.default.S_WRAPS.S_CLAMP_TO_EDGE),_.setFilter(e,f.default.S_FILTERS.S_NEAREST,f.default.S_FILTERS.S_NEAREST),_.updateTextureFilter(),_.setAlignment(1),_}},{key:"_reset",value:function(e,t,n){this._m_LightsIndexData||(this._m_LightsIndexData=this._createTexture(t,e.RGB32F,e.RGB,e.FLOAT)),this._m_LightsDecodeData||(this._m_LightsDecodeData=this._createTexture(t,e.RGB32F,e.RGB,e.FLOAT)),this._m_LightsData0||(this._m_LightsData0=this._createTexture(t,e.RGBA32F,e.RGBA,e.FLOAT)),this._m_LightsData0Array.length=0,this._m_LightsData1||(this._m_LightsData1=this._createTexture(t,e.RGBA32F,e.RGBA,e.FLOAT)),this._m_LightsData1Array.length=0,this._m_LightsData2||(this._m_LightsData2=this._createTexture(t,e.RGBA32F,e.RGBA,e.FLOAT)),this._m_LightsData2Array.length=0;for(var r=0;r<n;r++)this._m_Tiles[r]=[];this._m_LightsDecode.length=0,this._m_LightsIndex.length=0}},{key:"_lightClip",value:function(e,t){var n=t.getBoundingVolume(),r=n.getRadius(),_=r*this._m_CamLeftCoeff,i=r*this._m_CamTopCoeff,o=n.getCenter(this._m_Temp_Vec3);o=this._m_Temp_Vec4.setToInXYZW(o._m_X,o._m_Y,o._m_Z,1),this._m_Temp_Vec4._m_W=1,this._m_Temp_Vec4_2._m_W=1,this._m_Temp_Vec4_3._m_W=1;var u=this._m_Cam_Left.multLength(_,this._m_Temp_Vec4_2).add(o),s=this._m_Cam_Up.multLength(i,this._m_Temp_Vec4_3).add(o);a.default.multiplyMV(this._m_Light_Left,u,this._m_PV),a.default.multiplyMV(this._m_Light_Up,s,this._m_PV),a.default.multiplyMV(this._m_Light_Center,o,this._m_PV),this._m_Light_Left._m_X/=this._m_Light_Left._m_W,this._m_Light_Left._m_Y/=this._m_Light_Left._m_W,this._m_Light_Up._m_X/=this._m_Light_Up._m_W,this._m_Light_Up._m_Y/=this._m_Light_Up._m_W,this._m_Light_Center._m_X/=this._m_Light_Center._m_W,this._m_Light_Center._m_Y/=this._m_Light_Center._m_W,this._m_Light_Left._m_X=this._m_ViewPortWidth*(1+this._m_Light_Left._m_X),this._m_Light_Up._m_X=this._m_ViewPortWidth*(1+this._m_Light_Up._m_X),this._m_Light_Center._m_X=this._m_ViewPortWidth*(1+this._m_Light_Center._m_X),this._m_Light_Left._m_Y=this._m_ViewPortHeight*(1-this._m_Light_Left._m_Y),this._m_Light_Up._m_Y=this._m_ViewPortHeight*(1-this._m_Light_Up._m_Y),this._m_Light_Center._m_Y=this._m_ViewPortHeight*(1-this._m_Light_Center._m_Y);var l=Math.abs(this._m_Light_Left._m_X-this._m_Light_Center._m_X),f=Math.abs(this._m_Light_Center._m_Y-this._m_Light_Up._m_Y),m=-1,c=-1;this._m_Light_Center._m_Z<-this._m_Light_Center._m_W?(m=-this._m_Light_Center._m_X-l,c=-this._m_Light_Center._m_Y+f):(m=this._m_Light_Center._m_X-l,c=this._m_Light_Center._m_Y+f);var h=2*this._m_ViewPortHeight-c;return{left:m,right:2*l+m,top:2*f+h,bottom:h}}},{key:"_tile",value:function(e,t,n,r,_,a,i){for(var o=Math.max(Math.floor(a.left/e),0),u=Math.min(Math.ceil(a.right/e),t),s=Math.max(Math.floor(a.bottom/e),0),l=Math.min(Math.ceil(a.top/e),n),f=0,m=o;m<u;m++)for(var c=s;c<l;c++)(f=m+c*t)>=0&&f<r&&_[f].push(i)}},{key:"_tileLightDecode",value:function(e,t,n,r,_,a,i){var o=t.m_LastSubShader.getContextVars(),u=-1;u=i.length;var s=null;if(null!=o[m.S_LIGHT_NUM_SRC]&&e.uniform1i(o[m.S_LIGHT_NUM_SRC].loc,u),null!=o[m.S_TILE_V_LIGHT_DATA_0])s=1;else{if(null==o[m.S_TILE_W_LIGHT_DATA_0])return 0;s=0}for(var l=0,f=0,c=null;l<n;l++){u=(c=r[l]).length;for(var h=0;h<u;h++)this._m_LightsIndex.push(c[h]),this._m_LightsIndex.push(0),this._m_LightsIndex.push(0);this._m_LightsDecode.push(f),this._m_LightsDecode.push(u),this._m_LightsDecode.push(-1),f+=u}var d=Math.ceil(Math.sqrt(this._m_LightsIndex.length/3));null!=o[m.S_TILE_LIGHT_OFFSET_SIZE]&&e.uniform1f(o[m.S_TILE_LIGHT_OFFSET_SIZE].loc,d);for(var S=this._m_LightsIndex.length,p=d*d*3;S<p;S++)this._m_LightsIndex.push(-1);for(var g=0,y=this._m_LightsDecode.length;g<y;g+=3)this._m_LightsDecode[g+2]=this._m_LightsDecode[g]/d,this._m_LightsDecode[g]%=d;null!=o[m.S_TILE_LIGHT_DECODE_SRC]&&this._m_LightsDecodeData.uploadArrayData(o[m.S_TILE_LIGHT_DECODE_SRC].loc,_,a,new Float32Array(this._m_LightsDecode)),null!=o[m.S_TILE_LIGHT_INDEX_SRC]&&this._m_LightsIndexData.uploadArrayData(o[m.S_TILE_LIGHT_INDEX_SRC].loc,d,d,new Float32Array(this._m_LightsIndex));var v=null,T=null;u=i.length;for(var E=0;E<u;E++)switch(T=(v=i[E]).getColor(),this._m_LightsData0Array.push(T._m_X),this._m_LightsData0Array.push(T._m_Y),this._m_LightsData0Array.push(T._m_Z),this._m_LightsData0Array.push(v.getTypeId()),v.getType()){case"PointLight":s||(this._m_LightsData1Array.push(v.getPosition()._m_X),this._m_LightsData1Array.push(v.getPosition()._m_Y),this._m_LightsData1Array.push(v.getPosition()._m_Z),this._m_LightsData1Array.push(v.getInRadius())),this._m_LightsData2Array.push(0),this._m_LightsData2Array.push(0),this._m_LightsData2Array.push(0),this._m_LightsData2Array.push(0);break;case"SpotLight":s||(this._m_LightsData1Array.push(v.getPosition()._m_X),this._m_LightsData1Array.push(v.getPosition()._m_Y),this._m_LightsData1Array.push(v.getPosition()._m_Z),this._m_LightsData1Array.push(v.getInvSpotRange())),this._m_LightsData2Array.push(v.getDirection()._m_X),this._m_LightsData2Array.push(v.getDirection()._m_Y),this._m_LightsData2Array.push(v.getDirection()._m_Z),this._m_LightsData2Array.push(v.getPackedAngleCos())}var b=o[m.S_TILE_W_LIGHT_DATA_0]?o[m.S_TILE_W_LIGHT_DATA_0]:o[m.S_TILE_V_LIGHT_DATA_0];return b&&this._m_LightsData0.uploadArrayData(b.loc,this._m_LightsData0Array.length/4,1,new Float32Array(this._m_LightsData0Array)),(b=o[m.S_TILE_W_LIGHT_DATA_1]?o[m.S_TILE_W_LIGHT_DATA_1]:o[m.S_TILE_V_LIGHT_DATA_1])&&this._m_LightsData1.uploadArrayData(b.loc,this._m_LightsData1Array.length/4,1,new Float32Array(this._m_LightsData1Array)),(b=o[m.S_TILE_W_LIGHT_DATA_2]?o[m.S_TILE_W_LIGHT_DATA_2]:o[m.S_TILE_V_LIGHT_DATA_2])&&this._m_LightsData2.uploadArrayData(b.loc,this._m_LightsData2Array.length/4,1,new Float32Array(this._m_LightsData2Array)),1}},{key:"_uploadLights",value:function(e,t,n,r,_,i,o){var s=n.m_LastSubShader.getContextVars(),l=t.enableGIProbes();if(null!=s[m.S_BLEND_GI_PROBES]&&e.uniform1i(s[m.S_BLEND_GI_PROBES].loc,o&&l),null!=s[m.S_AMBIENT_LIGHT_COLOR])if(0==i){var f=t.AmbientLightColor;e.uniform3f(s[m.S_AMBIENT_LIGHT_COLOR].loc,f._m_X,f._m_Y,f._m_Z)}else e.uniform3f(s[m.S_AMBIENT_LIGHT_COLOR].loc,0,0,0),t.getRender()._checkRenderState(e,this._m_AccumulationLights,n.getRenderState());l&&this._blendGIProbes(e,t,n);var c=null,h=null;null!=s[m.S_V_LIGHT_DATA]?(h=1,c=s[m.S_V_LIGHT_DATA].loc):null!=s[m.S_W_LIGHT_DATA]&&(h=0,c=s[m.S_W_LIGHT_DATA].loc);var d=_+i>r.length?r.length-i:_;if(null==c)return d+i;for(var S=null,p=null,g=u.default.S_LIGHT_DATA_4,y=g.getArray(),v=u.default.S_TEMP_VEC4,T=u.default.S_TEMP_VEC4_2,E=i,b=0,C=d+i;E<C;E++,b+=12)p=(S=r[E]).getColor(),y[b]=p._m_X,y[b+1]=p._m_Y,y[b+2]=p._m_Z,y[b+3]=S.getTypeId(),"DirectionalLight"===S.getType()&&(h?(T.setToInXYZW(S.getDirection()._m_X,S.getDirection()._m_Y,S.getDirection()._m_Z,0),a.default.multiplyMV(v,T,t.getMainCamera().getViewMatrix()),y[b+4]=v._m_X,y[b+5]=v._m_Y,y[b+6]=v._m_Z,y[b+7]=-1):(y[b+4]=S.getDirection()._m_X,y[b+5]=S.getDirection()._m_Y,y[b+6]=S.getDirection()._m_Z,y[b+7]=-1),y[b+8]=0,y[b+9]=0,y[b+10]=0,y[b+11]=0);return e.uniform4fv(c,g.getBufferData(),0,12*d),null!=s[m.S_CUR_LIGHT_COUNT]&&e.uniform1i(s[m.S_CUR_LIGHT_COUNT].loc,3*d),d+i}},{key:"draw",value:function(e,t,n,r,_,a){if(n.getRenderState().store(),0==a){if(0==_.length){var i=n.m_LastSubShader.getContextVars(),o=t.enableGIProbes();if(o&&this._blendGIProbes(e,t,n),null!=i[m.S_BLEND_GI_PROBES]&&e.uniform1i(i[m.S_BLEND_GI_PROBES].loc,o),null!=i[m.S_AMBIENT_LIGHT_COLOR]){var u=t.AmbientLightColor;e.uniform3f(i[m.S_AMBIENT_LIGHT_COLOR].loc,u._m_X,u._m_Y,u._m_Z)}return null!=i[m.S_CUR_LIGHT_COUNT]&&e.uniform1i(i[m.S_CUR_LIGHT_COUNT].loc,0),void r.draw(n)}for(var s=t.getRender().getBatchLightSize(),l=0;l<_.length;)l=this._uploadLights(e,t,n,_,s,l,0==l),r.draw(n)}else if(1==a){if(0==_.length)return;var f=null,c=t.getRender().getTileInfo(),h=c.tileSize,d=c.tileWidth,S=c.tileHeight,p=c.tileNum;if(this._reset(e,t,p),_.length>0){t.getRender()._checkRenderState(e,this._m_AccumulationLights,n.getRenderState()),this._m_ViewPortWidth=.5*t.getMainCamera().getWidth(),this._m_ViewPortHeight=.5*t.getMainCamera().getHeight(),this._m_PV=t.getMainCamera().getProjectViewMatrix(!0);var g=t.getMainCamera().getViewMatrix();this._m_Temp_Vec3.setToInXYZ(g.m[0],g.m[4],g.m[8]),this._m_CamLeftCoeff=1/t.getMainCamera().getFrustumPlane(1).getNormal().dot(this._m_Temp_Vec3),this._m_Temp_Vec3.setToInXYZ(g.m[1],g.m[5],g.m[9]),this._m_CamTopCoeff=1/t.getMainCamera().getFrustumPlane(2).getNormal().dot(this._m_Temp_Vec3),this._m_Cam_Left.setToInXYZW(g.m[0],g.m[4],g.m[8],1).multLength(-1),this._m_Cam_Up.setToInXYZW(g.m[1],g.m[5],g.m[9],1)}for(var y=0,v=_.length;y<v;y++)(f=this._lightClip(e,_[y]))&&this._tile(h,d,S,p,this._m_Tiles,f,y);this._tileLightDecode(e,n,p,this._m_Tiles,d,S,_),r.draw(n)}t.getRender()._checkRenderState(e,n.getRenderState().restore(),n.getRenderState())}},{key:"drawArrays",value:function(e,t,n,r,_,a){if(n.getRenderState().store(),0==a){if(0==_.length){var i=n.m_LastSubShader.getContextVars(),o=t.enableGIProbes();if(o&&this._blendGIProbes(e,t,n),null!=i[m.S_BLEND_GI_PROBES]&&e.uniform1i(i[m.S_BLEND_GI_PROBES].loc,o),null!=i[m.S_AMBIENT_LIGHT_COLOR]){var u=t.AmbientLightColor;e.uniform3f(i[m.S_AMBIENT_LIGHT_COLOR].loc,u._m_X,u._m_Y,u._m_Z)}return null!=i[m.S_CUR_LIGHT_COUNT]&&e.uniform1i(i[m.S_CUR_LIGHT_COUNT].loc,0),void r.forEach((function(e){e.draw(n)}))}for(var s=t.getRender().getBatchLightSize(),l=0;l<_.length;)l=this._uploadLights(e,t,n,_,s,l,0==l),r.forEach((function(e){e.draw(n)}))}else if(1==a){if(0==_.length)return;var f=null,c=t.getRender().getTileInfo(),h=c.tileSize,d=c.tileWidth,S=c.tileHeight,p=c.tileNum;if(this._reset(e,t,p),_.length>0){t.getRender()._checkRenderState(e,this._m_AccumulationLights,n.getRenderState()),this._m_ViewPortWidth=.5*t.getMainCamera().getWidth(),this._m_ViewPortHeight=.5*t.getMainCamera().getHeight(),this._m_PV=t.getMainCamera().getProjectViewMatrix(!0);var g=t.getMainCamera().getViewMatrix();this._m_Temp_Vec3.setToInXYZ(g.m[0],g.m[4],g.m[8]),this._m_CamLeftCoeff=1/t.getMainCamera().getFrustumPlane(1).getNormal().dot(this._m_Temp_Vec3),this._m_Temp_Vec3.setToInXYZ(g.m[1],g.m[5],g.m[9]),this._m_CamTopCoeff=1/t.getMainCamera().getFrustumPlane(2).getNormal().dot(this._m_Temp_Vec3),this._m_Cam_Left.setToInXYZW(g.m[0],g.m[4],g.m[8],1).multLength(-1),this._m_Cam_Up.setToInXYZW(g.m[1],g.m[5],g.m[9],1)}for(var y=0,v=_.length;y<v;y++)(f=this._lightClip(e,_[y]))&&this._tile(h,d,S,p,this._m_Tiles,f,y);this._tileLightDecode(e,n,p,this._m_Tiles,d,S,_),r.forEach((function(e){e.draw(n)}))}t.getRender()._checkRenderState(e,n.getRenderState().restore(),n.getRenderState())}}])&&c(t.prototype,n),r&&c(t,r),m}(_.default);t.default=v,y(v,"PROGRAM_TYPE","TilePassIBLLighting"),y(v,"S_CUR_LIGHT_COUNT","_curLightCount"),y(v,"S_AMBIENT_LIGHT_COLOR","_ambientLightColor"),y(v,"S_V_LIGHT_DATA","_vLightData"),y(v,"S_W_LIGHT_DATA","_wLightData"),y(v,"S_LIGHT_NUM_SRC","_lightNum"),y(v,"S_TILE_LIGHT_DECODE_SRC","_tileLightDecode"),y(v,"S_TILE_LIGHT_INDEX_SRC","_tileLightIndex"),y(v,"S_TILE_LIGHT_OFFSET_SIZE","_tileLightOffsetSize"),y(v,"S_TILE_W_LIGHT_DATA_0","_tileWLightData0"),y(v,"S_TILE_V_LIGHT_DATA_0","_tileVLightData0"),y(v,"S_TILE_W_LIGHT_DATA_1","_tileWLightData1"),y(v,"S_TILE_V_LIGHT_DATA_1","_tileVLightData1"),y(v,"S_TILE_W_LIGHT_DATA_2","_tileWLightData2"),y(v,"S_TILE_V_LIGHT_DATA_2","_tileVLightData2"),y(v,"S_PREF_ENV_MAP_SRC","_prefEnvMap"),y(v,"S_WGIPROBE_SRC","_wGIProbe"),y(v,"S_SH_COEFFS_SRC","_ShCoeffs"),y(v,"S_BLEND_GI_PROBES","_blend_gi_probes")},2390:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=f(n(1393)),a=f(n(2320)),i=f(n(8435)),o=f(n(2475)),u=f(n(5604)),s=f(n(7141)),l=f(n(5141));function f(e){return e&&e.__esModule?e:{default:e}}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t){return c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},c(e,t)}function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=p(e);if(t){var _=p(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return d(this,n)}}function d(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return S(e)}function S(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e){return p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},p(e)}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(f,e);var t,n,r,_=h(f);function f(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),g(S(t=_.call(this,e)),"_m_Tiles",[]),g(S(t),"_m_LightsIndex",[]),g(S(t),"_m_LightsDecode",[]),g(S(t),"_m_LightsDecodeData",null),g(S(t),"_m_LightsIndexData",null),g(S(t),"_m_LightsData0",null),g(S(t),"_m_LightsData1",null),g(S(t),"_m_LightsData2",null),g(S(t),"_m_LightsData0Array",[]),g(S(t),"_m_LightsData1Array",[]),g(S(t),"_m_LightsData2Array",[]),g(S(t),"_m_PV",null),g(S(t),"_m_Temp_Vec3",new u.default),g(S(t),"_m_Temp_Vec4",new s.default),g(S(t),"_m_Temp_Vec4_2",new s.default),g(S(t),"_m_Temp_Vec4_3",new s.default),g(S(t),"_m_Cam_Up",new s.default),g(S(t),"_m_Cam_Left",new s.default),g(S(t),"_m_Light_Left",new s.default),g(S(t),"_m_Light_Up",new s.default),g(S(t),"_m_Light_Center",new s.default),g(S(t),"_m_ViewPortWidth",-1),g(S(t),"_m_ViewPortHeight",-1),g(S(t),"_m_CamLeftCoeff",-1),g(S(t),"_m_CamTopCoeff",-1),t._m_AccumulationLights=new i.default,t._m_AccumulationLights.setFlag(i.default.S_STATES[4],"On"),t._m_AccumulationLights.setFlag(i.default.S_STATES[1],"Off"),t._m_AccumulationLights.setFlag(i.default.S_STATES[5],["ONE","ONE"]),t}return t=f,(n=[{key:"_createTexture",value:function(e,t,n,r){var _=new l.default(e);return e.getCanvas().getGLContext(),_.setTextureFormat(t,n,r),_.setWrap(e,l.default.S_WRAPS.S_CLAMP_TO_EDGE,l.default.S_WRAPS.S_CLAMP_TO_EDGE),_.setFilter(e,l.default.S_FILTERS.S_NEAREST,l.default.S_FILTERS.S_NEAREST),_.updateTextureFilter(),_.setAlignment(1),_}},{key:"_reset",value:function(e,t,n){this._m_LightsIndexData||(this._m_LightsIndexData=this._createTexture(t,e.RGB32F,e.RGB,e.FLOAT)),this._m_LightsDecodeData||(this._m_LightsDecodeData=this._createTexture(t,e.RGB32F,e.RGB,e.FLOAT)),this._m_LightsData0||(this._m_LightsData0=this._createTexture(t,e.RGBA32F,e.RGBA,e.FLOAT)),this._m_LightsData0Array.length=0,this._m_LightsData1||(this._m_LightsData1=this._createTexture(t,e.RGBA32F,e.RGBA,e.FLOAT)),this._m_LightsData1Array.length=0,this._m_LightsData2||(this._m_LightsData2=this._createTexture(t,e.RGBA32F,e.RGBA,e.FLOAT)),this._m_LightsData2Array.length=0;for(var r=0;r<n;r++)this._m_Tiles[r]=[];this._m_LightsDecode.length=0,this._m_LightsIndex.length=0}},{key:"_lightClip",value:function(e,t){var n=t.getBoundingVolume(),r=n.getRadius(),_=r*this._m_CamLeftCoeff,i=r*this._m_CamTopCoeff,o=n.getCenter(this._m_Temp_Vec3);o=this._m_Temp_Vec4.setToInXYZW(o._m_X,o._m_Y,o._m_Z,1),this._m_Temp_Vec4._m_W=1,this._m_Temp_Vec4_2._m_W=1,this._m_Temp_Vec4_3._m_W=1;var u=this._m_Cam_Left.multLength(_,this._m_Temp_Vec4_2).add(o),s=this._m_Cam_Up.multLength(i,this._m_Temp_Vec4_3).add(o);a.default.multiplyMV(this._m_Light_Left,u,this._m_PV),a.default.multiplyMV(this._m_Light_Up,s,this._m_PV),a.default.multiplyMV(this._m_Light_Center,o,this._m_PV),this._m_Light_Left._m_X/=this._m_Light_Left._m_W,this._m_Light_Left._m_Y/=this._m_Light_Left._m_W,this._m_Light_Up._m_X/=this._m_Light_Up._m_W,this._m_Light_Up._m_Y/=this._m_Light_Up._m_W,this._m_Light_Center._m_X/=this._m_Light_Center._m_W,this._m_Light_Center._m_Y/=this._m_Light_Center._m_W,this._m_Light_Left._m_X=this._m_ViewPortWidth*(1+this._m_Light_Left._m_X),this._m_Light_Up._m_X=this._m_ViewPortWidth*(1+this._m_Light_Up._m_X),this._m_Light_Center._m_X=this._m_ViewPortWidth*(1+this._m_Light_Center._m_X),this._m_Light_Left._m_Y=this._m_ViewPortHeight*(1-this._m_Light_Left._m_Y),this._m_Light_Up._m_Y=this._m_ViewPortHeight*(1-this._m_Light_Up._m_Y),this._m_Light_Center._m_Y=this._m_ViewPortHeight*(1-this._m_Light_Center._m_Y);var l=Math.abs(this._m_Light_Left._m_X-this._m_Light_Center._m_X),f=Math.abs(this._m_Light_Center._m_Y-this._m_Light_Up._m_Y),m=-1,c=-1;this._m_Light_Center._m_Z<-this._m_Light_Center._m_W?(m=-this._m_Light_Center._m_X-l,c=-this._m_Light_Center._m_Y+f):(m=this._m_Light_Center._m_X-l,c=this._m_Light_Center._m_Y+f);var h=2*this._m_ViewPortHeight-c;return{left:m,right:2*l+m,top:2*f+h,bottom:h}}},{key:"_tile",value:function(e,t,n,r,_,a,i){for(var o=Math.max(Math.floor(a.left/e),0),u=Math.min(Math.ceil(a.right/e),t),s=Math.max(Math.floor(a.bottom/e),0),l=Math.min(Math.ceil(a.top/e),n),f=0,m=o;m<u;m++)for(var c=s;c<l;c++)(f=m+c*t)>=0&&f<r&&_[f].push(i)}},{key:"_tileLightDecode",value:function(e,t,n,r,_,a,i){var o=t.m_LastSubShader.getContextVars(),u=-1;u=i.length;var s=null;if(null!=o[f.S_LIGHT_NUM_SRC]&&e.uniform1i(o[f.S_LIGHT_NUM_SRC].loc,u),null!=o[f.S_TILE_V_LIGHT_DATA_0])s=1;else{if(null==o[f.S_TILE_W_LIGHT_DATA_0])return 0;s=0}for(var l=0,m=0,c=null;l<n;l++){u=(c=r[l]).length;for(var h=0;h<u;h++)this._m_LightsIndex.push(c[h]),this._m_LightsIndex.push(0),this._m_LightsIndex.push(0);this._m_LightsDecode.push(m),this._m_LightsDecode.push(u),this._m_LightsDecode.push(-1),m+=u}var d=Math.ceil(Math.sqrt(this._m_LightsIndex.length/3));null!=o[f.S_TILE_LIGHT_OFFSET_SIZE]&&e.uniform1f(o[f.S_TILE_LIGHT_OFFSET_SIZE].loc,d);for(var S=this._m_LightsIndex.length,p=d*d*3;S<p;S++)this._m_LightsIndex.push(-1);for(var g=0,y=this._m_LightsDecode.length;g<y;g+=3)this._m_LightsDecode[g+2]=this._m_LightsDecode[g]/d,this._m_LightsDecode[g]%=d;null!=o[f.S_TILE_LIGHT_DECODE_SRC]&&this._m_LightsDecodeData.uploadArrayData(o[f.S_TILE_LIGHT_DECODE_SRC].loc,_,a,new Float32Array(this._m_LightsDecode)),null!=o[f.S_TILE_LIGHT_INDEX_SRC]&&this._m_LightsIndexData.uploadArrayData(o[f.S_TILE_LIGHT_INDEX_SRC].loc,d,d,new Float32Array(this._m_LightsIndex));var v=null,T=null;u=i.length;for(var E=0;E<u;E++)switch(T=(v=i[E]).getColor(),this._m_LightsData0Array.push(T._m_X),this._m_LightsData0Array.push(T._m_Y),this._m_LightsData0Array.push(T._m_Z),this._m_LightsData0Array.push(v.getTypeId()),v.getType()){case"PointLight":s||(this._m_LightsData1Array.push(v.getPosition()._m_X),this._m_LightsData1Array.push(v.getPosition()._m_Y),this._m_LightsData1Array.push(v.getPosition()._m_Z),this._m_LightsData1Array.push(v.getInRadius())),this._m_LightsData2Array.push(0),this._m_LightsData2Array.push(0),this._m_LightsData2Array.push(0),this._m_LightsData2Array.push(0);break;case"SpotLight":s||(this._m_LightsData1Array.push(v.getPosition()._m_X),this._m_LightsData1Array.push(v.getPosition()._m_Y),this._m_LightsData1Array.push(v.getPosition()._m_Z),this._m_LightsData1Array.push(v.getInvSpotRange())),this._m_LightsData2Array.push(v.getDirection()._m_X),this._m_LightsData2Array.push(v.getDirection()._m_Y),this._m_LightsData2Array.push(v.getDirection()._m_Z),this._m_LightsData2Array.push(v.getPackedAngleCos())}var b=o[f.S_TILE_W_LIGHT_DATA_0]?o[f.S_TILE_W_LIGHT_DATA_0]:o[f.S_TILE_V_LIGHT_DATA_0];return b&&this._m_LightsData0.uploadArrayData(b.loc,this._m_LightsData0Array.length/4,1,new Float32Array(this._m_LightsData0Array)),(b=o[f.S_TILE_W_LIGHT_DATA_1]?o[f.S_TILE_W_LIGHT_DATA_1]:o[f.S_TILE_V_LIGHT_DATA_1])&&this._m_LightsData1.uploadArrayData(b.loc,this._m_LightsData1Array.length/4,1,new Float32Array(this._m_LightsData1Array)),(b=o[f.S_TILE_W_LIGHT_DATA_2]?o[f.S_TILE_W_LIGHT_DATA_2]:o[f.S_TILE_V_LIGHT_DATA_2])&&this._m_LightsData2.uploadArrayData(b.loc,this._m_LightsData2Array.length/4,1,new Float32Array(this._m_LightsData2Array)),1}},{key:"_uploadLights",value:function(e,t,n,r,_,i){var u=n.m_LastSubShader.getContextVars();if(null!=u[f.S_AMBIENT_LIGHT_COLOR])if(0==i){var s=t.AmbientLightColor;e.uniform3f(u[f.S_AMBIENT_LIGHT_COLOR].loc,s._m_X,s._m_Y,s._m_Z)}else e.uniform3f(u[f.S_AMBIENT_LIGHT_COLOR].loc,0,0,0),t.getRender()._checkRenderState(e,this._m_AccumulationLights,n.getRenderState());var l=null,m=null;null!=u[f.S_V_LIGHT_DATA]?(m=1,l=u[f.S_V_LIGHT_DATA].loc):null!=u[f.S_W_LIGHT_DATA]&&(m=0,l=u[f.S_W_LIGHT_DATA].loc);var c=_+i>r.length?r.length-i:_;if(null==l)return c+i;for(var h=null,d=null,S=o.default.S_LIGHT_DATA,p=S.getArray(),g=o.default.S_TEMP_VEC4,y=o.default.S_TEMP_VEC4_2,v=i,T=0,E=c+i;v<E;v++,T+=12)d=(h=r[v]).getColor(),p[T]=d._m_X,p[T+1]=d._m_Y,p[T+2]=d._m_Z,p[T+3]=h.getTypeId(),"DirectionalLight"===h.getType()&&(m?(y.setToInXYZW(h.getDirection()._m_X,h.getDirection()._m_Y,h.getDirection()._m_Z,0),a.default.multiplyMV(g,y,t.getMainCamera().getViewMatrix()),p[T+4]=g._m_X,p[T+5]=g._m_Y,p[T+6]=g._m_Z,p[T+7]=-1):(p[T+4]=h.getDirection()._m_X,p[T+5]=h.getDirection()._m_Y,p[T+6]=h.getDirection()._m_Z,p[T+7]=-1),p[T+8]=0,p[T+9]=0,p[T+10]=0,p[T+11]=0);return e.uniform4fv(l,S.getBufferData(),0,12*c),null!=u[f.S_CUR_LIGHT_COUNT]&&e.uniform1i(u[f.S_CUR_LIGHT_COUNT].loc,3*c),c+i}},{key:"draw",value:function(e,t,n,r,_,a){if(n.getRenderState().store(),0==a){if(0==_.length){var i=n.m_LastSubShader.getContextVars();if(null!=i[f.S_AMBIENT_LIGHT_COLOR]){var o=t.AmbientLightColor;e.uniform3f(i[f.S_AMBIENT_LIGHT_COLOR].loc,o._m_X,o._m_Y,o._m_Z)}return null!=i[f.S_CUR_LIGHT_COUNT]&&e.uniform1i(i[f.S_CUR_LIGHT_COUNT].loc,0),void r.draw(n)}for(var u=t.getRender().getBatchLightSize(),s=0;s<_.length;)s=this._uploadLights(e,t,n,_,u,s),r.draw(n)}else if(1==a){if(0==_.length)return;var l=null,m=t.getRender().getTileInfo(),c=m.tileSize,h=m.tileWidth,d=m.tileHeight,S=m.tileNum;if(this._reset(e,t,S),_.length>0){t.getRender()._checkRenderState(e,this._m_AccumulationLights,n.getRenderState()),this._m_ViewPortWidth=.5*t.getMainCamera().getWidth(),this._m_ViewPortHeight=.5*t.getMainCamera().getHeight(),this._m_PV=t.getMainCamera().getProjectViewMatrix(!0);var p=t.getMainCamera().getViewMatrix();this._m_Temp_Vec3.setToInXYZ(p.m[0],p.m[4],p.m[8]),this._m_CamLeftCoeff=1/t.getMainCamera().getFrustumPlane(1).getNormal().dot(this._m_Temp_Vec3),this._m_Temp_Vec3.setToInXYZ(p.m[1],p.m[5],p.m[9]),this._m_CamTopCoeff=1/t.getMainCamera().getFrustumPlane(2).getNormal().dot(this._m_Temp_Vec3),this._m_Cam_Left.setToInXYZW(p.m[0],p.m[4],p.m[8],1).multLength(-1),this._m_Cam_Up.setToInXYZW(p.m[1],p.m[5],p.m[9],1)}for(var g=0,y=_.length;g<y;g++)(l=this._lightClip(e,_[g]))&&this._tile(c,h,d,S,this._m_Tiles,l,g);this._tileLightDecode(e,n,S,this._m_Tiles,h,d,_),r.draw(n)}t.getRender()._checkRenderState(e,n.getRenderState().restore(),n.getRenderState())}},{key:"drawArrays",value:function(e,t,n,r,_,a){if(n.getRenderState().store(),0==a){if(0==_.length){var i=n.m_LastSubShader.getContextVars();if(null!=i[f.S_AMBIENT_LIGHT_COLOR]){var o=t.AmbientLightColor;e.uniform3f(i[f.S_AMBIENT_LIGHT_COLOR].loc,o._m_X,o._m_Y,o._m_Z)}return null!=i[f.S_CUR_LIGHT_COUNT]&&e.uniform1i(i[f.S_CUR_LIGHT_COUNT].loc,0),void r.forEach((function(e){e.draw(n)}))}for(var u=t.getRender().getBatchLightSize(),s=0;s<_.length;)s=this._uploadLights(e,t,n,_,u,s),r.forEach((function(e){e.draw(n)}))}else if(1==a){if(0==_.length)return;var l=null,m=t.getRender().getTileInfo(),c=m.tileSize,h=m.tileWidth,d=m.tileHeight,S=m.tileNum;if(this._reset(e,t,S),_.length>0){t.getRender()._checkRenderState(e,this._m_AccumulationLights,n.getRenderState()),this._m_ViewPortWidth=.5*t.getMainCamera().getWidth(),this._m_ViewPortHeight=.5*t.getMainCamera().getHeight(),this._m_PV=t.getMainCamera().getProjectViewMatrix(!0);var p=t.getMainCamera().getViewMatrix();this._m_Temp_Vec3.setToInXYZ(p.m[0],p.m[4],p.m[8]),this._m_CamLeftCoeff=1/t.getMainCamera().getFrustumPlane(1).getNormal().dot(this._m_Temp_Vec3),this._m_Temp_Vec3.setToInXYZ(p.m[1],p.m[5],p.m[9]),this._m_CamTopCoeff=1/t.getMainCamera().getFrustumPlane(2).getNormal().dot(this._m_Temp_Vec3),this._m_Cam_Left.setToInXYZW(p.m[0],p.m[4],p.m[8],1).multLength(-1),this._m_Cam_Up.setToInXYZW(p.m[1],p.m[5],p.m[9],1)}for(var g=0,y=_.length;g<y;g++)(l=this._lightClip(e,_[g]))&&this._tile(c,h,d,S,this._m_Tiles,l,g);this._tileLightDecode(e,n,S,this._m_Tiles,h,d,_),r.forEach((function(e){e.draw(n)}))}t.getRender()._checkRenderState(e,n.getRenderState().restore(),n.getRenderState())}}])&&m(t.prototype,n),r&&m(t,r),f}(_.default);t.default=y,g(y,"PROGRAM_TYPE","TilePassLighting"),g(y,"S_CUR_LIGHT_COUNT","_curLightCount"),g(y,"S_AMBIENT_LIGHT_COLOR","_ambientLightColor"),g(y,"S_V_LIGHT_DATA","_vLightData"),g(y,"S_W_LIGHT_DATA","_wLightData"),g(y,"S_LIGHT_NUM_SRC","_lightNum"),g(y,"S_TILE_LIGHT_DECODE_SRC","_tileLightDecode"),g(y,"S_TILE_LIGHT_INDEX_SRC","_tileLightIndex"),g(y,"S_TILE_LIGHT_OFFSET_SIZE","_tileLightOffsetSize"),g(y,"S_TILE_W_LIGHT_DATA_0","_tileWLightData0"),g(y,"S_TILE_V_LIGHT_DATA_0","_tileVLightData0"),g(y,"S_TILE_W_LIGHT_DATA_1","_tileWLightData1"),g(y,"S_TILE_V_LIGHT_DATA_1","_tileVLightData1"),g(y,"S_TILE_W_LIGHT_DATA_2","_tileWLightData2"),g(y,"S_TILE_V_LIGHT_DATA_2","_tileVLightData2")},3061:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=M(n(6798)),a=M(n(9650)),i=M(n(8435)),o=M(n(7341)),u=M(n(9784)),s=M(n(4008)),l=M(n(8113)),f=M(n(1393)),m=M(n(6148)),c=M(n(8546)),h=M(n(3846)),d=M(n(3370)),S=M(n(9510)),p=M(n(2475)),g=M(n(5734)),y=M(n(870)),v=M(n(4658)),T=M(n(8388)),E=M(n(2390)),b=M(n(6987)),C=M(n(2987)),P=M(n(1759)),R=M(n(1491));function M(e){return e&&e.__esModule?e:{default:e}}function A(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function w(e,t){return w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},w(e,t)}function I(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=D(e);if(t){var _=D(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return L(this,n)}}function L(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function D(e){return D=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},D(e)}function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var F=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(M,e);var t,n,r,a=I(M);function M(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,M),(n=a.call(this,e,t))._m_Drawables=[],n._m_DrawableIDs={},n._m_VisDrawables=[],n._m_FramePictures=[],n._m_FramePictureIDs=[],n._m_Sky=null,n._m_Pipeline={},n._m_PipelineConfig={},n._m_PriorityTechnology="",n._m_FrameContext=new _.default,n._m_RenderPrograms={},n._m_OpaqueRenderState=new i.default,n._m_TranslucentRenderState=new i.default,n._m_TranslucentRenderState.setFlag(i.default.S_STATES[4],"On"),n._m_TranslucentRenderState.setFlag(i.default.S_STATES[5],["SRC_ALPHA","ONE_MINUS_SRC_ALPHA"]),n._m_BatchLightSize=4,n._m_GammaCorrection=!0,n._m_GammaFactor=.45,n._m_ToneMapping=!1,n._m_TileInfo={tileSize:0,tileWidth:0,tileHeight:0,tileNum:0},n._m_Scene.getCanvas().on("resize",(function(e,t){n.updateTileInfo(e,t)})),n.setTileSize(32),n}return t=M,(n=[{key:"getType",value:function(){return"Render"}},{key:"updateTileInfo",value:function(e,t){var n=this._m_TileInfo.tileSize;this._m_TileInfo.tileWidth=Math.floor(e/n),this._m_TileInfo.tileHeight=Math.floor(t/n),this._m_TileInfo.tileNum=this._m_TileInfo.tileWidth*this._m_TileInfo.tileHeight}},{key:"setTileSize",value:function(e){e!=this._m_TileInfo.tileSize&&(this._m_TileInfo.tileSize=e,this.updateTileInfo(this._m_Scene.getCanvas().getWidth(),this._m_Scene.getCanvas().getHeight()))}},{key:"getTileInfo",value:function(){return this._m_TileInfo}},{key:"setPriorityTechnology",value:function(e){this._m_PriorityTechnology=e}},{key:"getPriorityTechnology",value:function(){return this._m_PriorityTechnology}},{key:"setBatchLightSize",value:function(e){e!=this._m_BatchLightSize&&(e>50&&(e=50),p.default.mallocLightData(e),this._m_BatchLightSize=e,u.default.resizeBatchLightSize(e))}},{key:"getBatchLightSize",value:function(){return this._m_BatchLightSize}},{key:"startUp",value:function(){var e=this,t=this._m_Scene.getCanvas().getGLContext(),n=t.getExtension("WEBKIT_WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture");h.default.debug("depthEXT:",n);var r=this._m_Scene.getCanvas().getWidth(),_=this._m_Scene.getCanvas().getHeight(),a=new o.default(t,M.DEFAULT_DEFERRED_SHADING_FRAMEBUFFER,r,_);this._m_FrameContext.addFrameBuffer(M.DEFAULT_DEFERRED_SHADING_FRAMEBUFFER,a),a.addTexture(t,u.default.S_G_BUFFER0_SRC,t.RGBA16F,0,t.RGBA,t.FLOAT,t.COLOR_ATTACHMENT0,!0),a.addTexture(t,u.default.S_G_BUFFER1_SRC,t.RGBA32F,0,t.RGBA,t.FLOAT,t.COLOR_ATTACHMENT1,!0),a.addTexture(t,u.default.S_G_BUFFER2_SRC,t.RGBA16F,0,t.RGBA,t.FLOAT,t.COLOR_ATTACHMENT2,!0),a.addTexture(t,u.default.S_G_DEPTH_SRC,t.DEPTH_COMPONENT24,0,t.DEPTH_COMPONENT,t.UNSIGNED_INT,t.DEPTH_ATTACHMENT,!1),a.finish(t,this._m_Scene,!0);var i=new o.default(t,M.DEFAULT_FORWARD_SHADING_FRAMEBUFFER,r,_);this._m_FrameContext.addFrameBuffer(M.DEFAULT_FORWARD_SHADING_FRAMEBUFFER,i),i.addTexture(t,u.default.S_FORWARD_COLOR_MAP_SRC,t.RGBA16F,0,t.RGBA,t.FLOAT,t.COLOR_ATTACHMENT0,!1),i.addBuffer(t,"depth",t.DEPTH_COMPONENT24,t.DEPTH_ATTACHMENT),i.finish(t,this._m_Scene,!0);var S=new s.default(this._m_Scene,{id:"for_m",frameContext:this.getFrameContext(),materialDef:l.default.parse(d.default.S_DEFAULT_OUT_COLOR_DEF_DATA)});S.setParam("gammaFactor",(new P.default).valueOf(this._m_GammaFactor)),i.getFramePicture().setMaterial(S),this._m_FrameContext._m_DefaultFrameBuffer=i.getFrameBuffer();var p=new o.default(t,M.DEFAULT_POST_FILTER_SHADING_FRAMEBUFFER,r,_);this._m_FrameContext.addFrameBuffer(M.DEFAULT_POST_FILTER_SHADING_FRAMEBUFFER,p),p.addTexture(t,u.default.S_IN_SCREEN_SRC,t.RGBA16F,0,t.RGBA,t.FLOAT,t.COLOR_ATTACHMENT0,!1),p.addTexture(t,u.default.S_IN_DEPTH_SRC,t.DEPTH_COMPONENT24,0,t.DEPTH_COMPONENT,t.UNSIGNED_INT,t.DEPTH_ATTACHMENT,!1),p.finish(t,this._m_Scene,!1),this._m_FrameContext._m_DefaultPostFilterFrameBuffer=p.getFrameBuffer(),this._m_RenderPrograms[f.default.PROGRAM_TYPE]=new f.default,this._m_RenderPrograms[m.default.PROGRAM_TYPE]=new m.default,this._m_RenderPrograms[v.default.PROGRAM_TYPE]=new v.default,this._m_RenderPrograms[c.default.PROGRAM_TYPE]=new c.default,this._m_RenderPrograms[T.default.PROGRAM_TYPE]=new T.default,this._m_RenderPrograms[E.default.PROGRAM_TYPE]=new E.default,this._m_RenderPrograms[C.default.PROGRAM_TYPE]=new C.default,this._m_PipelineConfig[M.FORWARD]=new g.default({render:this}),this._m_PipelineConfig[M.DEFERRED_SHADING]=new y.default({render:this}),this._m_PipelineConfig[M.TILE_DEFERRED_SHADING]=new b.default({render:this}),this.enablePipeline(M.FORWARD),this.enablePipeline(M.DEFERRED_SHADING),this._m_Scene.getCanvas().on("resize",(function(n,r){e._m_FrameContext.resize(t,n,r),e._m_FrameContext._m_DefaultFrameBuffer=e._m_FrameContext.getFrameBuffer(M.DEFAULT_FORWARD_SHADING_FRAMEBUFFER).getFrameBuffer(),e._m_FrameContext._m_DefaultPostFilterFrameBuffer=e._m_FrameContext.getFrameBuffer(M.DEFAULT_POST_FILTER_SHADING_FRAMEBUFFER).getFrameBuffer()}))}},{key:"enablePipeline",value:function(e){var t=-1;switch(e){case M.FORWARD:t=0;break;case M.DEFERRED_SHADING:case M.TILE_DEFERRED_SHADING:t=1}t>=0?this._m_Pipeline[t]=this._m_PipelineConfig[e]:h.default.warn("无效pipeline!")}},{key:"getVisDrawables",value:function(){return this._m_VisDrawables}},{key:"getDrawableIDs",value:function(){return this._m_DrawableIDs}},{key:"getFrameContext",value:function(){return this._m_FrameContext}},{key:"setSky",value:function(e){this._m_Sky!=e&&(this._m_Sky=e)}},{key:"getSky",value:function(){return this._m_Sky}},{key:"addDrawable",value:function(e){e.isFramePicture&&e.isFramePicture()?this._m_FramePictureIDs[e.getId()]||(this._m_FramePictureIDs[e.getId()]=e,this._m_FramePictures.push(e)):e.isSky&&e.isSky()||this._m_DrawableIDs[e.getId()]||(this._m_DrawableIDs[e.getId()]=e,this._m_Drawables.push(e))}},{key:"removeDrawable",value:function(e){this._m_DrawableIDs[e.getId()]&&(this._m_DrawableIDs[e.getId()]=null,this._m_Drawables.remove(e))}},{key:"_checkRenderState",value:function(e,t,n){var r=t.getState(),_=!1;for(var a in r)if(n.getFlag(a)!=r[a])switch(_=!0,n.setFlag(a,r[a]),a){case i.default.S_STATES[0]:switch(r[a]){case i.default.S_FACE_CULL_BACK:e.enable(e.CULL_FACE),e.cullFace(e.BACK);break;case i.default.S_FACE_CULL_FRONT:e.enable(e.CULL_FACE),e.cullFace(e.FRONT);break;case i.default.S_FACE_CULL_FRONT_AND_BACK:e.enable(e.CULL_FACE),e.cullFace(e.FRONT_AND_BACK);break;case i.default.S_FACE_CULL_OFF:e.disable(e.CULL_FACE)}break;case i.default.S_STATES[1]:"On"==r[a]?e.depthMask(!0):"Off"==r[a]&&e.depthMask(!1);break;case i.default.S_STATES[2]:"On"==r[a]?e.colorMask(!0,!0,!0,!0):"Off"==r[a]&&e.colorMask(!1,!1,!1,!1);break;case i.default.S_STATES[3]:"On"==r[a]?e.enable(e.DEPTH_TEST):"Off"==r[a]&&e.disable(e.DEPTH_TEST);break;case i.default.S_STATES[4]:"On"==r[a]?e.enable(e.BLEND):"Off"==r[a]&&e.disable(e.BLEND);break;case i.default.S_STATES[5]:var o=null,u=null;switch(r[a][0]){case"SRC_ALPHA":o=e.SRC_ALPHA;break;case"ONE":o=e.ONE}switch(r[a][1]){case"SRC_ALPHA":u=e.SRC_ALPHA;case"ONE_MINUS_SRC_COLOR":u=e.ONE_MINUS_SRC_COLOR;break;case"ONE_MINUS_SRC_ALPHA":u=e.ONE_MINUS_SRC_ALPHA;break;case"ONE":u=e.ONE}null!=o&&null!=u&&e.blendFunc(o,u);break;case i.default.S_STATES[6]:"On"==r[a]?e.enable(e.SCISSOR_TEST):"Off"==r[a]&&e.disable(e.SCISSOR_TEST);break;case i.default.S_STATES[7]:"On"==r[a]?e.enable(e.POLYGON_OFFSET_FILL):"Off"==r[a]&&e.disable(e.POLYGON_OFFSET_FILL);break;case i.default.S_STATES[8]:e.polygonOffset(r[a][0],r[a][1])}return _}},{key:"_resetFrameContext",value:function(){this._m_FrameContext.reset()}},{key:"_drawFrame",value:function(e){var t=this._m_Scene.getCanvas().getGLContext();this.fire(M.PRE_FRAME,[e]),this._resetFrameContext(),this._checkRenderState(t,this._m_FrameContext.getRenderState().reset(),this._m_FrameContext.getRenderState());var n=this._m_VisDrawables,r=!1,_=!1,a=!1,o=!1,u=this._m_Scene.getVisLights(),s={},l=[],f=[];n.forEach((function(e){e.isGUI()?(a=!0,f[e.getMaterial().getId()]||(f[e.getMaterial().getId()]=[]),f[e.getMaterial().getId()].push(e)):e.isOpaque()?(r=!0,s[e.getMaterial().getId()]||(s[e.getMaterial().getId()]=[]),s[e.getMaterial().getId()].push(e)):e.isTranslucent()&&(_=!0,l.push(e))})),this.fire(M.POST_QUEUE,[e]),r&&this._checkRenderState(t,this._m_OpaqueRenderState,this._m_FrameContext.getRenderState()),o=this._m_Pipeline[1].render({gl:t,scene:this._m_Scene,frameContext:this._m_FrameContext,lights:u,bucket:s});var m=this._m_Scene.getMainCamera().demandFilter();if(o||((this._m_GammaCorrection||m)&&(o=!0,t.bindFramebuffer(t.FRAMEBUFFER,this._m_FrameContext._m_DefaultFrameBuffer),this._m_FrameContext.m_LastFrameBuffer=this._m_FrameContext._m_DefaultFrameBuffer),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)),this._m_Pipeline[0].render({gl:t,scene:this._m_Scene,frameContext:this._m_FrameContext,lights:u,opaque:!0,bucket:s}),this._drawEnv(t,u),_&&(this._checkRenderState(t,this._m_TranslucentRenderState,this._m_FrameContext.getRenderState()),l=S.default.sortTranslucentBucket(this._m_Scene.getMainCamera(),l),this._m_Pipeline[0].render({gl:t,scene:this._m_Scene,frameContext:this._m_FrameContext,lights:u,translucent:!0,bucket:l})),t.bindFramebuffer(t.READ_FRAMEBUFFER,this._m_FrameContext._m_DefaultFrameBuffer),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this._m_FrameContext._m_DefaultPostFilterFrameBuffer),t.blitFramebuffer(0,0,this._m_Scene.getCanvas().getWidth(),this._m_Scene.getCanvas().getHeight(),0,0,this._m_Scene.getCanvas().getWidth(),this._m_Scene.getCanvas().getHeight(),t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this._m_FrameContext._m_DefaultFrameBuffer),"On"==this._m_FrameContext.getRenderState().getFlag(i.default.S_STATES[3])&&t.disable(t.DEPTH_TEST),this.fire(M.POST_FRAME,[e]),"On"==this._m_FrameContext.getRenderState().getFlag(i.default.S_STATES[3])&&t.enable(t.DEPTH_TEST),a&&(this._checkRenderState(t,this._m_TranslucentRenderState,this._m_FrameContext.getRenderState()),this._m_Pipeline[0].render({gl:t,scene:this._m_Scene,frameContext:this._m_FrameContext,lights:u,opaque:!0,bucket:f})),o){t.bindFramebuffer(t.FRAMEBUFFER,null);var c=this._m_FrameContext.getFrameBuffer(M.DEFAULT_FORWARD_SHADING_FRAMEBUFFER).getFramePicture(),h=c.getMaterial().getCurrentTechnology().getSubPasss(M.FORWARD);c.getMaterial()._selectSubShader(h.getSubShaders()[0].subShader);var d=h.getSubShaders()[0].subShader.getRenderDatas();for(var p in"On"==this._m_FrameContext.getRenderState().getFlag(i.default.S_STATES[3])&&t.disable(t.DEPTH_TEST),d)t.activeTexture(t.TEXTURE0+d[p].loc),t.bindTexture(t.TEXTURE_2D,this._m_FrameContext.getFrameBuffer(d[p].refId).getTexture(d[p].dataId).getLoc());c.draw(this._m_FrameContext),"On"==this._m_FrameContext.getRenderState().getFlag(i.default.S_STATES[3])&&t.enable(t.DEPTH_TEST),this._m_FrameContext.m_LastFrameBuffer=null}}},{key:"useDefaultFrame",value:function(){if(null!=this._m_FrameContext.m_LastFrameBuffer){var e=this._m_Scene.getCanvas().getGLContext();e.bindFramebuffer(e.FRAMEBUFFER,null),this._m_FrameContext.m_LastFrameBuffer=null}}},{key:"setViewPort",value:function(e,t,n,r,_){e.viewport(t,n,r,_)}},{key:"useForcedMat",value:function(e,t,n){var r=t.getCurrentTechnology().getSubPasss(e);if(r){var _=r.getSubShaders(),a=0;for(var i in _){if(a==n){t._selectSubShader(_[i].subShader);var o=_[i].subShader.getRenderDatas(),u=this._m_Scene.getCanvas().getGLContext();for(var s in o)u.activeTexture(u.TEXTURE0+o[s].loc),u.bindTexture(u.TEXTURE_2D,this._m_FrameContext.getFrameBuffer(o[s].refId).getTexture(o[s].dataId).getLoc());break}a++}}}},{key:"draw",value:function(e,t,n,r){var _=null,a=null,i=null;if(n){var o=this._m_FrameContext.m_LastFrameBuffer,u=null;for(var s in n)if(i=(a=this._m_Scene.getComponent(s)).getCurrentTechnology().getSubPasss(t))for(var l in _=i.getSubShaders()){a._selectSubShader(_[l].subShader),null!=_[l].subShader.getFBId()?(u=this._m_FrameContext.getFrameBuffer(_[l].subShader.getFBId()),this._m_FrameContext.m_LastFrameBuffer!=u&&(this._m_FrameContext.m_LastFrameBuffer=u,e.bindFramebuffer(e.FRAMEBUFFER,u.getFrameBuffer()),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT))):this._m_FrameContext.m_LastFrameBuffer!=o&&(e.bindFramebuffer(e.FRAMEBUFFER,o),this._m_FrameContext.m_LastFrameBuffer=o);var f=_[l].subShader.getRenderDatas();for(var m in f)e.activeTexture(e.TEXTURE0+f[m].loc),e.bindTexture(e.TEXTURE_2D,this._m_FrameContext.getFrameBuffer(f[m].refId).getTexture(f[m].dataId).getLoc());_[l].renderState&&this._checkRenderState(e,_[l].renderState,this._m_FrameContext.getRenderState()),this._m_RenderPrograms[_[l].subShader.getRenderProgramType()].drawArrays(e,this._m_Scene,this._m_FrameContext,n[s],r)}this._m_FrameContext.m_LastFrameBuffer!=o&&(e.bindFramebuffer(e.FRAMEBUFFER,o),this._m_FrameContext.m_LastFrameBuffer=o)}}},{key:"_drawEnv",value:function(e,t){if(this._m_Sky){var n=null,r=this._m_Sky.getMaterial(),_=r.getCurrentTechnology().getSubPasss(M.FORWARD);if(_)for(var a in n=_.getSubShaders())n[a].renderState&&this._checkRenderState(e,n[a].renderState,this._m_FrameContext.getRenderState()),r._selectSubShader(n[a].subShader),this._m_RenderPrograms[n[a].subShader.getRenderProgramType()].draw(e,this._m_Scene,this._m_FrameContext,this._m_Sky,t)}}},{key:"enableGammaCorrection",value:function(e){this._m_GammaCorrection=e}},{key:"enableToneMapping",value:function(e){e!=this._m_ToneMapping&&(this._m_ToneMapping=e,this._m_FrameContext.getFrameBuffer(M.DEFAULT_FORWARD_SHADING_FRAMEBUFFER).getFramePicture().getMaterial().setParam("toneMapping",(new R.default).valueOf(this._m_ToneMapping)))}},{key:"setGammaFactor",value:function(e){e!=this._m_GammaFactor&&(this._m_GammaFactor=e,this._m_FrameContext.getFrameBuffer(M.DEFAULT_FORWARD_SHADING_FRAMEBUFFER).getFramePicture().getMaterial().setParam("gammaFactor",(new P.default).valueOf(this._m_GammaFactor)))}},{key:"render",value:function(e){this._drawFrame(e)}},{key:"_sortDrawList",value:function(){}}])&&A(t.prototype,n),r&&A(t,r),M}(a.default);t.default=F,O(F,"FORWARD","Forward"),O(F,"DEFERRED_SHADING","DeferredShading"),O(F,"TILE_DEFERRED_SHADING","TileDeferredShading"),O(F,"DEFAULT_DEFERRED_SHADING_FRAMEBUFFER","DefaultDeferredShadingFrameBuffer"),O(F,"DEFAULT_FORWARD_SHADING_FRAMEBUFFER","DefaultForwardShadingFrameBuffer"),O(F,"DEFAULT_POST_FILTER_SHADING_FRAMEBUFFER","DefaultPostFilterShadingFrameBuffer"),O(F,"PRE_FRAME","preFrame"),O(F,"POST_QUEUE","postQueue"),O(F,"POST_FRAME","postFrame")},9510:(e,t)=>{function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.m_OpaqueBucket={},this.m_TranslucentBucket={}}var t,r,_;return t=e,_=[{key:"sortTranslucentBucket",value:function(t,n){var r=e._TEMP_BUCKET_ARRAY;r.length=0;var _=e._TEMP_ARRAY;_.length=0;var a=t.getEye();return n.forEach((function(e){_.push([e.getLocalTranslation().distanceSq(a),e])})),_.sort((function(e,t){return t[0]-e[0]})),_.forEach((function(e){r.push(e[1])})),r}}],(r=[{key:"addToOpaque",value:function(e){}}])&&n(t.prototype,r),_&&n(t,_),e}();t.default=_,r(_,"_TEMP_BUCKET_ARRAY",[]),r(_,"_TEMP_ARRAY",[])},1550:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=h(n(9650)),a=h(n(5604)),i=h(n(2320)),o=h(n(2475)),u=h(n(9784)),s=h(n(7088)),l=h(n(431)),f=h(n(3846)),m=h(n(3061)),c=h(n(7120));function h(e){return e&&e.__esModule?e:{default:e}}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function S(e,t){return S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},S(e,t)}function p(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=y(e);if(t){var _=y(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return g(this,n)}}function g(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function y(e){return y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},y(e)}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var T=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}(h,e);var t,n,r,_=p(h);function h(e,t){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h),(n=_.call(this,e,t))._m_Eye=new a.default(0,0,10),n._m_At=new a.default(0,0,-10),n._m_Up=new a.default(0,1,0),n._m_Dir=new a.default,n._m_ViewMatrix=new i.default,n._m_ProjectMatrix=new i.default,n._m_ProjectViewMatrix=new i.default,n._m_ViewMatrixUpdate=!1,n._m_ProjectMatrixUpdate=!1,n._m_ProjectViewMatrixUpdate=!1,n._m_ParallelProjection=null!=t.parallelProjection&&t.parallelProjection,n._m_Fovy=t.fovy||45,n._m_FixedAspect=null!=t.aspect&&t.aspect,n._m_IsRenderingCamera=!1,n._m_FrustumPlane=[];for(var r=0;r<6;r++)n._m_FrustumPlane.push(new s.default);n._m_FrustumNear=.1,n._m_FrustumFar=1e3,n._m_FrustumLeft=0,n._m_FrustumRight=0,n._m_FrustumTop=0,n._m_FrustumBottom=0,n._m_CoeffLeft=new Array(2).fill(0),n._m_CoeffRight=new Array(2).fill(0),n._m_CoeffBottom=new Array(2).fill(0),n._m_CoeffTop=new Array(2).fill(0),n._m_FrustumMask=0;var o=n._m_Scene.getCanvas(),u=o.getGLContext();return n._m_Width=t.width||o.getWidth(),n._m_Height=t.height||o.getHeight(),n._m_FixedSize=null!=t.fixedSize&&t.fixedSize,n._m_ViewMatrix.lookAt(n._m_Eye,n._m_At,n._m_Up),n._m_ViewMatrixUpdate=!0,n._m_ProjectMatrixUpdate=!0,n._m_UpdateCameraPosition=!0,u.viewport(0,0,n._m_Width,n._m_Height),n._init(),o.on("resize",(function(){n._m_FixedSize||(n._m_Width=o.getWidth(),n._m_Height=o.getHeight(),n._m_IsRenderingCamera&&u.viewport(0,0,n._m_Width,n._m_Height),n._m_ParallelProjection?n._m_ProjectMatrix.parallelM(n._m_FrustumLeft,n._m_FrustumRight,n._m_FrustumTop,n._m_FrustumBottom,n._m_FrustumNear,n._m_FrustumFar):n._m_ProjectMatrix.perspectiveM(n._m_Fovy,n._m_FixedAspect?n._m_FixedAspect:1*n._m_Width/n._m_Height,n._m_FrustumNear,n._m_FrustumFar),n._m_ProjectMatrixUpdate=!0),n._doUpdate()})),n._m_Filters=[],n._m_Scene.getRender().on(m.default.POST_QUEUE,(function(e){n._m_IsRenderingCamera&&n.demandFilter()&&n._m_Filters.forEach((function(e){e.isEnable()&&e.preFrame()}))})),n._m_Scene.getRender().on(m.default.POST_FRAME,(function(e){n._m_IsRenderingCamera&&n.demandFilter()&&n._m_Filters.forEach((function(e){e.isEnable()&&e.postFilter()}))})),n}return t=h,(n=[{key:"_init",value:function(){if(this._m_ParallelProjection)this._m_FrustumNear=1,this._m_FrustumFar=2,this._m_FrustumLeft=-.5,this._m_FrustumRight=.5,this._m_FrustumTop=.5,this._m_FrustumBottom=-.5,this._m_ProjectMatrix.parallelM(this._m_FrustumLeft,this._m_FrustumRight,this._m_FrustumTop,this._m_FrustumBottom,this._m_FrustumNear,this._m_FrustumFar);else{var e=1*this._m_Width/this._m_Height,t=.1*Math.tan(.5*l.default.toRadians(this._m_Fovy)),n=t*e;f.default.debug("w:"+n+";h:"+t+";as:"+e),this._m_FrustumLeft=-n,this._m_FrustumRight=n,this._m_FrustumBottom=-t,this._m_FrustumTop=t,this._m_FrustumNear=.1,this._m_FrustumFar=1e3,this._m_ProjectMatrix.perspectiveM(this._m_Fovy,this._m_FixedAspect?this._m_FixedAspect:1*this._m_Width/this._m_Height,this._m_FrustumNear,this._m_FrustumFar)}var r=this._m_Scene.getRender().getFrameContext(),_=this._m_Scene.getCanvas().getGLContext();if(r.getContextBlock("MAT"))this.MAT=r.getContextBlock("MAT");else{var a=_.createBuffer();this.MAT=a,_.bindBuffer(_.UNIFORM_BUFFER,a),_.bufferData(_.UNIFORM_BUFFER,192,_.STATIC_DRAW),_.bindBuffer(_.UNIFORM_BUFFER,null),_.bindBufferRange(_.UNIFORM_BUFFER,u.default.BLOCKS.MAT.blockIndex,a,0,192),r.addContextBlock("MAT",this.MAT)}if(r.getContextBlock("VIEW"))this.VIEW=r.getContextBlock("VIEW");else{var i=_.createBuffer();this.VIEW=i,_.bindBuffer(_.UNIFORM_BUFFER,i),_.bufferData(_.UNIFORM_BUFFER,12,_.STATIC_DRAW),_.bindBuffer(_.UNIFORM_BUFFER,null),_.bindBufferRange(_.UNIFORM_BUFFER,u.default.BLOCKS.VIEW.blockIndex,i,0,12),r.addContextBlock("VIEW",this.VIEW)}this._doUpdate()}},{key:"setFrustum",value:function(e,t,n,r,_,a){this._m_FrustumNear=_,this._m_FrustumFar=a,this._m_FrustumLeft=e,this._m_FrustumRight=t,this._m_FrustumTop=n,this._m_FrustumBottom=r,this._m_ProjectMatrix.parallelM(this._m_FrustumLeft,this._m_FrustumRight,this._m_FrustumTop,this._m_FrustumBottom,this._m_FrustumNear,this._m_FrustumFar)}},{key:"setFrustumPerspective",value:function(e,t,n,r){this._m_ParallelProjection=!1,this._m_Fovy=e,this._m_FixedAspect=t;var _=Math.tan(.5*l.default.toRadians(this._m_Fovy))*n,a=_*this._m_FixedAspect;this._m_FrustumLeft=-a,this._m_FrustumRight=a,this._m_FrustumBottom=-_,this._m_FrustumTop=_,this._m_FrustumNear=n,this._m_FrustumFar=r,this._m_ProjectMatrix.perspectiveM(this._m_Fovy,this._m_FixedAspect?this._m_FixedAspect:1*this._m_Width/this._m_Height,this._m_FrustumNear,this._m_FrustumFar)}},{key:"forceUpdateProjection",value:function(){this._m_ParallelProjection?this._m_ProjectMatrix.parallelM(this._m_FrustumLeft,this._m_FrustumRight,this._m_FrustumTop,this._m_FrustumBottom,this._m_FrustumNear,this._m_FrustumFar):this._m_ProjectMatrix.perspectiveM(this._m_Fovy,this._m_FixedAspect?this._m_FixedAspect:1*this._m_Width/this._m_Height,this._m_FrustumNear,this._m_FrustumFar)}},{key:"addFilterFromMaterial",value:function(e){var t=c.default.newFilterFromMaterial(this,e);return this._m_Filters.push(t),t}},{key:"addFilter",value:function(e,t){for(var n=[],r=0,_=Math.min(t,this._m_Filters.length);r<_;r++)n.push(this._m_Filters[r]);n.push(e),r++;for(var a=this._m_Filters.length;r<a;r++)n.push(this._m_Filters[r]);this._m_Filters=n}},{key:"getFilters",value:function(){return this._m_Filters}},{key:"demandFilter",value:function(){return null!=this._m_Filters&&this._m_Filters.length>0}},{key:"getLeft",value:function(){return this._m_FrustumLeft}},{key:"getRight",value:function(){return this._m_FrustumRight}},{key:"getTop",value:function(){return this._m_FrustumTop}},{key:"getBottom",value:function(){return this._m_FrustumBottom}},{key:"getNear",value:function(){return this._m_FrustumNear}},{key:"getFar",value:function(){return this._m_FrustumFar}},{key:"setFar",value:function(e){this._m_FrustumFar=e}},{key:"setIsRenderingCamera",value:function(e){this._m_IsRenderingCamera=e,this._m_UpdateCameraPosition=!0,this._m_ViewMatrixUpdate=!0,this._m_ProjectMatrixUpdate=!0,this._m_ProjectViewMatrixUpdate=!0,e&&this._doUpdate(!0)}},{key:"getFrustumPlane",value:function(e){return this._m_FrustumPlane[e]}},{key:"getFrustumMask",value:function(){return this._m_FrustumMask}},{key:"setFrustumMask",value:function(e){this._m_FrustumMask=e}},{key:"getAt",value:function(){return this._m_At}},{key:"setAt",value:function(e){this._m_At.setTo(e)}},{key:"getEye",value:function(){return this._m_Eye}},{key:"setEye",value:function(e){this._m_Eye.setTo(e)}},{key:"getUp",value:function(){return this._m_Up}},{key:"setUp",value:function(e){this._m_Up.setTo(e)}},{key:"getDir",value:function(){return this._m_Dir}},{key:"lookAt",value:function(e,t,n){this._m_Eye.setTo(e),this._m_At.setTo(t),this._m_At.sub(this._m_Eye,this._m_Dir),this._m_Dir.normal(),n.cross(this._m_Dir,h.S_TEMP_VEC3).normal(),this._m_Dir.cross(h.S_TEMP_VEC3,this._m_Up).normal(),this._m_ViewMatrix.lookAt(this._m_Eye,this._m_At,this._m_Up),this._m_ViewMatrixUpdate=!0,this._doUpdate()}},{key:"isParallelProjection",value:function(){return this._m_ParallelProjection}},{key:"_updateFrustum",value:function(){if(this._m_ParallelProjection)this._m_CoeffLeft[0]=1,this._m_CoeffLeft[1]=0,this._m_CoeffRight[0]=-1,this._m_CoeffRight[1]=0,this._m_CoeffBottom[0]=1,this._m_CoeffBottom[1]=0,this._m_CoeffTop[0]=-1,this._m_CoeffTop[1]=0;else{var e=this._m_FrustumNear*this._m_FrustumNear,t=this._m_FrustumLeft*this._m_FrustumLeft,n=this._m_FrustumRight*this._m_FrustumRight,r=this._m_FrustumBottom*this._m_FrustumBottom,_=this._m_FrustumTop*this._m_FrustumTop,a=1/Math.sqrt(e+t);this._m_CoeffLeft[0]=-this._m_FrustumNear*a,this._m_CoeffLeft[1]=-this._m_FrustumLeft*a,a=1/Math.sqrt(e+n),this._m_CoeffRight[0]=this._m_FrustumNear*a,this._m_CoeffRight[1]=this._m_FrustumRight*a,a=1/Math.sqrt(e+r),this._m_CoeffBottom[0]=this._m_FrustumNear*a,this._m_CoeffBottom[1]=-this._m_FrustumBottom*a,a=1/Math.sqrt(e+_),this._m_CoeffTop[0]=-this._m_FrustumNear*a,this._m_CoeffTop[1]=this._m_FrustumTop*a}h.S_TEMP_VEC3.setToInXYZ(-this._m_ViewMatrix.m[0],-this._m_ViewMatrix.m[4],-this._m_ViewMatrix.m[8]),h.S_TEMP_VEC3_2.setToInXYZ(this._m_ViewMatrix.m[1],this._m_ViewMatrix.m[5],this._m_ViewMatrix.m[9]),h.S_TEMP_VEC3_3.setTo(this._m_Dir);var i=h.S_TEMP_VEC3_3.dot(this._m_Eye),o=this._m_FrustumPlane[h.S_LEFT_PLANE].getNormal();o._m_X=h.S_TEMP_VEC3._m_X*this._m_CoeffLeft[0],o._m_Y=h.S_TEMP_VEC3._m_Y*this._m_CoeffLeft[0],o._m_Z=h.S_TEMP_VEC3._m_Z*this._m_CoeffLeft[0],o.addInXYZ(h.S_TEMP_VEC3_3._m_X*this._m_CoeffLeft[1],h.S_TEMP_VEC3_3._m_Y*this._m_CoeffLeft[1],h.S_TEMP_VEC3_3._m_Z*this._m_CoeffLeft[1]),this._m_FrustumPlane[h.S_LEFT_PLANE].setD(this._m_Eye.dot(o));var u=this._m_FrustumPlane[h.S_RIGHT_PLANE].getNormal();u._m_X=h.S_TEMP_VEC3._m_X*this._m_CoeffRight[0],u._m_Y=h.S_TEMP_VEC3._m_Y*this._m_CoeffRight[0],u._m_Z=h.S_TEMP_VEC3._m_Z*this._m_CoeffRight[0],u.addInXYZ(h.S_TEMP_VEC3_3._m_X*this._m_CoeffRight[1],h.S_TEMP_VEC3_3._m_Y*this._m_CoeffRight[1],h.S_TEMP_VEC3_3._m_Z*this._m_CoeffRight[1]),this._m_FrustumPlane[h.S_RIGHT_PLANE].setD(this._m_Eye.dot(u));var s=this._m_FrustumPlane[h.S_BOTTOM_PLANE].getNormal();s._m_X=h.S_TEMP_VEC3_2._m_X*this._m_CoeffBottom[0],s._m_Y=h.S_TEMP_VEC3_2._m_Y*this._m_CoeffBottom[0],s._m_Z=h.S_TEMP_VEC3_2._m_Z*this._m_CoeffBottom[0],s.addInXYZ(h.S_TEMP_VEC3_3._m_X*this._m_CoeffBottom[1],h.S_TEMP_VEC3_3._m_Y*this._m_CoeffBottom[1],h.S_TEMP_VEC3_3._m_Z*this._m_CoeffBottom[1]),this._m_FrustumPlane[h.S_BOTTOM_PLANE].setD(this._m_Eye.dot(s));var l=this._m_FrustumPlane[h.S_TOP_PLANE].getNormal();l._m_X=h.S_TEMP_VEC3_2._m_X*this._m_CoeffTop[0],l._m_Y=h.S_TEMP_VEC3_2._m_Y*this._m_CoeffTop[0],l._m_Z=h.S_TEMP_VEC3_2._m_Z*this._m_CoeffTop[0],l.addInXYZ(h.S_TEMP_VEC3_3._m_X*this._m_CoeffTop[1],h.S_TEMP_VEC3_3._m_Y*this._m_CoeffTop[1],h.S_TEMP_VEC3_3._m_Z*this._m_CoeffTop[1]),this._m_FrustumPlane[h.S_TOP_PLANE].setD(this._m_Eye.dot(l)),this._m_ParallelProjection&&(this._m_FrustumPlane[h.S_LEFT_PLANE].setD(this._m_FrustumPlane[h.S_LEFT_PLANE].getD()+this._m_FrustumLeft),this._m_FrustumPlane[h.S_RIGHT_PLANE].setD(this._m_FrustumPlane[h.S_RIGHT_PLANE].getD()-this._m_FrustumRight),this._m_FrustumPlane[h.S_TOP_PLANE].setD(this._m_FrustumPlane[h.S_TOP_PLANE].getD()-this._m_FrustumTop),this._m_FrustumPlane[h.S_BOTTOM_PLANE].setD(this._m_FrustumPlane[h.S_BOTTOM_PLANE].getD()+this._m_FrustumBottom)),this._m_FrustumPlane[h.S_FAR_PLANE].setNormaXYZ(-h.S_TEMP_VEC3_3._m_X,-h.S_TEMP_VEC3_3._m_Y,-h.S_TEMP_VEC3_3._m_Z),this._m_FrustumPlane[h.S_FAR_PLANE].setD(-(i+this._m_FrustumFar)),this._m_FrustumPlane[h.S_NEAR_PLANE].setNormaXYZ(h.S_TEMP_VEC3_3._m_X,h.S_TEMP_VEC3_3._m_Y,h.S_TEMP_VEC3_3._m_Z),this._m_FrustumPlane[h.S_NEAR_PLANE].setD(i+this._m_FrustumNear)}},{key:"_update",value:function(){var e=this._m_Scene.getCanvas().getGLContext();e.bindBuffer(e.UNIFORM_BUFFER,this.MAT);var t=this._m_Scene.getRender().getFrameContext();this._m_ViewMatrixUpdate&&(this._m_UpdateCameraPosition=!0,this._m_ProjectViewMatrixUpdate=!0,(t.getContext(u.default.S_VIEW_MATRIX_SRC)||t.getContext(u.default.S_VP_SRC)||t.getContext(u.default.S_MVP_SRC))&&(this._m_IsRenderingCamera&&(e.bufferSubData(e.UNIFORM_BUFFER,0,this._m_ViewMatrix.getBufferData()),t.setCalcContext(u.default.S_VIEW_MATRIX_SRC,this._m_ViewMatrix)),this._m_ViewMatrixUpdate=!1)),this._m_ProjectMatrixUpdate&&(this._m_ProjectViewMatrixUpdate=!0,(t.getContext(u.default.S_PROJECT_MATRIX_SRC)||t.getContext(u.default.S_VP_SRC)||t.getContext(u.default.S_MVP_SRC))&&(this._m_IsRenderingCamera&&(e.bufferSubData(e.UNIFORM_BUFFER,64,this._m_ProjectMatrix.getBufferData()),t.setCalcContext(u.default.S_PROJECT_MATRIX_SRC,this._m_ProjectMatrix)),this._m_ProjectMatrixUpdate=!1)),this._m_ProjectViewMatrixUpdate&&t.getContext(u.default.S_VP_SRC)&&(i.default.multiplyMM(this._m_ProjectViewMatrix,0,this._m_ProjectMatrix,0,this._m_ViewMatrix,0),this._m_IsRenderingCamera&&(e.bufferSubData(e.UNIFORM_BUFFER,128,this._m_ProjectViewMatrix.getBufferData()),t.setCalcContext(u.default.S_VP_SRC,this._m_ProjectViewMatrix)),this._m_ProjectViewMatrixUpdate=!1),e.bindBuffer(e.UNIFORM_BUFFER,null),this._m_UpdateCameraPosition&&t.getContext(u.default.S_CAMERA_POSITION_SRC)&&(this._m_IsRenderingCamera&&(e.bindBuffer(e.UNIFORM_BUFFER,this.VIEW),e.bufferSubData(e.UNIFORM_BUFFER,0,this._m_Eye.getBufferData()),e.bindBuffer(e.UNIFORM_BUFFER,null)),this._m_UpdateCameraPosition=!1),(this._m_ViewMatrixUpdate||this._m_ProjectMatrixUpdate||this._m_ProjectViewMatrixUpdate)&&this._doUpdate(),this._updateFrustum(),this.fire(h.S_CAMERA_UPDATE_EVENT,[this._m_ViewMatrix,this._m_ProjectMatrix,this._m_ProjectViewMatrix])}},{key:"setViewMatrix",value:function(e){this._m_ViewMatrix.set(e);var t=this._m_ViewMatrix.inertRetNew(o.default.S_TEMP_MAT4);t&&(this._m_Eye.setToInXYZ(t.m[12],t.m[13],t.m[14]),this._m_Up.setToInXYZ(t.m[4],t.m[5],t.m[6]),o.default.S_TEMP_VEC3.setToInXYZ(-t.m[8],-t.m[9],-t.m[10]),o.default.S_TEMP_VEC3.add(this._m_Eye,this._m_At),this._m_At.sub(this._m_Eye,this._m_Dir),this._m_Dir.normal()),this._m_ViewMatrixUpdate=!0,this._doUpdate()}},{key:"getViewMatrix",value:function(){return this._m_ViewMatrix}},{key:"getProjectViewMatrix",value:function(e){return e&&i.default.multiplyMM(this._m_ProjectViewMatrix,0,this._m_ProjectMatrix,0,this._m_ViewMatrix,0),this._m_ProjectViewMatrix}},{key:"setProjectMatrix",value:function(e){this._m_ProjectMatrix.set(e),this._m_ProjectMatrixUpdate=!0,this._doUpdate()}},{key:"getHeight",value:function(){return this._m_Height}},{key:"getWidth",value:function(){return this._m_Width}},{key:"scroll",value:function(e){this._m_ProjectMatrix.perspectiveM(e,1*this._m_Width/this._m_Height,this._m_FrustumNear,this._m_FrustumFar),this._m_ProjectMatrixUpdate=!0,this._doUpdate()}},{key:"getProjectMatrix",value:function(){return this._m_ProjectMatrix}},{key:"frustumContains",value:function(e){if(e){for(var t=0,n=0,r=0,_=h.S_FRUSTUM_INTERSECT_INSIDE,a=6;a>=0;a--)if(a!=e.getPriorityPlane()&&(t=1<<(n=6==a?e.getPriorityPlane():a),0==(this._m_FrustumMask&t))){if((r=e.whichSide(this._m_FrustumPlane[n]))==s.default.S_SIDE_NEGATIVE)return e.setPriorityPlane(n),h.S_FRUSTUM_INTERSECT_OUTSIDE;r==s.default.S_SIDE_POSITIVE?this._m_FrustumMask|=t:_=h.S_FRUSTUM_INTERSECT_INTERSECTS}return _}return h.S_FRUSTUM_INTERSECT_INSIDE}},{key:"getWorldCoordinates",value:function(e,t,n,r){r||(r=new a.default),n?(i.default.multiplyMM(this._m_ProjectViewMatrix,0,this._m_ProjectMatrix,0,this._m_ViewMatrix,0),h.S_TEMP_MAT4.set(this._m_ProjectViewMatrix)):h.S_TEMP_MAT4.set(this._m_ProjectMatrix),h.S_TEMP_MAT4.inert();var _=this.getWidth(),o=this.getHeight();h.S_TEMP_VEC3.setToInXYZ((e._m_X/_-0)/1*2-1,(e._m_Y/o-0)/1*2-1,2*t-1);var u=i.default.multiplyMV3(r,h.S_TEMP_VEC3,h.S_TEMP_MAT4);return r.multLength(1/u),r}}])&&d(t.prototype,n),r&&d(t,r),h}(_.default);t.default=T,v(T,"S_TEMP_MAT4",new i.default),v(T,"S_TEMP_VEC3",new a.default),v(T,"S_TEMP_VEC3_2",new a.default),v(T,"S_TEMP_VEC3_3",new a.default),v(T,"S_TEMP_VEC3_4",new a.default),v(T,"S_CAMERA_UPDATE_EVENT","camera_update_event"),v(T,"S_FRUSTUM_INTERSECT_INTERSECTS",0),v(T,"S_FRUSTUM_INTERSECT_INSIDE",1),v(T,"S_FRUSTUM_INTERSECT_OUTSIDE",2),v(T,"S_LEFT_PLANE",0),v(T,"S_RIGHT_PLANE",1),v(T,"S_BOTTOM_PLANE",2),v(T,"S_TOP_PLANE",3),v(T,"S_FAR_PLANE",4),v(T,"S_NEAR_PLANE",5)},4939:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=h(n(9650)),a=h(n(3061)),i=h(n(5109)),o=h(n(1550)),u=h(n(5489)),s=h(n(513)),l=h(n(2949)),f=h(n(7280)),m=h(n(2815)),c=h(n(5604));function h(e){return e&&e.__esModule?e:{default:e}}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function S(e,t){return S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},S(e,t)}function p(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v(e);if(t){var _=v(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return g(this,n)}}function g(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return y(e)}function y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function v(e){return v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},v(e)}var T=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}(g,e);var t,n,r,h=p(g);function g(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,g),(t=h.call(this,null,e))._m_TaskQueue=new u.default,t._m_Canvas=new i.default(y(t),{id:"default_canvas",canvas:e.cavnas}),t._m_Render=new a.default(y(t),{id:"default_render"}),t._m_MainCamera=new o.default(y(t),{id:"mainCamera"}),t._m_FrustumCullingCamera=t._m_MainCamera,t._m_MainCamera.setIsRenderingCamera(!0),t._m_Nodes=[],t._m_NodeIds={},t._m_Lights=[],t._m_AmbientLightColor=new c.default(1,1,1),t._m_EnableLights=[],t._m_VisLights=[],t._m_LightIds={},t._m_EnableLightIds={},t._m_GIProbes=[],t._m_GIProbeIds={},t._m_RefProbes=[],t._m_RefProbeIds={},t._m_Render.startUp(),t}return t=g,n=[{key:"getType",value:function(){return"Scene"}},{key:"AmbientLightColor",get:function(){return this._m_AmbientLightColor}},{key:"setAmbientLightColor",value:function(e,t,n){this._m_AmbientLightColor.setToInXYZ(e,t,n)}},{key:"getLights",value:function(){return this._m_Lights}},{key:"getEnableLights",value:function(){return this._m_EnableLights}},{key:"enableLight",value:function(e){this._m_EnableLightIds[e.getId()]||(this._m_EnableLightIds[e.getId()]=e,e.enable(),this._m_EnableLights.push(e))}},{key:"disableLight",value:function(e){if(this._m_EnableLightIds[e.getId()]){this._m_EnableLightIds[e.getId()]=null,e.disable();var t=this._m_EnableLights.indexOf(e);t>-1&&this._m_EnableLights.splice(t,1)}}},{key:"getVisLights",value:function(){return this._m_VisLights}},{key:"getLight",value:function(e){return this._m_LightIds[e]}},{key:"getGIProbes",value:function(){return this._m_GIProbes}},{key:"enableGIProbes",value:function(){return this._m_GIProbes.length>0&&this._m_GIProbes[0].isEnable()}},{key:"getGIProbe",value:function(e){return this._m_GIProbeIds[e]}},{key:"scheduleTask",value:function(e,t){this._m_TaskQueue.push(e),this._m_TaskQueue.push(t)}},{key:"runTasks",value:function(){for(var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,r=n>0?(new Date).getTime():0,_=0,a=this._m_TaskQueue.length;a>0&&(n<0||r<n);)e=this._m_TaskQueue.shift(),a-=2,(t=this._m_TaskQueue.shift())?e.call(t):e(),n>0&&(r=(new Date).getTime()),_++;return _}},{key:"getMainCamera",value:function(){return this._m_MainCamera}},{key:"setMainCamera",value:function(e){this._m_MainCamera!=e&&this._m_MainCamera&&this._m_MainCamera.setIsRenderingCamera(!1),this._m_MainCamera=e,this._m_MainCamera.setIsRenderingCamera(!0)}},{key:"setFrustumCullingCamera",value:function(e){this._m_FrustumCullingCamera=e}},{key:"getFrustumCullingCamera",value:function(){return this._m_FrustumCullingCamera}},{key:"getRender",value:function(){return this._m_Render}},{key:"getCanvas",value:function(){return this._m_Canvas}},{key:"setSky",value:function(e){null!=e&&"SkyBox"!=e.getType()||this._m_Render.setSky(e)}},{key:"getSky",value:function(){return this._m_Render.getSky()}},{key:"addSceneNode",value:function(e){e instanceof l.default&&!(e instanceof f.default)&&(this._m_NodeIds[e.getId()]||(this._m_Nodes.push(e),this._m_NodeIds[e.getId()]=e))}},{key:"getSceneNode",value:function(e){return this._m_Nodes[e]}},{key:"getSceneNodes",value:function(){return this._m_Nodes}},{key:"addComponentInScene",value:function(e){e instanceof _.default?this._m_ComponentIDs[e.getId()]?console.warn("组件[["+e.getId()+"]]已存在!!"):("Scene"!=e.getType()&&(this._m_ComponentIDs[e.getId()]=e,this._m_Components.push(e)),e.isDrawable&&e.isDrawable()&&this._m_Render.addDrawable(e),e instanceof s.default&&(e instanceof m.default?this._m_GIProbeIds[e.getId()]||(this._m_GIProbes.push(e),this._m_GIProbeIds[e.getId()]=e):this._m_LightIds[e.getId()]||(this._m_Lights.push(e),this._m_LightIds[e.getId()]=e))):console.error("component必须是一个Component对象!!")}},{key:"removeComponentInScene",value:function(e){e instanceof _.default&&this._m_ComponentIDs[e.getId()]&&(this._m_ComponentIDs[e.getId()]=null,this._m_Components.remove(e),e.isDrawable&&e.isDrawable()&&this._m_Render.removeDrawable(e))}},{key:"_gatherVisDrawable",value:function(e,t){var n=this;e.isDrawable&&e.isDrawable()?t.push(e):e.getChildren().length>0&&e.getChildren().forEach((function(e){n._gatherVisDrawable(e,t)}))}},{key:"_frustumCulling",value:function(e,t){var n=this;if(e.inFrustum(this._m_FrustumCullingCamera))if(e.isDrawable&&e.isDrawable())t.push(e);else if(e.getChildren().length>0){var r=this._m_FrustumCullingCamera.getFrustumMask();e.getChildren().forEach((function(e){e instanceof s.default||(e.getFilterFlag()==l.default.S_DYNAMIC?e.getCullingFlags()&l.default.S_DEFAULT_FRUSTUM_CULLING&&(n._m_FrustumCullingCamera.setFrustumMask(r),n._frustumCulling(e,t)):e.getFilterFlag()==l.default.S_NEVER&&n._gatherVisDrawable(e,t))}))}}},{key:"update",value:function(e){this.runTasks(),this.fire("update",[e])}},{key:"render",value:function(e){var t=this,n=this._m_Render.getVisDrawables();if(n.length=0,this.fire("render",[e]),this._m_Nodes.forEach((function(e){e.getFilterFlag()==l.default.S_DYNAMIC?e.getCullingFlags()&l.default.S_DEFAULT_FRUSTUM_CULLING&&(t._m_FrustumCullingCamera.setFrustumMask(0),t._frustumCulling(e,n)):e.getFilterFlag()==l.default.S_NEVER&&t._gatherVisDrawable(e,n)})),this._m_VisLights.length=0,this._m_EnableLights.length>0){var r=this._m_FrustumCullingCamera.getFrustumMask();this._m_FrustumCullingCamera.setFrustumMask(0),this._m_EnableLights.forEach((function(e){"GIProbe"!=e.getType()&&"RefProbe"!=e.getType()&&(e._m_Mark^=s.default.S_VISIBLE_LIGHT,e.getFilterFlag()==l.default.S_DYNAMIC?e.inFrustum(t._m_FrustumCullingCamera)&&(e._m_Mark|=s.default.S_VISIBLE_LIGHT,t._m_VisLights.push(e)):e.getFilterFlag()==l.default.S_NEVER&&(e._m_Mark|=s.default.S_VISIBLE_LIGHT,t._m_VisLights.push(e)))})),this._m_FrustumCullingCamera.setFrustumMask(r)}this._m_Render.render(e)}}],n&&d(t.prototype,n),r&&d(t,r),g}(_.default);t.default=T},5602:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=T(n(9650)),a=T(n(513)),i=T(n(8435)),o=T(n(3061)),u=T(n(2320)),s=T(n(7341)),l=(T(n(9784)),T(n(4008))),f=T(n(5397)),m=T(n(8113)),c=T(n(3370)),h=T(n(7280)),d=T(n(1359)),S=T(n(1491)),p=T(n(5776)),g=T(n(9271)),y=T(n(1759)),v=T(n(4690));function T(e){return e&&e.__esModule?e:{default:e}}function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function b(e,t){return b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},b(e,t)}function C(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=M(e);if(t){var _=M(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return P(this,n)}}function P(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return R(e)}function R(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function M(e){return M=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},M(e)}function A(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var w=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}(T,e);var t,n,r,_=C(T);function T(e,t){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,T),A(R(n=_.call(this,e,t)),"_m_ShadowSplitType",T.S_QUADRATIC_SCALING),A(R(n),"_m_MainCamera",void 0),A(R(n),"_m_PreShadowMat",void 0),A(R(n),"_m_PostShadowMat",void 0),A(R(n),"_m_NbShadowMaps",1),A(R(n),"_m_Light",void 0),A(R(n),"_m_SkipPass",void 0),A(R(n),"_m_ShadowGeometryCasts",[]),A(R(n),"_m_ShadowGeometryReceivers",[]),A(R(n),"_m_FadeInfo",null),A(R(n),"_m_ZFarOverride",0),A(R(n),"_m_FadeLength",0),A(R(n),"_m_BackfaceShadows",!1),A(R(n),"_m_PCFEdge",1),A(R(n),"_m_ShadowIntensity",.7),A(R(n),"_m_ResolutionInverse",new g.default),A(R(n),"_m_ShadowMapSizeInverse",new g.default),A(R(n),"_m_LVPM",[]),A(R(n),"_m_ShadowFB",[]),A(R(n),"_m_ShadowMapSize",512),A(R(n),"_m_ShadowMapSizes",[]),A(R(n),"_m_BiasFactor",1),A(R(n),"_m_BiasUnits",1),A(R(n),"_m_ShadowRenderState",new i.default),A(R(n),"_m_ShadowRenderState2",new i.default),A(R(n),"_m_UploadShadowMaps",[]),A(R(n),"_m_UploadLightViews",[]),A(R(n),"_m_Enable",!0),A(R(n),"_m_DebugShadowMap",[]),A(R(n),"_m_Debug",!1),n._m_NbShadowMaps=t.nbShadowMaps,n._m_ShadowMapSize=t.shadowMapSize,n._m_Debug=null!=t.debug&&t.debug,n._m_BackfaceShadows=null!=t.backfaceShadows&&t.backfaceShadows,n._m_ShadowSplitType=t.shadowSplitType||n._m_ShadowSplitType;for(var r=n._m_Scene.getCanvas().getGLContext(),a=n._m_ShadowMapSize,o=Math.min(1/n._m_NbShadowMaps,.25),v=0;v<n._m_NbShadowMaps;v++)if(n._m_LVPM[v]=new u.default,n._m_ShadowSplitType==T.S_QUADRATIC_SCALING?(n._m_ShadowFB[v]=new s.default(r,"ShadowFB_"+v,a,a),n._m_ShadowMapSizes[v]=a,a/=2,a=Math.max(a,128)):n._m_ShadowSplitType==T.S_FIXED?n._m_ShadowFB[v]=new s.default(r,"ShadowFB_"+v,n._m_ShadowMapSize,n._m_ShadowMapSize):Log.error("错误的阴影类型!"),n._m_ShadowFB[v].setFixedSize(!0),n._m_Debug&&n._m_ShadowFB[v].addTexture(r,"ShadowFBDefaultColor",r.RGBA,0,r.RGBA,r.UNSIGNED_BYTE,r.COLOR_ATTACHMENT0,!1),n._m_ShadowFB[v].addTexture(r,T.S_SHADOW_MAP_ARRAY_SRC[v],r.DEPTH_COMPONENT16,0,r.DEPTH_COMPONENT,r.UNSIGNED_SHORT,r.DEPTH_ATTACHMENT,!1),n._m_ShadowFB[v].finish(r,n._m_Scene,!1),n._m_UploadShadowMaps[v]=T.S_SHADOW_MAP_ARRAY_SRC[v],n._m_UploadLightViews[v]=T.S_LIGHT_SHADOW_VP_ARRAY_SRC[v],n._m_Debug){n._m_DebugShadowMap[v]=new h.default(n._m_Scene,{id:"debug_shadow_map_"+v}),n._m_DebugShadowMap[v].setSize(o,.3),n._m_DebugShadowMap[v].setLeftTop(2.01*o*v-(1-o),-.7),n._m_DebugShadowMap[v].useDefaultMat();var E=new d.default(n._m_Scene);E.setTextureFormat(d.default.S_TEXTURE_FORMAT.S_RGBA,d.default.S_TEXTURE_FORMAT.S_RGBA,d.default.S_TEXTURE_FORMAT.S_UNSIGNED_BYTE),E.target(n._m_ShadowFB[v]),n._m_DebugShadowMap[v].getMaterial().setParam("colorMap",E),n._m_DebugShadowMap[v].setZIndex(0)}n._m_ShadowRenderState.setFlag(i.default.S_STATES[0],i.default.S_FACE_CULL_FRONT),n._m_Debug||n._m_ShadowRenderState.setFlag(i.default.S_STATES[2],"Off"),n._m_ShadowRenderState.setFlag(i.default.S_STATES[7],"On"),n._m_ShadowRenderState.setFlag(i.default.S_STATES[8],[n._m_BiasFactor,n._m_BiasUnits]),n._m_ShadowRenderState2.setFlag(i.default.S_STATES[1],"Off"),n._m_PreShadowMat=new l.default(n._m_Scene,{id:"preShadowMat_"+f.default.nextId(),materialDef:m.default.parse(c.default.S_PRE_SHADOW_DEF_DATA)}),n._m_Debug&&n._m_PreShadowMat.setParam("debug",(new S.default).valueOf(!0)),n._m_PostShadowMat=new l.default(n._m_Scene,{id:"postShadowMat_"+f.default.nextId(),materialDef:m.default.parse(c.default.S_POST_SHADOW_DEF_DATA)}),n._m_PostShadowMat.setParam("pcfEdge",(new y.default).valueOf(n._m_PCFEdge)),n._m_PostShadowMat.setParam("shadowIntensity",(new y.default).valueOf(n._m_ShadowIntensity)),n._m_ShadowMapSizeInverse.setToInXY(1/n._m_ShadowMapSize,1/n._m_ShadowMapSize);var b=n._m_Scene.getCanvas().getWidth(),C=n._m_Scene.getCanvas().getHeight();return n._m_ResolutionInverse.setToInXY(1/b,1/C),n._m_PostShadowMat.setParam("backfaceShadows",(new S.default).valueOf(n._m_BackfaceShadows)),n._m_Scene.getCanvas().on("resize",(function(e,t){n._m_ResolutionInverse.setToInXY(1/e,1/t)})),n.initMat(),n._m_FramePicture=new p.default(n._m_Scene,{id:n._m_Id+"_picture"}),n._m_Scene.getMainCamera().addFilter(R(n),0),n}return t=T,(n=[{key:"isEnable",value:function(){return this._m_Enable}},{key:"enable",value:function(e){this._m_Enable=e}},{key:"initMat",value:function(){}},{key:"setBackfaceShadows",value:function(e){this._m_BackfaceShadows!=e&&(this._m_BackfaceShadows=e,this._m_PostShadowMat.setParam("backfaceShadows",(new S.default).valueOf(this._m_BackfaceShadows)))}},{key:"isBackfaceShadows",value:function(){return this._m_BackfaceShadows}},{key:"setBias",value:function(e,t){this._m_BiasFactor=e,this._m_BiasUnits=t,this._m_ShadowRenderState.setFlag(i.default.S_STATES[8],[this._m_BiasFactor,this._m_BiasUnits])}},{key:"getBiasFactor",value:function(){return this._m_BiasFactor}},{key:"getBiasUnits",value:function(){return this._m_BiasUnits}},{key:"setFade",value:function(e,t){this._m_FadeInfo||(this._m_FadeInfo=new v.default);var n=this._m_FadeInfo.valueFromXY(e,t);this._m_PostShadowMat.setParam("fadeInfo",n)}},{key:"setFadeExtend",value:function(e){this._m_ZFarOverride!=e&&(this._m_ZFarOverride=e),0==this._m_ZFarOverride?this._m_FadeInfo&&this.setFade(0,0):this.setFade(this._m_ZFarOverride-this._m_FadeLength,1/this._m_FadeLength)}},{key:"getFadeExtend",value:function(){return this._m_ZFarOverride}},{key:"setFadeLength",value:function(e){this._m_FadeLength!=e&&(this._m_FadeLength=e),0==this._m_ZFarOverride?this._m_FadeInfo&&this.setFade(0,0):this.setFade(this._m_ZFarOverride-this._m_FadeLength,1/this._m_FadeLength)}},{key:"getFadeLength",value:function(){return this._m_FadeLength}},{key:"setPCFEdge",value:function(e){this._m_PCFEdge!=e&&(this._m_PCFEdge=e,this._m_PostShadowMat.setParam("pcfEdge",(new y.default).valueOf(this._m_PCFEdge)))}},{key:"getPCFEdge",value:function(){return this._m_PCFEdge}},{key:"setShadowIntensity",value:function(e){this._m_ShadowIntensity!=e&&(this._m_ShadowIntensity=e,this._m_PostShadowMat.setParam("shadowIntensity",(new y.default).valueOf(this._m_ShadowIntensity)))}},{key:"getShadowIntensity",value:function(){return this._m_ShadowIntensity}},{key:"setLight",value:function(e){this._m_Light=e}},{key:"getLight",value:function(){return this._m_Light}},{key:"updateShadowCams",value:function(){}},{key:"visLight",value:function(){return 0!=(this._m_Light._m_Mark&a.default.S_VISIBLE_LIGHT)}},{key:"generateShadowMap",value:function(e,t,n,r){this._m_ShadowGeometryCasts.length=0,this._m_ShadowGeometryCasts=this.getShadowGeometryCasts(r,this._m_ShadowGeometryCasts);var _=this.getShadowCam(r);this._m_LVPM[r].set(_.getProjectViewMatrix(!0)),this._m_Scene.setMainCamera(_),this._m_ShadowFB[r].use(t),this._m_ShadowFB[r].clear(e),this._m_ShadowGeometryCasts.forEach((function(e){e.draw(n)}))}},{key:"getShadowGeometryCasts",value:function(e,t){return t}},{key:"getShadowGeometryReceivers",value:function(e){return e}},{key:"getShadowCam",value:function(e){}},{key:"_uploadInfo",value:function(e,t){for(var n=t.m_LastSubShader.getContextVars(),r=null,_=0;_<this._m_NbShadowMaps;_++)null!=(r=n[T.S_SHADOW_MAP_ARRAY_SRC[_]])&&(e.activeTexture(e.TEXTURE0+r.loc),e.bindTexture(e.TEXTURE_2D,this._m_ShadowFB[_].getTexture(T.S_SHADOW_MAP_ARRAY_SRC[_]).getLoc())),null!=(r=n[T.S_LIGHT_SHADOW_VP_ARRAY_SRC[_]])&&e[r.fun](r.loc,!1,this._m_LVPM[_].getBufferData());this._m_BackfaceShadows||null!=(r=n[T.S_RESOLUTION_INVERSE])&&e.uniform2f(r.loc,this._m_ResolutionInverse._m_X,this._m_ResolutionInverse._m_Y),null!=(r=n[T.S_SHADOW_MAP_SIZE])&&e.uniform1f(r.loc,this._m_ShadowMapSize),null!=(r=n[T.S_SHADOW_MAP_SIZE_INVERSE])&&e.uniform2f(r.loc,this._m_ShadowMapSizeInverse._m_X,this._m_ShadowMapSizeInverse._m_Y)}},{key:"preFrame",value:function(){if(this._m_ShadowGeometryReceivers.length=0,this._m_SkipPass=!this.visLight(),!this._m_SkipPass){this.updateShadowCams();var e=this._m_Scene.getRender();this._m_MainCamera=this._m_Scene.getMainCamera();var t=e.getFrameContext(),n=this._m_Scene.getCanvas().getGLContext();t.getRenderState().store(),this._m_ShadowSplitType==T.S_FIXED&&e.setViewPort(n,0,0,this._m_ShadowMapSize,this._m_ShadowMapSize),e._checkRenderState(n,this._m_ShadowRenderState,t.getRenderState()),e.useForcedMat("PreFrame",this._m_PreShadowMat,0);for(var r=0;r<this._m_NbShadowMaps;r++)this._m_ShadowSplitType==T.S_QUADRATIC_SCALING&&e.setViewPort(n,0,0,this._m_ShadowMapSizes[r],this._m_ShadowMapSizes[r]),this.generateShadowMap(n,e,t,r);this._m_Scene.setMainCamera(this._m_MainCamera),this._m_Scene.getRender().useDefaultFrame(),e.setViewPort(n,0,0,this._m_Scene.getCanvas().getWidth(),this._m_Scene.getCanvas().getHeight()),e._checkRenderState(n,t.getRenderState().restore(),t.getRenderState())}}},{key:"postFilter",value:function(){if(!this._m_SkipPass){var e=this._m_Scene.getRender(),t=e.getFrameContext(),n=this._m_Scene.getCanvas().getGLContext();if(t.getRenderState().store(),e._checkRenderState(n,this._m_ShadowRenderState2,t.getRenderState()),e.useForcedMat("PostFilter",this._m_PostShadowMat,0),this._uploadInfo(n,t),this._m_FramePicture.draw(t),this._m_Debug)for(var r=0;r<this._m_NbShadowMaps;r++)e.useForcedMat(o.default.FORWARD,this._m_DebugShadowMap[r].getMaterial(),0),this._m_DebugShadowMap[r].draw(t);e._checkRenderState(n,t.getRenderState().restore(),t.getRenderState())}}}])&&E(t.prototype,n),r&&E(t,r),T}(_.default);t.default=w,A(w,"S_QUADRATIC_SCALING",1),A(w,"S_FIXED",2),A(w,"S_SHADOW_MAP_ARRAY_SRC",{0:"_shadowMap0",1:"_shadowMap1",2:"_shadowMap2",3:"_shadowMap3",4:"_shadowMap4",5:"_shadowMap5",6:"_shadowMap6"}),A(w,"S_LIGHT_SHADOW_VP_ARRAY_SRC",{0:"_lightViewProjectMatrix0",1:"_lightViewProjectMatrix1",2:"_lightViewProjectMatrix2",3:"_lightViewProjectMatrix3",4:"_lightViewProjectMatrix4",5:"_lightViewProjectMatrix5",6:"_lightViewProjectMatrix6"}),A(w,"S_LIGHT_DIR","_lightDir"),A(w,"S_LIGHT_POS","_lightPos"),A(w,"S_SPLITS","_splits"),A(w,"S_FADEINFO","_fadeInfo"),A(w,"S_RESOLUTION_INVERSE","_ResolutionInverse"),A(w,"S_SHADOW_MAP_SIZE","_shadowMapSize"),A(w,"S_SHADOW_MAP_SIZE_INVERSE","_sMapSizeInverse")},6177:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=c(n(5602)),a=c(n(3846)),i=c(n(1550)),o=c(n(5397)),u=c(n(5604)),s=c(n(1266)),l=c(n(7141)),f=c(n(2949)),m=c(n(9784));function c(e){return e&&e.__esModule?e:{default:e}}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t,n){return d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=v(e)););return e}(e,t);if(r){var _=Object.getOwnPropertyDescriptor(r,t);return _.get?_.get.call(n):_.value}},d(e,t,n||e)}function S(e,t){return S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},S(e,t)}function p(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v(e);if(t){var _=v(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return g(this,n)}}function g(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return y(e)}function y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function v(e){return v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},v(e)}function T(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var E=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}(g,e);var t,n,r,c=p(g);function g(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,g),t.nbShadowMaps=t.nbSplits,T(y(n=c.call(this,e,t)),"_m_SplitsVec4",new l.default),T(y(n),"_m_SplitsArray",null),T(y(n),"_m_ShadowCam",null),T(y(n),"_m_Points",new Array(8)),T(y(n),"_m_TempVec3",new u.default),T(y(n),"_m_Lambda",.65),T(y(n),"_m_Stabilize",!0),n.init(t.nbSplits,t.shadowMapSize),n}return t=g,(n=[{key:"init",value:function(e,t){this._m_NbShadowMaps=Math.max(Math.min(e,4),1),this._m_NbShadowMaps!=e&&a.default.error("PSSM分割级别只能为1-4之间,指定的分割级别为:"+e),this._m_SplitsArray=new Array(this._m_NbShadowMaps+1),this._m_ShadowCam=new i.default(this._m_Scene,{id:"DirectionalLightShadowProcess_"+o.default.nextId(),width:t,height:t,fixedSize:!0,parallelProjection:!0}),this._m_ShadowCam.setEye(new u.default(0,0,0));for(var n=0;n<8;n++)this._m_Points[n]=new u.default}},{key:"initMat",value:function(){d(v(g.prototype),"initMat",this).call(this),this._m_PostShadowMat.addDefine(m.default.S_PSSM_SRC,!1)}},{key:"_uploadInfo",value:function(e,t){d(v(g.prototype),"_uploadInfo",this).call(this,e,t);var n=t.m_LastSubShader.getContextVars(),r=null;if(r=n[_.default.S_LIGHT_DIR]){var a=this._m_Light.getDirection();e.uniform3f(r.loc,a._m_X,a._m_Y,a._m_Z)}(r=n[_.default.S_SPLITS])&&e.uniform4f(r.loc,this._m_SplitsVec4._m_X,this._m_SplitsVec4._m_Y,this._m_SplitsVec4._m_Z,this._m_SplitsVec4._m_W)}},{key:"updateShadowCams",value:function(){if(null!=this._m_Light){var e=this._m_Scene.getMainCamera(),t=this._m_ZFarOverride;0==t&&(t=e.getFar());var n=Math.max(e.getNear(),.001);s.default.calculateLightConeScope(e,n,t,1,this._m_Points),this._m_ShadowCam.setFar(t);var r=this._m_ShadowCam.getEye();if(this._m_ShadowCam.lookAt(r,r.add(this._m_Light.getDirection(),this._m_TempVec3),this._m_ShadowCam.getUp()),this._m_ShadowCam._updateFrustum(),this._m_ShadowCam.forceUpdateProjection(),this._m_ShadowCam.getProjectViewMatrix(!0),s.default.calculateSplits(this._m_SplitsArray,n,t,this._m_Lambda),e.isParallelProjection())for(var _=1*(t-n),i=0;i<this._m_NbShadowMaps;i++)this._m_SplitsArray[i]/=_;switch(this._m_SplitsArray.length){case 5:this._m_SplitsVec4._m_W=this._m_SplitsArray[4];case 4:this._m_SplitsVec4._m_Z=this._m_SplitsArray[3];case 3:this._m_SplitsVec4._m_Y=this._m_SplitsArray[2];case 2:case 1:this._m_SplitsVec4._m_X=this._m_SplitsArray[1]}}else a.default.warn("无效光源!")}},{key:"getShadowCam",value:function(e){return this._m_ShadowCam}},{key:"getShadowGeometryCasts",value:function(e,t){return s.default.calculateLightConeScope(this._m_MainCamera,this._m_SplitsArray[e],this._m_SplitsArray[e+1],1,this._m_Points),0==this._m_ShadowGeometryReceivers.length&&s.default.calculateGeometriesInFrustum(this._m_Scene.getRender().getVisDrawables(),this._m_MainCamera,f.default.S_SHADOW_RECEIVE,this._m_ShadowGeometryReceivers),s.default.calculateShadowCamera(this._m_Scene.getSceneNodes(),this._m_ShadowGeometryReceivers,this._m_ShadowCam,this._m_Points,t,this._m_Stabilize?this._m_ShadowMapSize:0),t}},{key:"getShadowGeometryReceivers",value:function(e){0==e.length&&s.default.calculateGeometriesInFrustum(this._m_Scene.getRender().getVisDrawables(),this._m_MainCamera,f.default.S_SHADOW_RECEIVE,e)}}])&&h(t.prototype,n),r&&h(t,r),g}(_.default);t.default=E},4867:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=f(n(5602)),a=f(n(1550)),i=f(n(5397)),o=f(n(5604)),u=(f(n(4048)),f(n(1266))),s=f(n(2949)),l=f(n(9784));function f(e){return e&&e.__esModule?e:{default:e}}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=g(e)););return e}(e,t);if(r){var _=Object.getOwnPropertyDescriptor(r,t);return _.get?_.get.call(n):_.value}},c(e,t,n||e)}function h(e,t){return h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},h(e,t)}function d(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=g(e);if(t){var _=g(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return S(this,n)}}function S(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return p(e)}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(e){return g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},g(e)}function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var v=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(S,e);var t,n,r,f=d(S);function S(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,S),t.nbShadowMaps=S._S_FACE_NUMS,t.shadowSplitType=2,y(p(n=f.call(this,e,t)),"_m_ShadowCams",new Array(S._S_FACE_NUMS)),y(p(n),"_m_Position",new o.default),y(p(n),"_m_Radius",0),y(p(n),"_m_UpdateCasterCam",!1),n.init(t.shadowMapSize),n}return t=S,(n=[{key:"init",value:function(e){for(var t=0;t<S._S_FACE_NUMS;t++)this._m_ShadowCams[t]=new a.default(this._m_Scene,{id:this._m_Id+"_"+t+i.default.nextId(),width:e,height:e,fixedSize:!0})}},{key:"initMat",value:function(){c(g(S.prototype),"initMat",this).call(this),this._m_PostShadowMat.addDefine(l.default.S_POINTLIGHT_SHADOWS_SRC,!1)}},{key:"_uploadInfo",value:function(e,t){var n;c(g(S.prototype),"_uploadInfo",this).call(this,e,t),(n=t.m_LastSubShader.getContextVars()[_.default.S_LIGHT_POS])&&e.uniform3f(n.loc,this._m_Position._m_X,this._m_Position._m_Y,this._m_Position._m_Z)}},{key:"updateShadowCams",value:function(){if(this._m_Radius==this._m_Light.getRadius()&&this._m_Position.equals(this._m_Light.getPosition())){if(this._m_UpdateCasterCam){this._m_UpdateCasterCam=!1;for(var e=0;e<S._S_FACE_NUMS;e++)this._m_ShadowCams[e].setFrustumPerspective(90,1,.1,this._m_Radius),this._m_ShadowCams[e]._updateFrustum()}}else this._m_Radius=this._m_Light.getRadius(),this._m_Position.setTo(this._m_Light.getPosition()),this._calc()}},{key:"getShadowCam",value:function(e){return this._m_ShadowCams[e]}},{key:"getShadowGeometryCasts",value:function(e,t){var n=this;return this._m_Scene.getSceneNodes().forEach((function(r){u.default.calculateNodeInFrustum(r,n._m_ShadowCams[e],s.default.S_SHADOW_CAST,t)})),this._m_UpdateCasterCam=!0,this._m_ShadowCams[e].setFrustumPerspective(90,1,.1,1e3),this._m_ShadowCams[e].getProjectViewMatrix(!0),t}},{key:"_calc",value:function(){for(var e=S._S_TEMP_VEC3_0,t=0;t<S._S_FACE_NUMS;t++)S._S_CAPTURE_CONFIG[t].dir.add(this._m_Position,e),this._m_ShadowCams[t].lookAt(this._m_Position,e,S._S_CAPTURE_CONFIG[t].up),this._m_ShadowCams[t].setFrustumPerspective(90,1,.1,this._m_Radius),this._m_ShadowCams[t]._updateFrustum()}}])&&m(t.prototype,n),r&&m(t,r),S}(_.default);t.default=v,y(v,"_S_CAPTURE_CONFIG",[{dir:new o.default(0,-1,0),up:new o.default(0,0,-1)},{dir:new o.default(0,1,0),up:new o.default(0,0,1)},{dir:new o.default(0,0,-1),up:new o.default(0,1,0)},{dir:new o.default(0,0,1),up:new o.default(0,1,0)},{dir:new o.default(-1,0,0),up:new o.default(0,1,0)},{dir:new o.default(1,0,0),up:new o.default(0,1,0)}]),y(v,"_S_FACE_NUMS",6),y(v,"_S_TEMP_VEC3_0",new o.default)},1266:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=s(n(5604)),_=s(n(2949)),a=s(n(2320)),i=s(n(3801)),o=s(n(8578)),u=s(n(513));function s(e){return e&&e.__esModule?e:{default:e}}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var m=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,s;return t=e,s=[{key:"calculateLightConeScope",value:function(t,n,r,_,a){var i=1*t.getTop()/t.getNear(),o=1*n,u=1*r,s=1*t.getTop(),l=1*t.getRight()/s,f=-1,m=-1,c=-1,h=-1;t.isParallelProjection()?(m=(f=s)*l,h=(c=s)*l):(m=(f=i*o)*l,h=(c=i*u)*l);var d=t.getEye(),S=t.getDir(),p=t.getUp(),g=S.cross(p,e.S_TEMP_VEC3_1).normal(),y=S.multLength(u,e.S_TEMP_VEC3_2).add(d),v=S.multLength(o,e.S_TEMP_VEC3_3).add(d),T=p.multLength(f,e.S_TEMP_VEC3_4),E=p.multLength(c,e.S_TEMP_VEC3_5),b=g.multLength(m,e.S_TEMP_VEC3_6),C=g.multLength(h,e.S_TEMP_VEC3_7);if(v.sub(T,a[0]).sub(b),v.add(T,a[1]).sub(b),v.add(T,a[2]).add(b),v.sub(T,a[3]).add(b),y.sub(E,a[4]).sub(C),y.add(E,a[5]).sub(C),y.add(E,a[6]).add(C),y.sub(E,a[7]).add(C),1!=_){for(var P=e.S_TEMP_VEC3_8.setToInXYZ(0,0,0),R=0;R<8;R++)P.add(a[R]);P.multLength(1/8);for(var M=e.S_TEMP_VEC3_0,A=0;A<8;A++)a[A].sub(P,M),M.multLength(_-1),a[A].add(M)}}},{key:"calculateSplits",value:function(e,t,n,r){for(var _=-1,a=-1,i=-1,o=1*n/t,u=n-t,s=0,l=e.length;s<l;s++)_=1*s/l,a=t*Math.pow(o,_),i=t+u*_,e[s]=a*r+i*(1-r);e[0]=t,e[e.length-1]=n}},{key:"calculateShadowCamera",value:function(t,n,r,_,u,s){r.isParallelProjection()&&(r.setFrustum(-1,1,1,-1,-r.getFar(),r.getFar()),r.forceUpdateProjection());var l=r.getProjectViewMatrix(!0),f=e.calculateBoundaryFromPoints(_,l,e.S_AABB_BOUNDARY_BOX0),m=new i.default,c=new i.default,h=0,d=0,S=null,p=null,g=null;n.forEach((function(t){S=t.getBoundingVolume(),p=e.S_AABB_BOUNDARY_BOX1,S.transformFromMat44(l,e.S_AABB_BOUNDARY_BOX1),f.contains(p)&&(g=p.getCenter(),Math.abs(g._m_X)!=Number.MAX_VALUE&&!Number.isNaN(g._m_X)&&Number.isFinite(g._m_X)&&(c.merge(p),d++))}));var y=new o.default(l,h,f,m,u);t.forEach((function(e){y.calculate(e)})),(h=y._m_CasterCount)!=d&&m.setHalfInXYZ(m.getXHalf()+2,m.getYHalf()+2,m.getZHalf()+2);var v=m.getMin(e.S_TEMP_VEC3_00),T=m.getMax(e.S_TEMP_VEC3_11),E=c.getMin(e.S_TEMP_VEC3_22),b=c.getMax(e.S_TEMP_VEC3_33),C=f.getMin(e.S_TEMP_VEC3_44),P=f.getMax(e.S_TEMP_VEC3_55);C._m_Z=0;var R,M,A,w,I,L,D=r.getProjectMatrix(),O=e.S_TEMP_VEC3_8,F=e.S_TEMP_VEC3_7;O._m_X=Math.max(Math.max(v._m_X,E._m_X),C._m_X),F._m_X=Math.min(Math.min(T._m_X,b._m_X),P._m_X),O._m_Y=Math.max(Math.max(v._m_Y,E._m_Y),C._m_Y),F._m_Y=Math.min(Math.min(T._m_Y,b._m_Y),P._m_Y),O._m_Z=Math.min(v._m_Z,C._m_Z),F._m_Z=Math.min(b._m_Z,P._m_Z),R=2/(F._m_X-O._m_X),M=2/(F._m_Y-O._m_Y);var x=.5*s;if(0!=x&&R>0&&M>0){var k=.1;R=1/Math.ceil(1/R*k)*k,M=1/Math.ceil(1/M*k)*k}w=-.5*(F._m_X+O._m_X)*R,I=-.5*(F._m_Y+O._m_Y)*M,0!=x&&R>0&&M>0&&(w=1*Math.ceil(w*x)/x,I=1*Math.ceil(I*x)/x),A=1/(F._m_Z-O._m_Z),L=-O._m_Z*A;var N=e.S_TEMP_MAT44_0;N.setArray([R,0,0,0,0,M,0,0,0,0,A,0,w,I,L,1]);var B=e.S_TEMP_MAT44_1;a.default.multiplyMM(B,0,N,0,D,0),r.setProjectMatrix(B)}},{key:"calculateBoundaryFromPoints",value:function(t,n,_){for(var o=e.S_TEMP_VEC3_0.setTo(r.default.S_MIN),u=e.S_TEMP_VEC3_1.setTo(r.default.S_MAX),s=e.S_TEMP_VEC3_2,l=0,f=0,m=t.length;f<m;f++)l=a.default.multiplyMV3(s,t[f],n),s.multLength(1/l),o.min(s),u.max(s);var c=o.add(u,e.S_TEMP_VEC3_3).multLength(.5),h=u.sub(o,e.S_TEMP_VEC3_4).multLength(.5),d=_||new i.default;return d.setCenter(c),d.setHalfInXYZ(h._m_X+2,h._m_Y+2,h._m_Z+2.5),d}},{key:"calculateGeometriesInFrustum",value:function(t,n,r,_){var a=n.getFrustumMask();e._cull(t,n,r,_),n.setFrustumMask(a)}},{key:"calculateNodeInFrustum",value:function(t,n,r,_){var a=n.getFrustumMask();n.setFrustumMask(0),e._cull2(t,n,r,_),n.setFrustumMask(a)}},{key:"_cull",value:function(t,n,r,_){t.forEach((function(t){n.setFrustumMask(0),t.inFrustum(n)&&e._parseShadowMode(t,r)&&_.push(t)}))}},{key:"_cull2",value:function(t,n,r,a){if(t.getFilterFlag()!=_.default.S_ALWAYS&&t.inFrustum(n))if(t.isDrawable&&t.isDrawable()&&!t.isGUI())e._parseShadowMode(t,r)&&a.push(t);else if(t.getChildren().length>0){var i=n.getFrustumMask();t.getChildren().forEach((function(t){t instanceof u.default||(n.setFrustumMask(i),e._cull2(t,n,r,a))}))}}},{key:"_parseShadowMode",value:function(e,t){if(t!=_.default.S_SHADOW_NONE)switch(t){case _.default.S_SHADOW_CAST:return e.isCastShadow();case _.default.S_SHADOW_RECEIVE:return e.isReceiveShadow();case _.default.S_SHADOW_CAST_AND_RECEIVE:return!0}return!1}}],(n=null)&&l(t.prototype,n),s&&l(t,s),e}();t.default=m,f(m,"S_TEMP_VEC3_0",new r.default),f(m,"S_TEMP_VEC3_1",new r.default),f(m,"S_TEMP_VEC3_2",new r.default),f(m,"S_TEMP_VEC3_3",new r.default),f(m,"S_TEMP_VEC3_4",new r.default),f(m,"S_TEMP_VEC3_5",new r.default),f(m,"S_TEMP_VEC3_6",new r.default),f(m,"S_TEMP_VEC3_7",new r.default),f(m,"S_TEMP_VEC3_8",new r.default),f(m,"S_TEMP_VEC3_00",new r.default),f(m,"S_TEMP_VEC3_11",new r.default),f(m,"S_TEMP_VEC3_22",new r.default),f(m,"S_TEMP_VEC3_33",new r.default),f(m,"S_TEMP_VEC3_44",new r.default),f(m,"S_TEMP_VEC3_55",new r.default),f(m,"S_TEMP_MAT44_0",new a.default),f(m,"S_TEMP_MAT44_1",new a.default),f(m,"S_AABB_BOUNDARY_BOX0",new i.default),f(m,"S_AABB_BOUNDARY_BOX1",new i.default)},8578:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;o(n(4720));var r=o(n(2949)),_=o(n(3801)),a=o(n(1322)),i=o(n(5604));function o(e){return e&&e.__esModule?e:{default:e}}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var l=function(){function e(t,n,r,_,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),s(this,"_m_VP",void 0),s(this,"_m_CasterCount",void 0),s(this,"_m_SplitBoundaryBox",void 0),s(this,"_m_CasterBoundaryBox",void 0),s(this,"_m_SplitOccluders",void 0),this._m_VP=t,this._m_CasterCount=n,this._m_SplitBoundaryBox=r,this._m_CasterBoundaryBox=_,this._m_SplitOccluders=a}var t,n,_;return t=e,(n=[{key:"calculate",value:function(e){return this._calculate(e),this._m_CasterCount}},{key:"_calculate",value:function(t){var n=this;if(t.getFilterFlag()!=r.default.S_ALWAYS)if(t.isDrawable&&t.isDrawable()&&!t.isGUI()){if(t.isCastShadow()){var _=t.getBoundingVolume(),i=e.S_AABB_BOUNDARY_BOX0;_.transformFromMat44(this._m_VP,e.S_AABB_BOUNDARY_BOX0);var o=this._m_SplitBoundaryBox.contains(i);if(o||_.getType()!=a.default.S_TYPE_AABB)o&&(this._m_CasterBoundaryBox.merge(i),this._m_CasterCount++,null!=this._m_SplitOccluders&&this._m_SplitOccluders.push(t));else if(i.setZHalf(i.getZHalf()+50),i.setCenter(i.getCenter(e.S_TEMP_VEC3_0).addInXYZ(0,0,25)),this._m_SplitBoundaryBox.contains(i)){var u=i.getCenter(e.S_TEMP_VEC3_1)._m_X;Math.abs(u)!=Number.MAX_VALUE&&!Number.isNaN(u)&&Number.isFinite(u)&&(i.setZHalf(i.getZHalf()-50),i.setCenter(i.getCenter(e.S_TEMP_VEC3_0).subInXYZ(0,0,25)),this._m_CasterBoundaryBox.merge(i),this._m_CasterCount++),null!=this._m_SplitOccluders&&this._m_SplitOccluders.push(t)}}}else if(t instanceof r.default){var s=t.getBoundingVolume();if(null!=s){var l=e.S_AABB_BOUNDARY_BOX0;s.transformFromMat44(this._m_VP,e.S_AABB_BOUNDARY_BOX0);var f=this._m_SplitBoundaryBox.contains(l);f||l.getType()!=a.default.S_TYPE_AABB||(l.setZHalf(l.getZHalf()+50),l.setCenter(l.getCenter(e.S_TEMP_VEC3_0).addInXYZ(0,0,25)),f=this._m_SplitBoundaryBox.contains(l)),f&&t.getChildren().forEach((function(e){n._calculate(e)}))}}}}])&&u(t.prototype,n),_&&u(t,_),e}();t.default=l,s(l,"S_TEMP_VEC3_0",new i.default),s(l,"S_TEMP_VEC3_1",new i.default),s(l,"S_TEMP_VEC3_2",new i.default),s(l,"S_AABB_BOUNDARY_BOX0",new _.default),s(l,"S_AABB_BOUNDARY_BOX1",new _.default)},948:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=c(n(5602)),a=c(n(1550)),i=c(n(2949)),o=c(n(5397)),u=c(n(5604)),s=c(n(3846)),l=c(n(1266)),f=c(n(431)),m=c(n(9784));function c(e){return e&&e.__esModule?e:{default:e}}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t,n){return d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=v(e)););return e}(e,t);if(r){var _=Object.getOwnPropertyDescriptor(r,t);return _.get?_.get.call(n):_.value}},d(e,t,n||e)}function S(e,t){return S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},S(e,t)}function p(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v(e);if(t){var _=v(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return g(this,n)}}function g(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return y(e)}function y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function v(e){return v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},v(e)}function T(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var E=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}(g,e);var t,n,r,c=p(g);function g(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,g),t.nbShadowMaps=1,T(y(n=c.call(this,e,t)),"_m_ShadowCam",void 0),T(y(n),"_m_OutAngle",-1),T(y(n),"_m_SpotRange",-1),T(y(n),"_m_Position",new u.default),T(y(n),"_m_Direction",new u.default),T(y(n),"_m_UpdateCasterCam",!1),T(y(n),"_m_TempVec3",new u.default),n.init(t.shadowMapSize),n}return t=g,(n=[{key:"init",value:function(e){this._m_ShadowCam=new a.default(this._m_Scene,{id:this._m_Id+"_"+o.default.nextId(),width:e,height:e,fixedSize:!0})}},{key:"initMat",value:function(){d(v(g.prototype),"initMat",this).call(this),this._m_PostShadowMat.addDefine(m.default.S_SPOTLIGHT_SHADOWS_SRC,!1)}},{key:"_uploadInfo",value:function(e,t){d(v(g.prototype),"_uploadInfo",this).call(this,e,t);var n=t.m_LastSubShader.getContextVars(),r=null;if(r=n[_.default.S_LIGHT_DIR]){var a=this._m_Light.getDirection();e.uniform3f(r.loc,a._m_X,a._m_Y,a._m_Z)}if(r=n[_.default.S_LIGHT_POS]){var i=this._m_Light.getPosition();e.uniform3f(r.loc,i._m_X,i._m_Y,i._m_Z)}}},{key:"getShadowCam",value:function(e){return this._m_ShadowCam}},{key:"updateShadowCams",value:function(){null!=this._m_Light?this._m_OutAngle==this._m_Light.getOuterAngle()&&this._m_SpotRange==this._m_Light.getSpotRange()&&this._m_Position.equals(this._m_Light.getPosition())&&this._m_Direction.equals(this._m_Light.getDirection())?this._m_UpdateCasterCam&&(this._m_UpdateCasterCam=!1,this._m_ShadowCam.setFrustumPerspective(this._m_OutAngle*f.default.S_RAD_TO_DEG*2,1,1,this._m_SpotRange),this._m_ShadowCam._updateFrustum()):(this._m_OutAngle=this._m_Light.getOuterAngle(),this._m_SpotRange=this._m_Light.getSpotRange(),this._m_Position.setTo(this._m_Light.getPosition()),this._m_Direction.setTo(this._m_Light.getDirection()),this._m_ShadowCam.setFrustumPerspective(this._m_OutAngle*f.default.S_RAD_TO_DEG*2,1,1,this._m_SpotRange),this._m_ShadowCam.lookAt(this._m_Position,this._m_Position.add(this._m_Direction,this._m_TempVec3),this._m_ShadowCam.getUp()),this._m_ShadowCam._updateFrustum(),this._m_ShadowCam.getProjectViewMatrix(!0)):s.default.warn("无效光源!")}},{key:"getShadowGeometryCasts",value:function(e,t){var n=this;return this._m_Scene.getSceneNodes().forEach((function(e){l.default.calculateNodeInFrustum(e,n._m_ShadowCam,i.default.S_SHADOW_CAST,t)})),this._m_UpdateCasterCam=!0,this._m_ShadowCam.setFrustumPerspective(this._m_OutAngle*f.default.S_RAD_TO_DEG*2,1,1,1e3),this._m_ShadowCam.getProjectViewMatrix(!0),t}}])&&h(t.prototype,n),r&&h(t,r),g}(_.default);t.default=E},1193:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,_=(r=n(3846))&&r.__esModule?r:{default:r};function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,r=[{key:"_get",value:function(e,t,n,r){r=r||{sync:!0};var _=new XMLHttpRequest;if(_.open(n||"POST",e,r.sync),r&&r.inflate&&(_.responseType="arraybuffer"),0==r.sync)return _.send(null),200===_.status?_.responseText:null;_.onreadystatechange=function(){4===_.readyState&&200===_.status&&t(_.response)},_.send(null)}},{key:"getBasePath",value:function(e){var t=e.lastIndexOf("/");return-1===t?e:e.substring(0,t+1)}},{key:"loadFile",value:function(e,t,n,r){(r=r||{type:"GET",sync:!0}).type=r.type||"GET",r.sync=null==r.sync||r.sync;var a=new XMLHttpRequest;a.open(r.type,e,r.sync);var i=r&&r.inflate;if(_.default.debug("inflate:"+i),i&&(a.responseType="arraybuffer",_.default.debug("二进制")),0==r.sync)return a.send(null),200===a.status?a.responseText:null;a.addEventListener("load",(function(e){var r=e.target.response;200===a.status?t&&t(r):0===a.status?(_.default.warn("loadFile: HTTP Status 0 received."),t&&t(r)):n&&n(e)}),!1),a.addEventListener("error",(function(e){n&&n(e)}),!1),a.send(null)}},{key:"loadMaterialSourceDef",value:function(t,n){return e._get(t,null,"GET",{sync:!1})}},{key:"loadModel",value:function(e,t){}}],(n=null)&&a(t.prototype,n),r&&a(t,r),e}();t.default=i},66:(e,t)=>{function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.object=t,this.listeners={}}var t,r,_;return t=e,r=[{key:"removeA",value:function(e){for(var t,n,r=arguments,_=r.length;_>1&&e.length;)for(t=r[--_];-1!==(n=e.indexOf(t));)e.splice(n,1);return e}},{key:"isset",value:function(e){for(var t=0;t<arguments.length;t++)if(void 0===arguments[t]||null==arguments[t])return!1;return!0}},{key:"isArray",value:function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{key:"register",value:function(e,t,n){"string"==typeof e&&"function"==typeof t&&(this.listeners[e]||(this.listeners[e]=new Array),this.listeners[e].push({object:this.isset(n)?n:this.object,callback:t}))}},{key:"unregister",value:function(e,t,n){if("string"==typeof e&&"function"==typeof t&&(n=this.isset(n)?n:this.object,this.listeners[e]))for(var r=0;r<this.listeners[e].length;r++)if(this.listeners[e][r].object==n&&this.listeners[e][r].callback==t){this.listeners[e].splice(r,1);break}}},{key:"trigger",value:function(e,t,n){if("string"!=typeof e)return!1;if(t=t||new Array,this.isset(t)?this.isArray(t)||(t=[t]):t=new Array,"mouse"==e.substring(0,5).toLowerCase()&&(t[0]=this.normalizeEvent(t[0])),!this.listeners[e]||0==this.listeners[e].length)return!0;for(var r=this.listeners[e].slice(0),_=0;_<r.length;_++)if(!1===(this.isset(n)?r[_].callback.apply(n,t):r[_].callback.apply(r[_].object,t)))return!1;return!0}},{key:"normalizeEvent",value:function(e){return e}}],r&&n(t.prototype,r),_&&n(t,_),e}();t.default=r},3846:(e,t)=>{function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=console.log,a=console.info,i=console.warn,o=console.debug,u=console.error,s=console.time,l=console.timeEnd,f=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,f;return t=e,f=[{key:"debug",value:function(){}},{key:"log",value:function(){}},{key:"info",value:function(){}},{key:"warn",value:function(){}},{key:"error",value:function(){}},{key:"time",value:function(){}},{key:"timeEnd",value:function(){}},{key:"timeCalc",value:function(){}},{key:"enable",value:function(t,n){switch(t){case e.S_DEBUG:e.debug=n?o:function(){};break;case e.S_INFO:e.info=n?a:function(){};break;case e.S_LOG:e.log=n?_:function(){};break;case e.S_WARN:e.warn=n?i:function(){};break;case e.S_ERROR:e.error=n?u:function(){};break;case e.S_TIME:e.time=n?s:function(){},e.timeEnd=n?l:function(){};break;case e.S_TIME_CALC:e.timeCalc=n?function(e){return e?(e.time=(new Date).getTime()-e.time,e):((e={}).time=(new Date).getTime(),e)}:function(){}}}}],(r=null)&&n(t.prototype,r),f&&n(t,f),e}();t.default=f,r(f,"S_DEBUG",0),r(f,"S_INFO",1),r(f,"S_WARN",2),r(f,"S_LOG",3),r(f,"S_ERROR",4),r(f,"S_TIME",5),r(f,"S_TIME_CALC",6),f.enable(f.S_LOG,!0),f.enable(f.S_INFO,!0),f.enable(f.S_DEBUG,!0),f.enable(f.S_ERROR,!0),f.enable(f.S_WARN,!0),f.enable(f.S_TIME,!0)},8583:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(9271)),_=a(n(307));function a(e){return e&&e.__esModule?e:{default:e}}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o,u,s,l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,a;return t=e,a=[{key:"nextId",value:function(){return--e.count}},{key:"pushVec3ToArray",value:function(e,t){e.push(t._m_X),e.push(t._m_Y),e.push(t._m_Z)}},{key:"createProbeMesh",value:function(){var e=new _.default;return e.setData(_.default.S_POSITIONS,[3.4201992,0,-9.396927,2.7669992,2.0103426,-9.396927,1.0568995,3.2528028,-9.396927,-1.0568998,3.2528026,-9.396927,-2.7669995,2.0103424,-9.396927,-3.4201992,-2.9900332e-7,-9.396927,-2.766999,-2.010343,-9.396927,-1.0569,-3.2528026,-9.396927,1.0569001,-3.2528026,-9.396927,2.7670002,-2.0103416,-9.396927,3.4201992,0,-9.396927,6.427875,0,-7.660445,5.20026,3.7782102,-7.660445,1.9863225,6.1132727,-7.660445,-1.9863229,6.113272,-7.660445,-5.2002606,3.7782097,-7.660445,-6.427875,-5.6194267e-7,-7.660445,-5.2002597,-3.7782109,-7.660445,-1.9863232,-6.113272,-7.660445,1.9863235,-6.113272,-7.660445,5.2002616,-3.7782083,-7.660445,6.427875,0,-7.660445,8.6602545,0,-4.9999995,7.0062933,5.0903697,-4.9999995,2.6761656,8.236392,-4.9999995,-2.676166,8.236391,-4.9999995,-7.006294,5.090369,-4.9999995,-8.6602545,-7.5710346e-7,-4.9999995,-7.006293,-5.0903707,-4.9999995,-2.6761668,-8.236391,-4.9999995,2.676167,-8.236391,-4.9999995,7.006295,-5.0903673,-4.9999995,8.6602545,0,-4.9999995,9.848078,0,-1.7364818,7.9672623,5.7885547,-1.7364818,3.0432231,9.366078,-1.7364818,-3.0432239,9.366078,-1.7364818,-7.9672627,5.788554,-1.7364818,-9.848078,-8.6094633e-7,-1.7364818,-7.967262,-5.788556,-1.7364818,-3.0432243,-9.366078,-1.7364818,3.0432246,-9.366078,-1.7364818,7.9672647,-5.788552,-1.7364818,9.848078,0,-1.7364818,9.848078,0,1.7364826,7.9672623,5.7885547,1.7364826,3.0432231,9.366078,1.7364826,-3.0432239,9.366078,1.7364826,-7.9672627,5.788554,1.7364826,-9.848078,-8.6094633e-7,1.7364826,-7.967262,-5.788556,1.7364826,-3.0432243,-9.366078,1.7364826,3.0432246,-9.366078,1.7364826,7.9672647,-5.788552,1.7364826,9.848078,0,1.7364826,8.660254,0,5.0000005,7.0062923,5.090369,5.0000005,2.6761653,8.236391,5.0000005,-2.6761658,8.23639,5.0000005,-7.006293,5.0903687,5.0000005,-8.660254,-7.571034e-7,5.0000005,-7.006292,-5.09037,5.0000005,-2.6761663,-8.23639,5.0000005,2.6761665,-8.23639,5.0000005,7.0062943,-5.090367,5.0000005,8.660254,0,5.0000005,6.427875,0,7.660445,5.20026,3.7782102,7.660445,1.9863225,6.1132727,7.660445,-1.9863229,6.113272,7.660445,-5.2002606,3.7782097,7.660445,-6.427875,-5.6194267e-7,7.660445,-5.2002597,-3.7782109,7.660445,-1.9863232,-6.113272,7.660445,1.9863235,-6.113272,7.660445,5.2002616,-3.7782083,7.660445,6.427875,0,7.660445,3.4201992,0,9.396927,2.7669992,2.0103426,9.396927,1.0568995,3.2528028,9.396927,-1.0568998,3.2528026,9.396927,-2.7669995,2.0103424,9.396927,-3.4201992,-2.9900332e-7,9.396927,-2.766999,-2.010343,9.396927,-1.0569,-3.2528026,9.396927,1.0569001,-3.2528026,9.396927,2.7670002,-2.0103416,9.396927,3.4201992,0,9.396927,0,0,-10,0,0,10]),e.setData(_.default.S_NORMALS,[-.34201992,-0,.9396927,-.27669993,-.20103426,.9396927,-.10568996,-.32528028,.9396927,.10568998,-.32528028,.9396927,.27669996,-.20103423,.9396927,.34201992,2.990033e-8,.9396927,.2766999,.20103431,.9396927,.10569,.32528028,.9396927,-.10569002,.32528028,.9396927,-.27670002,.20103417,.9396927,-.34201992,-0,.9396927,-.6427875,-0,.76604456,-.520026,-.37782103,.76604456,-.19863226,-.6113273,.76604456,.19863228,-.61132723,.76604456,.5200261,-.37782097,.76604456,.6427875,5.6194267e-8,.76604456,.52002597,.3778211,.76604456,.19863233,.61132723,.76604456,-.19863234,.61132723,.76604456,-.52002615,.37782082,.76604456,-.6427875,-0,.76604456,-.86602545,-0,.49999997,-.70062935,-.50903696,.49999997,-.26761654,-.82363915,.4999999,.2676166,-.8236391,.49999997,.70062935,-.5090369,.4999999,.86602545,7.5710346e-8,.49999997,.70062923,.509037,.4999999,.2676167,.8236391,.49999997,-.26761672,.8236391,.49999997,-.7006295,.5090367,.4999999,-.86602545,-0,.49999997,-.9848078,-0,.17364818,-.7967262,-.57885545,.17364818,-.30432233,-.93660784,.17364818,.3043224,-.93660784,.17364818,.7967263,-.57885545,.17364818,.9848078,8.609464e-8,.17364818,.79672617,.57885563,.17364818,.30432245,.93660784,.17364818,-.30432245,.93660784,.17364818,-.79672647,.5788552,.17364818,-.9848078,-0,.17364818,-.9848078,-0,-.17364827,-.7967262,-.57885545,-.17364827,-.30432233,-.93660784,-.17364827,.3043224,-.93660784,-.17364827,.7967263,-.57885545,-.17364827,.9848078,8.609464e-8,-.17364827,.7967261,.5788556,-.17364825,.30432242,.9366078,-.17364825,-.30432245,.9366078,-.17364825,-.79672647,.5788552,-.17364827,-.9848078,-0,-.17364827,-.8660254,-0,-.50000006,-.70062923,-.50903696,-.50000006,-.26761654,-.8236391,-.50000006,.2676166,-.82363904,-.50000006,.7006293,-.5090369,-.50000006,.8660254,7.571034e-8,-.50000006,.7006292,.509037,-.50000006,.26761663,.82363904,-.50000006,-.26761666,.82363904,-.50000006,-.7006294,.5090367,-.50000006,-.8660254,-0,-.50000006,-.6427875,-0,-.76604456,-.520026,-.37782103,-.76604456,-.19863226,-.6113273,-.76604456,.19863228,-.61132723,-.76604456,.5200261,-.37782097,-.76604456,.6427875,5.6194267e-8,-.76604456,.52002597,.3778211,-.76604456,.19863233,.61132723,-.76604456,-.19863234,.61132723,-.76604456,-.52002615,.37782082,-.76604456,-.6427875,-0,-.76604456,-.34201992,-0,-.9396927,-.27669993,-.20103426,-.9396927,-.10568996,-.32528028,-.9396927,.10568998,-.32528028,-.9396927,.27669996,-.20103423,-.9396927,.34201992,2.990033e-8,-.9396927,.2766999,.20103431,-.9396927,.10569,.32528028,-.9396927,-.10569002,.32528028,-.9396927,-.27670002,.20103417,-.9396927,-.34201992,-0,-.9396927,0,0,1,0,0,-1]),e.setData(_.default.S_INDICES,[0,11,1,1,11,12,1,12,2,2,12,13,2,13,3,3,13,14,3,14,4,4,14,15,4,15,5,5,15,16,5,16,6,6,16,17,6,17,7,7,17,18,7,18,8,8,18,19,8,19,9,9,19,20,9,20,10,10,20,21,11,22,12,12,22,23,12,23,13,13,23,24,13,24,14,14,24,25,14,25,15,15,25,26,15,26,16,16,26,27,16,27,17,17,27,28,17,28,18,18,28,29,18,29,19,19,29,30,19,30,20,20,30,31,20,31,21,21,31,32,22,33,23,23,33,34,23,34,24,24,34,35,24,35,25,25,35,36,25,36,26,26,36,37,26,37,27,27,37,38,27,38,28,28,38,39,28,39,29,29,39,40,29,40,30,30,40,41,30,41,31,31,41,42,31,42,32,32,42,43,33,44,34,34,44,45,34,45,35,35,45,46,35,46,36,36,46,47,36,47,37,37,47,48,37,48,38,38,48,49,38,49,39,39,49,50,39,50,40,40,50,51,40,51,41,41,51,52,41,52,42,42,52,53,42,53,43,43,53,54,44,55,45,45,55,56,45,56,46,46,56,57,46,57,47,47,57,58,47,58,48,48,58,59,48,59,49,49,59,60,49,60,50,50,60,61,50,61,51,51,61,62,51,62,52,52,62,63,52,63,53,53,63,64,53,64,54,54,64,65,55,66,56,56,66,67,56,67,57,57,67,68,57,68,58,58,68,69,58,69,59,59,69,70,59,70,60,60,70,71,60,71,61,61,71,72,61,72,62,62,72,73,62,73,63,63,73,74,63,74,64,64,74,75,64,75,65,65,75,76,66,77,67,67,77,78,67,78,68,68,78,79,68,79,69,69,79,80,69,80,70,70,80,81,70,81,71,71,81,82,71,82,72,72,82,83,72,83,73,73,83,84,73,84,74,74,84,85,74,85,75,75,85,86,75,86,76,76,86,87,0,1,88,1,2,88,2,3,88,3,4,88,4,5,88,5,6,88,6,7,88,7,8,88,8,9,88,9,10,88,77,89,78,78,89,79,79,89,80,80,89,81,81,89,82,82,89,83,83,89,84,84,89,85,85,89,86,86,89,87]),e}},{key:"createAABBBoundingBoxMeshFromAABBBoundingBox",value:function(e){var t=new _.default,n=e.getMin(),r=e.getMax(),a=[n._m_X,n._m_Y,n._m_Z,n._m_X,n._m_Y,r._m_Z,r._m_X,n._m_Y,n._m_Z,r._m_X,n._m_Y,r._m_Z,n._m_X,r._m_Y,n._m_Z,n._m_X,r._m_Y,r._m_Z,r._m_X,r._m_Y,n._m_Z,r._m_X,r._m_Y,r._m_Z];return t.setData(_.default.S_POSITIONS,a),t.setData(_.default.S_INDICES,[0,1,1,3,3,2,2,0,4,5,5,7,7,6,6,4,0,4,1,5,2,6,3,7]),t.setPrimitive(_.default.S_PRIMITIVE_LINES),t}},{key:"createViewFrustumMeshFromCamera",value:function(t,n){var a=t.getWidth(),i=t.getHeight(),o=[];e.pushVec3ToArray(o,t.getWorldCoordinates(new r.default(0,0),0,n||!0)),e.pushVec3ToArray(o,t.getWorldCoordinates(new r.default(0,i),0,n||!0)),e.pushVec3ToArray(o,t.getWorldCoordinates(new r.default(a,i),0,n||!0)),e.pushVec3ToArray(o,t.getWorldCoordinates(new r.default(a,0),0,n||!0)),e.pushVec3ToArray(o,t.getWorldCoordinates(new r.default(0,0),1,n||!0)),e.pushVec3ToArray(o,t.getWorldCoordinates(new r.default(0,i),1,n||!0)),e.pushVec3ToArray(o,t.getWorldCoordinates(new r.default(a,i),1,n||!0)),e.pushVec3ToArray(o,t.getWorldCoordinates(new r.default(a,0),1,n||!0));var u=new _.default;return u.setData(_.default.S_POSITIONS,o),u.setData(_.default.S_INDICES,[0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),u.setPrimitive(_.default.S_PRIMITIVE_LINES),u}}],(n=null)&&i(t.prototype,n),a&&i(t,a),e}();t.default=l,s=0,(u="count")in(o=l)?Object.defineProperty(o,u,{value:s,enumerable:!0,configurable:!0,writable:!0}):o[u]=s},5247:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=d(n(7341)),_=d(n(5604)),a=d(n(1550)),i=d(n(5397)),o=(d(n(9784)),d(n(4048))),u=d(n(7141)),s=d(n(3846)),l=d(n(9468)),f=d(n(8113)),m=d(n(4008)),c=d(n(3370)),h=d(n(1759));function d(e){return e&&e.__esModule?e:{default:e}}function S(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function g(e,t,n){return t&&p(e.prototype,t),n&&p(e,n),e}function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var v=function(){function e(t,n,r,a){S(this,e),this._m_Scene=t,this._m_MipMap=a,this._m_Resolute=n,this._m_CaptureCameres=[],this._m_CaptureFrames=[],this._m_CaptureResult=new o.default(t),this._m_CaptureResult.setTextureFormat(o.default.S_TEXTURE_FORMAT.S_RGBA16F,o.default.S_TEXTURE_FORMAT.S_RGBA,o.default.S_TEXTURE_FORMAT.S_FLOAT),this._m_CapturePixels=[],this._m_Position=new _.default,r&&this._m_Position.setTo(r),this._m_PrefilterSky=new l.default(t,{id:"prefitlerSky"+i.default.nextId()}),this._m_PrefilterSky.setMaterial(new m.default(t,{id:"prefilterMat"+i.default.nextId(),materialDef:f.default.parse(c.default.S_PREFILTER_DEF)})),this._m_PrefilterSky.getMaterial().setParam("roughness",(new h.default).valueOf(0)),this._m_PrefilterSky.getMaterial().setParam("resolution",(new h.default).valueOf(n)),this._m_PrefilterSky.getMaterial().setParam("envMap",this._m_CaptureResult),this._m_PrefilterMap=new o.default(t),this._m_PrefilterMap.setTextureFormat(o.default.S_TEXTURE_FORMAT.S_RGBA16F,o.default.S_TEXTURE_FORMAT.S_RGBA,o.default.S_TEXTURE_FORMAT.S_FLOAT),this._m_PrefilterMap.setFilter(t,o.default.S_FILTERS.S_LINEAR_MIPMAP_NEAREST,o.default.S_FILTERS.S_LINEAR),this._m_PrefilterMipmap=0;for(var u=n,s=n;(u>=1||s>=1)&&1!=u&&1!=s;)u/=2,s/=2,this._m_PrefilterMipmap++;this._init()}return g(e,[{key:"_init",value:function(){for(var t=new _.default,n=this._m_Scene.getCanvas().getGLContext(),o=0;o<6;o++)this._m_CaptureCameres[o]=new a.default(this._m_Scene,{id:"capture_"+o+"_"+i.default.nextId(),fovy:90,aspect:1}),e._S_CAPTURE_CONFIG[o].dir.add(this._m_Position,t),this._m_CaptureCameres[o].lookAt(this._m_Position,t,e._S_CAPTURE_CONFIG[o].up),this._m_CaptureFrames[o]=new r.default(n,"capture_frame_"+o+"_"+i.default.nextId(),this._m_Resolute,this._m_Resolute),this._m_CaptureFrames[o].addTexture(n,"capture_texture_"+o,n.RGBA16F,0,n.RGBA,n.FLOAT,n.COLOR_ATTACHMENT0,!1,this._m_MipMap),this._m_CaptureFrames[o].addBuffer(n,"capture_depth_"+o,n.DEPTH24_STENCIL8,n.DEPTH_STENCIL_ATTACHMENT),this._m_CaptureFrames[o].finish(n,this._m_Scene,!1);this._m_CaptureResult.setPreloadColor(this._m_Scene,new u.default(.5,.5,.5,1))}},{key:"setPosition",value:function(e){this._m_Position.setTo(e)}},{key:"getPosition",value:function(){return this._m_Position}},{key:"capture",value:function(){var t=this._m_Scene.getCanvas().getGLContext();this._m_Scene.getRender()._resetFrameContext(),this._m_Scene.getRender()._drawEnv(t);var n=this._m_Scene.getMainCamera(),r=this._m_Scene.getRender(),_=null;r.setViewPort(t,0,0,this._m_Resolute,this._m_Resolute);for(var a=0;a<6;a++)this._m_Scene.setMainCamera(this._m_CaptureCameres[a]),this._m_CaptureFrames[a].use(r),this._m_CaptureFrames[a].clear(t),this._m_Scene.getRender()._drawEnv(t),_=this._m_CaptureFrames[a].readPixels(t,"",t.RGBA,t.FLOAT),this._m_CapturePixels[a]=_,this._m_CaptureResult.setImage(this._m_Scene,e._S_CAPTURE_FACE[a],_,{width:this._m_Resolute,height:this._m_Resolute});this._m_CaptureResult.setWrap(this._m_Scene,o.default.S_WRAPS.S_CLAMP_TO_EDGE,o.default.S_WRAPS.S_CLAMP_TO_EDGE,o.default.S_WRAPS.S_CLAMP_TO_EDGE),this._m_Scene.setMainCamera(n),this._m_Scene.getRender().useDefaultFrame(),r.setViewPort(t,0,0,this._m_Scene.getCanvas().getWidth(),this._m_Scene.getCanvas().getHeight())}},{key:"prefiltered",value:function(){var t=this._m_Scene.getCanvas().getGLContext(),n=this._m_Scene.getSky();this._m_Scene.setSky(this._m_PrefilterSky),this._m_Scene.getRender()._resetFrameContext(),this._m_Scene.getRender()._drawEnv(t);var r,_,a=this._m_Scene.getMainCamera(),i=this._m_Scene.getRender(),u=null;i.setViewPort(t,0,0,this._m_Resolute,this._m_Resolute);for(var s=0;s<6;s++){this._m_Scene.setMainCamera(this._m_CaptureCameres[s]),this._m_CaptureFrames[s].use(i),this._m_CaptureFrames[s].clear(t);for(var l=0;l<=this._m_PrefilterMipmap;l++)r=this._m_Resolute*Math.pow(.5,l),_=this._m_Resolute*Math.pow(.5,l),this._m_PrefilterSky.getMaterial().setParam("roughness",(new h.default).valueOf(1*l/(this._m_PrefilterMipmap-1))),this._m_CaptureFrames[s].clear(t),this._m_Scene.getRender()._drawEnv(t),u=this._m_CaptureFrames[s].readPixels(t,"",t.RGBA,t.FLOAT),this._m_PrefilterMap.setImage(this._m_Scene,e._S_CAPTURE_FACE[s],u,{width:r,height:_,mipmapLevel:l})}this._m_PrefilterMap.setWrap(this._m_Scene,o.default.S_WRAPS.S_CLAMP_TO_EDGE,o.default.S_WRAPS.S_CLAMP_TO_EDGE,o.default.S_WRAPS.S_CLAMP_TO_EDGE),this._m_Scene.setMainCamera(a),this._m_Scene.getRender().useDefaultFrame(),this._m_Scene.setSky(n),i.setViewPort(t,0,0,this._m_Scene.getCanvas().getWidth(),this._m_Scene.getCanvas().getHeight())}},{key:"getCaptureTextureCube",value:function(){return this._m_CaptureResult}},{key:"getCapturePixels",value:function(){return this._m_CapturePixels}},{key:"getPrefilterTextureCube",value:function(){return this._m_PrefilterMap}},{key:"getPrefilterMipMap",value:function(){return this._m_PrefilterMipmap}}]),e}();y(v,"_S_CAPTURE_CONFIG",[{dir:new _.default(1,0,0),up:new _.default(0,-1,0)},{dir:new _.default(-1,0,0),up:new _.default(0,-1,0)},{dir:new _.default(0,1,0),up:new _.default(0,0,1)},{dir:new _.default(0,-1,0),up:new _.default(0,0,-1)},{dir:new _.default(0,0,1),up:new _.default(0,-1,0)},{dir:new _.default(0,0,-1),up:new _.default(0,-1,0)}]),y(v,"_S_CAPTURE_FACE",{0:o.default.S_FACE.PositiveX,1:o.default.S_FACE.NegativeX,2:o.default.S_FACE.PositiveY,3:o.default.S_FACE.NegativeY,4:o.default.S_FACE.PositiveZ,5:o.default.S_FACE.NegativeZ});var T=function(){function e(){S(this,e)}return g(e,null,[{key:"captureProbe",value:function(t,n,r){t.getCanvas().getGLContext();var _=r&&null!=r.resolute?r.resolute:e._S_DEFAULT_CAPTURE_RESOLUTE,a=new v(t,_,n.getPosition(),r.mipmap);return s.default.time("capture!"),a.capture(),s.default.timeEnd("capture!"),a}},{key:"bakeGIProbe",value:function(t,n,r){(r=r||{}).mipmap=!0;var _=r&&null!=r.resolute?r.resolute:e._S_DEFAULT_CAPTURE_RESOLUTE,a=e.captureProbe(t,n,r);s.default.time("shCoeffs");var i=e.getShCoeffs(_,_,a.getCapturePixels(),e._S_FIX_SEAMS_METHOD.Wrap);return e.prepareShCoefs(i),n.setShCoeffs(i),s.default.timeEnd("shCoeffs"),s.default.time("prefiltered"),a.prefiltered(),n.setPrefilterEnvMap(a.getPrefilterTextureCube()),n.setPrefilterMipmap(a.getPrefilterMipMap()),s.default.timeEnd("prefiltered"),a}},{key:"_bakePrefilteredEnvMap",value:function(t,n,r,a){t.getCapturePixels(),a.getCapturePixels();for(var i=new _.default,o=new _.default,s=(new u.default,n),l=0;l<4;l++){e._getRFM(l,4),e._getSFM(l,4);for(var f=0;f<s;f++)for(var m=0;m<s;m++)o.setToInXYZ(0,0,0),e._getVFCFTC(m,f,s,face,i,r)}}},{key:"_prefilterEnvMapTexel",value:function(t,n,r,a,i,o,s){var l=2*Math.PI/1,f=256*Math.abs(a._m_Z+a._m_X),m=(Math.cos(.5*f%(2*Math.PI)),r*r);m*=m;var c=e._S_TEMP_UNIT_X;Math.abs(a._m_Z)<.999&&(c=e._S_TEMP_UNIT_Y);var h=new _.default,d=new _.default;h.setTo(c),h.cross(a),h.normal(),d.setTo(a),d.cross(h);for(var S=new _.default(0,0,1),p=new _.default,g=new u.default,y=new _.default,v=0;v<i;v++){g=e._getHPoint(v,i,g),(y=e._iSGGX(g,m,y)).normal();var T=y._m_Z,E=y.multLength(2*T).sub(S);E._m_Z;0!=o&&e._computeMipLevel(r,i,t,T),e._2World(E,a,h,d,p),0}}},{key:"_getHPoint",value:function(e,t,n){var r,_=e;return n._m_X=1*e/t,_=(16711935&(_=(252645135&(_=(858993459&(_=(1431655765&(_=_<<16|_>>16))<<1|(2863311530&_)>>>1))<<2|(3435973836&_)>>>2))<<4|(4042322160&_)>>>4))<<8|(4278255360&_)>>>8,_&=4294967295,n._m_Y=1*_*2.3283064365386963e-10,r=2*Math.PI*n._m_Y,n._m_Z=Math.cos(r),n._m_W=Math.sin(r),n}},{key:"_2World",value:function(e,t,n,r,a){a.setTo(n),a.multLength(e._m_X);var i=new _.default;i.set(r),i.multLength(e._m_Y),a.add(i),i.set(t),i.multLength(e._m_Z),a.add(i)}},{key:"_samplePixel",value:function(e,t,n,r,_,a){if(r<=0)return 0;var i=new u.default;return a._m_X=a._m_X+i._m_X*r,a._m_Y=a._m_Y+i._m_Y*r,a._m_Z=a._m_Z+i._m_Z*r,r}},{key:"_iSGGX",value:function(e,t,n){var r=Math.sqrt((1-e._m_X)/(1+(t-1)*e._m_X)),_=Math.sqrt(1-r*r),a=_*e._m_Z,i=_*e._m_W;return n._m_X=a,n._m_Y=i,n._m_Z=r,n}},{key:"_ggx",value:function(e,t){var n=t/(e*e*(t*t-1)+1);return n*n*(1/Math.PI)}},{key:"_computeMipLevel",value:function(t,n,r,_){var a=_+1e-5,i=1/(n*(e._ggx(a,t)*a/(4*_))),o=4*Math.PI/(6*r*r),u=Math.log(r)/Math.log(2),s=Math.log(i/o)/Math.log(2);return Math.min(Math.max(.5*s+1,0),1*u)}},{key:"_getRFM",value:function(e,t){var n=1/(t-1);return(n*=e)*n}},{key:"_getSFM",value:function(e,t){return 0==e?1:Math.min(1<<t-1+2*e,8192)}},{key:"prepareShCoefs",value:function(t){var n=e._S_SQRT_PI,r=e._S_SQRT_3PI,_=e._S_SQRT_5PI,a=e._S_SQRT_15PI,i=1/(2*n),o=-r/2,u=-o,s=o,l=a/2,f=-l,m=_/4,c=f,h=a/4;t[0].multLength(i).multLength(e._S_SH_BAND_FACTOR[0]),t[1].multLength(o).multLength(e._S_SH_BAND_FACTOR[1]),t[2].multLength(-u).multLength(e._S_SH_BAND_FACTOR[2]),t[3].multLength(-s).multLength(e._S_SH_BAND_FACTOR[3]),t[4].multLength(-l).multLength(e._S_SH_BAND_FACTOR[4]),t[5].multLength(-f).multLength(e._S_SH_BAND_FACTOR[5]),t[6].multLength(m).multLength(e._S_SH_BAND_FACTOR[6]),t[7].multLength(c).multLength(e._S_SH_BAND_FACTOR[7]),t[8].multLength(h).multLength(e._S_SH_BAND_FACTOR[8])}},{key:"getShCoeffs",value:function(t,n,r,a){for(var i=[],o=0;o<9;o++)i.push(new _.default);for(var s,l=[],f=0,m=new _.default,c=new u.default,h=0;h<6;h++)for(var d=0;d<n;d++)for(var S=0;S<t;S++){s=e.getSAAV(S,d,t,h,m,a),e.evalShBasis(m,l),e._getPixelColor(S,d,t,n,r[h],c);for(var p=0;p<9;p++)i[p].setToInXYZ(i[p]._m_X+c._m_X*l[p]*s,i[p]._m_Y+c._m_Y*l[p]*s,i[p]._m_Z+c._m_Z*l[p]*s);f+=s}for(var g=0;g<9;++g)i[g].multLength(4*Math.PI/f);return i}},{key:"_getPixelColor",value:function(e,t,n,r,_,a){e*=4,a._m_X=_[t*n*4+e],a._m_Y=_[t*n*4+e+1],a._m_Z=_[t*n*4+e+2],a._m_W=_[t*n*4+e+3]}},{key:"evalShBasis",value:function(t,n){var r=t._m_X,_=t._m_Y,a=t._m_Z,i=r*r,o=_*_,u=a*a,s=e._S_SQRT_PI,l=e._S_SQRT_3PI,f=e._S_SQRT_5PI,m=e._S_SQRT_15PI;n[0]=1/(2*s),n[1]=-l*_/2,n[2]=l*a/2,n[3]=-l*r/2,n[4]=m*r*_/2,n[5]=-m*_*a/2,n[6]=f*(3*u-1)/4,n[7]=-m*r*a/2,n[8]=m*(i-o)/4}},{key:"getSAAV",value:function(t,n,r,_,a,i){var o,u,s,l,f=2*(t+.5)/(r*=1)-1,m=2*(n+.5)/r-1;e._getVFCFTC(t,n,r,_,a,i);var c=1/r;return o=f-c,u=m-c,s=f+c,l=m+c,e._areaElement(o,u)-e._areaElement(o,l)-e._areaElement(s,u)+e._areaElement(s,l)}},{key:"_areaElement",value:function(e,t){return Math.atan2(e*t,Math.sqrt(e*e+t*t+1))}},{key:"_getVFCFTC",value:function(t,n,r,_,a,i){var o,u;if(t*=1,n*=1,r*=1,i==e._S_FIX_SEAMS_METHOD.Stretch?(o=2*t/(r-1)-1,u=2*n/(r-1)-1):(o=2*(t+.5)/r-1,u=2*(n+.5)/r-1),i==e._S_FIX_SEAMS_METHOD.Wrap){var s=Math.pow(r,2)/Math.pow(r-1,3);o=s*Math.pow(o,3)+o,u=s*Math.pow(u,3)+u}switch(_){case 0:a.setToInXYZ(1,-u,-o);break;case 1:a.setToInXYZ(-1,-u,o);break;case 2:a.setToInXYZ(o,1,u);break;case 3:a.setToInXYZ(o,-1,-u);break;case 4:a.setToInXYZ(o,-u,1);break;case 5:a.setToInXYZ(-o,-u,-1)}return a.normal(),a}}]),e}();t.default=T,y(T,"_S_TEMP_UNIT_X",new _.default(1,0,0)),y(T,"_S_TEMP_UNIT_Y",new _.default(0,1,0)),y(T,"_S_TEMP_UNIT_Z",new _.default(0,0,1)),y(T,"_S_DEFAULT_CAPTURE_RESOLUTE",256),y(T,"_S_FIX_SEAMS_METHOD",{Wrap:0,Stretch:1,None:2}),y(T,"_S_SQRT_PI",Math.sqrt(Math.PI)),y(T,"_S_SQRT_3PI",Math.sqrt(3/Math.PI)),y(T,"_S_SQRT_5PI",Math.sqrt(5/Math.PI)),y(T,"_S_SQRT_15PI",Math.sqrt(15/Math.PI)),y(T,"_S_SH_BAND_FACTOR",[1,2/3,2/3,2/3,1/4,1/4,1/4,1/4,1/4])},5489:(e,t)=>{function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._head=[],this._headLength=0,this._tail=[],this._index=0,this._length=0}var t,r,_;return t=e,(r=[{key:"length",get:function(){return this._length}},{key:"shift",value:function(){if(this._index>=this._headLength){var e=this._head;if(e.length=0,this._head=this._tail,this._tail=e,this._index=0,this._headLength=this._head.length,!this._headLength)return}var t=this._head[this._index];return this._index<0?delete this._head[this._index++]:this._head[this._index++]=void 0,this._length--,t}},{key:"push",value:function(e){return this._length++,this._tail.push(e),this}},{key:"unshift",value:function(e){return this._head[--this._index]=e,this._length++,this}}])&&n(t.prototype,r),_&&n(t,_),e}();t.default=r},2475:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(n(5604)),_=o(n(2320)),a=o(n(1446)),i=o(n(7141));function o(e){return e&&e.__esModule?e:{default:e}}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,r=[{key:"mallocLightData",value:function(t){e.S_LIGHT_DATA=new a.default(3*t*4)}}],(n=null)&&u(t.prototype,n),r&&u(t,r),e}();t.default=l,s(l,"S_TEMP_VEC3",new r.default),s(l,"S_TEMP_VEC3_2",new r.default),s(l,"S_TEMP_VEC3_3",new r.default),s(l,"S_TEMP_VEC3_4",new r.default),s(l,"S_TEMP_VEC4",new i.default),s(l,"S_TEMP_VEC4_2",new i.default),s(l,"S_TEMP_VEC4_3",new i.default),s(l,"S_TEMP_MAT4",new _.default),s(l,"S_TEMP_MAT4_1",new _.default),s(l,"S_TEMP_MAT4_2",new _.default),s(l,"S_TEMP_MAT4_3",new _.default),s(l,"S_LIGHT_DATA_4",new a.default(48)),s(l,"S_LIGHT_DATA",l.S_LIGHT_DATA_4),s(l,"S_LIGHT_DATA_8",new a.default(96)),s(l,"S_SH_COEFFS",new a.default(27))},5397:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _BoundingVolume=_interopRequireDefault(__webpack_require__(1322)),_Vector=_interopRequireDefault(__webpack_require__(5604)),_Vector2=_interopRequireDefault(__webpack_require__(9271)),_Log=_interopRequireDefault(__webpack_require__(3846));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var o={lz:function(e,t){if("number"!=typeof t||t<=0||"number"!=typeof e&&"string"!=typeof e)return e;for(e+="";e.length<t;)e="0"+e;return e},getHashCode:function(e){for(var t=0,n="string"==typeof e?e.length:0,r=0;r<n;)t=(t<<5)-t+e.charCodeAt(r++);return t<0?-1*t+4294967295:t},uniqueId:function(e,t){if(null==e||"string"!=typeof e){o.___uqidc?++o.___uqidc:o.___uqidc=0;var n=e=(new Date).getTime()+""+o.___uqidc}else n=o.getHashCode(e);return(t?"res:":"")+n.toString(32)+"-"+o.lz((4*e.length).toString(16),3)}},Tools=function(){function Tools(){_classCallCheck(this,Tools)}return _createClass(Tools,null,[{key:"isPowerOfTwo",value:function(e){return 0==(e&e-1)}},{key:"nextHighestPowerOfTwo",value:function(e){--e;for(var t=1;t<32;t<<=1)e|=e>>t;return e+1}},{key:"ensureImageSizePowerOfTwo",value:function(e,t){Tools.isPowerOfTwo(e.width)&&Tools.isPowerOfTwo(e.height)||(t.width=Tools.nextHighestPowerOfTwo(e.width),t.height=Tools.nextHighestPowerOfTwo(e.height),t.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t.width,t.height),e=t);return e}},{key:"checkIsNull",value:function(e){return null!=e&&null!=e}},{key:"nextId",value:function(){return Tools.uniqueId(--Tools._s_Id+"R3D")}},{key:"insertLine",value:function(e,t,n){for(var r=(e=Tools.trim(e)).split("\n"),_="",a=0;a<r.length;a++)a==n&&(_+=t+"\n"),_+=r[a]+"\n";return _}},{key:"uniqueId",value:function(e){return o.uniqueId(e)}},{key:"getTagPattern",value:function getTagPattern(str){return eval("/"+str+"/g")}},{key:"getPattern",value:function getPattern(str){return eval("/"+str+"/")}},{key:"trim",value:function(e){return e.replace(/(^\s*)|(\s*$)/g,"")}},{key:"find",value:function(e,t){return-1!=e.search(t)}},{key:"find2",value:function(e,t){return e.search(t)}},{key:"repSrc",value:function(e,t,n,r){return-1!=e.search(t)?e.replace(n,r):e}},{key:"approxScreenArea",value:function(e,t,n){return e.getType()==_BoundingVolume.default.S_TYPE_AABB?(e.getXHalf()*e.getXHalf()+e.getYHalf()*e.getYHalf()+e.getZHalf()*e.getZHalf())*n*n/(t*t*4)*Math.PI:(e.getType(),_BoundingVolume.default.S_TYPE_SPHERE,0)}},{key:"generatorTangents2",value:function(e,t,n,r){for(var _=t.length/3,a=new Float32Array(4*_),i=[],o=[],u=0;u<_;u++)i[u]=new _Vector.default,o[u]=new _Vector.default;for(var s=new _Vector.default,l=new _Vector.default,f=new _Vector.default,m=new _Vector2.default,c=new _Vector2.default,h=new _Vector2.default,d=new _Vector.default,S=new _Vector.default,p=function(e,r,_){s.setToInXYZ(t[3*e],t[3*e+1],t[3*e+2]),l.setToInXYZ(t[3*r],t[3*r+1],t[3*r+2]),f.setToInXYZ(t[3*_],t[3*_+1],t[3*_+2]),m.setToInXY(n[2*e],n[2*e+1]),c.setToInXY(n[2*r],n[2*r+1]),h.setToInXY(n[2*_],n[2*_+1]),l.sub(s),f.sub(s),c.sub(m),h.sub(m);var a=1/(c._m_X*h._m_Y-h._m_X*c._m_Y);isFinite(a)&&(d.setTo(l),d.multLength(h._m_Y),d.addInXYZ(f._m_X*-c._m_Y,f._m_Y*-c._m_Y,f._m_Z*-c._m_Y),d.multLength(a),S.setTo(f),S.multLength(c._m_X),S.addInXYZ(l._m_X*-h._m_X,l._m_Y*-h._m_X,l._m_Z*-h._m_X),S.multLength(a),i[e].add(d),i[r].add(d),i[_].add(d),o[e].add(S),o[r].add(S),o[_].add(S))},g=0;g<e.length;g+=3)p(e[g+0],e[g+1],e[g+2]);for(var y,v,T,E=new _Vector.default,b=new _Vector.default,C=new _Vector.default,P=new _Vector.default,R=function(e){C.setToInXYZ(r[3*e],r[3*e+1],r[3*e+2]),P.setTo(C),v=i[e],E.setTo(v),E.sub(C.multLength(C.dot(v))).normal(),P.cross(v,b),T=b.dot(o[e]),y=T<0?-1:1,a[4*e]=E._m_X,a[4*e+1]=E._m_Y,a[4*e+2]=E._m_Z,a[4*e+3]=y},M=0;M<e.length;M+=3)R(e[M+0]),R(e[M+1]),R(e[M+2]);return a}},{key:"generatorFillTangents2",value:function(e){for(var t=4*(e.length/3),n=[],r=0;r<t;r++)n[r]=0;return n}},{key:"generatorFillTangents",value:function(e){for(var t=[],n=0;n<e.length;n++)t[n]=e[n];return t}},{key:"generatorTangents",value:function(e,t,n){for(var r=new _Vector.default,_=new _Vector.default,a=new Array(4).fill(0),i=0,o=0,u=0,s=0,l=[],f={},m=new _Vector.default,c=new _Vector.default,h=new _Vector.default,d=new _Vector2.default,S=new _Vector2.default,p=new _Vector2.default,g=new _Vector2.default,y=0,v=0,T=0,E=0,b=0;b<e.length;b+=3){m.setToInXYZ(t[3*e[b]],t[3*e[b]+1],t[3*e[b]+2]),c.setToInXYZ(t[3*e[b+1]],t[3*e[b+1]+1],t[3*e[b+1]+2]),h.setToInXYZ(t[3*e[b+2]],t[3*e[b+2]+1],t[3*e[b+2]+2]),d.setToInXY(n[2*e[b]],n[2*e[b]+1]),S.setToInXY(n[2*e[b+1]],n[2*e[b+1]+1]),p.setToInXY(n[2*e[b+2]],n[2*e[b+2]+1]),c.sub(m,r),h.sub(m,_),S.sub(d,g),y=g._m_X,v=g._m_Y,p.sub(d,g),T=g._m_X,E=g._m_Y,Tools._generatorDietaryUVMat(y,v,T,E,a);var C=(o=a[0]*r._m_X+a[1]*_._m_X)*o+(u=a[0]*r._m_Y+a[1]*_._m_Y)*u+(s=a[0]*r._m_Z+a[1]*_._m_Z)*s;o*=C=1/Math.sqrt(C),u*=C,s*=C,Tools._generatorWeightedTangent(e[b],e[b+1],e[b+2],o,u,s,f)}for(var P in Tools._normalizedTangents(f),f)l[i++]=f[P][0],l[i++]=f[P][1],l[i++]=f[P][2];return l}},{key:"_normalizedTangents",value:function(e){var t=[],n=0;for(var r in e)t[0]=e[r][0],t[1]=e[r][1],t[2]=e[r][2],(n=t[0]*t[0]+t[1]*t[1]+t[2]*t[2])>0?(n=Math.sqrt(1*n),t[0]/=n,t[1]/=n,t[2]/=n):t[0]=t[1]=t[2]=0,e[r][0]=t[0],e[r][1]=t[1],e[r][2]=t[2]}},{key:"_generatorWeightedTangent",value:function(e,t,n,r,_,a,i){Tools.checkIsNull(i[e])?i[e]=[.5*(r+i[e][0]),.5*(_+i[e][1]),.5*(a+i[e][2])]:i[e]=[r,_,a],Tools.checkIsNull(i[t])?i[t]=[.5*(r+i[t][0]),.5*(_+i[t][1]),.5*(a+i[t][2])]:i[t]=[r,_,a],Tools.checkIsNull(i[n])?i[n]=[.5*(r+i[n][0]),.5*(_+i[n][1]),.5*(a+i[n][2])]:i[n]=[r,_,a]}},{key:"_generatorDietaryUVMat",value:function(e,t,n,r,_){var a=1/(e*r-n*t);return _[0]=r*a,_[1]=-t*a,_[2]=-n*a,_[3]=e*a,_}}]),Tools}();exports.default=Tools,_defineProperty(Tools,"_s_Id",0)},6693:(e,t)=>{function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,_;return t=e,_=[{key:"setBufLocal",value:function(e,t,n,r,_,a,i,o){e.bindBuffer(n,t),e.vertexAttribPointer(r,_,a,!1,i,o),e.enableVertexAttribArray(r),e.bindBuffer(n,null)}},{key:"setVertexBuf",value:function(e,t,n,r,_,a,i,o,u,s){e.bindVertexArray(t);var l=e.createBuffer();return e.bindBuffer(n,l),e.bufferData(n,r,_),e.vertexAttribPointer(a,i,o,!1,u,s),e.enableVertexAttribArray(a),e.bindBuffer(n,null),e.bindVertexArray(null),l}},{key:"setIndicesBuf",value:function(e,t,n,r,_){e.bindVertexArray(t);var a=e.createBuffer();return e.bindBuffer(n,a),e.bufferData(n,r,_),e.bindVertexArray(null),e.bindBuffer(n,null),a}}],(r=null)&&n(t.prototype,r),_&&n(t,_),e}();t.default=r},7902:(e,t)=>{function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.Buffer=void 0;var r=function(){function e(t,n,r,_,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._m_Name=t,this._m_Loc=n||null,this._m_Width=r||0,this._m_Height=_||0,this._m_Format=a}var t,r,_;return t=e,(r=[{key:"setName",value:function(e){this._m_Name=e}},{key:"getName",value:function(){return this._m_Name}},{key:"setLoc",value:function(e){this._m_Loc=e}},{key:"getLoc",value:function(){return this._m_Loc}},{key:"setWidth",value:function(e){this._m_Width=e}},{key:"getWidth",value:function(){return this._m_Width}},{key:"setHeight",value:function(e){this._m_Height=e}},{key:"getHeight",value:function(){return this._m_Height}},{key:"setFormat",value:function(e){this._m_Format=e}},{key:"getFormat",value:function(){return this._m_Format}}])&&n(t.prototype,r),_&&n(t,_),e}();t.Buffer=r},7341:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(7902),_=o(n(2584)),a=(o(n(7280)),o(n(5776))),i=o(n(3846));function o(e){return e&&e.__esModule?e:{default:e}}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=function(){function e(t,n,r,_){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._m_Name=n,this._m_Framebuffer=t.createFramebuffer(),this._m_Textures=[],this._m_NameTextures={},this._m_MapTextures={},this._m_Buffers=[],this._m_MapBuffers={},this._m_DrawBuffers=[],this._m_Width=r,this._m_Height=_,this._m_RData={},this._m_FramePicture=null,this._m_FixedSize=!1}var t,n,o;return t=e,(n=[{key:"setFixedSize",value:function(e){this._m_FixedSize=e}},{key:"isFixedSize",value:function(){return this._m_FixedSize}},{key:"readPixels",value:function(e,t,n,r,_,a,i,o){_=_||0,a=a||0,i=i||this._m_Width,o=o||this._m_Height;var u=-1,s=null;switch(n){case e.RGBA16F:s=Float32Array,u=4;break;case e.RGBA8:case e.RGBA:s=r!=e.FLOAT?Uint8Array:Float32Array,u=4;break;case e.RGB16F:s=Float32Array,u=3;break;case e.RGB8:case e.RGB:s=r!=e.FLOAT?Uint8Array:Float32Array,u=3}e.getParameter(e.IMPLEMENTATION_COLOR_READ_FORMAT),e.getParameter(e.IMPLEMENTATION_COLOR_READ_TYPE);var l=new s(i*o*u);return e.readPixels(_,a,i,o,n,r,l),l}},{key:"getFramePicture",value:function(){return this._m_FramePicture}},{key:"getFrameBuffer",value:function(){return this._m_Framebuffer}},{key:"use",value:function(e){var t=e.getFrameContext();if(t.m_LastFrameBuffer!=this._m_Framebuffer){var n=e._m_Scene.getCanvas().getGLContext();n.bindFramebuffer(n.FRAMEBUFFER,this._m_Framebuffer),t.m_LastFrameBuffer=this._m_Framebuffer}}},{key:"clear",value:function(e){e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)}},{key:"addBuffer",value:function(e,t,n,_){var a;e.bindFramebuffer(e.FRAMEBUFFER,this._m_Framebuffer),a=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,a);var i=new r.Buffer(t,a,this._m_Width,this._m_Height,n);e.renderbufferStorage(e.RENDERBUFFER,n,this._m_Width,this._m_Height),e.framebufferRenderbuffer(e.FRAMEBUFFER,_,e.RENDERBUFFER,a),this._m_MapBuffers[_]=i,this._m_Buffers.push(i),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),this._rData("buffer",{name:t,format:n,attachId:_})}},{key:"_rData",value:function(e,t){this._m_RData[e]||(this._m_RData[e]={keys:{},values:[]}),this._m_RData[e].keys[t.name]||(this._m_RData[e].keys[t.name]=!0,this._m_RData[e].values.push(t))}},{key:"getBuffers",value:function(){return this._m_Buffers}},{key:"setMipMap",value:function(e,t,n,r){e.framebufferTexture2D(e.FRAMEBUFFER,n,e.TEXTURE_2D,this._m_NameTextures[t].getLoc(),r)}},{key:"addTexture",value:function(e,t,n,r,a,i,o,u,s){e.bindFramebuffer(e.FRAMEBUFFER,this._m_Framebuffer);var l=e.createTexture(),f=new _.default(t,l,n,this._m_Width,this._m_Height,r,a,i,null);e.bindTexture(e.TEXTURE_2D,l),e.texImage2D(e.TEXTURE_2D,0,n,this._m_Width,this._m_Height,0,a,i,null),s?(e.generateMipmap(e.TEXTURE_2D),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST)),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.framebufferTexture2D(e.FRAMEBUFFER,o,e.TEXTURE_2D,l,0),this._m_MapTextures[o]=f,this._m_Textures.push(f),this._m_NameTextures[t]=f,u&&this._m_DrawBuffers.push(o),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindTexture(e.TEXTURE_2D,null),this._rData("texture",{name:t,internalformat:n,border:r,format:a,type:i,attachId:o,toDrawBuffer:u,genMipmap:s})}},{key:"getTextures",value:function(){return this._m_Textures}},{key:"getTexture",value:function(e){return this._m_NameTextures[e]}},{key:"resize",value:function(e,t,n){var r=this;if(!this._m_FixedSize&&(this._m_Width!=t||this._m_Height!=n)){this._m_Width=t,this._m_Height=n,e.deleteFramebuffer(this._m_Framebuffer),this._m_Framebuffer=e.createFramebuffer(),this._m_Textures=[],this._m_NameTextures={},this._m_MapTextures={},this._m_Buffers=[],this._m_MapBuffers={},this._m_DrawBuffers=[];var _=null;for(var a in this._m_RData)_=this._m_RData[a].values,"buffer"==a?_.forEach((function(t){r.addBuffer(e,t.name,t.format,t.attachId)})):"texture"==a&&_.forEach((function(t){r.addTexture(e,t.name,t.internalformat,t.border,t.format,t.type,t.attachId,t.toDrawBuffer,t.genMipmap)}));this.finish(e)}}},{key:"finish",value:function(e,t,n){switch(e.bindFramebuffer(e.FRAMEBUFFER,this._m_Framebuffer),this._m_DrawBuffers.length>0&&e.drawBuffers(this._m_DrawBuffers),e.isFramebuffer(this._m_Framebuffer)||i.default.error("[["+this._m_Name+"]]无效frameBuffer!"),e.checkFramebufferStatus(e.FRAMEBUFFER)){case e.FRAMEBUFFER_COMPLETE:i.default.log("[["+this._m_Name+"]]帧缓冲区已准备好显示。");break;case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:i.default.error("[["+this._m_Name+"]]附件类型不匹配或不是所有的帧缓冲附件点都已完成。");break;case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:i.default.error("[["+this._m_Name+"]]没有附件。");break;case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:i.default.error("[["+this._m_Name+"]]附件的高度和宽度不同。");break;case e.FRAMEBUFFER_UNSUPPORTED:i.default.error("[["+this._m_Name+"]]不支持附件的格式，或者深度和模板附件的渲染缓冲区不同。")}e.bindFramebuffer(e.FRAMEBUFFER,null),n&&(this._m_FramePicture=new a.default(t,{id:this._m_Name+"_picture"}))}}])&&u(t.prototype,n),o&&u(t,o),e}();t.default=s},6798:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,_=(r=n(8435))&&r.__esModule?r:{default:r};function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.m_LastMaterial=null,this.m_LastIDrawable=null,this.m_LastSubShader=null,this.m_LastSubShaderId=null,this.m_LastFrameBuffer=null,this.m_SM=0,this.m_SS=0,this._m_BatchLightLastIndex=0,this._m_DefaultFrameBuffer=null,this.m_Contexts={},this.m_CalcContexts={},this.m_RenderState=new _.default(!0),this.m_FrameBuffers={},this.m_Shaders={},this._m_ContextBlocks={}}var t,n,r;return t=e,(n=[{key:"getBatchLightLastIndex",value:function(){return this._m_BatchLightLastIndex}},{key:"BatchLightLastIndex",set:function(e){this._m_BatchLightLastIndex=e}},{key:"resize",value:function(e,t,n){for(var r in this.m_FrameBuffers)this.m_FrameBuffers[r].resize(e,t,n)}},{key:"getContextBlock",value:function(e){return this._m_ContextBlocks[e]}},{key:"addContextBlock",value:function(e,t){this._m_ContextBlocks[e]=t}},{key:"getFrameBuffer",value:function(e){return this.m_FrameBuffers[e]}},{key:"addFrameBuffer",value:function(e,t){this.m_FrameBuffers[e]=t}},{key:"getRenderState",value:function(){return this.m_RenderState}},{key:"addContext",value:function(e){this.m_Contexts[e]=!0}},{key:"getContext",value:function(e){return this.m_Contexts[e]}},{key:"getCalcContexts",value:function(){return this.m_CalcContexts}},{key:"getCalcContext",value:function(e){return this.m_CalcContexts[e]}},{key:"setCalcContext",value:function(e,t){this.m_CalcContexts[e]=t}},{key:"reset",value:function(){this._m_BatchLightLastIndex=0,this.m_LastMaterial=null,this.m_LastSubShader=null,this.m_LastSubShaderId=null,this.m_LastFrameBuffer=null,this.m_SM=0,this.m_SS=0}}])&&a(t.prototype,n),r&&a(t,r),e}();t.default=i},307:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(n(6693)),_=o(n(9784)),a=o(n(3846)),i=o(n(2228));function o(e){return e&&e.__esModule?e:{default:e}}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._m_Datas={},this._m_Bufs={},this._m_VAO=null,this._m_GL=null,this._m_ElementCount=0,this._m_Primitive=e.S_PRIMITIVE_TRIANGLES,this._m_DrawPrimitive=null,this._m_DrawType=null,this._m_CurrentLod=0,this._m_DrawLod=0,this._m_LodLevels={},this._m_LodLevelCount=0}var t,n,o;return t=e,(n=[{key:"setPrimitive",value:function(t){if(this._m_Primitive=t,this._m_GL)switch(this._m_Primitive){case e.S_PRIMITIVE_TRIANGLES:this._m_DrawPrimitive=this._m_GL.TRIANGLES;break;case e.S_PRIMITIVE_LINES:this._m_DrawPrimitive=this._m_GL.LINES}}},{key:"getPrimitive",value:function(){return this._m_Primitive}},{key:"_checkDataType",value:function(t){return!!e.S_DATAS[t]||(console.error("type is undefined:"+t),!1)}},{key:"setData",value:function(e,t,n){this._checkDataType(e)&&n&&null!=n.level?(this._m_Datas[e]||(this._m_Datas[e]={lod:!0,datas:[],count:0}),this._m_Datas[e].count+=t.length,this._m_Datas[e].datas.push({data:t,level:n.level,count:t.length})):this._m_Datas[e]=t}},{key:"getData",value:function(e){return this._m_Datas[e]}},{key:"_refreshBufLocal",value:function(e,t){var n=this;t.forEach((function(e){n._m_Bufs[e.name]}))}},{key:"_updateBound",value:function(t){if(this._m_GL=t,this._m_Datas){for(var n in this._m_VAO||(this._m_VAO=t.createVertexArray()),this._m_Datas)switch(n){case e.S_POSITIONS:r.default.setVertexBuf(t,this._m_VAO,t.ARRAY_BUFFER,new Float32Array(this._m_Datas[n]),t.STATIC_DRAW,_.default.S_POSITION,3,t.FLOAT,0,0);break;case e.S_COLORS:r.default.setVertexBuf(t,this._m_VAO,t.ARRAY_BUFFER,new Float32Array(this._m_Datas[n]),t.STATIC_DRAW,_.default.S_COLOR,4,t.FLOAT,0,0);break;case e.S_NORMALS:r.default.setVertexBuf(t,this._m_VAO,t.ARRAY_BUFFER,new Float32Array(this._m_Datas[n]),t.STATIC_DRAW,_.default.S_NORMAL,3,t.FLOAT,0,0);break;case e.S_TANGENTS:r.default.setVertexBuf(t,this._m_VAO,t.ARRAY_BUFFER,new Float32Array(this._m_Datas[n]),t.STATIC_DRAW,_.default.S_TANGENT,4,t.FLOAT,0,0);break;case e.S_INDICES:if(this._m_DrawType=t.UNSIGNED_SHORT,this._m_Datas[n].lod){for(var a=this._m_Datas[n].datas,i=new Uint16Array(this._m_Datas[n].count),o=0,u=0,s=0,l=0;s<a.length;s++){this._m_LodLevels[a[s].level]={lod:l,count:a[s].count},this._m_LodLevelCount++;for(var f=0,m=0==u?0:u+1;f<a[s].data.length;f++)i[l++]=m+a[s].data[f],o=Math.max(a[s].data[f]+m,o);u=o,o=0}this._m_CurrentLod=-1,this.lod(0),r.default.setIndicesBuf(t,this._m_VAO,t.ELEMENT_ARRAY_BUFFER,i,t.STATIC_DRAW)}else this._m_ElementCount=this._m_Datas[n].length,r.default.setIndicesBuf(t,this._m_VAO,t.ELEMENT_ARRAY_BUFFER,new Uint16Array(this._m_Datas[n]),t.STATIC_DRAW);break;case e.S_INDICES_32:if(this._m_DrawType=t.UNSIGNED_INT,this._m_Datas[n].lod){for(var c=this._m_Datas[n].datas,h=new Uint32Array(this._m_Datas[n].count),d=0,S=0,p=0,g=0;p<c.length;p++){this._m_LodLevels[c[p].level]={lod:g,count:c[p].count},this._m_LodLevelCount++;for(var y=0,v=0==S?0:S+1;y<c[p].data.length;y++)h[g++]=v+c[p].data[y],d=Math.max(c[p].data[y]+v,d);S=d,d=0}this._m_CurrentLod=-1,this.lod(0),r.default.setIndicesBuf(t,this._m_VAO,t.ELEMENT_ARRAY_BUFFER,h,t.STATIC_DRAW)}else this._m_ElementCount=this._m_Datas[n].length,r.default.setIndicesBuf(t,this._m_VAO,t.ELEMENT_ARRAY_BUFFER,new Uint32Array(this._m_Datas[n]),t.STATIC_DRAW);break;case e.S_UV0:r.default.setVertexBuf(t,this._m_VAO,t.ARRAY_BUFFER,new Float32Array(this._m_Datas[n]),t.STATIC_DRAW,_.default.S_UV0,2,t.FLOAT,0,0);break;case e.S_UV1:r.default.setVertexBuf(t,this._m_VAO,t.ARRAY_BUFFER,new Float32Array(this._m_Datas[n]),t.STATIC_DRAW,_.default.S_UV1,2,t.FLOAT,0,0);break;case e.S_UV2:r.default.setVertexBuf(t,this._m_VAO,t.ARRAY_BUFFER,new Float32Array(this._m_Datas[n]),t.STATIC_DRAW,_.default.S_UV2,2,t.FLOAT,0,0);break;case e.S_UV3:r.default.setVertexBuf(t,this._m_VAO,t.ARRAY_BUFFER,new Float32Array(this._m_Datas[n]),t.STATIC_DRAW,_.default.S_UV3,2,t.FLOAT,0,0);break;case e.S_JOINTS_0:r.default.setVertexBuf(t,this._m_VAO,t.ARRAY_BUFFER,new Uint16Array(this._m_Datas[n]),t.STATIC_DRAW,_.default.S_JOINT_0,4,t.UNSIGNED_SHORT,0,0);break;case e.S_JOINTS_0_32:r.default.setVertexBuf(t,this._m_VAO,t.ARRAY_BUFFER,new Uint32Array(this._m_Datas[n]),t.STATIC_DRAW,_.default.S_JOINT_0,4,t.UNSIGNED_INT,0,0);break;case e.S_WEIGHTS_0:r.default.setVertexBuf(t,this._m_VAO,t.ARRAY_BUFFER,new Float32Array(this._m_Datas[n]),t.STATIC_DRAW,_.default.S_WEIGHT_0,4,t.FLOAT,0,0)}switch(this._m_Primitive){case e.S_PRIMITIVE_TRIANGLES:this._m_DrawPrimitive=this._m_GL.TRIANGLES;break;case e.S_PRIMITIVE_LINES:this._m_DrawPrimitive=this._m_GL.LINES}}}},{key:"draw",value:function(e){e.bindVertexArray(this._m_VAO),e.drawElements(this._m_DrawPrimitive,this._m_ElementCount,this._m_DrawType,this._m_DrawLod)}},{key:"lod",value:function(e){this._m_CurrentLod!=e&&(null!=this._m_LodLevels[e]?(this._m_CurrentLod=e,this._m_ElementCount=this._m_LodLevels[this._m_CurrentLod].count,this._m_DrawLod=this._m_LodLevels[this._m_CurrentLod].lod*i.default.sizeof(i.default.S_UNSIGNED_SHORT)):a.default.error("lod level "+e+"对于当前Mesh无效!"))}},{key:"getLodLevelCount",value:function(){return this._m_LodLevelCount}},{key:"getLodPrimitiveCount",value:function(t){if(null!=this._m_LodLevels[t]){var n=this._m_LodLevels[t].count;switch(this._m_Primitive){case e.S_PRIMITIVE_TRIANGLES:return n/3;case e.S_PRIMITIVE_LINES:return n/2}}else a.default.error("lod level "+t+"对于当前Mesh无效!");return 0}}])&&u(t.prototype,n),o&&u(t,o),e}();t.default=l,s(l,"S_POSITIONS","positions"),s(l,"S_COLORS","colors"),s(l,"S_NORMALS","normals"),s(l,"S_INDICES","indices"),s(l,"S_INDICES_32","indices32"),s(l,"S_TANGENTS","tangents"),s(l,"S_UV0","uv0"),s(l,"S_UV1","uv1"),s(l,"S_UV2","uv2"),s(l,"S_UV3","uv3"),s(l,"S_JOINTS_0","joints_0"),s(l,"S_JOINTS_0_32","joints_0"),s(l,"S_WEIGHTS_0","weights_0"),s(l,"S_DATAS",{positions:"positions",colors:"colors",normals:"normals",indices:"indices",indices32:"indices",tangents:"tangents",uv0:"uv0",uv1:"uv1",uv2:"uv2",uv3:"uv3",joints_0:"joints_0",weights_0:"weights_0"}),s(l,"S_PRIMITIVE_TRIANGLES","triangles"),s(l,"S_PRIMITIVE_LINES","lines")},8435:(e,t)=>{function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._m_State={},this._m_StoreState={_state:{},getState:function(){return this._state}},this._m_ResetState={_state:{},getState:function(){return this._state}},t&&this._init()}var t,r,_;return t=e,(r=[{key:"getState",value:function(){return this._m_State}},{key:"getFlag",value:function(e){return this._m_State[e]}},{key:"setFlag",value:function(e,t){this._m_State[e]=t}},{key:"store",value:function(){for(var e in this._m_State)this._m_StoreState._state[e]=this._m_State[e]}},{key:"restore",value:function(){return this._m_StoreState}},{key:"_init",value:function(){this._m_State[e.S_STATES[0]]=e.S_FACE_CULL_BACK,this._m_State[e.S_STATES[1]]="On",this._m_State[e.S_STATES[2]]="On",this._m_State[e.S_STATES[3]]="On",this._m_State[e.S_STATES[4]]="Off",this._m_State[e.S_STATES[6]]="Off",this._m_State[e.S_STATES[7]]="Off",this._m_ResetState._state[e.S_STATES[0]]=e.S_FACE_CULL_BACK,this._m_ResetState._state[e.S_STATES[1]]="On",this._m_ResetState._state[e.S_STATES[2]]="On",this._m_ResetState._state[e.S_STATES[3]]="On",this._m_ResetState._state[e.S_STATES[4]]="Off",this._m_ResetState._state[e.S_STATES[6]]="Off",this._m_ResetState._state[e.S_STATES[7]]="Off"}},{key:"reset",value:function(){return this._m_ResetState}}])&&n(t.prototype,r),_&&n(t,_),e}();t.default=_,r(_,"S_FACE_CULL_OFF","Off"),r(_,"S_FACE_CULL_BACK","Back"),r(_,"S_FACE_CULL_FRONT","Front"),r(_,"S_FACE_CULL_FRONT_AND_BACK","FrontAndBack"),r(_,"S_STATES",["FaceCull","DepthWrite","ColorWrite","DepthTest","Blend","BlendFactor","ScissorTest","PolygonOffsetFill","PolygonOffset"])},6616:(e,t)=>{function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._m_GL=t,this._m_Shader=t.createShader(n),t.shaderSource(this._m_Shader,r),t.compileShader(this._m_Shader),this.compile=t.getShaderParameter(this._m_Shader,t.COMPILE_STATUS),this.compile||(this.error=t.getShaderInfoLog(this._m_Shader),console.log("编译["+(n==t.VERTEX_SHADER?"vertex_shader":n==t.FRAGMENT_SHADER?"fragment_shader":"unknow_shader")+"]失败!原因:\n"+this.error))}var t,r,_;return t=e,(r=[{key:"getShader",value:function(){return this._m_Shader}},{key:"deleteShader",value:function(){this._m_GL.deleteShader(this._m_Shader),this._m_Shader=null}}])&&n(t.prototype,r),_&&n(t,_),e}();t.default=_,r(_,"S_TYPE",{float:"float",mat4:"mat4"}),r(_,"S_GLOBALS_MAT","layout (std140) uniform S_GLOBALS_MAT\n{\nmat4 Globals_ViewMatrix;\nmat4 Globals_ProjectMatrix;\nmat4 Globals_ViewProjectMatrix;\n};\n"),r(_,"S_GLOBALS_PARAMS",{viewMatrix:"Globals_ViewProjectMatrix",projectMatrix:"Globals_ProjectMatrix",viewProjectMatrix:"Globals_ViewProjectMatrix"})},9836:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=i(n(9784)),_=i(n(6616)),a=i(n(5397));function i(e){return e&&e.__esModule?e:{default:e}}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var u=function(){function e(t,n,_,a,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._m_DefId=n,this._m_vs_s=_.get(r.default.VERTEX_SHADER),this._m_fs_s=_.get(r.default.FRAGMENT_SHADER),this._m_vsDefines=a?a[r.default.VERTEX_SHADER]:null,this._m_fsDefines=a?a[r.default.FRAGMENT_SHADER]:null,this._m_Hold=0,this._m_Holds={},i?this._m_needCompile=!0:this._compile(t)}var t,n,i;return t=e,(n=[{key:"canDestroy",value:function(){return this._m_Hold<=0}},{key:"destroy",value:function(e,t){this._m_Program&&(e.deleteProgram(this._m_Program),t.m_Shaders[this._m_DefId]=null,this._m_Program=null)}},{key:"addHold",value:function(e){this._m_Hold++,this._m_Holds[e._m_ObjId]=e}},{key:"deleteHold",value:function(e){this._m_Hold--,this._m_Holds[e._m_ObjId]=null}},{key:"needCompile",value:function(){return this._m_needCompile}},{key:"_compile",value:function(e){if(this._m_needCompile=!1,this._m_vs_s&&(this._m_vsDefines&&(this._m_vs_s=a.default.insertLine(this._m_vs_s,this._m_vsDefines,1)),this._m_vs=new _.default(e,e.VERTEX_SHADER,this._m_vs_s)),this._m_fs_s&&(this._m_fsDefines&&(this._m_fs_s=a.default.insertLine(this._m_fs_s,this._m_fsDefines,1)),this._m_fs=new _.default(e,e.FRAGMENT_SHADER,this._m_fs_s)),this._m_Program=null,this._m_vs&&this._m_fs)if(this._m_vs.compile&&this._m_fs.compile){if(this._m_Program=e.createProgram(),e.attachShader(this._m_Program,this._m_vs.getShader()),e.attachShader(this._m_Program,this._m_fs.getShader()),e.linkProgram(this._m_Program),!e.getProgramParameter(this._m_Program,e.LINK_STATUS)){var t=e.getProgramInfoLog(this._m_Program);console.error("[["+name+"]]链接ShaderProgram异常:"+t),console.log("vs:\n"+this._m_vs_s),console.log("fs:\n"+this._m_fs_s)}this._m_vs.deleteShader(),this._m_fs.deleteShader()}else console.error("[["+name+"]]无法创建着色器程序,vs或fs编译失败!!"),console.log("vs:\n"+this._m_vs_s),console.log("fs:\n"+this._m_fs_s)}},{key:"use",value:function(e){e.useProgram(this._m_Program)}},{key:"getProgram",value:function(){return this._m_Program}}])&&o(t.prototype,n),i&&o(t,i),e}();t.default=u},9784:(e,t)=>{function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._m_Source={}}var t,r,_;return t=e,_=[{key:"resizeBatchLightSize",value:function(t){t!=e.S_BATCH_LIGHT_SIZE&&(e.S_BATCH_LIGHT_SIZE=3*t,e.Context_Data["Context.VLightData"].modifier="["+e.S_BATCH_LIGHT_SIZE+"]",e.Context_Data["Context.WLightData"].modifier="["+e.S_BATCH_LIGHT_SIZE+"]")}}],(r=[{key:"set",value:function(t,n){e.SOURCE_ENUM[t]?this._m_Source[t]=n:console.error("未知着色器类型:"+t)}},{key:"get",value:function(t){return e.SOURCE_ENUM[t]?this._m_Source[t]:(console.error("未知着色器类型:"+t),null)}}])&&n(t.prototype,r),_&&n(t,_),e}();t.default=_,r(_,"VERTEX_SHADER","vertex_shader"),r(_,"FRAGMENT_SHADER","fragment_shader"),r(_,"SOURCE_ENUM",{vertex_shader:"vertex_shader",fragment_shader:"fragment_shader"}),r(_,"S_POSITION",1),r(_,"S_COLOR",2),r(_,"S_NORMAL",3),r(_,"S_TANGENT",4),r(_,"S_UV0",5),r(_,"S_UV1",6),r(_,"S_UV2",7),r(_,"S_UV3",8),r(_,"S_JOINT_0",9),r(_,"S_WEIGHT_0",10),r(_,"S_MODEL_MATRIX",17),r(_,"S_VIEW_MATRIX",18),r(_,"S_PROJECT_MATRIX",19),r(_,"S_MVP",20),r(_,"S_MV",21),r(_,"S_VP",22),r(_,"S_NDP",23),r(_,"S_G_BUFFER0",0),r(_,"S_G_BUFFER1",1),r(_,"S_G_BUFFER2",2),r(_,"S_G_DEPTH",3),r(_,"S_POSITION_SRC","_position"),r(_,"S_COLOR_SRC","_color"),r(_,"S_NORMAL_SRC","_normal"),r(_,"S_TANGENT_SRC","_tangent"),r(_,"S_UV0_SRC","_uv0"),r(_,"S_UV1_SRC","_uv1"),r(_,"S_UV2_SRC","_uv2"),r(_,"S_UV3_SRC","_uv3"),r(_,"S_JOINT_0_SRC","_joint_0"),r(_,"S_WEIGHT_0_SRC","_weight_0"),r(_,"S_JOINTS_SRC","_joints"),r(_,"S_OUT_COLOR","_outColor"),r(_,"S_OUT_POSITION","gl_Position"),r(_,"S_MODEL_MATRIX_SRC","_model_matrix"),r(_,"S_VIEW_MATRIX_SRC","_view_matrix"),r(_,"S_PROJECT_MATRIX_SRC","_project_matrix"),r(_,"S_MVP_SRC","_model_view_project_matrix"),r(_,"S_MV_SRC","_model_view_matrix"),r(_,"S_VP_SRC","_view_project_matrix"),r(_,"S_NDP",""),r(_,"S_V_LIGHT_DATA_SRC","_vLightData"),r(_,"S_W_LIGHT_DATA_SRC","_wLightData"),r(_,"S_MULTI_ID_SRC","_multiId"),r(_,"S_BLEND_GI_PROBES","_blend_gi_probes"),r(_,"S_V_LIGHT_DATA0_SRC","_vLight_Data_0"),r(_,"S_V_LIGHT_DATA1_SRC","_vLight_Data_1"),r(_,"S_V_LIGHT_DATA2_SRC","_vLight_Data_2"),r(_,"S_W_LIGHT_DATA0_SRC","_wLight_Data_0"),r(_,"S_W_LIGHT_DATA1_SRC","_wLight_Data_1"),r(_,"S_W_LIGHT_DATA2_SRC","_wLight_Data_2"),r(_,"S_AMBIENT_LIGHT_COLOR","_ambientLightColor"),r(_,"S_CUR_LIGHT_COUNT_SRC","_curLightCount"),r(_,"S_NB_LIGHTS","_NB_LIGHTS"),r(_,"S_BATCH_LIGHT_SIZE",12),r(_,"S_CAMERA_POSITION_SRC","_cameraPosition"),r(_,"S_MAX_BONE",256),r(_,"S_SKINS_SRC","_C_SKINS"),r(_,"S_SRGB_SRC","_C_SRGB"),r(_,"S_GIPROBES_SRC","_C_GIPROBES"),r(_,"S_PSSM_SRC","_C_PSSM"),r(_,"S_POINTLIGHT_SHADOWS_SRC","_C_POINTLIGHT_SHADOWS"),r(_,"S_SPOTLIGHT_SHADOWS_SRC","_C_SPOTLIGHT_SHADOWS"),r(_,"S_FADE_SRC","_C_FADE"),r(_,"S_G_BUFFER0_SRC","_gBuffer0"),r(_,"S_G_BUFFER1_SRC","_gBuffer1"),r(_,"S_G_BUFFER2_SRC","_gBuffer2"),r(_,"S_G_DEPTH_SRC","_gDepth"),r(_,"S_G_DEPTH_RENDER_BUFFER_SRC","_gDepthRenderBuffer"),r(_,"S_SCREEN_SRC","_screen"),r(_,"S_FORWARD_COLOR_MAP_SRC","_forwardColorMap"),r(_,"S_IN_SCREEN_SRC","_inScreenMap"),r(_,"S_IN_DEPTH_SRC","_inDepthMap"),r(_,"S_LIGHT_NUM_SRC","_lightNum"),r(_,"S_TILE_LIGHT_DECODE_SRC","_tileLightDecode"),r(_,"S_TILE_LIGHT_INDEX_SRC","_tileLightIndex"),r(_,"S_TILE_LIGHT_OFFSET_SIZE","_tileLightOffsetSize"),r(_,"S_TILE_W_LIGHT_DATA_0","_tileWLightData0"),r(_,"S_TILE_V_LIGHT_DATA_0","_tileVLightData0"),r(_,"S_TILE_W_LIGHT_DATA_1","_tileWLightData1"),r(_,"S_TILE_V_LIGHT_DATA_1","_tileVLightData1"),r(_,"S_TILE_W_LIGHT_DATA_2","_tileWLightData2"),r(_,"S_TILE_V_LIGHT_DATA_2","_tileVLightData2"),r(_,"S_PREF_ENV_MAP_SRC","_prefEnvMap"),r(_,"S_WGIPROBE_SRC","_wGIProbe"),r(_,"S_SH_COEFFS_SRC","_ShCoeffs"),r(_,"S_RESOLUTION_INVERSE","_ResolutionInverse"),r(_,"S_SHADOW_MAP_ARRAY_SRC",{0:"_shadowMap0",1:"_shadowMap1",2:"_shadowMap2",3:"_shadowMap3",4:"_shadowMap4",5:"_shadowMap5",6:"_shadowMap6"}),r(_,"S_LIGHT_SHADOW_VP_ARRAY_SRC",{0:"_lightViewProjectMatrix0",1:"_lightViewProjectMatrix1",2:"_lightViewProjectMatrix2",3:"_lightViewProjectMatrix3",4:"_lightViewProjectMatrix4",5:"_lightViewProjectMatrix5",6:"_lightViewProjectMatrix6"}),r(_,"S_LIGHT_DIR","_lightDir"),r(_,"S_LIGHT_POS","_lightPos"),r(_,"S_SPLITS","_splits"),r(_,"S_FADEINFO","_fadeInfo"),r(_,"S_SHADOW_MAP_SIZE","_shadowMapSize"),r(_,"S_SHADOW_MAP_SIZE_INVERSE","_sMapSizeInverse"),r(_,"ContextBlocks",{S_VIEW_MATRIX_SRC:!0,S_PROJECT_MATRIX_SRC:!0,S_VP_SRC:!0}),r(_,"MAT","layout (std140) uniform MAT\n{\nmat4 "+_.S_VIEW_MATRIX_SRC+";\nmat4 "+_.S_PROJECT_MATRIX_SRC+";\nmat4 "+_.S_VP_SRC+";\n};\n"),r(_,"VIEW","layout (std140) uniform VIEW\n{\nvec3 "+_.S_CAMERA_POSITION_SRC+";\n};\n"),r(_,"BLOCKS",{MAT:{blockIndex:1,blockDef:_.MAT},VIEW:{blockIndex:2,blockDef:_.VIEW}}),r(_,"Context_RenderDataRefFBs",{_gBuffer0:"DefaultDeferredShadingFrameBuffer",_gBuffer1:"DefaultDeferredShadingFrameBuffer",_gBuffer2:"DefaultDeferredShadingFrameBuffer",_gDepth:"DefaultDeferredShadingFrameBuffer",_forwardColorMap:"DefaultForwardShadingFrameBuffer",_inScreenMap:"DefaultPostFilterShadingFrameBuffer",_inDepthMap:"DefaultPostFilterShadingFrameBuffer"}),r(_,"Context_Data",{"Context.InPosition":{src:_.S_POSITION_SRC,loc:_.S_POSITION,pattern:/Context.InPosition/,pattern2:/Context.InPosition[\s+-;.,\*\\]{1,}/,tagPattern:/Context.InPosition/g,tag:_.S_POSITION_SRC,type:"vec3"},"Context.InNormal":{src:_.S_NORMAL_SRC,loc:_.S_NORMAL,pattern:/Context.InNormal/,pattern2:/Context.InNormal[\s+-;.,\*\\]{1,}/,tagPattern:/Context.InNormal/g,tag:_.S_NORMAL_SRC,type:"vec3"},"Context.InTangent":{src:_.S_TANGENT_SRC,loc:_.S_TANGENT,pattern:/Context.InTangent/,pattern2:/Context.InTangent[\s+-;.,\*\\]{1,}/,tagPattern:/Context.InTangent/g,tag:_.S_TANGENT_SRC,type:"vec4"},"Context.InUv0":{src:_.S_UV0_SRC,loc:_.S_UV0,pattern:/Context.InUv0/,pattern2:/Context.InUv0[\s+-;.,\*\\]{1,}/,tagPattern:/Context.InUv0/g,tag:_.S_UV0_SRC,type:"vec2"},"Context.InJoint0":{src:_.S_JOINT_0_SRC,loc:_.S_JOINT_0,pattern:/Context.InJoint0/,pattern2:/Context.InJoint0[\s+-;.,\*\\]{1,}/,tagPattern:/Context.InJoint0/g,tag:_.S_JOINT_0_SRC,type:"vec4"},"Context.InWeight0":{src:_.S_WEIGHT_0_SRC,loc:_.S_WEIGHT_0,pattern:/Context.InWeight0/,pattern2:/Context.InWeight0[\s+-;.,\*\\]{1,}/,tagPattern:/Context.InWeight0/g,tag:_.S_WEIGHT_0_SRC,type:"vec4"},"Context.OutPosition":{src:_.S_OUT_POSITION,pattern:/Context.OutPosition/,pattern2:/Context.OutPosition[\s+-;.,\*\\]{1,}/,tagPattern:/Context.OutPosition/g,tag:"gl_Position"},"Context.ProjectViewModelMatrix":{src:_.S_MVP_SRC,pattern:/Context.ProjectViewModelMatrix/,pattern2:/Context.ProjectViewModelMatrix[\s+-;.,\*\\]{1,}/,tagPattern:/Context.ProjectViewModelMatrix/g,tag:"_model_view_project_matrix",type:"mat4",utype:"uniform mat4"},"Context.ViewMatrix":{src:_.S_VIEW_MATRIX_SRC,pattern:/Context.ViewMatrix/,pattern2:/Context.ViewMatrix[\s+-;.,\*\\]{1,}/,tagPattern:/Context.ViewMatrix/g,tag:_.S_VIEW_MATRIX_SRC,def:"MAT"},"Context.ProjectMatrix":{src:_.S_PROJECT_MATRIX_SRC,pattern:/Context.ProjectMatrix/,pattern2:/Context.ProjectMatrix[\s+-;.,\*\\]{1,}/,tagPattern:/Context.ProjectMatrix/g,tag:_.S_PROJECT_MATRIX_SRC,def:"MAT"},"Context.ModelMatrix":{src:_.S_MODEL_MATRIX_SRC,pattern:/Context.ModelMatrix/,pattern2:/Context.ModelMatrix[\s+-;.,\*\\]{1,}/,tagPattern:/Context.ModelMatrix/g,tag:_.S_MODEL_MATRIX_SRC,type:"mat4",utype:"uniform mat4"},"Context.ProjectViewMatrix":{src:_.S_VP_SRC,pattern:/Context.ProjectViewMatrix/,pattern2:/Context.ProjectViewMatrix[\s+-;.,\*\\]{1,}/,tagPattern:/Context.ProjectViewMatrix/g,tag:_.S_VP_SRC,def:"MAT"},"Context.OutColor":{src:_.S_OUT_COLOR,pattern:/Context.OutColor/,pattern2:/Context.OutColor[\s+-;.,\*\\]{1,}/,tagPattern:/Context.OutColor/g,tag:"_outColor",type:"out vec4"},"Context.Joints":{src:_.S_JOINTS_SRC,pattern:/Context.Joints/,pattern2:/Context.Joints[\s+-;.,\*\\]{1,}/,tagPattern:/Context.Joints/g,tag:_.S_JOINTS_SRC,type:"vec4",utype:"uniform mat4",modifier:"["+_.S_MAX_BONE+"]"},"Context.VLightData":{src:_.S_V_LIGHT_DATA_SRC,pattern:/Context.VLightData/,pattern2:/Context.VLightData[\s+-;.,\*\\]{1,}/,tagPattern:/Context.VLightData/g,tag:_.S_V_LIGHT_DATA_SRC,type:"vec4",utype:"uniform vec4",modifier:"["+_.S_BATCH_LIGHT_SIZE+"]"},"Context.MultiId":{src:_.S_MULTI_ID_SRC,pattern:/Context.MultiId/,pattern2:/Context.MultiId[\s+-;.,\*\\]{1,}/,tagPattern:/Context.MultiId/g,tag:_.S_MULTI_ID_SRC,type:"int",utype:"uniform int"},"Context.TileLightNum":{src:_.S_LIGHT_NUM_SRC,pattern:/Context.TileLightNum/,pattern2:/Context.TileLightNum[\s+-;.,\*\\]{1,}/,tagPattern:/Context.TileLightNum/g,tag:_.S_LIGHT_NUM_SRC,type:"int",utype:"uniform int"},"Context.TileLightOffsetSize":{src:_.S_TILE_LIGHT_OFFSET_SIZE,pattern:/Context.TileLightOffsetSize/,pattern2:/Context.TileLightOffsetSize[\s+-;.,\*\\]{1,}/,tagPattern:/Context.TileLightOffsetSize/g,tag:_.S_TILE_LIGHT_OFFSET_SIZE,type:"float",utype:"uniform float"},"Context.BlendGiProbes":{src:_.S_BLEND_GI_PROBES,pattern:/Context.BlendGiProbes/,pattern2:/Context.BlendGiProbes[\s+-;.,\*\\]{1,}/,tagPattern:/Context.BlendGiProbes/g,tag:_.S_BLEND_GI_PROBES,type:"bool",utype:"uniform bool"},"Context.VLight_Data_0":{src:_.S_V_LIGHT_DATA0_SRC,pattern:/Context.VLight_Data_0/,pattern2:/Context.VLight_Data_0[\s+-;.,\*\\]{1,}/,tagPattern:/Context.VLight_Data_0/g,tag:_.S_V_LIGHT_DATA0_SRC,type:"vec4",utype:"uniform vec4"},"Context.VLight_Data_1":{src:_.S_V_LIGHT_DATA1_SRC,pattern:/Context.VLight_Data_1/,pattern2:/Context.VLight_Data_1[\s+-;.,\*\\]{1,}/,tagPattern:/Context.VLight_Data_1/g,tag:_.S_V_LIGHT_DATA1_SRC,type:"vec4",utype:"uniform vec4"},"Context.VLight_Data_2":{src:_.S_V_LIGHT_DATA2_SRC,pattern:/Context.VLight_Data_2/,pattern2:/Context.VLight_Data_2[\s+-;.,\*\\]{1,}/,tagPattern:/Context.VLight_Data_2/g,tag:_.S_V_LIGHT_DATA2_SRC,type:"vec4",utype:"uniform vec4"},"Context.WLightData":{src:_.S_W_LIGHT_DATA_SRC,pattern:/Context.WLightData/,pattern2:/Context.WLightData[\s+-;.,\*\\]{1,}/,tagPattern:/Context.WLightData/g,tag:_.S_W_LIGHT_DATA_SRC,type:"vec4",utype:"uniform vec4",modifier:"["+_.S_BATCH_LIGHT_SIZE+"]"},"Context.WLight_Data_0":{src:_.S_W_LIGHT_DATA0_SRC,pattern:/Context.WLight_Data_0/,pattern2:/Context.WLight_Data_0[\s+-;.,\*\\]{1,}/,tagPattern:/Context.WLight_Data_0/g,tag:_.S_W_LIGHT_DATA0_SRC,type:"vec4",utype:"uniform vec4"},"Context.WLight_Data_1":{src:_.S_W_LIGHT_DATA1_SRC,pattern:/Context.WLight_Data_1/,pattern2:/Context.WLight_Data_1[\s+-;.,\*\\]{1,}/,tagPattern:/Context.WLight_Data_1/g,tag:_.S_W_LIGHT_DATA1_SRC,type:"vec4",utype:"uniform vec4"},"Context.WLight_Data_2":{src:_.S_W_LIGHT_DATA2_SRC,pattern:/Context.WLight_Data_2/,pattern2:/Context.WLight_Data_2[\s+-;.,\*\\]{1,}/,tagPattern:/Context.WLight_Data_2/g,tag:_.S_W_LIGHT_DATA2_SRC,type:"vec4",utype:"uniform vec4"},"Context.AmbientLightColor":{src:_.S_AMBIENT_LIGHT_COLOR,pattern:/Context.AmbientLightColor/,pattern2:/Context.AmbientLightColor[\s+-;.,\*\\]{1,}/,tagPattern:/Context.AmbientLightColor/g,tag:_.S_AMBIENT_LIGHT_COLOR,type:"vec3",utype:"uniform vec3"},"Context.CurLightCount":{src:_.S_CUR_LIGHT_COUNT_SRC,pattern:/Context.CurLightCount/,pattern2:/Context.CurLightCount[\s+-;.,\*\\]{1,}/,tagPattern:/Context.CurLightCount/g,tag:_.S_CUR_LIGHT_COUNT_SRC,type:"int",utype:"uniform int"},"Context.CameraPosition":{src:_.S_CAMERA_POSITION_SRC,pattern:/Context.CameraPosition/,pattern2:/Context.CameraPosition[\s+-;.,\*\\]{1,}/,tagPattern:/Context.CameraPosition/g,tag:_.S_CAMERA_POSITION_SRC,def:"VIEW"},"Context.WGIProbe":{src:_.S_WGIPROBE_SRC,pattern:/Context.WGIProbe/,pattern2:/Context.WGIProbe[\s+-;.,\*\\]{1,}/,tagPattern:/Context.WGIProbe/g,tag:_.S_WGIPROBE_SRC,type:"vec4",utype:"uniform vec4"},"Context.ShCoeffs":{src:_.S_SH_COEFFS_SRC,pattern:/Context.ShCoeffs/,pattern2:/Context.ShCoeffs[\s+-;.,\*\\]{1,}/,tagPattern:/Context.ShCoeffs/g,tag:_.S_SH_COEFFS_SRC,type:"vec3",utype:"uniform vec3",modifier:"[9]"},"Context.InGBuffer0":{src:_.S_G_BUFFER0_SRC,pattern:/Context.InGBuffer0/,pattern2:/Context.InGBuffer0[\s+-;.,\*\\]{1,}/,tagPattern:/Context.InGBuffer0/g,tag:_.S_G_BUFFER0_SRC,type:"sampler2D",utype:"uniform sampler2D",flag:"renderData"},"Context.InGBuffer1":{src:_.S_G_BUFFER1_SRC,pattern:/Context.InGBuffer1/,pattern2:/Context.InGBuffer1[\s+-;.,\*\\]{1,}/,tagPattern:/Context.InGBuffer1/g,tag:_.S_G_BUFFER1_SRC,type:"sampler2D",utype:"uniform sampler2D",flag:"renderData"},"Context.InGBuffer2":{src:_.S_G_BUFFER2_SRC,pattern:/Context.InGBuffer2/,pattern2:/Context.InGBuffer2[\s+-;.,\*\\]{1,}/,tagPattern:/Context.InGBuffer2/g,tag:_.S_G_BUFFER2_SRC,type:"sampler2D",utype:"uniform sampler2D",flag:"renderData"},"Context.InGDepth":{src:_.S_G_DEPTH_SRC,pattern:/Context.InGDepth/,pattern2:/Context.InGDepth[\s+-;.,\*\\]{1,}/,tagPattern:/Context.InGDepth/g,tag:_.S_G_DEPTH_SRC,type:"sampler2D",utype:"uniform sampler2D",flag:"renderData"},"Context.InScreen":{src:_.S_IN_SCREEN_SRC,pattern:/Context.InScreen/,pattern2:/Context.InScreen[\s+-;.,\*\\]{1,}/,tagPattern:/Context.InScreen/g,tag:_.S_IN_SCREEN_SRC,type:"sampler2D",utype:"uniform sampler2D",flag:"renderData"},"Context.InDepth":{src:_.S_IN_DEPTH_SRC,pattern:/Context.InDepth/,pattern2:/Context.InDepth[\s+-;.,\*\\]{1,}/,tagPattern:/Context.InDepth/g,tag:_.S_IN_DEPTH_SRC,type:"sampler2D",utype:"uniform sampler2D",flag:"renderData"},"Context.InForwardColorMap":{src:_.S_FORWARD_COLOR_MAP_SRC,pattern:/Context.InForwardColorMap/,pattern2:/Context.InForwardColorMap[\s+-;.,\*\\]{1,}/,tagPattern:/Context.InForwardColorMap/g,tag:_.S_FORWARD_COLOR_MAP_SRC,type:"sampler2D",utype:"uniform sampler2D",flag:"renderData"},"Context.InPrefEnvMap":{src:_.S_PREF_ENV_MAP_SRC,pattern:/Context.InPrefEnvMap/,pattern2:/Context.InPrefEnvMap[\s+-;.,\*\\]{1,}/,tagPattern:/Context.InPrefEnvMap/g,tag:_.S_PREF_ENV_MAP_SRC,type:"samplerCube",utype:"uniform samplerCube"},"Context.InTileLightDecode":{src:_.S_TILE_LIGHT_DECODE_SRC,pattern:/Context.InTileLightDecode/,pattern2:/Context.InTileLightDecode[\s+-;.,\*\\]{1,}/,tagPattern:/Context.InTileLightDecode/g,tag:_.S_TILE_LIGHT_DECODE_SRC,type:"sampler2D",utype:"uniform sampler2D"},"Context.InTileLightIndex":{src:_.S_TILE_LIGHT_INDEX_SRC,pattern:/Context.InTileLightIndex/,pattern2:/Context.InTileLightIndex[\s+-;.,\*\\]{1,}/,tagPattern:/Context.InTileLightIndex/g,tag:_.S_TILE_LIGHT_INDEX_SRC,type:"sampler2D",utype:"uniform sampler2D"},"Context.InTileWLightData0":{src:_.S_TILE_W_LIGHT_DATA_0,pattern:/Context.InTileWLightData0/,pattern2:/Context.InTileWLightData0[\s+-;.,\*\\]{1,}/,tagPattern:/Context.InTileWLightData0/g,tag:_.S_TILE_W_LIGHT_DATA_0,type:"sampler2D",utype:"uniform sampler2D"},"Context.InTileVLightData0":{src:_.S_TILE_V_LIGHT_DATA_0,pattern:/Context.InTileVLightData0/,pattern2:/Context.InTileVLightData0[\s+-;.,\*\\]{1,}/,tagPattern:/Context.InTileVLightData0/g,tag:_.S_TILE_V_LIGHT_DATA_0,type:"sampler2D",utype:"uniform sampler2D"},"Context.InTileWLightData1":{src:_.S_TILE_W_LIGHT_DATA_1,pattern:/Context.InTileWLightData1/,pattern2:/Context.InTileWLightData1[\s+-;.,\*\\]{1,}/,tagPattern:/Context.InTileWLightData1/g,tag:_.S_TILE_W_LIGHT_DATA_1,type:"sampler2D",utype:"uniform sampler2D"},"Context.InTileVLightData1":{src:_.S_TILE_V_LIGHT_DATA_1,pattern:/Context.InTileVLightData1/,pattern2:/Context.InTileVLightData1[\s+-;.,\*\\]{1,}/,tagPattern:/Context.InTileVLightData1/g,tag:_.S_TILE_V_LIGHT_DATA_1,type:"sampler2D",utype:"uniform sampler2D"},"Context.InTileWLightData2":{src:_.S_TILE_W_LIGHT_DATA_2,pattern:/Context.InTileWLightData2/,pattern2:/Context.InTileWLightData2[\s+-;.,\*\\]{1,}/,tagPattern:/Context.InTileWLightData2/g,tag:_.S_TILE_W_LIGHT_DATA_2,type:"sampler2D",utype:"uniform sampler2D"},"Context.InTileVLightData2":{src:_.S_TILE_V_LIGHT_DATA_2,pattern:/Context.InTileVLightData2/,pattern2:/Context.InTileVLightData2[\s+-;.,\*\\]{1,}/,tagPattern:/Context.InTileVLightData2/g,tag:_.S_TILE_V_LIGHT_DATA_2,type:"sampler2D",utype:"uniform sampler2D"},"Context.InShadowMap0":{src:_.S_SHADOW_MAP_ARRAY_SRC[0],pattern:/Context.InShadowMap0/,pattern2:/Context.InShadowMap0[\s+-;.,\*\\]{1,}/,tagPattern:/Context.InShadowMap0/g,tag:_.S_SHADOW_MAP_ARRAY_SRC[0],type:"sampler2D",utype:"uniform sampler2D"},"Context.InShadowMap1":{src:_.S_SHADOW_MAP_ARRAY_SRC[1],pattern:/Context.InShadowMap1/,pattern2:/Context.InShadowMap1[\s+-;.,\*\\]{1,}/,tagPattern:/Context.InShadowMap1/g,tag:_.S_SHADOW_MAP_ARRAY_SRC[1],type:"sampler2D",utype:"uniform sampler2D"},"Context.InShadowMap2":{src:_.S_SHADOW_MAP_ARRAY_SRC[2],pattern:/Context.InShadowMap2/,pattern2:/Context.InShadowMap2[\s+-;.,\*\\]{1,}/,tagPattern:/Context.InShadowMap2/g,tag:_.S_SHADOW_MAP_ARRAY_SRC[2],type:"sampler2D",utype:"uniform sampler2D"},"Context.InShadowMap3":{src:_.S_SHADOW_MAP_ARRAY_SRC[3],pattern:/Context.InShadowMap3/,pattern2:/Context.InShadowMap3[\s+-;.,\*\\]{1,}/,tagPattern:/Context.InShadowMap3/g,tag:_.S_SHADOW_MAP_ARRAY_SRC[3],type:"sampler2D",utype:"uniform sampler2D"},"Context.InShadowMap4":{src:_.S_SHADOW_MAP_ARRAY_SRC[4],pattern:/Context.InShadowMap4/,pattern2:/Context.InShadowMap4[\s+-;.,\*\\]{1,}/,tagPattern:/Context.InShadowMap4/g,tag:_.S_SHADOW_MAP_ARRAY_SRC[4],type:"sampler2D",utype:"uniform sampler2D"},"Context.InShadowMap5":{src:_.S_SHADOW_MAP_ARRAY_SRC[5],pattern:/Context.InShadowMap5/,pattern2:/Context.InShadowMap5[\s+-;.,\*\\]{1,}/,tagPattern:/Context.InShadowMap5/g,tag:_.S_SHADOW_MAP_ARRAY_SRC[5],type:"sampler2D",utype:"uniform sampler2D"},"Context.InShadowMap6":{src:_.S_SHADOW_MAP_ARRAY_SRC[6],pattern:/Context.InShadowMap6/,pattern2:/Context.InShadowMap6[\s+-;.,\*\\]{1,}/,tagPattern:/Context.InShadowMap6/g,tag:_.S_SHADOW_MAP_ARRAY_SRC[6],type:"sampler2D",utype:"uniform sampler2D"},"Context.LightViewProjectMatrix0":{src:_.S_LIGHT_SHADOW_VP_ARRAY_SRC[0],pattern:/Context.LightViewProjectMatrix0/,pattern2:/Context.LightViewProjectMatrix0[\s+-;.,\*\\]{1,}/,tagPattern:/Context.LightViewProjectMatrix0/g,tag:_.S_LIGHT_SHADOW_VP_ARRAY_SRC[0],type:"mat4",utype:"uniform mat4"},"Context.LightViewProjectMatrix1":{src:_.S_LIGHT_SHADOW_VP_ARRAY_SRC[1],pattern:/Context.LightViewProjectMatrix1/,pattern2:/Context.LightViewProjectMatrix1[\s+-;.,\*\\]{1,}/,tagPattern:/Context.LightViewProjectMatrix1/g,tag:_.S_LIGHT_SHADOW_VP_ARRAY_SRC[1],type:"mat4",utype:"uniform mat4"},"Context.LightViewProjectMatrix2":{src:_.S_LIGHT_SHADOW_VP_ARRAY_SRC[2],pattern:/Context.LightViewProjectMatrix2/,pattern2:/Context.LightViewProjectMatrix2[\s+-;.,\*\\]{1,}/,tagPattern:/Context.LightViewProjectMatrix2/g,tag:_.S_LIGHT_SHADOW_VP_ARRAY_SRC[2],type:"mat4",utype:"uniform mat4"},"Context.LightViewProjectMatrix3":{src:_.S_LIGHT_SHADOW_VP_ARRAY_SRC[3],pattern:/Context.LightViewProjectMatrix3/,pattern2:/Context.LightViewProjectMatrix3[\s+-;.,\*\\]{1,}/,tagPattern:/Context.LightViewProjectMatrix3/g,tag:_.S_LIGHT_SHADOW_VP_ARRAY_SRC[3],type:"mat4",utype:"uniform mat4"},"Context.LightViewProjectMatrix4":{src:_.S_LIGHT_SHADOW_VP_ARRAY_SRC[4],pattern:/Context.LightViewProjectMatrix4/,pattern2:/Context.LightViewProjectMatrix4[\s+-;.,\*\\]{1,}/,tagPattern:/Context.LightViewProjectMatrix4/g,tag:_.S_LIGHT_SHADOW_VP_ARRAY_SRC[4],type:"mat4",utype:"uniform mat4"},"Context.LightViewProjectMatrix5":{src:_.S_LIGHT_SHADOW_VP_ARRAY_SRC[5],pattern:/Context.LightViewProjectMatrix5/,pattern2:/Context.LightViewProjectMatrix5[\s+-;.,\*\\]{1,}/,tagPattern:/Context.LightViewProjectMatrix5/g,tag:_.S_LIGHT_SHADOW_VP_ARRAY_SRC[5],type:"mat4",utype:"uniform mat4"},"Context.LightViewProjectMatrix6":{src:_.S_LIGHT_SHADOW_VP_ARRAY_SRC[6],pattern:/Context.LightViewProjectMatrix6/,pattern2:/Context.LightViewProjectMatrix6[\s+-;.,\*\\]{1,}/,tagPattern:/Context.LightViewProjectMatrix6/g,tag:_.S_LIGHT_SHADOW_VP_ARRAY_SRC[6],type:"mat4",utype:"uniform mat4"},"Context.LightDir":{src:_.S_LIGHT_DIR,pattern:/Context.LightDir/,pattern2:/Context.LightDir[\s+-;.,\*\\]{1,}/,tagPattern:/Context.LightDir/g,tag:_.S_LIGHT_DIR,type:"vec3",utype:"uniform vec3"},"Context.LightPos":{src:_.S_LIGHT_POS,pattern:/Context.LightPos/,pattern2:/Context.LightPos[\s+-;.,\*\\]{1,}/,tagPattern:/Context.LightPos/g,tag:_.S_LIGHT_POS,type:"vec3",utype:"uniform vec3"},"Context.Splits":{src:_.S_SPLITS,pattern:/Context.Splits/,pattern2:/Context.Splits[\s+-;.,\*\\]{1,}/,tagPattern:/Context.Splits/g,tag:_.S_SPLITS,type:"vec4",utype:"uniform vec4"},"Context.Fadeinfo":{src:_.S_FADEINFO,pattern:/Context.Fadeinfo/,pattern2:/Context.Fadeinfo[\s+-;.,\*\\]{1,}/,tagPattern:/Context.Fadeinfo/g,tag:_.S_FADEINFO,type:"vec2",utype:"uniform vec2"},"Context.ResolutionInverse":{src:_.S_RESOLUTION_INVERSE,pattern:/Context.ResolutionInverse/,pattern2:/Context.ResolutionInverse[\s+-;.,\*\\]{1,}/,tagPattern:/Context.ResolutionInverse/g,tag:_.S_RESOLUTION_INVERSE,type:"vec2",utype:"uniform vec2"},"Context.ShadowMapSize":{src:_.S_SHADOW_MAP_SIZE,pattern:/Context.ShadowMapSize/,pattern2:/Context.ShadowMapSize[\s+-;.,\*\\]{1,}/,tagPattern:/Context.ShadowMapSize/g,tag:_.S_SHADOW_MAP_SIZE,type:"float",utype:"uniform float"},"Context.SMapSizeInverse":{src:_.S_SHADOW_MAP_SIZE_INVERSE,pattern:/Context.SMapSizeInverse/,pattern2:/Context.SMapSizeInverse[\s+-;.,\*\\]{1,}/,tagPattern:/Context.SMapSizeInverse/g,tag:_.S_SHADOW_MAP_SIZE_INVERSE,type:"vec2",utype:"uniform vec2"},"Context.OutGBuffer0":{src:_.S_G_BUFFER0_SRC,loc:_.S_G_BUFFER0,pattern:/Context.OutGBuffer0/,pattern2:/Context.OutGBuffer0[\s+-;.,\*\\]{1,}/,tagPattern:/Context.OutGBuffer0/g,tag:_.S_G_BUFFER0_SRC,type:"vec4"},"Context.OutGBuffer1":{src:_.S_G_BUFFER1_SRC,loc:_.S_G_BUFFER1,pattern:/Context.OutGBuffer1/,pattern2:/Context.OutGBuffer1[\s+-;.,\*\\]{1,}/,tagPattern:/Context.OutGBuffer1/g,tag:_.S_G_BUFFER1_SRC,type:"vec4"},"Context.OutGBuffer2":{src:_.S_G_BUFFER2_SRC,loc:_.S_G_BUFFER2,pattern:/Context.OutGBuffer2/,pattern2:/Context.OutGBuffer2[\s+-;.,\*\\]{1,}/,tagPattern:/Context.OutGBuffer2/g,tag:_.S_G_BUFFER2_SRC,type:"vec4"},"Context.OutGDepth":{src:_.S_G_DEPTH_SRC,loc:_.S_G_DEPTH,pattern:/Context.OutGDepth/,pattern2:/Context.OutGDepth[\s+-;.,\*\\]{1,}/,tagPattern:/Context.OutGDepth/g,tag:_.S_G_DEPTH_SRC,type:"vec4"},"Context.Skins":{src:_.S_SKINS_SRC,pattern:/Context.Skins/,pattern2:/Context.Skins[\s+-;.,\*\\]{1,}/,tagPattern:/Context.Skins/g,tag:_.S_SKINS_SRC,isFlagVariable:!0},"Context.Srgb":{src:_.S_SRGB_SRC,pattern:/Context.Srgb/,pattern2:/Context.Srgb[\s+-;.,\*\\]{1,}/,tagPattern:/Context.Srgb/g,tag:_.S_SRGB_SRC,isFlagVariable:!0},"Context.GIProbes":{src:_.S_GIPROBES_SRC,pattern:/Context.GIProbes/,pattern2:/Context.GIProbes[\s+-;.,\*\\]{1,}/,tagPattern:/Context.GIProbes/g,tag:_.S_GIPROBES_SRC,isFlagVariable:!0},"Context.Pssm":{src:_.S_PSSM_SRC,pattern:/Context.Pssm/,pattern2:/Context.Pssm[\s+-;.,\*\\]{1,}/,tagPattern:/Context.Pssm/g,tag:_.S_PSSM_SRC,isFlagVariable:!0},"Context.PointLightShadows":{src:_.S_POINTLIGHT_SHADOWS_SRC,pattern:/Context.PointLightShadows/,pattern2:/Context.PointLightShadows[\s+-;.,\*\\]{1,}/,tagPattern:/Context.PointLightShadows/g,tag:_.S_POINTLIGHT_SHADOWS_SRC,isFlagVariable:!0},"Context.SpotLightShadows":{src:_.S_SPOTLIGHT_SHADOWS_SRC,pattern:/Context.SpotLightShadows/,pattern2:/Context.SpotLightShadows[\s+-;.,\*\\]{1,}/,tagPattern:/Context.SpotLightShadows/g,tag:_.S_SPOTLIGHT_SHADOWS_SRC,isFlagVariable:!0},"Context.Fade":{src:_.S_FADE_SRC,pattern:/Context.Fade/,pattern2:/Context.Fade[\s+-;.,\*\\]{1,}/,tagPattern:/Context.Fade/g,tag:_.S_FADE_SRC,isFlagVariable:!0},_C_SKINS:"#define "+_.S_SKINS_SRC+" "+_.S_SKINS_SRC,_C_SRGB:"#define "+_.S_SRGB_SRC+" "+_.S_SRGB_SRC,_C_GIPROBES:"#define "+_.S_GIPROBES_SRC+" "+_.S_GIPROBES_SRC,_C_PSSM:"#define "+_.S_PSSM_SRC+" "+_.S_PSSM_SRC,_C_POINTLIGHT_SHADOWS:"#define "+_.S_POINTLIGHT_SHADOWS_SRC+" "+_.S_POINTLIGHT_SHADOWS_SRC,_C_SPOTLIGHT_SHADOWS:"#define "+_.S_SPOTLIGHT_SHADOWS_SRC+" "+_.S_SPOTLIGHT_SHADOWS_SRC,_FADE:"#define "+_.S_FADE_SRC+" "+_.S_FADE_SRC})},2228:(e,t)=>{function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,_,a,i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,_;return t=e,_=[{key:"sizeof",value:function(t){return t===e.S_UNSIGNED_SHORT?2:-1}}],(r=null)&&n(t.prototype,r),_&&n(t,_),e}();t.default=i,a=1,(_="S_UNSIGNED_SHORT")in(r=i)?Object.defineProperty(r,_,{value:a,enumerable:!0,configurable:!0,writable:!0}):r[_]=a},2584:(e,t)=>{function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(){function e(t,n,r,_,a,i,o,u,s){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._m_Name=t,this._m_Loc=n,this._m_InternalFormat=r,this._m_Widht=_,this._m_Height=a,this._m_Border=i,this._m_Format=o,this._m_Type=u,this._m_Data=s}var t,r,_;return t=e,(r=[{key:"setName",value:function(e){this._m_Name=e}},{key:"getName",value:function(){return this._m_Name}},{key:"setLoc",value:function(e){this._m_Loc=e}},{key:"getLoc",value:function(){return this._m_Loc}},{key:"setInternalFormat",value:function(e){this._m_InternalFormat=e}},{key:"getInternalFormat",value:function(){return this._m_InternalFormat}},{key:"setWidth",value:function(e){this._m_Widht=e}},{key:"getWidth",value:function(){return this._m_Widht}},{key:"setHeihgt",value:function(e){this._m_Height=e}},{key:"getHeight",value:function(){return this._m_Height}},{key:"setBorder",value:function(e){this._m_Border=e}},{key:"getBorder",value:function(){return this._m_Border}},{key:"setFormat",value:function(e){this._m_Format=e}},{key:"getFormat",value:function(){return this._m_Format}},{key:"setType",value:function(e){this._m_Type=e}},{key:"getType",value:function(){return this._m_Type}},{key:"setData",value:function(e){this._m_Data=e}},{key:"getData",value:function(){return this._m_Data}}])&&n(t.prototype,r),_&&n(t,_),e}();t.default=r},1446:(e,t)=>{function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._m_Buffer=new Float32Array(t),this._m_Array=new Array(t).fill(0)}var t,r,_;return t=e,(r=[{key:"getArray",value:function(){return this._m_Array}},{key:"getBufferData",value:function(){return this._m_Buffer.set(this._m_Array),this._m_Buffer}}])&&n(t.prototype,r),_&&n(t,_),e}();t.default=r},6140:(e,t)=>{function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._m_Buffer=new Uint8Array(t),this._m_Array=new Array(t).fill(0)}var t,r,_;return t=e,(r=[{key:"getArray",value:function(){return this._m_Array}},{key:"getBufferData",value:function(){return this._m_Buffer.set(this._m_Array),this._m_Buffer}}])&&n(t.prototype,r),_&&n(t,_),e}();t.default=r},1491:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}var _;function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t){return i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},i(e,t)}function o(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=s(e);if(t){var _=s(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return u(this,n)}}function u(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function s(e){return s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},s(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var l=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(u,e);var t,n,r,_=o(u);function u(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(t=_.call(this,e))._m_Bool=!1,t}return t=u,(n=[{key:"valueOf",value:function(e){return this._m_Bool=e,this}},{key:"compare",value:function(e){return!1}},{key:"_upload",value:function(e,t,n){e.uniform1i(t,this._m_Bool)}}])&&a(t.prototype,n),r&&a(t,r),u}(((_=n(3552))&&_.__esModule?_:{default:_}).default);t.default=l},1759:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}var _;function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t){return i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},i(e,t)}function o(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=s(e);if(t){var _=s(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return u(this,n)}}function u(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function s(e){return s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},s(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var l=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(u,e);var t,n,r,_=o(u);function u(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(t=_.call(this,e))._m_Float=0,t}return t=u,(n=[{key:"valueOf",value:function(e){return this._m_Float=e,this}},{key:"compare",value:function(e){return!1}},{key:"_upload",value:function(e,t,n){e.uniform1f(t,this._m_Float)}}])&&a(t.prototype,n),r&&a(t,r),u}(((_=n(3552))&&_.__esModule?_:{default:_}).default);t.default=l},1359:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=i(n(3552)),a=(i(n(6140)),i(n(1446)));function i(e){return e&&e.__esModule?e:{default:e}}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t){return u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},u(e,t)}function s(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m(e);if(t){var _=m(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return l(this,n)}}function l(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return f(e)}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function m(e){return m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},m(e)}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var h=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(a,e);var t,n,r,_=s(a);function a(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),c(f(t=_.call(this,e)),"_m_Target",void 0),t._m_Scene=e;var n=e.getCanvas().getGLContext();return a.S_TEXTURE_FORMAT={S_RGB:n.RGB,S_RGBA:n.RGBA,S_RGB16F:n.RGB16F,S_RGB32F:n.RGB32F,S_RGBA16F:n.RGBA16F,S_RGBA32F:n.RGBA32F,S_RGBE5:n.RGB9_E5,S_SRGB:n.SRGB,S_SRGB8:n.SRGB8,S_SRGBA:n.SRGB8_ALPHA8,S_DEPTH_COMPONENT24:n.DEPTH_COMPONENT24,S_DEPTH_COMPONENT:n.DEPTH_COMPONENT,S_SHORT:n.SHORT,S_INT:n.INT,S_BYTE:n.BYTE,S_UNSIGNED_BYTE:n.UNSIGNED_BYTE,S_FLOAT:n.FLOAT},t._m_Texture=n.createTexture(),t._setFilter(e,n.TEXTURE_MIN_FILTER,n.NEAREST),t._setFilter(e,n.TEXTURE_MAG_FILTER,n.LINEAR),t._m_Internalformat=n.RGBA16F,t._m_Format=n.RGBA,t._m_Type=n.FLOAT,t._m_UpdateImage=!1,t._m_Image=null,t._m_Rgbe=!1,t._m_Width=t._m_Scene.getCanvas().getWidth(),t._m_Height=t._m_Scene.getCanvas().getHeight(),t._m_FlipY=!1,t._m_Alignment=4,t._m_WrapS=null,t._m_WrapT=null,t._m_MinFilter=a.S_FILTERS.S_LINEAR_MIPMAP_NEAREST,t._m_MagFilter=a.S_FILTERS.S_LINEAR,t}return t=a,(n=[{key:"target",value:function(e){this._m_Target=e}},{key:"setTextureFormat",value:function(e,t,n){this._m_Internalformat=e,this._m_Format=t,this._m_Type=n}},{key:"setAlignment",value:function(e){this._m_Alignment!=e&&(this._m_Alignment=e)}},{key:"updateTextureFilter",value:function(){var e=this._m_Scene.getCanvas().getGLContext();this._m_WrapS&&this._setWrap(this._m_Scene,e.TEXTURE_WRAP_S,this._parseWrap(e,this._m_WrapS)),this._m_WrapT&&this._setWrap(this._m_Scene,e.TEXTURE_WRAP_T,this._parseWrap(e,this._m_WrapT)),this._m_MinFilter&&this._setFilter(this._m_Scene,e.TEXTURE_MIN_FILTER,this._parseFilter(e,this._m_MinFilter)),this._m_MagFilter&&this._setFilter(this._m_Scene,e.TEXTURE_MAG_FILTER,this._parseFilter(e,this._m_MagFilter))}},{key:"uploadArrayData",value:function(e,t,n,r){var _=this._m_Scene.getCanvas().getGLContext();_.activeTexture(_.TEXTURE0+e),_.bindTexture(_.TEXTURE_2D,this._m_Texture),_.pixelStorei(_.UNPACK_FLIP_Y_WEBGL,this._m_FlipY),_.pixelStorei(_.UNPACK_ALIGNMENT,this._m_Alignment),_.texImage2D(_.TEXTURE_2D,0,this._m_Internalformat,t,n,0,this._m_Format,this._m_Type,r)}},{key:"setFlipY",value:function(e){this._m_FlipY=e}},{key:"genMipmap",value:function(e){var t=e.getCanvas().getGLContext();t.bindTexture(t.TEXTURE_2D,this._m_Texture),t.generateMipmap(t.TEXTURE_2D),t.bindTexture(t.TEXTURE_2D,null)}},{key:"setFilter",value:function(e,t,n){this._m_MinFilter=t,this._m_MagFilter=n}},{key:"_parseFilter",value:function(e,t){switch(t){case a.S_FILTERS.S_LINEAR:return e.LINEAR;case a.S_FILTERS.S_NEAREST:return e.NEAREST;case a.S_FILTERS.S_LINEAR_MIPMAP_NEAREST:return e.LINEAR_MIPMAP_NEAREST;case a.S_FILTERS.S_LINEAR_MIPMAP_LINEAR:return e.LINEAR_MIPMAP_LINEAR;case a.S_FILTERS.S_NEAREST_MIPMAP_LINEAR:return e.NEAREST_MIPMAP_LINEAR;case a.S_FILTERS.S_NEAREST_MIPMAP_NEAREST:return e.NEAREST_MIPMAP_NEAREST}return null}},{key:"_setFilter",value:function(e,t,n){var r=e.getCanvas().getGLContext();r.bindTexture(r.TEXTURE_2D,this._m_Texture),r.texParameteri(r.TEXTURE_2D,t,n),r.bindTexture(r.TEXTURE_2D,null)}},{key:"setWrap",value:function(e,t,n){this._m_WrapS=t,this._m_WrapT=n}},{key:"_parseWrap",value:function(e,t){switch(t){case a.S_WRAPS.S_CLAMP:return e.CLAMP;case a.S_WRAPS.S_REPEAT:return e.REPEAT;case a.S_WRAPS.S_CLAMP_TO_EDGE:return e.CLAMP_TO_EDGE;case a.S_WRAPS.S_CLAMP_TO_BORDER:return e.CLAMP_TO_BORDER}return null}},{key:"_setWrap",value:function(e,t,n){var r=e.getCanvas().getGLContext();r.bindTexture(r.TEXTURE_2D,this._m_Texture),r.texParameteri(r.TEXTURE_2D,t,n),r.bindTexture(r.TEXTURE_2D,null)}},{key:"setPreloadColor",value:function(e,t){var n=a._S_TEMP_COLOR.getArray();t?(n[0]=Math.floor(255*t._m_X),n[1]=Math.floor(255*t._m_Y),n[2]=Math.floor(255*t._m_Z),n[3]=Math.floor(255*t._m_W)):(n[0]=0,n[1]=0,n[2]=0,n[3]=255);var r=e.getCanvas().getGLContext();r.bindTexture(r.TEXTURE_2D,this._m_Texture),r.texImage2D(r.TEXTURE_2D,0,this._m_Internalformat,1,1,0,this._m_Format,this._m_Type,a._S_TEMP_COLOR.getBufferData()),r.bindTexture(r.TEXTURE_2D,null)}},{key:"setImageSrc",value:function(e,t,n){var r=this,_=n&&n.rgbe?RadianceLoader.rgbeImg():new Image;_.onload=function(){for(var e in r._m_Image=n&&n.rgbe?n.linearFloat?_.dataFloat:_.dataRGBE:_,n&&n.rgbe&&(r._m_Rgbe=!0),r._m_Width=_.width,r._m_Height=_.height,r._m_UpdateImage=!0,r._m_OwnerFlags)r._m_OwnerFlags[e].owner.setParam(r._m_OwnerFlags[e].flag,r)},_.src=t}},{key:"setImage",value:function(e,t,n){for(var r in this._m_Image=n&&n.rgbe?n.linearFloat?t.dataFloat:t.dataRGBE:t,n&&n.rgbe&&(this._m_Rgbe=!0),this._m_Width=n&&null!=n.width?n.width:t.width,this._m_Height=n&&null!=n.height?n.height:t.height,this._m_UpdateImage=!0,this._m_OwnerFlags)this._m_OwnerFlags[r].owner.setParam(this._m_OwnerFlags[r].flag,this)}},{key:"_setImage",value:function(e,t,n){var r=e.getCanvas().getGLContext();r.bindTexture(r.TEXTURE_2D,this._m_Texture),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,this._m_FlipY),this._m_Rgbe,r.texImage2D(r.TEXTURE_2D,0,this._m_Internalformat,this._m_Width,this._m_Height,0,this._m_Format,this._m_Type,t),r.bindTexture(r.TEXTURE_2D,null)}},{key:"_upload",value:function(e,t,n){if(e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,this._m_Texture),this._m_Target){var r=this._m_Scene.getRender().getFrameContext();e.bindFramebuffer(e.READ_FRAMEBUFFER,this._m_Target.getFrameBuffer()),e.copyTexImage2D(e.TEXTURE_2D,0,this._m_Internalformat,0,0,this._m_Target._m_Width,this._m_Target._m_Height,0),this._m_MinFilter!=a.S_FILTERS.S_NEAREST&&(this._m_MinFilter,a.S_FILTERS.S_LINEAR),e.bindFramebuffer(e.FRAMEBUFFER,r.m_LastFrameBuffer)}}},{key:"compare",value:function(e){return!1}}])&&o(t.prototype,n),r&&o(t,r),a}(_.default);t.default=h,c(h,"_S_TEMP_COLOR",new a.default(4)),c(h,"S_FILTERS",{S_NEAREST:1,S_LINEAR:2,S_LINEAR_MIPMAP_NEAREST:3,S_NEAREST_MIPMAP_LINEAR:4,S_LINEAR_MIPMAP_LINEAR:5,S_NEAREST_MIPMAP_NEAREST:6}),c(h,"S_WRAPS",{S_REPEAT:1,S_CLAMP:2,S_CLAMP_TO_EDGE:3,S_CLAMP_TO_BORDER:4}),c(h,"S_TEXTURE_FORMAT",{})},5141:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=o(n(3552)),a=o(n(6140)),i=(o(n(5397)),o(n(6797)));function o(e){return e&&e.__esModule?e:{default:e}}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t){return s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},s(e,t)}function l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m(e);if(t){var _=m(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return f(this,n)}}function f(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function m(e){return m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},m(e)}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var h=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(a,e);var t,n,r,_=l(a);function a(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=_.call(this,e))._m_Scene=e;var n=e.getCanvas().getGLContext();return a.S_TEXTURE_FORMAT={S_RGB:n.RGB,S_RGBA:n.RGBA,S_RGB16F:n.RGB16F,S_RGB32F:n.RGB32F,S_RGBA16F:n.RGBA16F,S_RGBA32F:n.RGBA32F,S_RGBE5:n.RGB9_E5,S_SRGB:n.SRGB,S_SRGB8:n.SRGB8,S_SRGBA:n.SRGB8_ALPHA8,S_SHORT:n.SHORT,S_INT:n.INT,S_BYTE:n.BYTE,S_UNSIGNED_BYTE:n.UNSIGNED_BYTE,S_FLOAT:n.FLOAT},t._m_Texture=n.createTexture(),t._setFilter(e,n.TEXTURE_MIN_FILTER,n.NEAREST),t._setFilter(e,n.TEXTURE_MAG_FILTER,n.LINEAR),t._m_Internalformat=n.RGBA,t._m_Format=n.RGBA,t._m_Type=n.UNSIGNED_BYTE,t._m_UpdateImage=!1,t._m_Image=null,t._m_Rgbe=!1,t._m_Width=-1,t._m_Height=-1,t._m_FlipY=!1,t._m_Alignment=4,t._m_WrapS=null,t._m_WrapT=null,t._m_MinFilter=a.S_FILTERS.S_LINEAR_MIPMAP_NEAREST,t._m_MagFilter=a.S_FILTERS.S_LINEAR,t}return t=a,(n=[{key:"setTextureFormat",value:function(e,t,n){this._m_Internalformat=e,this._m_Format=t,this._m_Type=n}},{key:"setAlignment",value:function(e){this._m_Alignment!=e&&(this._m_Alignment=e)}},{key:"updateTextureFilter",value:function(){var e=this._m_Scene.getCanvas().getGLContext();this._m_WrapS&&this._setWrap(this._m_Scene,e.TEXTURE_WRAP_S,this._parseWrap(e,this._m_WrapS)),this._m_WrapT&&this._setWrap(this._m_Scene,e.TEXTURE_WRAP_T,this._parseWrap(e,this._m_WrapT)),this._m_MinFilter&&this._setFilter(this._m_Scene,e.TEXTURE_MIN_FILTER,this._parseFilter(e,this._m_MinFilter)),this._m_MagFilter&&this._setFilter(this._m_Scene,e.TEXTURE_MAG_FILTER,this._parseFilter(e,this._m_MagFilter))}},{key:"uploadArrayData",value:function(e,t,n,r){var _=this._m_Scene.getCanvas().getGLContext();_.activeTexture(_.TEXTURE0+e),_.bindTexture(_.TEXTURE_2D,this._m_Texture),_.pixelStorei(_.UNPACK_FLIP_Y_WEBGL,this._m_FlipY),_.pixelStorei(_.UNPACK_ALIGNMENT,this._m_Alignment),_.texImage2D(_.TEXTURE_2D,0,this._m_Internalformat,t,n,0,this._m_Format,this._m_Type,r)}},{key:"setFlipY",value:function(e){this._m_FlipY=e}},{key:"genMipmap",value:function(e){var t=e.getCanvas().getGLContext();t.bindTexture(t.TEXTURE_2D,this._m_Texture),t.generateMipmap(t.TEXTURE_2D),t.bindTexture(t.TEXTURE_2D,null)}},{key:"setFilter",value:function(e,t,n){this._m_MinFilter=t,this._m_MagFilter=n}},{key:"_parseFilter",value:function(e,t){switch(t){case a.S_FILTERS.S_LINEAR:return e.LINEAR;case a.S_FILTERS.S_NEAREST:return e.NEAREST;case a.S_FILTERS.S_LINEAR_MIPMAP_NEAREST:return e.LINEAR_MIPMAP_NEAREST;case a.S_FILTERS.S_LINEAR_MIPMAP_LINEAR:return e.LINEAR_MIPMAP_LINEAR;case a.S_FILTERS.S_NEAREST_MIPMAP_LINEAR:return e.NEAREST_MIPMAP_LINEAR;case a.S_FILTERS.S_NEAREST_MIPMAP_NEAREST:return e.NEAREST_MIPMAP_NEAREST}return null}},{key:"_setFilter",value:function(e,t,n){var r=e.getCanvas().getGLContext();r.bindTexture(r.TEXTURE_2D,this._m_Texture),r.texParameteri(r.TEXTURE_2D,t,n),r.bindTexture(r.TEXTURE_2D,null)}},{key:"setWrap",value:function(e,t,n){this._m_WrapS=t,this._m_WrapT=n}},{key:"_parseWrap",value:function(e,t){switch(t){case a.S_WRAPS.S_CLAMP:return e.CLAMP;case a.S_WRAPS.S_REPEAT:return e.REPEAT;case a.S_WRAPS.S_CLAMP_TO_EDGE:return e.CLAMP_TO_EDGE;case a.S_WRAPS.S_CLAMP_TO_BORDER:return e.CLAMP_TO_BORDER}return null}},{key:"_setWrap",value:function(e,t,n){var r=e.getCanvas().getGLContext();r.bindTexture(r.TEXTURE_2D,this._m_Texture),r.texParameteri(r.TEXTURE_2D,t,n),r.bindTexture(r.TEXTURE_2D,null)}},{key:"setPreloadColor",value:function(e,t){var n=a._S_TEMP_COLOR.getArray();t?(n[0]=Math.floor(255*t._m_X),n[1]=Math.floor(255*t._m_Y),n[2]=Math.floor(255*t._m_Z),n[3]=Math.floor(255*t._m_W)):(n[0]=0,n[1]=0,n[2]=0,n[3]=255);var r=e.getCanvas().getGLContext();r.bindTexture(r.TEXTURE_2D,this._m_Texture),r.texImage2D(r.TEXTURE_2D,0,this._m_Internalformat,1,1,0,this._m_Format,this._m_Type,a._S_TEMP_COLOR.getBufferData()),r.bindTexture(r.TEXTURE_2D,null)}},{key:"setImageSrc",value:function(e,t,n){var r=this,_=n&&n.rgbe?i.default.rgbeImg():new Image;_.onload=function(){for(var e in r._m_Image=n&&n.rgbe?n.linearFloat?_.dataFloat:_.dataRGBE:_,n&&n.rgbe&&(r._m_Rgbe=!0),r._m_Width=_.width,r._m_Height=_.height,r._m_UpdateImage=!0,r._m_OwnerFlags)r._m_OwnerFlags[e].owner.setParam(r._m_OwnerFlags[e].flag,r)},_.src=t}},{key:"setImage",value:function(e,t,n){for(var r in this._m_Image=n&&n.rgbe?n.linearFloat?t.dataFloat:t.dataRGBE:t,n&&n.rgbe&&(this._m_Rgbe=!0),this._m_Width=n&&null!=n.width?n.width:t.width,this._m_Height=n&&null!=n.height?n.height:t.height,this._m_UpdateImage=!0,this._m_OwnerFlags)this._m_OwnerFlags[r].owner.setParam(this._m_OwnerFlags[r].flag,this)}},{key:"_setImage",value:function(e,t,n){var r=e.getCanvas().getGLContext();r.bindTexture(r.TEXTURE_2D,this._m_Texture),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,this._m_FlipY),this._m_Rgbe,r.texImage2D(r.TEXTURE_2D,0,this._m_Internalformat,this._m_Width,this._m_Height,0,this._m_Format,this._m_Type,t),r.bindTexture(r.TEXTURE_2D,null)}},{key:"_upload",value:function(e,t,n){e.activeTexture(e.TEXTURE0+t),this._m_UpdateImage&&(this._setImage(this._m_Scene,this._m_Image),this._m_MinFilter!=a.S_FILTERS.S_NEAREST&&this._m_MinFilter!=a.S_FILTERS.S_LINEAR&&this.genMipmap(this._m_Scene),this.updateTextureFilter(),this._m_UpdateImage=!1,this._m_Image=null,this._m_Width=this._m_Height=-1,this._m_Rgbe=!1),e.bindTexture(e.TEXTURE_2D,this._m_Texture)}},{key:"compare",value:function(e){return!1}}])&&u(t.prototype,n),r&&u(t,r),a}(_.default);t.default=h,c(h,"_S_TEMP_COLOR",new a.default(4)),c(h,"S_FILTERS",{S_NEAREST:1,S_LINEAR:2,S_LINEAR_MIPMAP_NEAREST:3,S_NEAREST_MIPMAP_LINEAR:4,S_LINEAR_MIPMAP_LINEAR:5,S_NEAREST_MIPMAP_NEAREST:6}),c(h,"S_WRAPS",{S_REPEAT:1,S_CLAMP:2,S_CLAMP_TO_EDGE:3,S_CLAMP_TO_BORDER:4}),c(h,"S_TEXTURE_FORMAT",{})},4048:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=o(n(3552)),a=o(n(6140)),i=o(n(1446));function o(e){return e&&e.__esModule?e:{default:e}}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t){return s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},s(e,t)}function l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m(e);if(t){var _=m(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return f(this,n)}}function f(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function m(e){return m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},m(e)}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var h=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(a,e);var t,n,r,_=l(a);function a(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=_.call(this,e))._m_Scene=e;var n=e.getCanvas().getGLContext();return a.S_TEXTURE_FORMAT={S_RGB:n.RGB,S_RGBA:n.RGBA,S_RGB16F:n.RGB16F,S_RGB32F:n.RGB32F,S_RGBA16F:n.RGBA16F,S_RGBA32F:n.RGBA32F,S_RGBE5:n.RGB9_E5,S_SHORT:n.SHORT,S_SRGB:n.SRGB,S_SRGB8:n.SRGB8,S_SRGBA:n.SRGB8_ALPHA8,S_INT:n.INT,S_BYTE:n.BYTE,S_UNSIGNED_BYTE:n.UNSIGNED_BYTE,S_FLOAT:n.FLOAT},t._m_Texture=n.createTexture(),t._setFilter(e,n.TEXTURE_MIN_FILTER,n.NEAREST),t._setFilter(e,n.TEXTURE_MAG_FILTER,n.LINEAR),t._m_Internalformat=n.RGBA,t._m_Format=n.RGBA,t._m_Type=n.UNSIGNED_BYTE,t._m_CubeMaps={},t._m_UpdateImage=!1,t._m_FlipY=!1,t._m_WrapS=null,t._m_WrapT=null,t._m_WrapR=null,t._m_MinFilter=a.S_FILTERS.S_LINEAR,t._m_MagFilter=a.S_FILTERS.S_LINEAR,t}return t=a,(n=[{key:"setTextureFormat",value:function(e,t,n){this._m_Internalformat=e,this._m_Format=t,this._m_Type=n}},{key:"setFlipY",value:function(e){this._m_FlipY=e}},{key:"genMipmap",value:function(e){var t=e.getCanvas().getGLContext();t.bindTexture(t.TEXTURE_CUBE_MAP,this._m_Texture),t.generateMipmap(t.TEXTURE_CUBE_MAP),t.bindTexture(t.TEXTURE_CUBE_MAP,null)}},{key:"setFilter",value:function(e,t,n){this._m_MinFilter=t,this._m_MagFilter=n}},{key:"_parseFilter",value:function(e,t){switch(t){case a.S_FILTERS.S_LINEAR:return e.LINEAR;case a.S_FILTERS.S_NEAREST:return e.NEAREST;case a.S_FILTERS.S_LINEAR_MIPMAP_NEAREST:return e.LINEAR_MIPMAP_NEAREST}return null}},{key:"_setFilter",value:function(e,t,n){var r=e.getCanvas().getGLContext();r.bindTexture(r.TEXTURE_CUBE_MAP,this._m_Texture),r.texParameteri(r.TEXTURE_CUBE_MAP,t,n),r.bindTexture(r.TEXTURE_CUBE_MAP,null)}},{key:"setWrap",value:function(e,t,n,r){this._m_WrapS=t,this._m_WrapT=n,this._m_WrapR=r}},{key:"_parseWrap",value:function(e,t){switch(t){case a.S_WRAPS.S_CLAMP:return e.CLAMP;case a.S_WRAPS.S_REPEAT:return e.REPEAT;case a.S_WRAPS.S_CLAMP_TO_EDGE:return e.CLAMP_TO_EDGE;case a.S_WRAPS.S_CLAMP_TO_BORDER:return e.CLAMP_TO_BORDER}return null}},{key:"_setWrap",value:function(e,t,n){var r=e.getCanvas().getGLContext();r.bindTexture(r.TEXTURE_CUBE_MAP,this._m_Texture),r.texParameteri(r.TEXTURE_CUBE_MAP,t,n),r.bindTexture(r.TEXTURE_CUBE_MAP,null)}},{key:"setPreloadColor",value:function(e,t){var n=this._m_Type!=a.S_TEXTURE_FORMAT.S_FLOAT?a._S_TEMP_COLOR:a._S_TEMP_COLORF,r=n.getArray();t?(r[0]=Math.floor(255*t._m_X),r[1]=Math.floor(255*t._m_Y),r[2]=Math.floor(255*t._m_Z),r[3]=Math.floor(255*t._m_W)):(r[0]=0,r[1]=0,r[2]=0,r[3]=255);var _=e.getCanvas().getGLContext();_.bindTexture(_.TEXTURE_CUBE_MAP,this._m_Texture);for(var i=0;i<6;i++)_.texImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,this._m_Internalformat,1,1,0,this._m_Format,this._m_Type,n.getBufferData());_.bindTexture(_.TEXTURE_CUBE_MAP,null)}},{key:"setImageSrc",value:function(e,t,n,r){var _=this,a=r&&r.rgbe?RadianceLoader.rgbeImg():new Image;a.onload=function(){for(var e in _._m_UpdateImage=!0,_._m_CubeMaps[t]={imgData:r&&r.rgbe?a.dataRGBE:a},r&&r.rgbe&&(_._m_CubeMaps[t].rgbe=!0),_._m_CubeMaps[t].width=a.width,_._m_CubeMaps[t].height=a.height,_._m_CubeMaps[t].updateImage=!0,_._m_OwnerFlags)_._m_OwnerFlags[e].owner.setParam(_._m_OwnerFlags[e].flag,_)},a.src=n}},{key:"setImage",value:function(e,t,n,r){this._m_UpdateImage=!0;var _=r&&null!=r.mipmapLevel?r.mipmapLevel:null,a=null;for(var i in null!=_?(this._m_CubeMaps[t]||(this._m_CubeMaps[t]=[]),this._m_CubeMaps[t].push({imgData:r&&r.rgbe?n.dataRGBE:n,mipmapLevel:_}),a=this._m_CubeMaps[t][this._m_CubeMaps[t].length-1]):(this._m_CubeMaps[t]={imgData:r&&r.rgbe?n.dataRGBE:n},a=this._m_CubeMaps[t]),r&&r.rgbe&&(a.rgbe=!0),a.width=r&&null!=r.width?r.width:n.width,a.height=r&&null!=r.height?r.height:n.height,a.updateImage=!0,a.mipmapLevel=r&&r.mipmapLevel?r.mipmapLevel:0,this._m_OwnerFlags)this._m_OwnerFlags[i].owner.setParam(this._m_OwnerFlags[i].flag,this)}},{key:"_setImage",value:function(e,t,n,r){var _=e.getCanvas().getGLContext();if(_.bindTexture(_.TEXTURE_CUBE_MAP,this._m_Texture),_.pixelStorei(_.UNPACK_FLIP_Y_WEBGL,this._m_FlipY),n.rgbe)_.texImage2D(this._parseFace(_,t),n.mipmapLevel,this._m_Internalformat,n.width,n.height,0,this._m_Format,this._m_Type,n.imgData);else if(Array.isArray(n)){_.texParameteri(_.TEXTURE_CUBE_MAP,_.TEXTURE_BASE_LEVEL,0),_.texParameteri(_.TEXTURE_CUBE_MAP,_.TEXTURE_MAX_LEVEL,n.length);for(var a=null,i=0;i<n.length;i++)a=n[i],_.texImage2D(this._parseFace(_,t),a.mipmapLevel,this._m_Internalformat,a.width,a.height,0,this._m_Format,this._m_Type,a.imgData)}else _.texImage2D(this._parseFace(_,t),n.mipmapLevel,this._m_Internalformat,n.width,n.height,0,this._m_Format,this._m_Type,n.imgData);_.bindTexture(_.TEXTURE_CUBE_MAP,null)}},{key:"_parseFace",value:function(e,t){switch(t){case a.S_FACE.PositiveX:return e.TEXTURE_CUBE_MAP_POSITIVE_X;case a.S_FACE.NegativeX:return e.TEXTURE_CUBE_MAP_NEGATIVE_X;case a.S_FACE.PositiveY:return e.TEXTURE_CUBE_MAP_POSITIVE_Y;case a.S_FACE.NegativeY:return e.TEXTURE_CUBE_MAP_NEGATIVE_Y;case a.S_FACE.PositiveZ:return e.TEXTURE_CUBE_MAP_POSITIVE_Z;case a.S_FACE.NegativeZ:return e.TEXTURE_CUBE_MAP_NEGATIVE_Z}}},{key:"_upload",value:function(e,t,n){if(e.activeTexture(e.TEXTURE0+t),this._m_UpdateImage){for(var r in this._m_CubeMaps)this._m_CubeMaps[r]&&(this._setImage(this._m_Scene,r,this._m_CubeMaps[r]),this._m_CubeMaps[r]=null);this._m_MinFilter!=a.S_FILTERS.S_LINEAR_MIPMAP_NEAREST&&this._m_MagFilter!=a.S_FILTERS.S_LINEAR_MIPMAP_NEAREST||this.genMipmap(this._m_Scene);var _=this._m_Scene.getCanvas().getGLContext();this._m_WrapS&&this._setWrap(this._m_Scene,_.TEXTURE_WRAP_S,this._parseWrap(_,this._m_WrapS)),this._m_WrapT&&this._setWrap(this._m_Scene,_.TEXTURE_WRAP_T,this._parseWrap(_,this._m_WrapT)),this._m_WrapR&&this._setWrap(this._m_Scene,_.TEXTURE_WRAP_R,this._parseWrap(_,this._m_WrapR)),this._m_MinFilter&&this._setFilter(this._m_Scene,_.TEXTURE_MIN_FILTER,this._parseFilter(_,this._m_MinFilter)),this._m_MagFilter&&this._setFilter(this._m_Scene,_.TEXTURE_MAG_FILTER,this._parseFilter(_,this._m_MagFilter)),this._m_UpdateImage=!1}e.bindTexture(e.TEXTURE_CUBE_MAP,this._m_Texture)}},{key:"compare",value:function(e){return!1}}])&&u(t.prototype,n),r&&u(t,r),a}(_.default);t.default=h,c(h,"_S_TEMP_COLOR",new a.default(4)),c(h,"_S_TEMP_COLORF",new i.default(4)),c(h,"S_FACE",{PositiveX:"1",NegativeX:"2",PositiveY:"3",NegativeY:"4",PositiveZ:"5",NegativeZ:"6"}),c(h,"S_FILTERS",{S_NEAREST:1,S_LINEAR:2,S_LINEAR_MIPMAP_NEAREST:3}),c(h,"S_WRAPS",{S_REPEAT:1,S_CLAMP:2,S_CLAMP_TO_EDGE:3,S_CLAMP_TO_BORDER:4}),c(h,"S_TEXTURE_FORMAT",{})},3552:(e,t)=>{function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._m_OwnerFlags={}}var t,r,_;return t=e,(r=[{key:"compare",value:function(e){return!1}},{key:"_upload",value:function(e,t,n){}},{key:"owner",value:function(e,t){this._m_OwnerFlags[e.getId()]||(this._m_OwnerFlags[e.getId()]={owner:e,flag:t})}}])&&n(t.prototype,r),_&&n(t,_),e}();t.default=r},4690:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}var _;function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t){return i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},i(e,t)}function o(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=s(e);if(t){var _=s(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return u(this,n)}}function u(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function s(e){return s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},s(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var l=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(u,e);var t,n,r,_=o(u);function u(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(t=_.call(this,e))._m_X=0,t._m_Y=0,t}return t=u,(n=[{key:"valueFromXY",value:function(e,t){return this._m_X=e,this._m_Y=t,this}},{key:"compare",value:function(e){return!1}},{key:"_upload",value:function(e,t,n){e.uniform2f(t,this._m_X,this._m_Y)}}])&&a(t.prototype,n),r&&a(t,r),u}(((_=n(3552))&&_.__esModule?_:{default:_}).default);t.default=l},2462:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}var _;function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t){return i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},i(e,t)}function o(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=s(e);if(t){var _=s(this).constructor;n=Reflect.construct(r,arguments,_)}else n=r.apply(this,arguments);return u(this,n)}}function u(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function s(e){return s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},s(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var l=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(u,e);var t,n,r,_=o(u);function u(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(t=_.call(this,e))._m_X=0,t._m_Y=0,t._m_Z=0,t._m_W=1,t}return t=u,(n=[{key:"valueFromXYZW",value:function(e,t,n,r){return this._m_X=e,this._m_Y=t,this._m_Z=n,this._m_W=r,this}},{key:"compare",value:function(e){return!1}},{key:"_upload",value:function(e,t,n){e.uniform4f(t,this._m_X,this._m_Y,this._m_Z,this._m_W)}}])&&a(t.prototype,n),r&&a(t,r),u}(((_=n(3552))&&_.__esModule?_:{default:_}).default);t.default=l},4620:(e,n,r)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var _=w(r(2949)),a=w(r(5397)),i=w(r(1193)),o=w(r(3846)),u=w(r(4720)),s=w(r(307)),l=w(r(8113)),f=w(r(4008)),m=w(r(9586)),c=w(r(6858)),h=w(r(479)),d=w(r(7938)),S=w(r(4755)),p=w(r(1245)),g=w(r(7868)),y=w(r(1608)),v=w(r(8649)),T=w(r(1648)),E=w(r(9784)),b=w(r(2462)),C=w(r(1759)),P=w(r(5141)),R=w(r(1491)),M=w(r(7141)),A=w(r(2320));function w(e){return e&&e.__esModule?e:{default:e}}function I(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function L(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var D=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),L(this,"_m_CustomMatDef","PrincipledLightingDef")}var n,r,w;return n=e,(r=[{key:"load",value:function(e,t,n,r){this._m_Scene=e,this._m_Batch=r&&r.batch,this._m_GLTFRootNode=null,this._m_PrincipledMatDef=null,this._m_DefaultMatDef=null,this._m_Joints={},this._m_Bones=[],this._m_Nodes={},this._m_Aps=[],this._m_Skeletons={},this._m_AnimationProcessors={},this._m_Mats={},this._m_MatMeshs={},this._m_BasePath=i.default.getBasePath(t),this._loadGLTF(t,n)}},{key:"reset",value:function(){this._m_GLTFRootNode=null,this._m_PrincipledMatDef=null,this._m_DefaultMatDef=null,this._m_Joints={},this._m_Bones=[],this._m_Nodes={},this._m_Aps=[],this._m_Skeletons={},this._m_AnimationProcessors={},this._m_Mats={},this._m_MatMeshs={}}},{key:"setAssetsPath",value:function(e,t){this._m_AssetsPath=e,t&&(this._m_CustomMatDef=t)}},{key:"_loadBIN",value:function(e,t,n,r,_){var a=this;r>0?i.default.loadFile(this._m_BasePath+e.buffers[n].uri,(function(i){r--,t.push({data:i,byteLength:e.buffers[n].byteLength}),a._loadBIN(e,t,++n,r,_)}),null,{inflate:!0}):_&&_()}},{key:"_loadGLTF",value:function(e,t){var n=this;i.default.loadFile(e,(function(e){if((e=JSON.parse(e))&&e.buffers&&e.buffers.length>0){var r=e.buffers.length,_=[];n._loadBIN(e,_,0,r,(function(){if(e.buffers=_,a.default.checkIsNull(e.scene)&&n._addScene(e),n._m_Batch?n._batchScene():(n._bindBone(),a.default.checkIsNull(e.animations)&&(n._parseAnimations(e),n._m_Aps.forEach((function(e){e.skeleton.finished()})))),o.default.log("当前材质:",n._m_Mats),n._m_Mats)for(var r in n._m_Mats)n._m_Mats[r].preload();t&&t(n._m_GLTFRootNode)}))}o.default.log("gltf:",e)}))}},{key:"_batchScene",value:function(){if(this._m_MatMeshs){var e=null,t=null;for(var n in this._m_MatMeshs)e=this._m_MatMeshs[n].mesh,(t=new u.default(this._m_Scene,{id:n+"_"+a.default.nextId()})).setMesh(e),t.updateBound(),t.setMaterial(this._m_Mats[n]),this._m_Mats[n].renderState&&("BLEND"!=this._m_Mats[n].renderState.alphaMode&&"MASK"!=this._m_Mats[n].renderState.alphaMode||t.setTranslucent()),this._m_GLTFRootNode.addChildren(t)}}},{key:"_bindBone",value:function(){for(var e=null,t=null,n=0;n<this._m_Aps.length;n++){e=this._m_Aps[n].skeleton.getJoints(),o.default.log("jointcount:"+e.length);for(var r=0;r<e.length;r++)(t=this._m_Nodes[e[r].getId()])instanceof m.default||t._update2||(t.getType=function(){return"Bone"},t._update2=t._updateLocalMatrix,t.bind=function(e){this._m_Bind=e},t.getBind=function(){return this._m_Bind},t._updateLocalMatrix=function(){this._update2(),this._m_Bind&&this._m_Bind.actived()}),t&&e[r].link(t)}}},{key:"_parseAnimations",value:function(e){var t=this,n=null,r=null,_=null,i=null,u=!1;e.animations.forEach((function(s){r=new h.default(t._getName(s.name)),n=new d.default,s.channels.forEach((function(l){var f=l.target.node;if(_=new S.default(l.target.path),t._m_Nodes[f]){p.default.createTrack(_,t._m_Nodes[f]);var m=s.samplers[l.sampler];t._parseSampler(e,m.input,m.output,m.interpolation,g.default.S_KEY_FRAME[l.target.path],_),n.addClip(_),u=!1;for(var c=0;c<t._m_Aps.length;c++){i=t._m_Aps[c].skeleton.getJoints();for(var h=0;h<i.length;h++)if(i[h].getId()==f){u=!0,t._m_Aps[c].animationProcessor.addAnimationAction(r);break}if(u)break}if(!u){if(o.default.log(f+"非skin动画!path:"+l.target.path),!t._m_AnimationProcessors[f]){var d=new T.default(t._m_GLTFRootNode,{id:a.default.nextId()+"_"+f+"_animationProcessor"});t._m_AnimationProcessors[f]=d}t._m_AnimationProcessors[f].addAnimationAction(r)}}else o.default.log("animation_node:"+f)})),r.setTrackMixer(n)}))}},{key:"_getAccessorData",value:function(t,n){var r=t.accessors[n],_=t.buffers,a=t.bufferViews[r.bufferView],i=e.DATA_COMPONENT[r.type];return new e.DATA[r.componentType](_[a.buffer].data,(a.byteOffset||0)+(r.byteOffset||0),r.count*i)}},{key:"_parseSampler",value:function(t,n,r,_,a,i){for(var u=this._getAccessorData(t,n),s=this._getAccessorData(t,r),l=t.accessors[n].count,f=e.DATA_COMPONENT[t.accessors[r].type],m=null,c=0,h=0;h<l;h++)c=h*f,f>3?(a||o.default.warn("未知keyframe!"),m=new a(u[h],s[c],s[c+1],s[c+2],s[c+3])):(a||o.default.warn("未知keyframe!"),m=new a(u[h],s[c],s[c+1],s[c+2])),m.setInterpolationMode(_),i.addKeyframe(m)}},{key:"_addScene",value:function(e){var t=this;if(a.default.checkIsNull(e.scene)){var n=e.scenes[e.scene],r=new _.default(this._m_Scene,{id:n.name});return this._m_Batch?(this._m_GLTFRootNode=new _.default(this._m_Scene,{id:a.default.nextId()+"_scene"}),this._m_GLTFRootNode.addChildren(r)):this._m_GLTFRootNode=r,a.default.checkIsNull(n.nodes)&&n.nodes.forEach((function(n){t._addNode(e,r,n)})),this._m_GLTFRootNode}return null}},{key:"_getName",value:function(e){return null==e||null==e||""==e?a.default.nextId():e}},{key:"_parseSkins",value:function(e,t){var n=this,r=e.skins[t],_=new y.default(this._getName(r.name)),a=null,i=this._getAccessorData(e,r.inverseBindMatrices),o=0,u=[];return r.joints.forEach((function(e){n._m_Joints[e]=!0,u.length=0;for(var t=0,r=16*o;t<16;t++)u.push(i[t+r]);(a=new v.default(e,o)).setJointSpace(u),_.addJoint(a),o++})),_}},{key:"_addNode",value:function(e,t,n){var r=this,i=e.nodes[n],u=null;if(this._m_Joints[n]?(u=new m.default(t,{id:this._getName(i.name)}),this._m_Bones.push(u)):u=new _.default(t,{id:this._getName(i.name)}),this._m_Nodes[n]=u,t.addChildren(u),a.default.checkIsNull(i.children)&&i.children.forEach((function(t){r._addNode(e,u,t)})),u&&(a.default.checkIsNull(i.scale)&&u.setLocalScaleXYZ(i.scale[0],i.scale[1],i.scale[2]),a.default.checkIsNull(i.rotation)&&u.setLocalRotationFromXYZW(i.rotation[0],i.rotation[1],i.rotation[2],i.rotation[3]),a.default.checkIsNull(i.translation)&&u.setLocalTranslationXYZ(i.translation[0],i.translation[1],i.translation[2]),a.default.checkIsNull(i.matrix)&&u.setLocalMatrixFromArray(i.matrix)),a.default.checkIsNull(i.mesh))if(this._m_Batch)this._parseMeshBatch(e,u,i.mesh);else if(this._parseMesh(e,u,i.mesh,a.default.checkIsNull(i.skin)),a.default.checkIsNull(i.skin)){var s=null;if(this._m_Skeletons[i.skin]?s=this._m_Skeletons[i.skin]:(s=this._parseSkins(e,i.skin),this._m_Skeletons[i.skin]=s,o.default.log("创建Skeleton!")),u.getChildren().forEach((function(e){e.setSkeleton(s)})),this._m_AnimationProcessors[i.skin]);else{var l=new T.default(this._m_GLTFRootNode,{id:a.default.nextId()+"_animationProcessor"});this._m_Aps.push({skeleton:s,animationProcessor:l}),this._m_AnimationProcessors[i.skin]=l}}}},{key:"_transformVertex",value:function(e,t){for(var n=new M.default,r=new M.default,_=[],a=0;a<e.length;a+=3)n.setToInXYZW(e[a],e[a+1],e[a+2],1),A.default.multiplyMV(r,n,t),_.push(r._m_X),_.push(r._m_Y),_.push(r._m_Z);return _}},{key:"_transformNormal",value:function(e,t){var n=new A.default;n.set(t),n.inert(),n.transpose();for(var r=new M.default,_=new M.default,a=[],i=0;i<e.length;i+=3)r.setToInXYZW(e[i],e[i+1],e[i+2],0),A.default.multiplyMV(_,r,t),a.push(_._m_X),a.push(_._m_Y),a.push(_._m_Z);return a}},{key:"_parseMeshBatch",value:function(e,n,r){for(var _=this,i=e.meshes[r].primitives,o=null,u=null,m=0;m<i.length;m++){o=i[m];var c=null;if(a.default.checkIsNull(o.material)){this._m_PrincipledMatDef||(this._m_PrincipledMatDef=l.default.load(this._m_AssetsPath+this._m_CustomMatDef)),c=this._getName(e.materials[o.material].name);var h=null;this._m_Mats[c]?h=this._m_Mats[c]:(h=new f.default(this._m_Scene,{id:c,materialDef:this._m_PrincipledMatDef}),this._parseMaterial(e,o.material,h),this._m_Mats[c]=h)}else{this._m_DefaultMatDef||(this._m_DefaultMatDef=l.default.load(this._m_AssetsPath+"ColorDef")),c="default_gltf_mat";var d=null;this._m_Mats[c]?d=this._m_Mats[c]:(d=new f.default(this._m_Scene,{id:c,materialDef:this._m_DefaultMatDef}),this._m_Mats[c]=d)}if(this._m_MatMeshs[c]){u=this._m_MatMeshs[c].mesh;var S=0;a.default.checkIsNull(o.attributes.POSITION)&&function(){var t=_._parsePositions(e,o.attributes.POSITION);n&&(t.data=_._transformVertex(t.data,n.getWorldMatrix()));var r=u.getData(s.default.S_POSITIONS);r&&(S=r.length,t.data.forEach((function(e){r.push(e)})),u.setData(s.default.S_POSITIONS,r))}(),a.default.checkIsNull(o.attributes.NORMAL)&&function(){var t=_._parseNormals(e,o.attributes.NORMAL);n&&(t.data=_._transformNormal(t.data,n.getWorldMatrix()));var r=u.getData(s.default.S_NORMALS);r&&(t.data.forEach((function(e){r.push(e)})),u.setData(s.default.S_NORMALS,r))}(),a.default.checkIsNull(o.attributes.TEXCOORD_0)&&function(){var t=_._parseTexcoords(e,o.attributes.TEXCOORD_0),n=u.getData(s.default.S_UV0);n&&(t.data.forEach((function(e){n.push(e)})),u.setData(s.default.S_UV0,n))}(),a.default.checkIsNull(o.indices)&&function(){var t=_._parseIndices(e,o.indices),n=u.getData(s.default.S_INDICES),r=0;n?(r=S/3,t.data.forEach((function(e){n.push(e+r)})),u.setData(5125==t.bufType?s.default.S_INDICES_32:s.default.S_INDICES,n),5125!=t.bufType&&u.setData(s.default.S_INDICES,null)):(n=u.getData(s.default.S_INDICES_32))&&(r=S/3,t.data.forEach((function(e){n.push(e+r)})),u.setData(s.default.S_INDICES_32,n))}(),a.default.checkIsNull(o.attributes.TANGENT)?function(){var t=_._parseTangents(e,o.attributes.TANGENT),n=u.getData(s.default.S_TANGENTS);n&&(t.data.forEach((function(e){n.push(e)})),u.setData(s.default.S_TANGENTS,n))}():u.getData(s.default.S_UV0)?function(){var e=a.default.generatorTangents(u.getData(s.default.S_INDICES)?u.getData(s.default.S_INDICES):u.getData(s.default.S_INDICES_32),u.getData(s.default.S_POSITIONS),u.getData(s.default.S_UV0)),t=u.getData(s.default.S_TANGENTS);t&&(e.forEach((function(e){t.push(e)})),u.setData(s.default.S_TANGENTS,t))}():function(){var e=a.default.generatorFillTangents(u.getData(s.default.S_INDICES)?u.getData(s.default.S_INDICES):u.getData(s.default.S_INDICES_32),u.getData(s.default.S_POSITIONS),u.getData(s.default.S_UV0)),t=u.getData(s.default.S_TANGENTS);t&&(e.forEach((function(e){t.push(e)})),u.setData(s.default.S_TANGENTS,t))}()}else{if(u=new s.default,a.default.checkIsNull(o.attributes.POSITION)){var p=this._parsePositions(e,o.attributes.POSITION);n&&(p.data=this._transformVertex(p.data,n.getWorldMatrix())),u.setData(s.default.S_POSITIONS,p.data)}if(a.default.checkIsNull(o.attributes.NORMAL)){var g=this._parseNormals(e,o.attributes.NORMAL);n&&(g.data=this._transformNormal(g.data,n.getWorldMatrix())),u.setData(s.default.S_NORMALS,g.data)}if(a.default.checkIsNull(o.attributes.TEXCOORD_0)){for(var y=this._parseTexcoords(e,o.attributes.TEXCOORD_0),v=[],T=0;T<y.data.length;T++)v.push(y.data[T]);u.setData(s.default.S_UV0,v)}if(a.default.checkIsNull(o.indices)){for(var E=this._parseIndices(e,o.indices),b=[],C=0;C<E.data.length;C++)b.push(E.data[C]);u.setData(5125==E.bufType?s.default.S_INDICES_32:s.default.S_INDICES,b)}if(a.default.checkIsNull(o.attributes.TANGENT)){for(var P=this._parseTangents(e,o.attributes.TANGENT),R=[],M=0;M<P.data.length;M++)R.push(P.data[M]);u.setData(s.default.S_TANGENTS,R)}else if(u.getData(s.default.S_UV0)){for(var A=a.default.generatorTangents2(u.getData(s.default.S_INDICES)?u.getData(s.default.S_INDICES):u.getData(s.default.S_INDICES_32),u.getData(s.default.S_POSITIONS),u.getData(s.default.S_UV0),u.getData(s.default.S_NORMALS)),w=[],I=0;I<A.length;I++)w.push(A[I]);u.setData(s.default.S_TANGENTS,w)}else{for(var L=a.default.generatorFillTangents2(u.getData(s.default.S_INDICES)?u.getData(s.default.S_INDICES):u.getData(s.default.S_INDICES_32),u.getData(s.default.S_POSITIONS),u.getData(s.default.S_UV0)),D=0;D<L.length;D++)t.push(L[D]);u.setData(s.default.S_TANGENTS,t)}this._m_MatMeshs[c]={mesh:u}}}}},{key:"_parseMesh",value:function(e,t,n,r){for(var _=e.meshes[n],i=_.primitives,o=null,m=null,h=null,d=0;d<i.length;d++){if(o=i[d],m=r?new c.default(t,{id:this._getName(_.name)+d}):new u.default(t,{id:this._getName(_.name)+d}),t.addChildren(m),h=new s.default,a.default.checkIsNull(o.attributes.POSITION)){var S=this._parsePositions(e,o.attributes.POSITION);h.setData(s.default.S_POSITIONS,S.data)}if(a.default.checkIsNull(o.attributes.NORMAL)){var p=this._parseNormals(e,o.attributes.NORMAL);h.setData(s.default.S_NORMALS,p.data)}if(a.default.checkIsNull(o.attributes.TEXCOORD_0)){var g=this._parseTexcoords(e,o.attributes.TEXCOORD_0);h.setData(s.default.S_UV0,g.data)}if(r){if(a.default.checkIsNull(o.attributes.JOINTS_0)){var y=this._parseJoints(e,o.attributes.JOINTS_0);h.setData(5125==y.bufType?s.default.S_JOINTS_0_32:s.default.S_JOINTS_0,y.data)}if(a.default.checkIsNull(o.attributes.WEIGHTS_0)){var v=this._parseWeights(e,o.attributes.WEIGHTS_0);h.setData(s.default.S_WEIGHTS_0,v.data)}}if(a.default.checkIsNull(o.indices)){var T=this._parseIndices(e,o.indices);h.setData(5125==T.bufType?s.default.S_INDICES_32:s.default.S_INDICES,T.data)}if(a.default.checkIsNull(o.attributes.TANGENT)){var b=this._parseTangents(e,o.attributes.TANGENT);h.setData(s.default.S_TANGENTS,b.data)}else if(h.getData(s.default.S_UV0)){console.log("生成切线数据");var C=a.default.generatorTangents2(h.getData(s.default.S_INDICES)?h.getData(s.default.S_INDICES):h.getData(s.default.S_INDICES_32),h.getData(s.default.S_POSITIONS),h.getData(s.default.S_UV0),h.getData(s.default.S_NORMALS));h.setData(s.default.S_TANGENTS,C)}else console.log("-----------------------------");if(a.default.checkIsNull(o.material)){this._m_PrincipledMatDef||(this._m_PrincipledMatDef=l.default.load(this._m_AssetsPath+"PrincipledLightingDef"));var P=this._getName(e.materials[o.material].name),R=null;this._m_Mats[P]?R=this._m_Mats[P]:(R=new f.default(this._m_Scene,{id:P,materialDef:this._m_PrincipledMatDef}),this._parseMaterial(e,o.material,R),this._m_Mats[P]=R),m.setMaterial(R),R.renderState&&("BLEND"!=R.renderState.alphaMode&&"MASK"!=R.renderState.alphaMode||m.setTranslucent())}else{this._m_DefaultMatDef||(this._m_DefaultMatDef=l.default.load(this._m_AssetsPath+"ColorDef"));var M="default_gltf_mat",A=null;this._m_Mats[M]?A=this._m_Mats[M]:(A=new f.default(this._m_Scene,{id:M,materialDef:this._m_DefaultMatDef}),this._m_Mats[M]=A),m.setMaterial(A)}m.setMesh(h),m.updateBound(),r&&m.getMaterial().addDefine(E.default.S_SKINS_SRC)}}},{key:"_samplerMap",value:function(t,n,r){var _=t.textures[n],i=t.images[_.source],o=new P.default(this._m_Scene);if(r&&o.setTextureFormat(P.default.S_TEXTURE_FORMAT.S_SRGBA,P.default.S_TEXTURE_FORMAT.S_RGBA,P.default.S_TEXTURE_FORMAT.S_UNSIGNED_BYTE),o.setImageSrc(this._m_Scene,this._m_BasePath+i.uri),a.default.checkIsNull(_.sampler)){var u=t.samplers[_.sampler];if(a.default.checkIsNull(u)){var s=u.magFilter,l=u.minFilter;s&&l&&o.setFilter(this._m_Scene,e.FILTERS[l],e.FILTERS[s]);var f=u.wrapS,m=u.wrapT;f&&m&&o.setWrap(this._m_Scene,e.WRAPS[f],e.WRAPS[m])}}return o}},{key:"_parseMaterial",value:function(e,t,n){var r=e.materials[t];if(r.pbrMetallicRoughness){var _=r.pbrMetallicRoughness,i=_.baseColorFactor;a.default.checkIsNull(i)&&n.setParam("baseColor",(new b.default).valueFromXYZW(i[0],i[1],i[2],i[3]));var o=_.roughnessFactor;a.default.checkIsNull(o)&&n.setParam("roughness",(new C.default).valueOf(o));var u=_.metallicFactor;a.default.checkIsNull(u)&&n.setParam("metallic",(new C.default).valueOf(u));var s=_.baseColorTexture;a.default.checkIsNull(s)&&n.setParam("baseColorMap",this._samplerMap(e,s.index,!0));var l=_.metallicRoughnessTexture;a.default.checkIsNull(l)&&n.setParam("metallicRoughnessMap",this._samplerMap(e,l.index))}if(r.extensions&&r.extensions.KHR_materials_pbrSpecularGlossiness){var f=r.extensions.KHR_materials_pbrSpecularGlossiness;n.setParam("useSpecGloss",(new R.default).valueOf(!0));var m=f.diffuseTexture;a.default.checkIsNull(m)&&n.setParam("baseColorMap",this._samplerMap(e,m.index,!0));var c=f.specularGlossinessTexture;a.default.checkIsNull(c)&&n.setParam("specularGlossinessMap",this._samplerMap(e,c.index,!0))}var h=r.normalTexture;a.default.checkIsNull(h)&&n.setParam("normalMap",this._samplerMap(e,h.index));var d=r.occlusionTexture;if(a.default.checkIsNull(d)){var S=d.texCoord;n.setParam("lightMap",this._samplerMap(e,d.index,!0)),null!=S&&0!=S||n.setParam("aoMap",(new R.default).valueOf(!0))}var p=r.emissiveFactor;a.default.checkIsNull(p)&&n.setParam("emissive",(new b.default).valueFromXYZW(p[0],p[1],p[2],1));var g=r.emissiveTexture;a.default.checkIsNull(g)&&n.setParam("emissiveMap",this._samplerMap(e,g.index,!0));var y={};r.alphaMode&&(y.alphaMode=r.alphaMode),r.doubleSided&&(y.doubleSided=r.doubleSided),n.renderState=y}},{key:"_parsePositions",value:function(t,n){var r=t.accessors[n],_=t.buffers,a=t.bufferViews[r.bufferView],i=_[a.buffer].data;return{data:new e.DATA[r.componentType](i,(a.byteOffset||0)+(r.byteOffset||0),3*r.count),bufType:r.componentType}}},{key:"_parseTangents",value:function(t,n){var r=t.accessors[n],_=t.buffers,a=t.bufferViews[r.bufferView],i=_[a.buffer].data;return{data:new e.DATA[r.componentType](i,(a.byteOffset||0)+(r.byteOffset||0),4*r.count),bufType:r.componentType}}},{key:"_parseNormals",value:function(t,n){var r=t.accessors[n],_=t.buffers,a=t.bufferViews[r.bufferView],i=_[a.buffer].data;return{data:new e.DATA[r.componentType](i,(a.byteOffset||0)+(r.byteOffset||0),3*r.count),bufType:r.componentType}}},{key:"_parseTexcoords",value:function(t,n){var r=t.accessors[n],_=t.buffers,a=t.bufferViews[r.bufferView],i=_[a.buffer].data;return{data:new e.DATA[r.componentType](i,(a.byteOffset||0)+(r.byteOffset||0),2*r.count),bufType:r.componentType}}},{key:"_parseIndices",value:function(t,n){var r=t.accessors[n],_=t.buffers,a=t.bufferViews[r.bufferView],i=_[a.buffer].data;return{data:new e.DATA[r.componentType](i,(a.byteOffset||0)+(r.byteOffset||0),r.count),bufType:r.componentType}}},{key:"_parseJoints",value:function(t,n){var r=t.accessors[n],_=t.buffers,a=t.bufferViews[r.bufferView],i=_[a.buffer].data;return{data:new e.DATA[r.componentType](i,(a.byteOffset||0)+(r.byteOffset||0),4*r.count),bufType:r.componentType}}},{key:"_parseWeights",value:function(t,n){var r=t.accessors[n],_=t.buffers,a=t.bufferViews[r.bufferView],i=_[a.buffer].data;return{data:new e.DATA[r.componentType](i,(a.byteOffset||0)+(r.byteOffset||0),4*r.count),bufType:r.componentType}}}])&&I(n.prototype,r),w&&I(n,w),e}();n.default=D,L(D,"DATA",{5121:Uint8Array,5123:Uint16Array,5124:Uint16Array,5125:Uint32Array,5126:Float32Array}),L(D,"DATA_COMPONENT",{SCALAR:1,VEC3:3,VEC4:4,MAT4:16}),L(D,"FILTERS",{9729:P.default.S_FILTERS.S_LINEAR,9728:P.default.S_FILTERS.S_NEAREST,9987:P.default.S_FILTERS.S_LINEAR_MIPMAP_LINEAR,9986:P.default.S_FILTERS.S_NEAREST_MIPMAP_LINEAR,9985:P.default.S_FILTERS.S_LINEAR_MIPMAP_NEAREST,9984:P.default.S_FILTERS.S_NEAREST_MIPMAP_NEAREST}),L(D,"WRAPS",{10497:P.default.S_WRAPS.S_REPEAT,33071:P.default.S_WRAPS.S_CLAMP_TO_EDGE})},8236:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=h(n(2949)),_=h(n(8113)),a=h(n(4008)),i=h(n(307)),o=h(n(4720)),u=h(n(5397)),s=h(n(3846)),l=h(n(2462)),f=h(n(1759)),m=h(n(7141)),c=h(n(5141));function h(e){return e&&e.__esModule?e:{default:e}}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function S(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var p=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),S(this,"_m_CustomMatDef","BasicLightingDef"),S(this,"_m_AlphaMode",e.S_ALPHA_MODE_BLEND)}var t,n,h;return t=e,(n=[{key:"load",value:function(e,t,n,_){this._m_Scene=e,this._m_DefaultMatDef=null,this._m_Mats={},this._m_CurrentMat=null;var a=new r.default(e,{id:t||u.default.nextId()});this._load(a,n,_)}},{key:"config",value:function(e){this._m_AlphaMode=e.alphaMode||this._m_AlphaMode}},{key:"setAssetsPath",value:function(e,t){this._m_AssetsPath=e,t&&(this._m_CustomMatDef=t)}},{key:"_load",value:function(e,t,n){var r=this;this.loadOBJ(e,t,(function(t){r._m_DefaultMatDef||(r._m_DefaultMatDef=_.default.load(r._m_AssetsPath+r._m_CustomMatDef)),r.loadMTLs(e,t,(function(){r.createMeshes(e,t),n&&n(e)}))}))}},{key:"loadOBJ",value:function(e,t,n){var r=this;this.loadFile(t,(function(_){var a=r.parseOBJ(e,_,t);n(a)}),(function(e){s.default.error(e)}))}},{key:"parseOBJ",value:function(e,t,n){var r={vertex_pattern:/^v\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,normal_pattern:/^vn\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,uv_pattern:/^vt\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,face_vertex:/^f\s+(-?\d+)\s+(-?\d+)\s+(-?\d+)(?:\s+(-?\d+))?/,face_vertex_uv:/^f\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+))?/,face_vertex_uv_normal:/^f\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+)\/(-?\d+))?/,face_vertex_normal:/^f\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)(?:\s+(-?\d+)\/\/(-?\d+))?/,object_pattern:/^[og]\s*(.+)?/,smoothing_pattern:/^s\s+(\d+|on|off)/,material_library_pattern:/^mtllib /,material_use_pattern:/^usemtl /},_={src:n=n||"",basePath:this.getBasePath(n),objects:[],object:{},positions:[],normals:[],uv:[],materialLibraries:{}};this.startObject(_,"",!1),-1!==t.indexOf("\r\n")&&(t=t.replace("\r\n","\n"));for(var a=t.split("\n"),i="",o="",u="",l=[],f="function"==typeof"".trimLeft,m=0,c=a.length;m<c;m++)if(i=a[m],0!==(i=f?i.trimLeft():i.trim()).length&&"#"!==(o=i.charAt(0)))if("v"===o)if(" "===(u=i.charAt(1))&&null!==(l=r.vertex_pattern.exec(i)))_.positions.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3]));else if("n"===u&&null!==(l=r.normal_pattern.exec(i)))_.normals.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3]));else{if("t"!==u||null===(l=r.uv_pattern.exec(i)))return void s.default.error("Unexpected vertex/normal/uv line: '"+i+"'");_.uv.push(parseFloat(l[1]),parseFloat(l[2]))}else if("f"===o)if(null!==(l=r.face_vertex_uv_normal.exec(i)))this.addFace(_,l[1],l[4],l[7],l[10],l[2],l[5],l[8],l[11],l[3],l[6],l[9],l[12]);else if(null!==(l=r.face_vertex_uv.exec(i)))this.addFace(_,l[1],l[3],l[5],l[7],l[2],l[4],l[6],l[8]);else if(null!==(l=r.face_vertex_normal.exec(i)))this.addFace(_,l[1],l[3],l[5],l[7],void 0,void 0,void 0,void 0,l[2],l[4],l[6],l[8]);else{if(null===(l=r.face_vertex.exec(i)))return void s.default.error("Unexpected face line: '"+i+"'");this.addFace(_,l[1],l[2],l[3],l[4])}else if("l"===o){var h=i.substring(1).trim().split(" "),d=[],S=[];if(-1===i.indexOf("/"))d=h;else for(var p=0,g=h.length;p<g;p++){var y=h[p].split("/");""!==y[0]&&d.push(y[0]),""!==y[1]&&S.push(y[1])}this.addLineGeometry(_,d,S)}else if(null!==(l=r.object_pattern.exec(i))){var v=l[0].substr(1).trim();this.startObject(_,v,!0)}else if(r.material_use_pattern.test(i)){var T=i.substring(7).trim();_.object.material.id=T}else if(r.material_library_pattern.test(i))_.materialLibraries[i.substring(7).trim()]=!0;else{if(null===(l=r.smoothing_pattern.exec(i))){if("\0"===i)continue;return void s.default.error("Unexpected line: '"+i+"'")}var E=l[1].trim().toLowerCase();_.object.material.smooth="1"===E||"on"===E}return _}},{key:"getBasePath",value:function(e){var t=e.lastIndexOf("/");return-1===t?e:e.substring(0,t+1)}},{key:"startObject",value:function(e,t,n){if(e.object&&!1===e.object.fromDeclaration)return e.object.id=t,void(e.object.fromDeclaration=!1!==n);e.object={id:t||"",geometry:{positions:[],normals:[],uv:[]},material:{id:"",smooth:!0},fromDeclaration:!1!==n},e.objects.push(e.object)}},{key:"parseVertexIndex",value:function(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)}},{key:"parseNormalIndex",value:function(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)}},{key:"parseUVIndex",value:function(e,t){var n=parseInt(e,10);return 2*(n>=0?n-1:n+t/2)}},{key:"addVertex",value:function(e,t,n,r){var _=e.positions,a=e.object.geometry.positions;a.push(_[t+0]),a.push(_[t+1]),a.push(_[t+2]),a.push(_[n+0]),a.push(_[n+1]),a.push(_[n+2]),a.push(_[r+0]),a.push(_[r+1]),a.push(_[r+2])}},{key:"addVertexLine",value:function(e,t){var n=e.positions,r=e.object.geometry.positions;r.push(n[t+0]),r.push(n[t+1]),r.push(n[t+2])}},{key:"addNormal",value:function(e,t,n,r){var _=e.normals,a=e.object.geometry.normals;a.push(_[t+0]),a.push(_[t+1]),a.push(_[t+2]),a.push(_[n+0]),a.push(_[n+1]),a.push(_[n+2]),a.push(_[r+0]),a.push(_[r+1]),a.push(_[r+2])}},{key:"addUV",value:function(e,t,n,r){var _=e.uv,a=e.object.geometry.uv;a.push(_[t+0]),a.push(_[t+1]),a.push(_[n+0]),a.push(_[n+1]),a.push(_[r+0]),a.push(_[r+1])}},{key:"addUVLine",value:function(e,t){var n=e.uv,r=e.object.geometry.uv;r.push(n[t+0]),r.push(n[t+1])}},{key:"addFace",value:function(e,t,n,r,_,a,i,o,u,s,l,f,m){var c,h=e.positions.length,d=this.parseVertexIndex(t,h),S=this.parseVertexIndex(n,h),p=this.parseVertexIndex(r,h);if(void 0===_?this.addVertex(e,d,S,p):(c=this.parseVertexIndex(_,h),this.addVertex(e,d,S,c),this.addVertex(e,S,p,c)),void 0!==a){var g=e.uv.length;d=this.parseUVIndex(a,g),S=this.parseUVIndex(i,g),p=this.parseUVIndex(o,g),void 0===_?this.addUV(e,d,S,p):(c=this.parseUVIndex(u,g),this.addUV(e,d,S,c),this.addUV(e,S,p,c))}if(void 0!==s){var y=e.normals.length;d=this.parseNormalIndex(s,y),S=s===l?d:this.parseNormalIndex(l,y),p=s===f?d:this.parseNormalIndex(f,y),void 0===_?this.addNormal(e,d,S,p):(c=this.parseNormalIndex(m,y),this.addNormal(e,d,S,c),this.addNormal(e,S,p,c))}}},{key:"addLineGeometry",value:function(e,t,n){e.object.geometry.type="Line";for(var r=e.positions.length,_=e.uv.length,a=0,i=t.length;a<i;a++)this.addVertexLine(e,this.parseVertexIndex(t[a],r));for(var o=0,u=n.length;o<u;o++)this.addUVLine(e,this.parseUVIndex(n[o],_))}},{key:"loadMTLs",value:function(e,t,n){for(var r=t.basePath,_=Object.keys(t.materialLibraries),a=_.length,i=0,o=a;i<o;i++)this.loadMTL(e,r,r+_[i],(function(){0==--a&&n()}))}},{key:"loadMTL",value:function(e,t,n,r){var _=this;this.loadFile(n,(function(n){_.parseMTL(e,n,t),r()}),(function(e){s.default.error(e),r()}))}},{key:"createTexture",value:function(e,t,n,r){var _={},a=n.split(/\s+/),i=a.indexOf("-bm");i>=0&&a.splice(i,2),(i=a.indexOf("-s"))>=0&&(_.scale=[parseFloat(a[i+1]),parseFloat(a[i+2])],a.splice(i,4)),(i=a.indexOf("-o"))>=0&&(_.translate=[parseFloat(a[i+1]),parseFloat(a[i+2])],a.splice(i,4)),_.src=t+a.join(" ").trim(),_.flipY=!0,_.encoding=r||"linear";var o=new c.default(this._m_Scene);return"sRGB"==_.encoding&&o.setTextureFormat(c.default.S_TEXTURE_FORMAT.S_SRGBA,c.default.S_TEXTURE_FORMAT.S_RGBA,c.default.S_TEXTURE_FORMAT.S_UNSIGNED_BYTE),o.setPreloadColor(this._m_Scene,new m.default(.2,.2,.2,1)),o.setImageSrc(this._m_Scene,_.src),o.setFlipY(!0),o}},{key:"createMaterial",value:function(e,t){if(this._m_DefaultMatDef&&!this._m_Mats[t.id]){var n=new a.default(this._m_Scene,{id:t.id,materialDef:this._m_DefaultMatDef});this._m_Mats[t.id]=n,this._m_CurrentMat=n,this._m_CurrentMat.setParam("diffuseColor",(new l.default).valueFromXYZW(.5,.5,.5,1)),this._m_CurrentMat.setParam("ambientColor",(new l.default).valueFromXYZW(.2,.2,.2,1)),this._m_CurrentMat.setParam("specularColor",(new l.default).valueFromXYZW(1,1,1,1)),this._m_CurrentMat.setParam("shininess",(new f.default).valueOf(32))}}},{key:"parseRGB",value:function(e){var t=e.split(/\s+/,3);return[parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2])]}},{key:"parseMTL",value:function(t,n,r){var _,a,i,o,u,s=n.split("\n"),m={id:"Default"};r=r||"";for(var c=0;c<s.length;c++)if(0!==(_=s[c].trim()).length&&"#"!==_.charAt(0))switch(i=(i=(a=_.indexOf(" "))>=0?_.substring(0,a):_).toLowerCase(),o=(o=a>=0?_.substring(a+1):"").trim(),i.toLowerCase()){case"newmtl":m={id:o},this.createMaterial(t,m);break;case"ka":m.ambient=this.parseRGB(o),this._m_CurrentMat.setParam("ambientColor",(new l.default).valueFromXYZW(m.ambient[0],m.ambient[1],m.ambient[2],1));break;case"kd":m.diffuse=this.parseRGB(o),this._m_CurrentMat.setParam("diffuseColor",(new l.default).valueFromXYZW(m.diffuse[0],m.diffuse[1],m.diffuse[2],1));break;case"ks":m.specular=this.parseRGB(o),this._m_CurrentMat.setParam("specularColor",(new l.default).valueFromXYZW(m.specular[0],m.specular[1],m.specular[2],1));break;case"map_kd":m.diffuseMap||(m.diffuseMap=this.createTexture(t,r,o,"sRGB"),this._m_CurrentMat.setParam("diffuseMap",m.diffuseMap));break;case"map_ks":m.specularMap||(m.specularMap=this.createTexture(t,r,o,"linear"),this._m_CurrentMat.setParam("specularMap",m.specularMap));break;case"map_bump":case"bump":m.normalMap||(m.normalMap=this.createTexture(t,r,o),this._m_CurrentMat.setParam("normalMap",m.normalMap));break;case"ns":m.shininess=parseFloat(o),this._m_CurrentMat.setParam("shininess",(new f.default).valueOf(m.shininess));break;case"d":(u=parseFloat(o))<=.1&&(this._m_AlphaMode==e.S_ALPHA_MODE_BLEND?this._m_CurrentMat.alphaMode="blend":this._m_AlphaMode==e.S_ALPHA_MODE_DISCARD&&this._m_CurrentMat.setParam("alphaDiscard",(new f.default).valueOf(u))),u<1&&(m.alpha=u,this._m_AlphaMode==e.S_ALPHA_MODE_BLEND&&(m.alphaMode="blend"));break;case"tr":(u=parseFloat(o))<=.1&&(this._m_AlphaMode==e.S_ALPHA_MODE_BLEND?this._m_CurrentMat.alphaMode="blend":this._m_AlphaMode==e.S_ALPHA_MODE_DISCARD&&this._m_CurrentMat.setParam("alphaDiscard",(new f.default).valueOf(1-u))),u>0&&(m.alpha=1-u,this._m_AlphaMode==e.S_ALPHA_MODE_BLEND&&(m.alphaMode="blend"))}}},{key:"createMeshes",value:function(e,t){s.default.debug("state.objects.length:"+t.objects.length);for(var n={},r=0,_=0,l=t.objects.length;_<l;_++){var f=t.objects[_],m=f.geometry,c=(m.type,f.material.id),h=void 0,d=null;if(0!==m.positions.length)if(n[c])!function(){for(var e=n[c].mesh,t=n[c].unitType,r=e.getData(i.default.S_POSITIONS),_=new Array(m.positions.length/3),a=0,o=r.length/3;a<_.length;a++)_[a]=a+o;if(r&&m.positions.forEach((function(e){r.push(e)})),e.setData(i.default.S_POSITIONS,r),m.normals.length>0){var u=e.getData(i.default.S_NORMALS);u&&m.normals.forEach((function(e){u.push(e)})),e.setData(i.default.S_NORMALS,u)}if(m.uv.length>0){var s=e.getData(i.default.S_UV0);s&&m.uv.forEach((function(e){s.push(e)})),e.setData(i.default.S_UV0,s)}var l=e.getData(t);l&&_.forEach((function(e){l.push(e)})),e.setData(t,l)}();else{r++;var S=new Array(m.positions.length/3);d=S.length>65534?i.default.S_INDICES_32:i.default.S_INDICES;for(var p=0;p<S.length;p++)S[p]=p;var g=new i.default;if(g.setData(i.default.S_POSITIONS,m.positions),m.normals.length>0&&g.setData(i.default.S_NORMALS,m.normals),m.uv.length>0&&g.setData(i.default.S_UV0,m.uv),g.setData(d,S),c&&""!==c)(h=this._m_Mats[c])||s.default.error("Material not found: "+c);else if(this._m_DefaultMatDef){if(!this._m_Mats.Default){var y=new a.default(this._m_Scene,{id:"Default",materialDef:this._m_DefaultMatDef});this._m_Mats.Default=y}h=this._m_Mats.Default}n[c]={mesh:g,material:h,unitType:d}}}if(r)for(var v in s.default.debug("实体数量:"+r),n){var T=n[v].material,E=n[v].unitType,b=n[v].mesh;if(b.getData(i.default.S_UV0)){var C=u.default.generatorTangents2(b.getData(E),b.getData(i.default.S_POSITIONS),b.getData(i.default.S_UV0),b.getData(i.default.S_NORMALS));b.setData(i.default.S_TANGENTS,C)}else{var P=u.default.generatorFillTangents2(b.getData(i.default.S_POSITIONS));b.setData(i.default.S_TANGENTS,P)}var R=new o.default(e,{id:"Geo_"+v});R.setMesh(b),R.setMaterial(T),R.updateBound(),T.alphaMode&&R.setTranslucent(),e.addChildren(R)}}},{key:"loadFile",value:function(e,t,n){var r=new XMLHttpRequest;r.open("GET",e,!0),r.addEventListener("load",(function(e){var _=e.target.response;200===r.status?t&&t(_):0===r.status?(s.default.warn("loadFile: HTTP Status 0 received."),t&&t(_)):n&&n(e)}),!1),r.addEventListener("error",(function(e){n&&n(e)}),!1),r.send(null)}}])&&d(t.prototype,n),h&&d(t,h),e}();t.default=p,S(p,"S_ALPHA_MODE_BLEND","blend"),S(p,"S_ALPHA_MODE_DISCARD","discard")},6797:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,_=(r=n(3319))&&r.__esModule?r:{default:r};function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,r=[{key:"rgbeImg",value:function(){return(new _.default).HDRImage()}}],(n=[{key:"loadHDR",value:function(t,n){var r=e.rgbeImg();r.onload=function(){n(r)},r.src=t}}])&&a(t.prototype,n),r&&a(t,r),e}();t.default=i},3319:(t,n)=>{function r(){var e,t,n=document.createElement("canvas"),r="t",s=1,l=2.2,f=null;return n.__defineGetter__("exposure",(function(){return s})),n.__defineSetter__("exposure",(function(n){s=n,f&&(u(f,s,l,t.data),e.putImageData(t,0,0))})),n.__defineGetter__("gamma",(function(){return l})),n.__defineSetter__("gamma",(function(n){l=n,f&&(u(f,s,l,t.data),e.putImageData(t,0,0))})),n.__defineGetter__("dataFloat",(function(){return o(f)})),n.__defineGetter__("dataRGBE",(function(){return f})),n.toHDRBlob=function(e,t,n){function r(e,t,n){var r=e.createShader(n);return e.shaderSource(r,t),e.compileShader(r),r}var a=t&&t.match(/rgb9_e5/i)?new Uint8Array(_(o(f)).buffer):new Uint8Array(f.buffer),i=this.width,u=this.height;if(i*u*4<a.byteLength)return console.error("not big enough.");var s=document.createElement("canvas");s.width=i,s.height=u;var l=s.getContext("webgl",{antialias:!1,alpha:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!0}),m=l.createTexture();l.activeTexture(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,m),l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,!0),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texImage2D(l.TEXTURE_2D,0,l.RGBA,i,u,0,l.RGBA,l.UNSIGNED_BYTE,new Uint8Array(a.buffer));var c=function(e,t,n){var _,a,i=e.createProgram();return e.attachShader(i,_=r(e,t,e.VERTEX_SHADER)),e.attachShader(i,a=r(e,n,e.FRAGMENT_SHADER)),e.linkProgram(i),e.deleteShader(_),e.deleteShader(a),i}(l,"precision highp float;\nattribute vec3 position;\nvarying vec2 tex;\nvoid main() { tex = position.xy/2.0+0.5; gl_Position = vec4(position, 1.0); }","precision highp float;\nprecision highp sampler2D;\nuniform sampler2D tx;\nvarying vec2 tex;\nvoid main() { gl_FragColor = texture2D(tx,tex); }"),h=l.getUniformLocation(c,"tx"),d=new Float32Array([-1,-1,0,1,-1,0,1,1,0,1,1,0,-1,1,0,-1,-1,0]),S=l.createBuffer();return l.enableVertexAttribArray(0),l.bindBuffer(l.ARRAY_BUFFER,S),l.bufferData(l.ARRAY_BUFFER,d,l.STATIC_DRAW),l.vertexAttribPointer(0,3,l.FLOAT,!1,0,0),l.useProgram(c),l.uniform1i(h,0),l.drawArrays(l.TRIANGLES,0,6),l.deleteTexture(m),l.deleteProgram(c),e?s.toBlob(e):void 0},n.__defineGetter__("src",(function(){return r})),n.__defineSetter__("src",(function(_){if(r=_,e&&e.clearRect(0,0,this.width,this.height),_.match(/\.hdr$/i))m=_,c=function(n,r,_){f=n,this.width=this.style.width=r,this.height=this.style.height=_,e=this.getContext("2d"),t=e.getImageData(0,0,r,_),u(n,s,l,t.data),e.putImageData(t,0,0),this.onload&&this.onload()}.bind(n),h=function(e,t){for(var n in t)e[n]=t[n];return e}(new XMLHttpRequest,{responseType:"arraybuffer"}),h.onerror=c.bind(h,!1),h.onload=function(){if(this.status>=400)return this.onerror();for(var e,t="",n=0,r=new Uint8Array(this.response);!t.match(/\n\n[^\n]+\n/g);)t+=String.fromCharCode(r[n++]);if("32-bit_rle_rgbe"!=(e=t.match(/FORMAT=(.*)$/m)[1]))return console.warn("unknown format : "+e),this.onerror();for(var _=t.split(/\n/).reverse()[1].split(" "),a=1*_[3],i=1*_[1],o=new Uint8Array(a*i*4),u=0,s=0;s<i;s++){var l=r.slice(n,n+=4),f=[];if(2!=l[0]||2!=l[1]||128&l[2]){var m=a;for(n-=4;m>0;)if(o.set(r.slice(n,n+=4),u),1==o[u]&&1==o[u+1]&&1==o[u+2])for(o[u+3];h>0;h--)o.set(o.slice(u-4,u),u),u+=4,m--;else m--,u+=4}else{if((l[2]<<8)+l[3]!=a)return console.warn("HDR line mismatch .."),this.onerror();for(var h=0;h<4;h++)for(var d,S,p=h*a,g=(h+1)*a;p<g;)if((d=r.slice(n,n+=2))[0]>128)for(S=d[0]-128;S-- >0;)f[p++]=d[1];else for(S=d[0]-1,f[p++]=d[1];S-- >0;)f[p++]=r[n++];for(h=0;h<a;h++)o[u++]=f[h],o[u++]=f[h+a],o[u++]=f[h+2*a],o[u++]=f[h+3*a]}}c&&c(o,a,i)},h.open("GET",m,!0),h.send(null);else if(_.match(/\.rgb9_e5\.png$/i)){(o=new Image).src=_,o.onload=function(){var n=document.createElement("canvas"),r=this.width=this.style.width=n.width=o.width,_=this.height=this.style.height=n.height=o.height,m=n.getContext("webgl"),c=m.createTexture();m.bindTexture(m.TEXTURE_2D,c),m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,o),fb=m.createFramebuffer(),m.bindFramebuffer(m.FRAMEBUFFER,fb),m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_2D,c,0);var h=new Uint8Array(r*_*4);m.readPixels(0,0,r,_,m.RGBA,m.UNSIGNED_BYTE,h),m.deleteTexture(c),m.deleteFramebuffer(fb),this.dataRAW=new Uint32Array(h.buffer),f=i(a(this.dataRAW)),e=this.getContext("2d"),t=e.getImageData(0,0,r,_),u(f,s,l,t.data),e.putImageData(t,0,0),this.onload&&this.onload()}.bind(n)}else if(_.match(/\.hdr\.png$|\.rgbe\.png/i)){var o;(o=new Image).src=_,o.onload=function(){var n=document.createElement("canvas"),r=this.width=this.style.width=n.width=o.width,_=this.height=this.style.height=n.height=o.height,a=n.getContext("webgl"),i=a.createTexture();a.bindTexture(a.TEXTURE_2D,i),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,o),fb=a.createFramebuffer(),a.bindFramebuffer(a.FRAMEBUFFER,fb),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,i,0);var m=new Uint8Array(r*_*4);a.readPixels(0,0,r,_,a.RGBA,a.UNSIGNED_BYTE,m),a.deleteTexture(i),a.deleteFramebuffer(fb),f=m,e=this.getContext("2d"),t=e.getImageData(0,0,r,_),u(f,s,l,t.data),e.putImageData(t,0,0),this.onload&&this.onload()}.bind(n)}var m,c,h})),n}function _(e,t){for(var n,r,_,a,i,o,u=e.byteLength/12|0,s=(t=t||new Uint32Array(u),0);s<u;s++)n=Math.min(32768,e[3*s]),r=Math.min(32768,e[3*s+1]),_=Math.min(32768,e[3*s+2]),a=Math.max(Math.max(n,r),_),i=Math.max(-16,Math.floor(Math.log2(a)))+16,o=Math.pow(2,i-24),511==Math.floor(a/o+.5)&&(o*=2,i+=1),t[s]=(Math.floor(n/o+.5)<<23)+(Math.floor(r/o+.5)<<14)+(Math.floor(_/o+.5)<<5)+(0|i);return t}function a(e,t){for(var n,r,_=e.byteLength>>2,a=(t=t||new Float32Array(3*_),0);a<_;a++)n=e[a],r=Math.pow(2,(31&n)-24),t[3*a]=(n>>>23)*r,t[3*a+1]=(n>>>14&511)*r,t[3*a+2]=(n>>>5&511)*r;return t}function i(t,n){for(var r,_,a,i,o,u=t.byteLength/12|0,s=(n=n||new Uint8Array(4*u),0);s<u;s++)r=t[3*s],_=t[3*s+1],a=t[3*s+2],i=Math.max(Math.max(r,_),a),e=Math.ceil(Math.log2(i)),o=Math.pow(2,e-8),n[4*s]=r/o|0,n[4*s+1]=_/o|0,n[4*s+2]=a/o|0,n[4*s+3]=e+128;return n}function o(e,t){for(var n,r=e.byteLength>>2,_=(t=t||new Float32Array(3*r),0);_<r;_++)n=Math.pow(2,e[4*_+3]-136),t[3*_]=e[4*_]*n,t[3*_+1]=e[4*_+1]*n,t[3*_+2]=e[4*_+2]*n;return t}function u(e,t,n,r){t=Math.pow(2,void 0===t?1:t)/2,void 0===n&&(n=2.2);for(var _,a=1/n,i=e.byteLength>>2,o=(r=r||new Uint8ClampedArray(4*i),0);o<i;o++)_=t*Math.pow(2,e[4*o+3]-136),r[4*o]=255*Math.pow(e[4*o]*_,a),r[4*o+1]=255*Math.pow(e[4*o+1]*_,a),r[4*o+2]=255*Math.pow(e[4*o+2]*_,a),r[4*o+3]=255;return r}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0,r.floatToRgbe=i,r.rgbeToFloat=o,r.floatToRgb9_e5=_,r.rgb9_e5ToFloat=a,r.rgbeToLDR=u,r.floatToLDR=function(e,t,n,r){t=Math.pow(2,void 0===t?1:t)/2,void 0===n&&(n=2.2);for(var _=1/n,a=e.byteLength/12|0,i=(r=r||new Uint8ClampedArray(4*a),0);i<a;i++)r[4*i]=255*Math.pow(e[3*i]*t,_),r[4*i+1]=255*Math.pow(e[3*i+1]*t,_),r[4*i+2]=255*Math.pow(e[3*i+2]*t,_),r[4*i+3]=255;return r};n.default=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.HDRImage=r}}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](n,n.exports,__webpack_require__),n.exports}var __webpack_exports__={};return(()=>{var e=__webpack_exports__;e.default=void 0;var t=ft(__webpack_require__(4939)),n=ft(__webpack_require__(9586)),r=ft(__webpack_require__(1648)),_=ft(__webpack_require__(479)),a=ft(__webpack_require__(4755)),i=ft(__webpack_require__(6858)),o=ft(__webpack_require__(1608)),u=ft(__webpack_require__(8649)),s=ft(__webpack_require__(1245)),l=ft(__webpack_require__(7938)),f=ft(__webpack_require__(6458)),m=ft(__webpack_require__(7868)),c=ft(__webpack_require__(8081)),h=ft(__webpack_require__(6454)),d=ft(__webpack_require__(2414)),S=ft(__webpack_require__(5109)),p=ft(__webpack_require__(7120)),g=ft(__webpack_require__(6984)),y=ft(__webpack_require__(8878)),v=ft(__webpack_require__(4165)),T=ft(__webpack_require__(2028)),E=ft(__webpack_require__(7539)),b=ft(__webpack_require__(2815)),C=ft(__webpack_require__(513)),P=ft(__webpack_require__(6807)),R=ft(__webpack_require__(6967)),M=ft(__webpack_require__(3330)),A=ft(__webpack_require__(9098)),w=ft(__webpack_require__(4008)),I=ft(__webpack_require__(8113)),L=ft(__webpack_require__(5449)),D=ft(__webpack_require__(2603)),O=ft(__webpack_require__(4974)),F=ft(__webpack_require__(7057)),x=ft(__webpack_require__(2768)),k=ft(__webpack_require__(8173)),N=ft(__webpack_require__(3801)),B=ft(__webpack_require__(1846)),V=ft(__webpack_require__(1322)),G=ft(__webpack_require__(2320)),U=ft(__webpack_require__(431)),H=ft(__webpack_require__(7088)),X=ft(__webpack_require__(453)),Y=ft(__webpack_require__(9271)),j=ft(__webpack_require__(5604)),W=ft(__webpack_require__(7141)),Z=ft(__webpack_require__(2949)),q=ft(__webpack_require__(5765)),z=ft(__webpack_require__(1645)),K=ft(__webpack_require__(6341)),J=ft(__webpack_require__(9468)),Q=ft(__webpack_require__(5776)),$=ft(__webpack_require__(4720)),ee=ft(__webpack_require__(7280)),te=ft(__webpack_require__(2482)),ne=ft(__webpack_require__(9011)),re=ft(__webpack_require__(9369)),_e=ft(__webpack_require__(512)),ae=ft(__webpack_require__(6528)),ie=ft(__webpack_require__(870)),oe=ft(__webpack_require__(5734)),ue=ft(__webpack_require__(9526)),se=ft(__webpack_require__(6987)),le=ft(__webpack_require__(1393)),fe=ft(__webpack_require__(8388)),me=ft(__webpack_require__(4658)),ce=ft(__webpack_require__(8546)),he=ft(__webpack_require__(6148)),de=ft(__webpack_require__(2987)),Se=ft(__webpack_require__(2390)),pe=ft(__webpack_require__(7664)),ge=ft(__webpack_require__(3370)),ye=ft(__webpack_require__(3061)),ve=ft(__webpack_require__(9510)),Te=ft(__webpack_require__(1550)),Ee=ft(__webpack_require__(5602)),be=ft(__webpack_require__(6177)),Ce=ft(__webpack_require__(4867)),Pe=ft(__webpack_require__(1266)),Re=ft(__webpack_require__(8578)),Me=ft(__webpack_require__(948)),Ae=ft(__webpack_require__(1193)),we=ft(__webpack_require__(66)),Ie=ft(__webpack_require__(3846)),Le=ft(__webpack_require__(8583)),De=ft(__webpack_require__(5247)),Oe=ft(__webpack_require__(5489)),Fe=ft(__webpack_require__(2475)),xe=ft(__webpack_require__(5397)),ke=ft(__webpack_require__(1491)),Ne=ft(__webpack_require__(1759)),Be=ft(__webpack_require__(1359)),Ve=ft(__webpack_require__(5141)),Ge=ft(__webpack_require__(4048)),Ue=ft(__webpack_require__(3552)),He=ft(__webpack_require__(4690)),Xe=ft(__webpack_require__(2462)),Ye=ft(__webpack_require__(6693)),je=__webpack_require__(7902),We=ft(__webpack_require__(7341)),Ze=ft(__webpack_require__(6798)),qe=ft(__webpack_require__(307)),ze=ft(__webpack_require__(8435)),Ke=ft(__webpack_require__(6616)),Je=ft(__webpack_require__(9836)),Qe=ft(__webpack_require__(9784)),$e=ft(__webpack_require__(2228)),et=ft(__webpack_require__(2584)),tt=ft(__webpack_require__(1446)),nt=ft(__webpack_require__(6140)),rt=ft(__webpack_require__(9650)),_t=ft(__webpack_require__(8636)),at=ft(__webpack_require__(1797)),it=ft(__webpack_require__(4620)),ot=ft(__webpack_require__(8236)),ut=ft(__webpack_require__(6797)),st=ft(__webpack_require__(3319)),lt=ft(__webpack_require__(7698));function ft(e){return e&&e.__esModule?e:{default:e}}var mt={Scene:t.default,Bone:n.default,AnimationProcessor:r.default,AnimationAction:_.default,ActionClip:a.default,SkinGeometry:i.default,Skeleton:o.default,Joint:u.default,TrackBinding:s.default,TrackMixer:l.default,AnimKeyframe:f.default,AnimKeyframeEnum:m.default,QuaternionKeyframe:c.default,Vector3Keyframe:h.default,Vector4Keyframe:d.default,Canvas:S.default,Filter:p.default,CameraIps:g.default,FirstPersonController:y.default,Input:v.default,SceneBrowsingController:T.default,DirectionalLight:E.default,GIProbe:b.default,Light:C.default,PointLight:P.default,Probe:R.default,RefProbe:M.default,SpotLight:A.default,Material:w.default,MaterialDef:I.default,SubPass:L.default,SubShader:D.default,SubShaderDef:O.default,SubShaderSource:F.default,Technology:x.default,TechnologyDef:k.default,AABBBoundingBox:N.default,BoundingSphere:B.default,BoundingVolume:V.default,Matrix44:G.default,MoreMath:U.default,Plane:H.default,Quaternion:X.default,Vector2:Y.default,Vector3:j.default,Vector4:W.default,Box:q.default,GroupPlane:z.default,Grid:lt.default,Sphere:K.default,SkyBox:J.default,FramePicture:Q.default,Geometry:$.default,Node:Z.default,Picture:ee.default,LodControl:te.default,OctCullingControl:ne.default,OctNode:re.default,Base:_e.default,Clustered:ae.default,Deferred:ie.default,Forward:oe.default,ForwardPlus:ue.default,TileDeferred:se.default,DefaultRenderProgram:le.default,MultiPassIBLLightingRenderProgram:fe.default,MultiPassLightingRenderProgram:me.default,SinglePassIBLLightingRenderProgram:ce.default,SinglePassLightingRenderProgram:he.default,TilePassIBLLightingRenderProgram:de.default,TilePassLightingRenderProgram:Se.default,IDrawable:pe.default,Internal:ge.default,Render:ye.default,RenderQueue:ve.default,Camera:Te.default,BasicShadowProcess:Ee.default,DirectionalLightShadowProcess:be.default,PointLightShadowProcess:Ce.default,Shadow:Pe.default,SplitOccluders:Re.default,SpotLightShadowProcess:Me.default,AssetLoader:Ae.default,Events:we.default,Log:Ie.default,MeshFactor:Le.default,ProbeTools:De.default,Queue:Oe.default,TempVars:Fe.default,Tools:xe.default,BoolVars:ke.default,FloatVars:Ne.default,Texture2DTargetVars:Be.default,Texture2DVars:Ve.default,TextureCubeVars:Ge.default,Vars:Ue.default,Vec2Vars:He.default,Vec4Vars:Xe.default,ArrayBuf:Ye.default,Buffer:je.Buffer,FrameBuffer:We.default,FrameContext:Ze.default,Mesh:qe.default,RenderState:ze.default,Shader:Ke.default,ShaderProgram:Je.default,ShaderSource:Qe.default,SizeOf:$e.default,Texture:et.default,UniformBuffer:tt.default,UniformBufferI:nt.default,Component:rt.default,Globals:_t.default,RenderEngine:at.default,GLTFLoader:it.default,OBJLoader:ot.default,RadianceLoader:ut.default,hdrpng:st.default};e.default=mt})(),__webpack_exports__=__webpack_exports__.default,__webpack_exports__})()}));